var e=Object.prototype.hasOwnProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.propertyIsEnumerable,n=Object.assign,r=(n,r)=>{var l={};for(var o in n)e.call(n,o)&&r.indexOf(o)<0&&(l[o]=n[o]);if(null!=n&&t)for(var o of t(n))r.indexOf(o)<0&&a.call(n,o)&&(l[o]=n[o]);return l};import{v as l,n as o,l as d,d as s,i as c,a as i,r as u,c as v,w as m,b as f,e as p,f as h,g as y,o as g,h as x,j as b,k as w,m as k,p as S,q as M,s as A,t as B,u as I,x as C,y as E,z as O,A as $,B as j,C as D,F,D as T,E as L,G as N,H as P,I as z,J as _,K as W,L as U,M as V,N as G}from"./vendor.6dea0f0f.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(a){const n=new URL(e,location),r=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((a,l)=>{const o=new URL(e,n);if(self[t].moduleMap[o])return a(self[t].moduleMap[o]);const d=new Blob([`import * as m from '${o}';`,`${t}.moduleMap['${o}']=m;`],{type:"text/javascript"}),s=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(d),onerror(){l(new Error(`Failed to import: ${e}`)),r(s)},onload(){a(self[t].moduleMap[o]),r(s)}});document.head.appendChild(s)})),self[t].moduleMap={}}}("/blendic-svg/assets/");function K(e){return[`translate(${e.translate.x},${e.translate.y})`,`rotate(${e.rotate})`,`scale(${e.scale.x},${e.scale.y})`].join(" ")}function H(e,t=!1){if(0===e.length)return"";const[a,...n]=e;return`M${a.x},${a.y}`+n.map((e=>`L${e.x},${e.y}`)).join("")+(t?"z":"")}function R(e){return`${e.x} ${e.y} ${e.width} ${e.height}`}const q=/\.[0-9]{3,}$/;function X(e){return q.test(e)?e.replace(q,(e=>"."+`${parseInt(e.slice(1),10)+1}`.padStart(3,"0"))):`${e}.001`}function Y(e,t){const a=new Map(t.map((e=>[e,!0])));let n=X(e);for(;a.has(n);)n=X(n);return n}function J(e={}){return n({translate:{x:0,y:0},origin:{x:0,y:0},rotate:0,scale:{x:1,y:1}},e)}function Q(e={},t=!1){return n({id:t?l():"",name:"",transform:J(),parentId:"",connected:!1,head:{x:0,y:0},tail:{x:0,y:0}},e)}function Z(e={},t=!1){return n({id:t?l():"",name:"",transform:J(),borns:[]},e)}function ee(e){return e.reduce(((e,t)=>n(n({},e),{[t.id]:t})),{})}function te(e,t){return Object.keys(n(n({},e),t)).reduce(((a,r)=>{var l,o;return a[r]=n(n({},null!=(l=e[r])?l:{}),null!=(o=t[r])?o:{}),a}),{})}function ae(e,t){return Object.keys(t).reduce(((t,a)=>(t[a]=e[a],t)),{})}function ne(e){return!!e&&(!!e.head||!!e.tail)}function re(e){return e.reduce(((e,t)=>{return n=t,J({scale:{x:(a=e).scale.x*n.scale.x,y:a.scale.y*n.scale.y},rotate:a.rotate+n.rotate,translate:o(a.translate,n.translate)});var a,n}),J())}function le(e,t){return o(s(function(e,t,a={x:0,y:0}){return{x:a.x+(e.x-a.x)*t.x,y:a.y+(e.y-a.y)*t.y}}(e,t.scale,t.origin),t.rotate/180*Math.PI,t.origin),t.translate)}function oe(e,t,a){const r=a.head?le(e.head,t):e.head,l=a.tail?le(e.tail,t):e.tail;return n(n({},e),{head:r,tail:l})}function de(e,t){const a=re(t),r=le(e.head,J({translate:a.translate})),l=le(e.tail,J(n(n({},a),{origin:e.head})));return n(n({},e),{head:r,tail:l,transform:J()})}function se(e,t){return e.find((e=>e.id===t))}function ce(e,t,a,r=!1){const l=se(e.borns,t);if(!l)return{};let o={[t]:a};if(!r){if(a.head&&l.connected){const t=se(e.borns,l.parentId);t&&(o=n(n({},ce(e,t.id,{tail:!0},r)),o))}a.tail&&function(e,t,a=!1){return e.borns.filter((e=>e.parentId===t&&(!a||e.connected)))}(e,l.id,!0).forEach((e=>{o[e.id]={head:!0}}))}return o}function ie(e){return e.reduce(((t,a)=>{const n=se(e,a.parentId);return n?a.connected&&(t[a.id]={connected:d(n.tail,a.head)}):t[a.id]={connected:!1,parentId:""},t}),{})}function ue(e){const t=[],a=Object.keys(e).reduce(((a,n)=>{const r=e[n];return r.parentId?a[r.parentId]?a[r.parentId].push(r):a[r.parentId]=[r]:t.push(r),a}),{});return t.map((e=>n(n({},e),{children:ve(a,e.id)})))}function ve(e,t){var a,r;return null!=(r=null==(a=e[t])?void 0:a.map((t=>n(n({},t),{children:ve(e,t.id)}))))?r:[]}function me(e){return ee(pe(function(e){return ue(e).map((e=>n(n({},e),{children:fe(e)})))}(e)))}function fe(e){var t;return null!=(t=e.children.map((t=>{const a=function(e,t){const a=o(t.head,t.transform.translate),r=le(a,n(n({},e.transform),{origin:e.head})),l=i(r,a);return n(n({},t),{transform:{translate:o(t.transform.translate,l),rotate:t.transform.rotate+e.transform.rotate,scale:{x:t.transform.scale.x*e.transform.scale.x,y:t.transform.scale.y*e.transform.scale.y},origin:{x:0,y:0}}})}(e,t);return n(n({},a),{children:fe(n(n({},a),{children:t.children}))})})))?t:[]}function pe(e){return e.map((e=>{const{children:t}=e;return r(e,["children"])})).concat(e.flatMap((e=>pe(e.children))))}function he(e,t){return ee(ye(ue(e),t))}function ye(e,t){return e.flatMap((e=>{if(ne(t[e.id])){const{children:t}=e;return[r(e,["children"])]}return ye(e.children,t)}))}const ge=u({undoStack:[],redoStack:[]}),xe=v((()=>ge.undoStack.concat(ge.redoStack.concat().reverse()))),be=v((()=>ge.undoStack.length-1));function we(){ge.undoStack=[],ge.redoStack=[]}function ke(e){ge.undoStack.push(e),ge.redoStack=[]}function Se(){const e=ge.undoStack.pop();e&&(e.undo(),ge.redoStack.push(e))}function Me(){const e=ge.redoStack.pop();e&&(e.redo(),ge.undoStack.push(e))}function Ae(){return{state:ge,allStack:xe,currentItemIndex:be,clearHistory:we,push:ke,undo:Se,redo:Me}}const Be=Ae(),Ie=u(Z({name:"armature",borns:[Q({name:"born",head:{x:20,y:200},tail:{x:220,y:200}},!0)]},!0)),Ce=u({armatures:[Ie],lastSelectedArmatureId:"",lastSelectedBornId:"",selectedArmatures:{},selectedBorns:{}}),Ee=v((()=>Ce.armatures.findIndex((e=>e.id===Ce.lastSelectedArmatureId&&Ce.selectedArmatures[Ce.lastSelectedArmatureId])))),Oe=v((()=>-1!==Ee.value?Ce.armatures[Ee.value]:void 0)),$e=v((()=>Oe.value?Oe.value.borns.findIndex((e=>{var t,a;return e.id===Ce.lastSelectedBornId&&((null==(t=Ce.selectedBorns[Ce.lastSelectedBornId])?void 0:t.head)||(null==(a=Ce.selectedBorns[Ce.lastSelectedBornId])?void 0:a.tail))})):-1)),je=v((()=>{if(Oe.value)return-1!==$e.value?Oe.value.borns[$e.value]:void 0})),De=v((()=>ee(Ce.armatures))),Fe=v((()=>{var e,t;return ee(null!=(t=null==(e=Oe.value)?void 0:e.borns)?t:[])})),Te=v((()=>function(e,t){const a=Object.keys(t).map((a=>{const n=[],r=de(e[a],[e[a].transform]);return t[a].head&&n.push(r.head),t[a].tail&&n.push(r.tail),n})).flat();return 0===a.length?{x:0,y:0}:c(a.reduce(((e,t)=>o(e,t)),{x:0,y:0}),1/a.length)}(Fe.value,Ce.selectedBorns)));function Le(e=""){if(Ce.lastSelectedArmatureId===e)return;const t=Re(e);t.redo(),Be.push(t)}function Ne(e){if(!Oe.value)return;const t=function(e){const t=ae(Oe.value,e);return{name:"Update Armature",undo:()=>{const e=Ee.value;Ce.armatures[e]=n(n({},Ce.armatures[e]),t)},redo:()=>{const t=Ee.value;Ce.armatures[t]=n(n({},Ce.armatures[t]),e)}}}({name:e});t.redo(),Be.push(t)}function Pe(){const e=function(){const e=n({},Oe.value),t=Ee.value,a=Re("");return{name:"Delete Armature",undo:()=>{Ce.armatures.splice(t,0,e),a.undo()},redo:()=>{Ce.armatures.splice(t,1)}}}();e.redo(),Be.push(e)}function ze(){const e=function(e){const t=Ce.armatures.length,a=Re(e.id);return{name:"Add Armature",undo:()=>{Ce.armatures.splice(t,1),a.undo()},redo:()=>{Ce.armatures.push(e),a.redo()}}}(Z({name:Y("armature",Ce.armatures.map((e=>e.name))),borns:[Q({name:"born",tail:{x:100,y:0}},!0)]},!0));e.redo(),Be.push(e)}function _e(e="",t={head:!0,tail:!0},a=!1,n=!1){if(!Oe.value)return;if(Ce.lastSelectedBornId===e&&(r=Ce.selectedBorns[e],l=t,!!(null==r?void 0:r.head)==!!(null==l?void 0:l.head)&&!!(null==r?void 0:r.tail)==!!(null==l?void 0:l.tail)))return;var r,l;const o=qe(e,t,a,n);o.redo(),Be.push(o)}function We(){if(!Oe.value)return;const e=function(){const e=Oe.value.borns.concat(),t=Oe.value.borns.filter((e=>!Ce.selectedBorns[e.id])),a=Xe(ie(t)),n=qe("");return{name:"Delete Born",undo:()=>{Oe.value.borns=e.concat(),n.undo(),a.undo()},redo:()=>{Oe.value.borns=t,a.redo()}}}();e.redo(),Be.push(e)}function Ue(){Oe.value&&Ve([Q({name:Y("born",Oe.value.borns.map((e=>e.name))),tail:{x:100,y:0}},!0)])}function Ve(e,t){if(!Oe.value)return;const a=function(e,t){const a=e.map(((e,a)=>qe(e.id,t[e.id],0!==a)));return{name:"Add Born",undo:()=>{Oe.value.borns=Oe.value.borns.slice(0,Oe.value.borns.length-e.length),a.forEach((e=>e.undo()))},redo:()=>{Oe.value.borns=Oe.value.borns.concat(e),a.forEach((e=>e.redo()))}}}(e,e.reduce(((e,a)=>(t&&(e[a.id]=n({},t)),e)),{}));a.redo(),Be.push(a)}function Ge(e){if(!Oe.value)return;const t=Xe(e);t.redo(),Be.push(t)}function Ke(e){if(!Oe.value)return;if(!je.value)return;const t=function(e){const t=ae(je.value,e);return{name:"Update Born",undo:()=>{const e=$e.value;Oe.value.borns[e]=n(n({},Oe.value.borns[e]),t)},redo:()=>{const t=$e.value;Oe.value.borns[t]=n(n({},Oe.value.borns[t]),e)}}}(function(e,t){if(!t.connected)return t;const a=se(e,t.parentId);return n(n({},t),a?{head:a.tail}:{connected:!1,parentId:""})}(Oe.value.borns,n(n({},je.value),e)));t.redo(),Be.push(t)}function He(){return{state:Ce,lastSelectedArmature:Oe,lastSelectedBorn:je,bornMap:Fe,selectedBornsOrigin:Te,selectArmature:Le,updateArmatureName:Ne,deleteArmature:Pe,addArmature:ze,selectBorn:_e,deleteBorn:We,addBorn:Ue,addBorns:Ve,updateBorns:Ge,updateBorn:Ke}}function Re(e){const t=n({},Ce.selectedArmatures),a=Ce.lastSelectedArmatureId;return{name:"Select Armature",undo:()=>{Ce.selectedArmatures=n({},t),Ce.lastSelectedArmatureId=a},redo:()=>{Ce.selectedArmatures=e?{[e]:!0}:{},Ce.lastSelectedArmatureId=e}}}function qe(e,t={head:!0,tail:!0},a=!1,r=!1){const l=n({},Ce.selectedBorns),o=Ce.lastSelectedBornId;return{name:"Select Born",undo:()=>{Ce.selectedBorns=n({},l),Ce.lastSelectedBornId=o},redo:()=>{Ce.selectedBorns=e?te(n(n({},a?Ce.selectedBorns:{}),{[e]:t}),ce(Oe.value,e,t,r)):{},Ce.lastSelectedBornId=e}}}function Xe(e){const t=te(e,ie(Oe.value.borns.map((t=>n(n({},t),e[t.id]))))),a=Object.keys(t).reduce(((e,a)=>(Fe.value[a]&&(e[a]=ae(Fe.value[a],t[a])),e)),{});return{name:"Update Born",undo:()=>{Oe.value.borns=Oe.value.borns.map((e=>n(n({},e),a[e.id])))},redo:()=>{Oe.value.borns=Oe.value.borns.map((e=>n(n({},e),t[e.id])))}}}m((()=>Ce.selectedArmatures),(()=>{Ce.selectedArmatures[Ce.lastSelectedArmatureId]||(Ce.lastSelectedArmatureId="")})),m((()=>De.value),(()=>{Ce.selectedArmatures=Object.keys(Ce.selectedArmatures).reduce(((e,t)=>De.value[t]?n(n({},e),{[t]:Ce.selectedArmatures[t]}):e),{})})),m((()=>Ce.selectedBorns),(()=>{if(!ne(Ce.selectedBorns[Ce.lastSelectedBornId])){const e=Object.keys(Ce.selectedBorns);Ce.lastSelectedBornId=e.length>0?e[0]:""}})),m((()=>Fe.value),(()=>{Ce.selectedBorns=Object.keys(Ce.selectedBorns).reduce(((e,t)=>Fe.value[t]?n(n({},e),{[t]:Ce.selectedBorns[t]}):e),{})}));var Ye=f({props:{origin:{type:Object,required:!0},current:{type:Object,required:!0},scale:{type:Number,required:!0},side:{type:Boolean,default:!1}},setup:e=>({rotate:v((()=>p(e.current,e.origin)/Math.PI*180))})});const Je={fill:"black",stroke:"black"},Qe=y("circle",{r:"2"},null,-1),Ze=y("circle",{r:"2"},null,-1),et=y("path",{d:"M-20,0L-10,-10L-10,10z"},null,-1),tt=y("path",{d:"M20,0L10,-10L10,10z"},null,-1);function at(e){const t=u({command:"",editMovement:void 0}),a=He(),r=v((()=>a.state.selectedBorns)),l=v((()=>{var e;return null==(e=a.lastSelectedBorn.value)?void 0:e.id})),o=v((()=>a.lastSelectedArmature.value)),d=v((()=>!!l.value)),s=v((()=>{var e,t;return null!=(t=null==(e=o.value)?void 0:e.borns.map((e=>e.name)))?t:[]}));function m(){t.command="",t.editMovement=void 0}function f(e,t=!1){return n({},function(e,t=!1){const a=t?e.head:e.tail;return Q({head:a,tail:a,parentId:t?e.parentId:e.id,connected:!t||e.connected},!0)}(e,t))}const h=v((()=>{if(!t.editMovement)return{};if("scale"===t.command){const n=a.selectedBornsOrigin.value,l=e.isOppositeSide(n,t.editMovement.start,t.editMovement.current),o=c(c({x:1,y:1},l?-1:1),x(t.editMovement.current,n)/x(t.editMovement.start,n)),d=e.snapScale(o);return Object.keys(r.value).reduce(((e,t)=>(e[t]=J({origin:n,scale:d}),e)),{})}if("rotate"===t.command){const e=a.selectedBornsOrigin.value,n=(p(t.editMovement.current,e)-p(t.editMovement.start,e))/Math.PI*180;return Object.keys(r.value).reduce(((t,a)=>(t[a]=J({origin:e,rotate:n}),t)),{})}const n=i(t.editMovement.current,t.editMovement.start),l=e.snapTranslate(n);return Object.keys(r.value).reduce(((e,t)=>(e[t]=J({translate:l}),e)),{})})),y=v((()=>Object.keys(h.value).reduce(((e,t)=>(e[t]=oe(a.bornMap.value[t],h.value[t],r.value[t]),e)),{})));function g(){o.value&&(a.updateBorns(y.value),t.editMovement=void 0,t.command="")}return{command:v((()=>t.command)),getEditTransforms:e=>h.value[e]||J(),end:()=>m(),cancel:m,setEditMode:function(e){if(o.value&&(m(),d.value&&(t.command=e,"extrude"===e))){const e={},t=s.value.concat(),n=[];Object.keys(r.value).forEach((l=>{const o=r.value[l],d=a.bornMap.value[l],s=[];o.tail&&s.push(f(d)),o.head&&s.push(f(d,!0)),s.forEach((a=>{e[a.parentId]||(a.name=Y(d.name,t),n.push(a),t.push(a.name),e[a.parentId]=!0)}))})),a.addBorns(n,{tail:!0})}},select:function(e,n){t.command?g():a.selectBorn(e,n)},shiftSelect:function(e,n){t.command?g():a.selectBorn(e,n,!0)},mousemove:function(e){t.command&&(t.editMovement=e)},clickAny:function(){t.command&&g()},clickEmpty:function(){t.command?g():a.selectBorn()},execDelete:function(){""===t.command&&a.deleteBorn()},execAdd:function(){""===t.command&&a.addBorn()}}}Ye.render=function(e,t,a,n,r,l){return g(),h("g",Je,[y("g",{transform:`translate(${e.origin.x}, ${e.origin.y}) rotate(${e.rotate}) scale(${e.scale})`},[Qe],8,["transform"]),y("line",{x1:e.origin.x,y1:e.origin.y,x2:e.current.x,y2:e.current.y,"stroke-width":e.scale,"stroke-dasharray":`${2*e.scale} ${2*e.scale}`},null,8,["x1","y1","x2","y2","stroke-width","stroke-dasharray"]),y("g",{transform:`translate(${e.current.x}, ${e.current.y}) rotate(${e.rotate}) scale(${e.scale})`},[Ze,y("g",{transform:`rotate(${e.side?90:0})`},[et,tt],8,["transform"])],8,["transform"])])};const nt=Ae();function rt(e,t){const a=n({},e.selectedMap),r=e.lastSelectedId;return{name:`Select ${e.label}`,undo:()=>{e.selectedMap=n({},a),e.lastSelectedId=r},redo:()=>{e.selectedMap=t?{[t]:!0}:{},e.lastSelectedId=t}}}const lt=b(0),ot=b(60),dt=function(e){const t=u({label:e,list:[],lastSelectedId:"",selectedMap:{}}),a=v((()=>t.list.findIndex((e=>e.id===t.lastSelectedId&&t.selectedMap[t.lastSelectedId])))),r=v((()=>ee(t.list))),l=v((()=>-1!==a.value?t.list[a.value]:void 0));return m((()=>t.selectedMap),(()=>{t.selectedMap[t.lastSelectedId]||(t.lastSelectedId="")})),m((()=>r.value),(()=>{t.selectedMap=Object.keys(t.selectedMap).reduce(((e,a)=>r.value[a]?n(n({},e),{[a]:t.selectedMap[a]}):e),{})})),{state:t,itemMap:r,lastSelectedItem:l,selectItem:function(e){if(t.lastSelectedId===e)return;const a=rt(t,e);a.redo(),nt.push(a)},addItem:function(e){const a=function(e,t){const a=e.list.length,n=rt(e,t.id),r=()=>{e.list.push(t),n.redo()};return{name:`Add ${e.label}`,undo:()=>{e.list.splice(a,1),n.undo()},redo:r}}(t,e);a.redo(),nt.push(a)},deleteItem:function(){if(-1===a.value)return;const e=function(e,t){const a=n({},e.list[t]),r=t,l=rt(e,""),o=()=>{e.list.splice(r,1)};return{name:`Delete ${e.label}`,undo:()=>{e.list.splice(r,0,a),l.undo()},redo:o}}(t,a.value);e.redo(),nt.push(e)},updateItem:function(e){if(-1===a.value)return;const r=function(e,t,a){const r=ae(e.list[a],t),l=()=>{e.list[a]=n(n({},e.list[a]),t)};return{name:`Update ${e.label}`,undo:()=>{e.list[a]=n(n({},e.list[a]),r)},redo:l}}(t,e,a.value);r.redo(),nt.push(r)}}}("Action"),st=b({}),ct=Ae(),it=He(),ut=v((()=>{var e,t;return null!=(t=null==(e=dt.lastSelectedItem.value)?void 0:e.keyframes.filter((e=>e.frame===lt.value)))?t:[]})),vt=v((()=>ut.value.reduce(((e,t)=>n(n({},e),{[t.bornId]:t})),{}))),mt=v((()=>Array.from(new Set(Object.keys(st.value).concat(Object.keys(vt.value)))))),ft=v((()=>mt.value.reduce(((e,t)=>(vt.value[t]?e[t]=re([vt.value[t].transform,kt(t)]):e[t]=kt(t),e)),{}))),pt=v((()=>it.lastSelectedArmature.value?me(ee(it.lastSelectedArmature.value.borns.map((e=>n(n({},e),{transform:St(e.id)}))))):{})),ht=v((()=>he(pt.value,it.state.selectedBorns))),yt=v((()=>it.lastSelectedArmature.value?function(e){const t=Object.keys(e).map((t=>de(e[t],[e[t].transform]).head));return 0===t.length?{x:0,y:0}:c(t.reduce(((e,t)=>o(e,t)),{x:0,y:0}),1/t.length)}(ht.value):{x:0,y:0}));function gt(){it.lastSelectedArmature.value&&dt.addItem(function(e={},t=!1){return n({id:t?l():"",name:"",totalFrame:60,armatureId:"",keyframes:[]},e)}({name:Y("action",dt.state.list.map((e=>e.name))),armatureId:it.lastSelectedArmature.value.id},!0))}function xt(e){if(ot.value===e)return;const t=function(e){const t=ot.value;return{name:"Update End Frame",undo:()=>{ot.value=t},redo:()=>{ot.value=e}}}(e);t.redo(),ct.push(t)}function bt(e){const t=function(e){const t=n({},st.value);return{name:"Update Pose",undo:()=>{st.value=t},redo:()=>{st.value=e}}}(e);t.redo(),ct.push(t)}function wt(e){bt(Array.from(new Set(Object.keys(st.value).concat(Object.keys(e)))).reduce(((t,a)=>{var n;return t[a]=re([kt(a),null!=(n=e[a])?n:J()]),t}),{}))}function kt(e){var t;return null!=(t=st.value[e])?t:J()}function St(e){var t;return null!=(t=ft.value[e])?t:J()}function Mt(){return{currentFrame:lt,endFrame:ot,actions:dt.state.list,posedBornIds:mt,currentPosedBorns:pt,selectedBorns:ht,selectedPosedBornOrigin:yt,getCurrentSelfTransforms:St,setEndFrame:xt,selectedAction:dt.lastSelectedItem,selectAction:dt.selectItem,addAction:gt,deleteAction:dt.deleteItem,updateAction:e=>dt.updateItem(e),applyEditedTransforms:wt}}m(lt,(()=>{st.value={}}));const At=Ae(),Bt=u({canvasMode:"object",pastCanvasMode:"edit",axisGrid:""}),It=v((()=>"edit"===Bt.canvasMode?at(Pt()):"pose"===Bt.canvasMode?function(e){const t=u({command:"",editMovement:void 0}),a=He(),n=Mt(),r=v((()=>{var e;return null==(e=a.lastSelectedBorn.value)?void 0:e.id})),l=v((()=>a.lastSelectedArmature.value)),o=v((()=>!!r.value));function d(){t.command="",t.editMovement=void 0}function c(e,t){const a=n.currentPosedBorns.value[t],r=n.currentPosedBorns.value[a.parentId];return r?s(e,-r.transform.rotate/180*Math.PI):e}const m=v((()=>{if(!t.editMovement)return{};if("rotate"===t.command){const e=n.selectedPosedBornOrigin.value,a=(p(t.editMovement.current,e)-p(t.editMovement.start,e))/Math.PI*180;return Object.keys(n.selectedBorns.value).reduce(((e,t)=>(e[t]=J({rotate:a}),e)),{})}const a=i(t.editMovement.current,t.editMovement.start),r=e.snapTranslate(a);return Object.keys(n.selectedBorns.value).reduce(((e,t)=>(n.selectedBorns.value[t].connected||(e[t]=J({translate:c(r,t)})),e)),{})}));function f(){l.value&&(n.applyEditedTransforms(m.value),t.editMovement=void 0,t.command="")}return{command:v((()=>t.command)),getEditTransforms(e){var t;return null!=(t=m.value[e])?t:J()},end:()=>d(),cancel:d,setEditMode:function(e){l.value&&(d(),o.value&&(t.command=e))},select:function(e,n){t.command?f():a.selectBorn(e,n,!1,!0)},shiftSelect:function(e,n){t.command?f():a.selectBorn(e,n,!0,!0)},mousemove:function(e){t.command&&(t.editMovement=e)},clickAny:function(){t.command&&f()},clickEmpty:function(){t.command?f():a.selectBorn()},execDelete:()=>{},execAdd:()=>{}}}(Pt()):function(){const e=u({command:"",editMovement:void 0}),t=He(),a=v((()=>t.lastSelectedArmature.value));function n(){e.command="",e.editMovement=void 0}const r=v((()=>({})));function l(){a.value&&(e.editMovement=void 0,e.command="")}return{command:v((()=>e.command)),getEditTransforms:e=>r.value[e]||J(),end:()=>n(),cancel:n,setEditMode:function(t){a.value&&(n(),e.command=t)},select:function(a,n){e.command?l():t.selectBorn(a,n)},shiftSelect:function(a,n){e.command?l():t.selectBorn(a,n,!0)},mousemove:function(t){e.command&&(e.editMovement=t)},clickAny:function(){e.command&&l()},clickEmpty:function(){e.command?l():t.selectArmature()},execDelete:function(){""===e.command&&t.deleteArmature()},execAdd:function(){""===e.command&&t.addArmature()}}}()));m(It,((e,t)=>{t&&t.end()}));const Ct=v((()=>It.value.command.value));function Et(){"edit"===Bt.canvasMode?$t(Bt.pastCanvasMode):$t("edit")}function Ot(){"edit"===Bt.canvasMode?"object"===Bt.pastCanvasMode?$t("pose"):$t("object"):"object"===Bt.canvasMode?$t("pose"):$t("object")}function $t(e){const t=function(e){const t=Bt.canvasMode,a=Bt.pastCanvasMode;return{name:"Change Mode",undo:()=>{Bt.canvasMode=t,Bt.pastCanvasMode=a},redo:()=>{Bt.pastCanvasMode=Bt.canvasMode,Bt.canvasMode=e}}}(e);At.push(t),t.redo()}function jt(e){Bt.axisGrid=e}function Dt(e){Bt.axisGrid=Bt.axisGrid===e?"":e}function Ft(e){return{x:"y"===Bt.axisGrid?1:e.x,y:"x"===Bt.axisGrid?1:e.y}}function Tt(e){return{x:"y"===Bt.axisGrid?0:e.x,y:"x"===Bt.axisGrid?0:e.y}}function Lt(e,t,a){return w(i(t,e),i(a,e))<0}function Nt(e){return It.value.getEditTransforms(e)}function Pt(){return{state:Bt,command:Ct,toggleCanvasMode:Et,ctrlToggleCanvasMode:Ot,setCanvasMode:$t,setAxisGrid:jt,switchAxisGrid:Dt,snapScale:Ft,snapTranslate:Tt,isOppositeSide:Lt,getEditTransforms:Nt,mousemove:e=>It.value.mousemove(e),clickAny:()=>It.value.clickAny(),clickEmpty:()=>It.value.clickEmpty(),cancel:()=>It.value.cancel(),setEditMode:e=>It.value.setEditMode(e),execDelete:()=>It.value.execDelete(),execAdd:()=>It.value.execAdd(),select:(e,t)=>It.value.select(e,t),shiftSelect:(e,t)=>It.value.shiftSelect(e,t)}}const zt=u({size:{width:100,height:100}});function _t(){return{state:zt}}window.addEventListener("resize",(()=>{zt.size={width:window.innerWidth,height:window.innerHeight}}));var Wt=f({components:{ScaleMarker:Ye},props:{originalViewBox:{type:Object,default:()=>({x:0,y:0,width:600,height:400})},currentCommand:{type:String,default:""}},emits:["mousemove","click-any","click-empty","escape","tab","ctrl-tab","g","s","r","e","x","y","shift-a"],setup(e,{emit:t}){const a=u({width:600,height:400}),r=b(),l=b(),d=b(),s=b(),f=b(1),p=b({x:0,y:0}),h=b(),y=He(),g=Pt(),x=Mt();function w(e){return o(p.value,c(e,f.value))}const A=v((()=>"edit"===g.state.canvasMode?y.selectedBornsOrigin.value:x.selectedPosedBornOrigin.value)),B=v((()=>({x:p.value.x,y:p.value.y,width:a.width*f.value,height:a.height*f.value}))),I=v((()=>R(B.value))),C=v((()=>M(n({x:0,y:0},a)))),E=v((()=>{if(""!==g.state.axisGrid&&d.value)return function(e,t,a,r){return n(n({},{strokeWidth:e}),"x"===t?{from:{x:a.x,y:r.y},to:{x:a.x+a.width,y:r.y},stroke:"red"}:{from:{x:r.x,y:a.y},to:{x:r.x,y:a.y+a.height},stroke:"green"})}(f.value,g.state.axisGrid,B.value,A.value)})),O=v((()=>{if(s.value&&["scale","rotate"].includes(e.currentCommand))return{origin:A.value,current:w(s.value),side:"rotate"===e.currentCommand}}));function $(){if(!l.value)return;const e=l.value.getBoundingClientRect();a.width=e.width,a.height=e.height}m((()=>e.currentCommand),(e=>{g.setAxisGrid(""),""===e&&(d.value=void 0)}));const j=_t();return k($),m((()=>j.state.size),$),{scale:f,viewSize:a,svg:r,wrapper:l,viewBox:I,gridLineElm:E,scaleNaviElm:O,canvasMode:v((()=>g.state.canvasMode)),focus(){r.value&&r.value.focus()},wheel(e){const t=s.value?s.value:C.value,a=w(t);f.value=f.value*Math.pow(1.1,e.deltaY>0?1:-1);const n=w(t);p.value=o(p.value,i(a,n))},downMiddle(){s.value&&(h.value={origin:n({},p.value),downAt:n({},s.value)})},upMiddle(){h.value=void 0},leave(){h.value=void 0},mousemove:e=>{if(s.value=S(e),h.value)p.value=o(h.value.origin,c(i(h.value.downAt,s.value),f.value));else{if(!d.value)return;t("mousemove",{current:w(s.value),start:w(d.value)})}},clickAny(e){e.target===r.value?(d.value=void 0,t("click-empty")):t("click-any")},keyDownTab:()=>{t("tab")},keyDownCtrlTab:()=>t("ctrl-tab"),keyDownEscape:()=>{t("escape")},editKeyDown(a){s.value&&(!["grab","scale"].includes(e.currentCommand)||"x"!==a&&"y"!==a?(d.value=s.value,t(a)):g.switchAxisGrid(a))}}}});const Ut=$("data-v-b1519028");j("data-v-b1519028");const Vt={ref:"wrapper",class:"app-canvas-root"},Gt={class:"help"};D();const Kt=Ut(((e,t,a,n,r,l)=>{const o=A("ScaleMarker");return g(),h("div",Vt,[(g(),h("svg",{ref:"svg",tabindex:"-1",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"none","font-family":"sans-serif",viewBox:e.viewBox,width:e.viewSize.width,height:e.viewSize.height,onWheel:t[1]||(t[1]=B(((...t)=>e.wheel&&e.wheel(...t)),["prevent"])),onClick:t[2]||(t[2]=B(((...t)=>e.clickAny&&e.clickAny(...t)),["left"])),onContextmenu:t[3]||(t[3]=B(((...t)=>e.keyDownEscape&&e.keyDownEscape(...t)),["right","prevent"])),onMouseenter:t[4]||(t[4]=(...t)=>e.focus&&e.focus(...t)),onMousemove:t[5]||(t[5]=B(((...t)=>e.mousemove&&e.mousemove(...t)),["prevent"])),onMousedown:t[6]||(t[6]=B(((...t)=>e.downMiddle&&e.downMiddle(...t)),["middle","prevent"])),onMouseup:t[7]||(t[7]=B(((...t)=>e.upMiddle&&e.upMiddle(...t)),["middle","prevent"])),onMouseleave:t[8]||(t[8]=(...t)=>e.leave&&e.leave(...t)),onKeydown:[t[9]||(t[9]=I(B(((...t)=>e.keyDownEscape&&e.keyDownEscape(...t)),["exact","prevent"]),["escape"])),t[10]||(t[10]=I(B(((...t)=>e.keyDownTab&&e.keyDownTab(...t)),["exact","prevent"]),["tab"])),t[11]||(t[11]=I(B(((...t)=>e.keyDownCtrlTab&&e.keyDownCtrlTab(...t)),["shift","exact","prevent"]),["tab"])),t[12]||(t[12]=I(B((t=>e.editKeyDown("g")),["exact","prevent"]),["g"])),t[13]||(t[13]=I(B((t=>e.editKeyDown("s")),["exact","prevent"]),["s"])),t[14]||(t[14]=I(B((t=>e.editKeyDown("r")),["exact","prevent"]),["r"])),t[15]||(t[15]=I(B((t=>e.editKeyDown("e")),["exact","prevent"]),["e"])),t[16]||(t[16]=I(B((t=>e.editKeyDown("x")),["exact","prevent"]),["x"])),t[17]||(t[17]=I(B((t=>e.editKeyDown("y")),["exact","prevent"]),["y"])),t[18]||(t[18]=I(B((t=>e.editKeyDown("shift-a")),["shift","exact","prevent"]),["a"]))]},[y("rect",{x:e.originalViewBox.x,y:e.originalViewBox.y,width:e.originalViewBox.width,height:e.originalViewBox.height,fill:"none",stroke:"black","stroke-width":"1","stroke-dasharray":"4 4"},null,8,["x","y","width","height"]),e.gridLineElm?(g(),h("line",{key:0,x1:e.gridLineElm.from.x,y1:e.gridLineElm.from.y,x2:e.gridLineElm.to.x,y2:e.gridLineElm.to.y,stroke:e.gridLineElm.stroke,"stroke-width":e.gridLineElm.strokeWidth},null,8,["x1","y1","x2","y2","stroke","stroke-width"])):C("",!0),E(e.$slots,"default"),e.scaleNaviElm?(g(),h(o,{key:1,origin:e.scaleNaviElm.origin,current:e.scaleNaviElm.current,scale:e.scale,side:e.scaleNaviElm.side},null,8,["origin","current","scale","side"])):C("",!0)],40,["viewBox","width","height"])),y("div",Gt,[y("p",null,"Mode: "+O(e.canvasMode),1)])],512)}));Wt.render=Kt,Wt.__scopeId="data-v-b1519028";var Ht=f({props:{tabs:{type:Array,default:()=>[]}},setup(e){var t,a;const n=b(null!=(a=null==(t=e.tabs[0])?void 0:t.key)?a:"");return{current:n,setTab:e=>n.value=e}}});const Rt=$("data-v-16db2673");j("data-v-16db2673");const qt={class:"tab-panel-root"},Xt={class:"panels"};D();const Yt=Rt(((e,t,a,n,r,l)=>(g(),h("div",qt,[y("ul",null,[(g(!0),h(F,null,T(e.tabs,(t=>(g(),h("li",{key:t.key,class:{current:t.key===e.current}},[y("a",{href:"#",onClick:B((a=>e.setTab(t.key)),["prevent"])},O(t.label),9,["onClick"])],2)))),128))]),y("div",Xt,[(g(!0),h(F,null,T(e.tabs,(t=>L((g(),h("div",{key:t.key},[E(e.$slots,t.key)],512)),[[N,t.key===e.current]]))),128))])]))));Ht.render=Yt,Ht.__scopeId="data-v-16db2673";var Jt=f({setup(){const e=Ae();return{allStack:v((()=>e.allStack.value)),currentItemIndex:v((()=>e.currentItemIndex.value))}}});const Qt=$("data-v-65f8ee82");j("data-v-65f8ee82");const Zt=y("h3",null,"history",-1);D();const ea=Qt(((e,t,a,n,r,l)=>(g(),h("div",null,[Zt,y("ul",null,[(g(!0),h(F,null,T(e.allStack,((t,a)=>(g(),h("li",{key:a,class:{current:a===e.currentItemIndex}},O(t.name),3)))),128))])]))));Jt.render=ea,Jt.__scopeId="data-v-65f8ee82";var ta=f({props:{options:{type:Array,default:()=>[]},modelValue:{type:[Number,String],default:""}},emits:["update:modelValue"],setup:(e,{emit:t})=>({value:v({get:()=>e.modelValue,set(e){t("update:modelValue",e)}})})});const aa=$("data-v-fddf1844");j("data-v-fddf1844");const na={class:"select-root"},ra=y("option",{value:""},"-- None --",-1);D();const la=aa(((e,t,a,n,r,l)=>(g(),h("span",na,[L(y("select",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.value=t)},[ra,(g(!0),h(F,null,T(e.options,(e=>(g(),h("option",{key:e.value,value:e.value},O(e.label),9,["value"])))),128))],512),[[P,e.value]])]))));ta.render=la,ta.__scopeId="data-v-fddf1844";var oa=f({components:{TabPanel:Ht,HistoryStack:Jt,SelectField:ta},setup(){const e=He(),t=b(""),a=v((()=>e.lastSelectedArmature.value?e.lastSelectedArmature.value.borns.filter((t=>{var a;return t.id!==(null==(a=e.lastSelectedBorn.value)?void 0:a.id)})).map((e=>({value:e.id,label:e.name}))):[])),n=v((()=>e.lastSelectedBorn.value?"born":e.lastSelectedArmature.value?"armature":""));function r(){e.lastSelectedBorn.value?t.value=e.lastSelectedBorn.value.name:e.lastSelectedArmature.value?t.value=e.lastSelectedArmature.value.name:t.value=""}return m(e.lastSelectedArmature,r),m(e.lastSelectedBorn,r),{draftName:t,lastSelectedArmature:e.lastSelectedArmature,lastSelectedBorn:e.lastSelectedBorn,parentOptions:a,selectedObjectType:n,connected:v({get(){var t,a;return null!=(a=null==(t=e.lastSelectedBorn.value)?void 0:t.connected)&&a},set(t){e.updateBorn({connected:t})}}),parentId:v({get(){var t,a;return null!=(a=null==(t=e.lastSelectedBorn.value)?void 0:t.parentId)?a:""},set(t){e.updateBorn({parentId:t})}}),changeArmatureName(){t.value&&e.updateArmatureName(t.value)},changeBornName(){t.value&&e.updateBorn({name:t.value})}}}});const da=$("data-v-a1a2983c");j("data-v-a1a2983c");const sa=y("h3",null,"Armature",-1),ca={class:"field inline"},ia=y("label",null,"Name",-1),ua=y("h3",null,"Born",-1),va={class:"field inline"},ma=y("label",null,"Name",-1),fa={class:"field inline"},pa=y("label",null,"Parent",-1),ha={class:"field inline"},ya=y("label",null,"Connect",-1);D();const ga=da(((e,t,a,n,r,l)=>{const o=A("SelectField"),d=A("HistoryStack"),s=A("TabPanel");return g(),h("div",null,[y(s,{tabs:[{key:"detail",label:"Detail"},{key:"history",label:"History"}]},{detail:da((()=>["armature"===e.selectedObjectType?(g(),h("form",{key:0,onSubmit:t[3]||(t[3]=B((()=>{}),["prevent"]))},[sa,y("div",ca,[ia,L(y("input",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.draftName=t),type:"text",onChange:t[2]||(t[2]=(...t)=>e.changeArmatureName&&e.changeArmatureName(...t))},null,544),[[z,e.draftName]])])],32)):C("",!0),"born"===e.selectedObjectType?(g(),h("form",{key:1,onSubmit:t[8]||(t[8]=B((()=>{}),["prevent"]))},[ua,y("div",va,[ma,L(y("input",{"onUpdate:modelValue":t[4]||(t[4]=t=>e.draftName=t),type:"text",onChange:t[5]||(t[5]=(...t)=>e.changeBornName&&e.changeBornName(...t))},null,544),[[z,e.draftName]])]),y("div",fa,[pa,y(o,{modelValue:e.parentId,"onUpdate:modelValue":t[6]||(t[6]=t=>e.parentId=t),options:e.parentOptions},null,8,["modelValue","options"])]),y("div",ha,[ya,L(y("input",{"onUpdate:modelValue":t[7]||(t[7]=t=>e.connected=t),type:"checkbox",disabled:!e.parentId},null,8,["disabled"]),[[_,e.connected]])])],32)):C("",!0)])),history:da((()=>[y(d)])),_:1})])}));oa.render=ga,oa.__scopeId="data-v-a1a2983c";var xa=f({emits:["down-left","up-left","mousemove","drag","click-any","click-empty","escape","g","x"],setup(e,{emit:t}){const a=b(),r=b(),l=function(e={}){const t=u({width:600,height:100}),a=b(),r=b(),l=b(1),d=b({x:0,y:0}),s=b(),m=b(),f=v((()=>({x:d.value.x,y:d.value.y,width:t.width*l.value,height:t.height*l.value}))),p=v((()=>M(n({x:0,y:0},t)))),h=v((()=>R(f.value)));function y(e){return o(d.value,c(e,l.value))}return{viewSize:t,editStartPoint:a,mousePoint:r,scale:l,viewOrigin:d,dragInfo:m,viewMovingInfo:s,viewCenter:p,viewBox:h,viewToCanvas:y,wheel(t,a=!1){var n,s;const c=!a&&r.value?r.value:p.value,u=y(c);l.value=Math.min(Math.max(l.value*Math.pow(1.1,t.deltaY>0?1:-1),null!=(n=e.scaleMin)?n:0),null!=(s=e.scaleMax)?s:10);const v=y(c);d.value=o(d.value,i(u,v))},downLeft(){r.value&&(m.value={})},upLeft(){m.value=void 0},downMiddle(){r.value&&(s.value={origin:n({},d.value),downAt:n({},r.value)})},upMiddle(){s.value=void 0},leave(){s.value=void 0},viewMove(){s.value&&r.value&&(d.value=o(s.value.origin,c(i(s.value.downAt,r.value),l.value)))}}}({scaleMin:1});function d(){if(!r.value)return;const e=r.value.getBoundingClientRect();l.viewSize.width=e.width,l.viewSize.height=e.height}const s=_t();return k(d),m((()=>s.state.size),d),{scale:l.scale,viewOrigin:l.viewOrigin,viewSize:v((()=>l.viewSize)),wrapper:r,svg:a,viewBox:l.viewBox,focus(){a.value&&a.value.focus()},wheel:e=>l.wheel(e,!0),downLeft:()=>{l.mousePoint.value&&(l.downLeft(),t("down-left",l.viewToCanvas(l.mousePoint.value)))},upLeft:()=>{l.upLeft(),t("up-left")},downMiddle:l.downMiddle,upMiddle:l.upMiddle,leave:l.leave,mousemove:e=>{l.mousePoint.value=S(e),l.dragInfo.value?t("drag",l.viewToCanvas(l.mousePoint.value)):l.viewMovingInfo.value?l.viewMove():l.editStartPoint.value&&t("mousemove",{current:l.viewToCanvas(l.mousePoint.value),start:l.viewToCanvas(l.editStartPoint.value)})},clickAny(e){e.target===a.value?(l.editStartPoint.value=void 0,t("click-empty")):t("click-any")},keyDownEscape:()=>{t("escape")},editKeyDown(e){l.mousePoint.value&&(l.editStartPoint.value=l.mousePoint.value,t(e))}}}});const ba=$("data-v-5868f1c8");j("data-v-5868f1c8");const wa={ref:"wrapper",class:"timeline-canvas-root"};D();const ka=ba(((e,t,a,n,r,l)=>(g(),h("div",wa,[(g(),h("svg",{ref:"svg",tabindex:"-1",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"none","font-family":"sans-serif",viewBox:e.viewBox,width:e.viewSize.width,height:e.viewSize.height,onWheel:t[1]||(t[1]=B(((...t)=>e.wheel&&e.wheel(...t)),["prevent"])),onClick:t[2]||(t[2]=B(((...t)=>e.clickAny&&e.clickAny(...t)),["left"])),onContextmenu:t[3]||(t[3]=B(((...t)=>e.keyDownEscape&&e.keyDownEscape(...t)),["right","prevent"])),onMouseenter:t[4]||(t[4]=(...t)=>e.focus&&e.focus(...t)),onMousedown:[t[5]||(t[5]=B(((...t)=>e.downLeft&&e.downLeft(...t)),["left","prevent"])),t[8]||(t[8]=B(((...t)=>e.downMiddle&&e.downMiddle(...t)),["middle","prevent"]))],onMouseup:[t[6]||(t[6]=B(((...t)=>e.upLeft&&e.upLeft(...t)),["left","prevent"])),t[9]||(t[9]=B(((...t)=>e.upMiddle&&e.upMiddle(...t)),["middle","prevent"]))],onMousemove:t[7]||(t[7]=B(((...t)=>e.mousemove&&e.mousemove(...t)),["prevent"])),onMouseleave:t[10]||(t[10]=(...t)=>e.leave&&e.leave(...t)),onKeydown:[t[11]||(t[11]=I(B(((...t)=>e.keyDownEscape&&e.keyDownEscape(...t)),["exact","prevent"]),["escape"])),t[12]||(t[12]=I(B((t=>e.editKeyDown("g")),["exact","prevent"]),["g"])),t[13]||(t[13]=I(B((t=>e.editKeyDown("x")),["exact","prevent"]),["x"]))]},[E(e.$slots,"default",{scale:e.scale,viewOrigin:e.viewOrigin,viewSize:e.viewSize})],40,["viewBox","width","height"]))],512))));xa.render=ka,xa.__scopeId="data-v-5868f1c8";var Sa=f({props:{labelWidth:{type:Number,default:100},index:{type:Number,required:!0},label:{type:String,required:!0}},setup:()=>({height:24})});Sa.render=function(e,t,a,n,r,l){return g(),h("g",{transform:`translate(0, ${e.index*e.height})`},[y("rect",{width:e.labelWidth,height:e.height,fill:"#fff",stroke:"black"},null,8,["width","height"]),y("text",{x:"4",y:e.height/2,"dominant-baseline":"central"},O(e.label),9,["y"])],8,["transform"])};function Ma(e){return Math.round(function(e){return Math.round(Math.log(e)/Math.log(1.1))}(e)/2)+1}var Aa=f({props:{scale:{type:Number,default:1},originX:{type:Number,default:0},viewWidth:{type:Number,default:100},currentFrame:{type:Number,default:0},endFrame:{type:Number,default:60}},emits:["down-current-frame","up-current-frame"],setup(e,{emit:t}){const a=v((()=>Ma(e.scale))),n=v((()=>function(e,t){const a=Math.floor(Math.max(t,0)/20);return a-a%(2*e)}(a.value,e.originX))),r=v((()=>Math.ceil(e.viewWidth*e.scale/20))),l=v((()=>Math.floor(r.value/a.value))),o=v((()=>[...Array(l.value)].map(((e,t)=>{const r=t*a.value+n.value;return{f:r,labelSize:r%10==0?14:r%2==0?11:0,strokeWidth:r%10==0?2:1}})))),d=v((()=>20*e.currentFrame)),s=v((()=>10*Math.max(e.currentFrame.toString().length,2)+2));return{headerHeight:24,frames:o,frameWidth:20,currentFrameX:d,endFrameX:v((()=>20*e.endFrame)),currentFrameLabelWidth:s,downCurrentFrame:()=>t("down-current-frame")}}});const Ba=$("data-v-d1cae906");j("data-v-d1cae906");const Ia={class:"view-only"},Ca={fill:"#aaa",stroke:"none","fill-opacity":"0.5"},Ea=y("g",{transform:"scale(-1, 1)"},[y("rect",{width:"200000",height:"200000"})],-1),Oa=y("rect",{width:"200000",height:"200000"},null,-1);D();const $a=Ba(((e,t,a,n,r,l)=>(g(),h("g",null,[y("g",{transform:`scale(${e.scale})`,onMousedown:t[1]||(t[1]=B(((...t)=>e.downCurrentFrame&&e.downCurrentFrame(...t)),["left"]))},[y("rect",{x:"-100000",width:"200000",height:e.headerHeight,fill:"#fff",stroke:"#000"},null,8,["height"])],40,["transform"]),y("g",Ia,[y("g",null,[(g(!0),h(F,null,T(e.frames,(t=>(g(),h("g",{key:t,transform:`translate(${t.f*e.frameWidth}, 0)`},[y("g",{transform:`scale(${e.scale})`},[t.labelSize>0?(g(),h("text",{key:0,y:e.headerHeight-4,"font-size":t.labelSize,"dominant-baseline":"text-after-edge","text-anchor":"middle"},O(t.f),9,["y","font-size"])):C("",!0),t.strokeWidth>0?(g(),h("line",{key:1,x1:"0",y1:e.headerHeight,x2:"0",y2:"20000",stroke:"#aaa","stroke-width":t.strokeWidth},null,8,["y1","stroke-width"])):C("",!0)],8,["transform"])],8,["transform"])))),128))]),y("g",Ca,[Ea,y("g",{transform:`translate(${e.endFrameX}, 0)`},[Oa],8,["transform"])]),y("g",{transform:`translate(${e.currentFrameX}, 0) scale(${e.scale})`},[y("rect",{x:-e.currentFrameLabelWidth/2,y:2,width:e.currentFrameLabelWidth,height:20,rx:"4",ry:"4",fill:"blue",stroke:"none"},null,8,["x","width"]),y("text",{y:e.headerHeight-4,"font-size":"12","dominant-baseline":"text-after-edge","text-anchor":"middle",fill:"#fff"},O(e.currentFrame),9,["y"]),y("line",{x1:"0",y1:e.headerHeight,x2:"0",y2:"20000",stroke:"blue","stroke-width":"2"},null,8,["y1"])],8,["transform"])])]))));Aa.render=$a,Aa.__scopeId="data-v-d1cae906";var ja=f({components:{SelectField:ta,TimelineCanvas:xa,TimelineRow:Sa,TimelineAxis:Aa},setup(){const e=He(),t=Mt(),a=b(""),n=b(""),r=b(""),l=v((()=>t.selectedAction.value)),o=v((()=>{var t,a;return null!=(a=null==(t=e.lastSelectedArmature.value)?void 0:t.borns)?a:[]})),d=v((()=>t.actions.map((t=>{var a;const n=(null==(a=e.lastSelectedArmature.value)?void 0:a.id)!==t.armatureId;return{value:t.id,label:`${n?"(x)":""} ${t.name}`}}))));function s(e){var n;"move-current-frame"===a.value&&(t.currentFrame.value=(n=e.x-140-20,Math.round(Math.max(n,0)/20)))}return W((()=>{var e,t;n.value=null!=(t=null==(e=l.value)?void 0:e.name)?t:""})),W((()=>{r.value=t.endFrame.value.toString()})),{actions:t.actions,selectedBorns:o,draftName:n,draftEndFrame:r,labelWidth:140,axisPadding:20,currentFrame:t.currentFrame,endFrame:t.endFrame,changeActionName:()=>{n.value&&t.updateAction({name:n.value})},changeEndFrame:()=>{const e=parseInt(r.value,10);!isNaN(e)&&e>=0?t.setEndFrame(e):r.value=t.endFrame.value.toString()},addAction:t.addAction,deleteAction:t.deleteAction,actionOptions:d,selectedActionId:v({get:()=>{var e,t;return null!=(t=null==(e=l.value)?void 0:e.id)?t:""},set:e=>t.selectAction(e)}),downCurrentFrame:function(){a.value="move-current-frame"},downLeft:function(e){s(e)},drag:s,upLeft:function(){a.value=""}}}});const Da=$("data-v-54016e66");j("data-v-54016e66");const Fa={class:"animation-panel-root"},Ta={class:"top"},La={class:"select-action"},Na={class:"end-frame-field"},Pa=U("End: "),za={class:"middle"};D();const _a=Da(((e,t,a,n,r,l)=>{const o=A("SelectField"),d=A("TimelineAxis"),s=A("TimelineRow"),c=A("TimelineCanvas");return g(),h("div",Fa,[y("div",Ta,[y("div",La,[y(o,{modelValue:e.selectedActionId,"onUpdate:modelValue":t[1]||(t[1]=t=>e.selectedActionId=t),options:e.actionOptions},null,8,["modelValue","options"])]),L(y("input",{"onUpdate:modelValue":t[2]||(t[2]=t=>e.draftName=t),type:"text",onChange:t[3]||(t[3]=(...t)=>e.changeActionName&&e.changeActionName(...t))},null,544),[[z,e.draftName]]),y("button",{class:"add-action",onClick:t[4]||(t[4]=(...t)=>e.addAction&&e.addAction(...t))},"+"),y("button",{class:"delete-action",onClick:t[5]||(t[5]=(...t)=>e.deleteAction&&e.deleteAction(...t))},"x"),y("label",Na,[Pa,L(y("input",{"onUpdate:modelValue":t[6]||(t[6]=t=>e.draftEndFrame=t),type:"number",onChange:t[7]||(t[7]=(...t)=>e.changeEndFrame&&e.changeEndFrame(...t))},null,544),[[z,e.draftEndFrame]])])]),y("div",za,[y(c,{onUpLeft:e.upLeft,onDrag:e.drag,onDownLeft:e.downLeft},{default:Da((({scale:t,viewOrigin:a,viewSize:n})=>[y("g",{transform:`translate(${e.labelWidth+e.axisPadding}, ${a.y})`},[y(d,{scale:t,"origin-x":a.x,"view-width":n.width,"current-frame":e.currentFrame,"end-frame":e.endFrame,onDownCurrentFrame:e.downCurrentFrame},null,8,["scale","origin-x","view-width","current-frame","end-frame","onDownCurrentFrame"])],8,["transform"]),y("g",{transform:`translate(${a.x}, ${a.y}) scale(${t})`},[y("g",null,[y("rect",{width:e.labelWidth,height:"10000",stroke:"none",fill:"#fff"},null,8,["width"]),y("line",{x1:e.labelWidth,y1:"0",x2:e.labelWidth,y2:"10000",stroke:"black"},null,8,["x1","x2"]),y(s,{index:1,"label-width":e.labelWidth,label:"Summary"},null,8,["label-width"]),(g(!0),h(F,null,T(e.selectedBorns,((t,a)=>(g(),h(s,{key:t.id,index:a+2,"label-width":e.labelWidth,label:t.name},null,8,["index","label-width","label"])))),128))])],8,["transform"])])),_:1},8,["onUpLeft","onDrag","onDownLeft"])])])}));ja.render=_a,ja.__scopeId="data-v-54016e66";const Wa=u({selectedColor:"orange"});function Ua(e,t,a=!1){return o(e,s(c(i(t,e),.15),Math.PI/4*(a?-1:1)))}var Va=f({props:{born:{type:Object,required:!0},parent:{type:Object,default:void 0},opacity:{type:Number,default:1},selectedState:{type:Object,default:()=>({head:!1,tail:!1})},poseMode:{type:Boolean,default:!1}},emits:["select","shift-select"],setup(e,{emit:t}){const{settings:a}={settings:Wa},r=v((()=>e.born.head)),l=v((()=>e.born.tail)),o=v((()=>Ua(r.value,l.value))),d=v((()=>Ua(r.value,l.value,!0))),s=v((()=>e.poseMode?e.selectedState.head||e.selectedState.tail:e.selectedState.head&&e.selectedState.tail));return{transform:v((()=>K(e.born.transform))),head:r,tail:l,headPath:v((()=>H([r.value,o.value,d.value],!0))),tailPath:v((()=>H([l.value,o.value,d.value],!0))),fill:v((()=>s.value?a.selectedColor:"#ddd")),fillDark:v((()=>s.value?a.selectedColor:"#bbb")),fillHead:v((()=>e.selectedState.head?a.selectedColor:"")),fillTail:v((()=>e.selectedState.tail?a.selectedColor:"")),click:a=>{e.poseMode?s.value?t("select",{head:!1,tail:!1}):t("select",{head:!0,tail:!0}):t("select",a)},shiftClick:a=>{e.poseMode||a.head&&a.tail?s.value?t("shift-select",{head:!1,tail:!1}):t("shift-select",{head:!0,tail:!0}):a.head?t("shift-select",n(n({},e.selectedState),{head:!e.selectedState.head})):a.tail&&t("shift-select",n(n({},e.selectedState),{tail:!e.selectedState.tail}))}}}});const Ga=$("data-v-13fd028e")(((e,t,a,n,r,l)=>(g(),h("g",{stroke:"black",fill:e.fill,transform:e.transform,opacity:e.opacity},[y("g",{onClick:[t[1]||(t[1]=B((t=>e.click({head:!0,tail:!0})),["exact"])),t[2]||(t[2]=B((t=>e.shiftClick({head:!0,tail:!0})),["shift","exact"]))]},[y("path",{d:e.headPath,fill:e.fillDark},null,8,["d","fill"]),y("path",{d:e.tailPath},null,8,["d"])]),y("circle",{r:"10",cx:e.head.x,cy:e.head.y,fill:e.fillHead,onClick:[t[3]||(t[3]=B((t=>e.click({head:!0,tail:!1})),["exact"])),t[4]||(t[4]=B((t=>e.shiftClick({head:!0,tail:!1})),["shift","exact"]))]},null,8,["cx","cy","fill"]),y("circle",{r:"10",cx:e.tail.x,cy:e.tail.y,fill:e.fillTail,onClick:[t[5]||(t[5]=B((t=>e.click({head:!1,tail:!0})),["exact"])),t[6]||(t[6]=B((t=>e.shiftClick({head:!1,tail:!0})),["shift","exact"]))]},null,8,["cx","cy","fill"]),e.parent?(g(),h("line",{key:0,x1:e.parent.tail.x,y1:e.parent.tail.y,x2:e.head.x,y2:e.head.y,"stroke-dasharray":"2 2",class:"view-only"},null,8,["x1","y1","x2","y2"])):C("",!0),y("text",{x:(e.head.x+e.tail.x)/2,y:(e.head.y+e.tail.y)/2,"text-anchor":"middle",fill:"black",stroke:"none",class:"view-only"},O(e.born.name),9,["x","y"])],8,["fill","transform","opacity"]))));Va.render=Ga,Va.__scopeId="data-v-13fd028e";var Ka=f({components:{BornElm:Va},props:{armature:{type:Object,required:!0},opacity:{type:Number,default:.8},selected:{type:Boolean,default:!1}},emits:["select","shift-select"],setup:(e,{emit:t})=>({bornMap:v((()=>ee(e.armature.borns))),transform:v((()=>K(e.armature.transform))),bornSelectedState:v((()=>e.selected?{head:!0,tail:!0}:void 0)),click:()=>t("select",!e.selected),shiftClick:()=>t("shift-select",!e.selected)})});const Ha=$("data-v-e1a73d3c")(((e,t,a,n,r,l)=>{const o=A("BornElm");return g(),h("g",{stroke:"black",transform:e.transform,opacity:e.opacity},[(g(!0),h(F,null,T(e.armature.borns,(t=>(g(),h(o,{key:t.name,born:t,"selected-state":e.bornSelectedState,parent:e.bornMap[t.parentId],onSelect:e.click,onShiftSelect:e.shiftClick},null,8,["born","selected-state","parent","onSelect","onShiftSelect"])))),128))],8,["transform","opacity"])}));Ka.render=Ha,Ka.__scopeId="data-v-e1a73d3c";var Ra=f({components:{AppCanvas:Wt,ArmatureElm:Ka,BornElm:Va,SidePanel:oa,AnimationPanel:ja},setup(){const e=He(),t=Pt(),a=Mt(),r=Ae(),l=v((()=>t.state.canvasMode)),o=v((()=>e.lastSelectedArmature.value)),d=v((()=>e.state.armatures.filter((t=>{var a;return t.id!==(null==(a=e.lastSelectedArmature.value)?void 0:a.id)})))),s=v((()=>{if(!o.value)return{};if("edit"===l.value)return ee(o.value.borns.map((a=>oe(a,t.getEditTransforms(a.id),e.state.selectedBorns[a.id]||[]))));{const e=me(ee(o.value.borns.map((e=>n(n({},e),{transform:re([a.getCurrentSelfTransforms(e.id),t.getEditTransforms(e.id)])})))));return Object.keys(e).reduce(((t,a)=>{const n=e[a];return t[a]=de(n,[n.transform]),t}),{})}})),c=v((()=>{return"grab"===(e=t.command.value)||"extrude"===e?"grab":"rotate"===e?"rotate":"scale"===e?"scale":"";var e}));function i(e){var t;["input","textarea"].includes(null==(t=e.target)?void 0:t.tagName.toLowerCase())||e.ctrlKey&&"z"===e.key.toLowerCase()&&(e.preventDefault(),e.shiftKey?r.redo():r.undo())}return k((()=>{document.addEventListener("keydown",i)})),V((()=>{document.removeEventListener("keydown",i)})),{armatures:v((()=>e.state.armatures)),otherArmatures:d,lastSelectedArmatureId:v((()=>{var t;return null==(t=e.lastSelectedArmature.value)?void 0:t.id})),editBornMap:s,selectedBorns:v((()=>e.state.selectedBorns)),canvasMode:l,canvasCommand:c,mousemove(e){t.mousemove(e)},clickAny(){t.clickAny()},clickEmpty(){t.clickEmpty()},selectBorn(e,a){t.select(e,a)},shiftSelectBorn(e,a){t.shiftSelect(e,a)},selectArmature(t,a){e.selectArmature(a?t:"")},shiftSelectArmature(t,a){e.selectArmature(a?t:"")},escape(){t.cancel()},toggleCanvasMode(){e.lastSelectedArmature.value&&t.toggleCanvasMode()},ctrlToggleCanvasMode(){e.lastSelectedArmature.value&&t.ctrlToggleCanvasMode()},setEditMode(e){t.setEditMode(e)},execDelete(){t.execDelete()},addItem(){t.execAdd()}}}});const qa=$("data-v-3aae5998");j("data-v-3aae5998");const Xa={class:"main"},Ya={key:0},Ja={key:1},Qa={key:2},Za={class:"bottom"};D();const en=qa(((e,t,a,n,r,l)=>{const o=A("ArmatureElm"),d=A("BornElm"),s=A("AppCanvas"),c=A("SidePanel"),i=A("AnimationPanel");return g(),h("div",null,[y("div",Xa,[y(s,{"current-command":e.canvasCommand,class:"canvas",onMousemove:e.mousemove,onClickAny:e.clickAny,onClickEmpty:e.clickEmpty,onEscape:e.escape,onTab:e.toggleCanvasMode,onCtrlTab:e.ctrlToggleCanvasMode,onG:t[1]||(t[1]=t=>e.setEditMode("grab")),onS:t[2]||(t[2]=t=>e.setEditMode("scale")),onR:t[3]||(t[3]=t=>e.setEditMode("rotate")),onE:t[4]||(t[4]=t=>e.setEditMode("extrude")),onX:e.execDelete,onShiftA:e.addItem},{default:qa((()=>["object"===e.canvasMode?(g(),h("g",Ya,[(g(!0),h(F,null,T(e.armatures,(t=>(g(),h(o,{key:t.id,armature:t,selected:e.lastSelectedArmatureId===t.id,onSelect:a=>e.selectArmature(t.id,a),onShiftSelect:a=>e.shiftSelectArmature(t.id,a)},null,8,["armature","selected","onSelect","onShiftSelect"])))),128))])):C("",!0),"edit"===e.canvasMode?(g(),h("g",Ja,[(g(!0),h(F,null,T(e.otherArmatures,(e=>(g(),h(o,{key:e.id,armature:e,opacity:.3},null,8,["armature","opacity"])))),128)),(g(!0),h(F,null,T(e.editBornMap,(t=>(g(),h(d,{key:t.id,born:t,parent:e.editBornMap[t.parentId],"selected-state":e.selectedBorns[t.id],onSelect:a=>e.selectBorn(t.id,a),onShiftSelect:a=>e.shiftSelectBorn(t.id,a)},null,8,["born","parent","selected-state","onSelect","onShiftSelect"])))),128))])):C("",!0),"pose"===e.canvasMode?(g(),h("g",Qa,[(g(!0),h(F,null,T(e.otherArmatures,(e=>(g(),h(o,{key:e.id,armature:e,opacity:.3},null,8,["armature","opacity"])))),128)),(g(!0),h(F,null,T(e.editBornMap,(t=>(g(),h(d,{key:t.id,born:t,parent:e.editBornMap[t.parentId],"selected-state":e.selectedBorns[t.id],"pose-mode":"",onSelect:a=>e.selectBorn(t.id,a),onShiftSelect:a=>e.shiftSelectBorn(t.id,a)},null,8,["born","parent","selected-state","onSelect","onShiftSelect"])))),128))])):C("",!0)])),_:1},8,["current-command","onMousemove","onClickAny","onClickEmpty","onEscape","onTab","onCtrlTab","onX","onShiftA"]),y(c,{class:"side-panel"})]),y("div",Za,[y(i)])])}));Ra.render=en,Ra.__scopeId="data-v-3aae5998",G(Ra).mount("#app");
