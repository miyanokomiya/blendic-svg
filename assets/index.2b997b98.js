var e=Object.assign;import{v as t,l as a,a as n,d as r,n as l,i as o,r as d,c as i,w as s,b as u,e as c,f as v,g as m,o as f,h as p,j as h,k as y,m as g,p as x,q as w,s as b,t as k,u as S,x as M,y as A,z as B,A as I,B as E,F as C,C as $,D as F,E as L,G as O,H as N,I as D,J as j,K as P,L as z,M as T,N as _}from"./vendor.7342bca8.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(a){const n=new URL(e,location),r=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((a,l)=>{const o=new URL(e,n);if(self[t].moduleMap[o])return a(self[t].moduleMap[o]);const d=new Blob([`import * as m from '${o}';`,`${t}.moduleMap['${o}']=m;`],{type:"text/javascript"}),i=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(d),onerror(){l(new Error(`Failed to import: ${e}`)),r(i)},onload(){a(self[t].moduleMap[o]),r(i)}});document.head.appendChild(i)})),self[t].moduleMap={}}}("/assets/");function W(e){return[`translate(${e.translate.x},${e.translate.y})`,`rotate(${e.rotate})`,`scale(${e.scale.x},${e.scale.y})`].join(" ")}function U(e,t=!1){if(0===e.length)return"";const[a,...n]=e;return`M${a.x},${a.y}`+n.map((e=>`L${e.x},${e.y}`)).join("")+(t?"z":"")}function V(e){return`${e.x} ${e.y} ${e.width} ${e.height}`}const G=/\.[0-9]{3,}$/;function K(e){return G.test(e)?e.replace(G,(e=>"."+`${parseInt(e.slice(1),10)+1}`.padStart(3,"0"))):`${e}.001`}function H(e,t){const a=new Map(t.map((e=>[e,!0])));let n=K(e);for(;a.has(n);)n=K(n);return n}function R(t={}){return e({translate:{x:0,y:0},origin:{x:0,y:0},rotate:0,scale:{x:1,y:1}},t)}function q(a={},n=!1){return e({id:n?t():"",name:"",transform:R(),parentId:"",connected:!1,head:{x:0,y:0},tail:{x:0,y:0}},a)}function X(a={},n=!1){return e({id:n?t():"",name:"",transform:R(),borns:[]},a)}function Y(t){return t.reduce(((t,a)=>e(e({},t),{[a.id]:a})),{})}function J(t,a){return Object.keys(e(e({},t),a)).reduce(((n,r)=>{var l,o;return n[r]=e(e({},null!=(l=t[r])?l:{}),null!=(o=a[r])?o:{}),n}),{})}function Q(e,t){return Object.keys(t).reduce(((t,a)=>(t[a]=e[a],t)),{})}function Z(e,t){return l(r(function(e,t,a){return{x:a.x+(e.x-a.x)*t.x,y:a.y+(e.y-a.y)*t.y}}(e,t.scale,t.origin),t.rotate/180*Math.PI),t.translate)}function ee(t,a,o){const d=function(t){return t.reduce(((t,a)=>{const o={x:a.origin.x*(1-a.scale.x),y:a.origin.y*(1-a.scale.y)},d=n(a.origin,r(a.origin,a.rotate/180*Math.PI));return e(e({},t),{scale:{x:t.scale.x*a.scale.x,y:t.scale.y*a.scale.y},rotate:t.rotate+a.rotate,translate:l(l(l(t.translate,a.translate),o),d)})}),R())}(a),i=o.head?Z(t.head,d):t.head,s=o.tail?Z(t.tail,d):t.tail;return e(e({},t),{head:i,tail:s})}function te(e,t){return e.find((e=>e.id===t))}function ae(t,a,n){const r=te(t.borns,a);if(!r)return{};let l={[a]:n};if(n.head&&r.connected){const a=te(t.borns,r.parentId);a&&(l=e(e({},ae(t,a.id,{tail:!0})),l))}return n.tail&&function(e,t,a=!1){return e.borns.filter((e=>e.parentId===t&&(!a||e.connected)))}(t,r.id,!0).forEach((e=>{l[e.id]={head:!0}})),l}function ne(e){return e.reduce(((t,n)=>{const r=te(e,n.parentId);return r?n.connected&&(t[n.id]={connected:a(r.tail,n.head)}):t[n.id]={connected:!1,parentId:""},t}),{})}const re=d({undoStack:[],redoStack:[]}),le=i((()=>re.undoStack.concat(re.redoStack.concat().reverse()))),oe=i((()=>re.undoStack.length-1));function de(){re.undoStack=[],re.redoStack=[]}function ie(e){re.undoStack.push(e),re.redoStack=[]}function se(){const e=re.undoStack.pop();e&&(e.undo(),re.redoStack.push(e))}function ue(){const e=re.redoStack.pop();e&&(e.redo(),re.undoStack.push(e))}function ce(){return{state:re,allStack:le,currentItemIndex:oe,clearHistory:de,push:ie,undo:se,redo:ue}}const ve=ce(),me=d(X({name:"armature",borns:[q({name:"born",head:{x:20,y:200},tail:{x:220,y:200}},!0)]},!0)),fe=d({armatures:[me],lastSelectedArmatureId:"",lastSelectedBornId:"",selectedArmatures:{},selectedBorns:{}}),pe=i((()=>fe.armatures.findIndex((e=>e.id===fe.lastSelectedArmatureId&&fe.selectedArmatures[fe.lastSelectedArmatureId])))),he=i((()=>-1!==pe.value?fe.armatures[pe.value]:void 0)),ye=i((()=>he.value?he.value.borns.findIndex((e=>{var t,a;return e.id===fe.lastSelectedBornId&&((null==(t=fe.selectedBorns[fe.lastSelectedBornId])?void 0:t.head)||(null==(a=fe.selectedBorns[fe.lastSelectedBornId])?void 0:a.tail))})):-1)),ge=i((()=>{if(he.value)return-1!==ye.value?he.value.borns[ye.value]:void 0})),xe=i((()=>Y(fe.armatures))),we=i((()=>{var e,t;return Y(null!=(t=null==(e=he.value)?void 0:e.borns)?t:[])})),be=i((()=>function(e,t){const a=Object.keys(t).map((a=>{const n=[];return t[a].head&&n.push(e[a].head),t[a].tail&&n.push(e[a].tail),n})).flat();return 0===a.length?{x:0,y:0}:o(a.reduce(((e,t)=>l(e,t)),{x:0,y:0}),1/a.length)}(we.value,fe.selectedBorns)));function ke(e=""){if(fe.lastSelectedArmatureId===e)return;const t=Oe(e);t.redo(),ve.push(t)}function Se(t){if(!he.value)return;const a=function(t){const a=Q(he.value,t);return{name:"Update Armature",undo:()=>{const t=pe.value;fe.armatures[t]=e(e({},fe.armatures[t]),a)},redo:()=>{const a=pe.value;fe.armatures[a]=e(e({},fe.armatures[a]),t)}}}({name:t});a.redo(),ve.push(a)}function Me(){const t=function(){const t=e({},he.value),a=pe.value,n=Oe("");return{name:"Delete Armature",undo:()=>{fe.armatures.splice(a,0,t),n.undo()},redo:()=>{fe.armatures.splice(a,1)}}}();t.redo(),ve.push(t)}function Ae(){const e=function(e){const t=fe.armatures.length,a=Oe(e.id);return{name:"Add Armature",undo:()=>{fe.armatures.splice(t,1),a.undo()},redo:()=>{fe.armatures.push(e),a.redo()}}}(X({name:H("armature",fe.armatures.map((e=>e.name))),borns:[q({name:"born",tail:{x:100,y:0}},!0)]},!0));e.redo(),ve.push(e)}function Be(e="",t={head:!0,tail:!0},a=!1){if(!he.value)return;if(fe.lastSelectedBornId===e&&(n=fe.selectedBorns[e],r=t,!!(null==n?void 0:n.head)==!!(null==r?void 0:r.head)&&!!(null==n?void 0:n.tail)==!!(null==r?void 0:r.tail)))return;var n,r;const l=Ne(e,t,a);l.redo(),ve.push(l)}function Ie(){if(!he.value)return;const e=function(){const e=he.value.borns.concat(),t=he.value.borns.filter((e=>!fe.selectedBorns[e.id])),a=De(ne(t)),n=Ne("");return{name:"Delete Born",undo:()=>{he.value.borns=e.concat(),n.undo(),a.undo()},redo:()=>{he.value.borns=t,a.redo()}}}();e.redo(),ve.push(e)}function Ee(){he.value&&Ce([q({name:H("born",he.value.borns.map((e=>e.name))),tail:{x:100,y:0}},!0)])}function Ce(t,a){if(!he.value)return;const n=function(e,t){const a=e.map(((e,a)=>Ne(e.id,t[e.id],0!==a)));return{name:"Add Born",undo:()=>{he.value.borns=he.value.borns.slice(0,he.value.borns.length-e.length),a.forEach((e=>e.undo()))},redo:()=>{he.value.borns=he.value.borns.concat(e),a.forEach((e=>e.redo()))}}}(t,t.reduce(((t,n)=>(a&&(t[n.id]=e({},a)),t)),{}));n.redo(),ve.push(n)}function $e(e){if(!he.value)return;const t=De(e);t.redo(),ve.push(t)}function Fe(t){if(!he.value)return;if(!ge.value)return;const a=function(t){const a=Q(ge.value,t);return{name:"Update Born",undo:()=>{const t=ye.value;he.value.borns[t]=e(e({},he.value.borns[t]),a)},redo:()=>{const a=ye.value;he.value.borns[a]=e(e({},he.value.borns[a]),t)}}}(function(t,a){if(!a.connected)return a;const n=te(t,a.parentId);return e(e({},a),n?{head:n.tail}:{connected:!1,parentId:""})}(he.value.borns,e(e({},ge.value),t)));a.redo(),ve.push(a)}function Le(){return{state:fe,lastSelectedArmature:he,lastSelectedBorn:ge,bornMap:we,selectedBornsOrigin:be,selectArmature:ke,updateArmatureName:Se,deleteArmature:Me,addArmature:Ae,selectBorn:Be,deleteBorn:Ie,addBorn:Ee,addBorns:Ce,updateBorns:$e,updateBorn:Fe}}function Oe(t){const a=e({},fe.selectedArmatures),n=fe.lastSelectedArmatureId;return{name:"Select Armature",undo:()=>{fe.selectedArmatures=e({},a),fe.lastSelectedArmatureId=n},redo:()=>{fe.selectedArmatures=t?{[t]:!0}:{},fe.lastSelectedArmatureId=t}}}function Ne(t,a={head:!0,tail:!0},n=!1){const r=e({},fe.selectedBorns),l=fe.lastSelectedBornId;return{name:"Select Born",undo:()=>{fe.selectedBorns=e({},r),fe.lastSelectedBornId=l},redo:()=>{fe.selectedBorns=t?J(e(e({},n?fe.selectedBorns:{}),{[t]:a}),ae(he.value,t,a)):{},fe.lastSelectedBornId=t}}}function De(t){const a=J(t,ne(he.value.borns.map((a=>e(e({},a),t[a.id]))))),n=Object.keys(a).reduce(((e,t)=>(we.value[t]&&(e[t]=Q(we.value[t],a[t])),e)),{});return{name:"Update Born",undo:()=>{he.value.borns=he.value.borns.map((t=>e(e({},t),n[t.id])))},redo:()=>{he.value.borns=he.value.borns.map((t=>e(e({},t),a[t.id])))}}}s((()=>fe.selectedArmatures),(()=>{fe.selectedArmatures[fe.lastSelectedArmatureId]||(fe.lastSelectedArmatureId="")})),s((()=>xe.value),(()=>{fe.selectedArmatures=Object.keys(fe.selectedArmatures).reduce(((t,a)=>xe.value[a]?e(e({},t),{[a]:fe.selectedArmatures[a]}):t),{})})),s((()=>fe.selectedBorns),(()=>{if(!(e=fe.selectedBorns[fe.lastSelectedBornId])||!e.head&&!e.tail){const e=Object.keys(fe.selectedBorns);fe.lastSelectedBornId=e.length>0?e[0]:""}var e})),s((()=>we.value),(()=>{fe.selectedBorns=Object.keys(fe.selectedBorns).reduce(((t,a)=>we.value[a]?e(e({},t),{[a]:fe.selectedBorns[a]}):t),{})}));var je=u({props:{origin:{type:Object,required:!0},current:{type:Object,required:!0},scale:{type:Number,required:!0},side:{type:Boolean,default:!1}},setup:e=>({rotate:i((()=>c(e.current,e.origin)/Math.PI*180))})});const Pe={fill:"black",stroke:"black"},ze=m("circle",{r:"2"},null,-1),Te=m("circle",{r:"2"},null,-1),_e=m("path",{d:"M-20,0L-10,-10L-10,10z"},null,-1),We=m("path",{d:"M20,0L10,-10L10,10z"},null,-1);je.render=function(e,t,a,n,r,l){return f(),v("g",Pe,[m("g",{transform:`translate(${e.origin.x}, ${e.origin.y}) rotate(${e.rotate}) scale(${e.scale})`},[ze],8,["transform"]),m("line",{x1:e.origin.x,y1:e.origin.y,x2:e.current.x,y2:e.current.y,"stroke-width":e.scale,"stroke-dasharray":`${2*e.scale} ${2*e.scale}`},null,8,["x1","y1","x2","y2","stroke-width","stroke-dasharray"]),m("g",{transform:`translate(${e.current.x}, ${e.current.y}) rotate(${e.rotate}) scale(${e.scale})`},[Te,m("g",{transform:`rotate(${e.side?90:0})`},[_e,We],8,["transform"])],8,["transform"])])};const Ue=ce(),Ve=d({canvasMode:"object",axisGrid:""});function Ge(e){const t=function(e){const t=Ve.canvasMode;return{name:"Change Mode",undo:()=>Ve.canvasMode=t,redo:()=>Ve.canvasMode=e}}(e);Ue.push(t),t.redo()}function Ke(e){Ve.axisGrid=e}function He(e){Ve.axisGrid=Ve.axisGrid===e?"":e}function Re(e){return{x:"y"===Ve.axisGrid?1:e.x,y:"x"===Ve.axisGrid?1:e.y}}function qe(e){return{x:"y"===Ve.axisGrid?0:e.x,y:"x"===Ve.axisGrid?0:e.y}}function Xe(e,t,a){return p(n(t,e),n(a,e))<0}function Ye(){return{state:Ve,setCanvasMode:Ge,setAxisGrid:Ke,switchAxisGrid:He,snapScale:Re,snapTranslate:qe,isOppositeSide:Xe}}const Je=d({size:{width:100,height:100}});function Qe(){return{state:Je}}window.addEventListener("resize",(()=>{Je.size={width:window.innerWidth,height:window.innerHeight}}));var Ze=u({components:{ScaleMarker:je},props:{originalViewBox:{type:Object,default:()=>({x:0,y:0,width:600,height:400})},currentCommand:{type:String,default:""}},emits:["mousemove","click-any","click-empty","escape","tab","g","s","r","e","x","y","shift-a"],setup(t,{emit:a}){const r=d({width:600,height:400}),u=h(),c=h(),v=h(),m=h(),f=h(1),p=h({x:0,y:0}),w=h(),b=Le(),k=Ye();function S(e){return l(p.value,o(e,f.value))}const M=i((()=>({x:p.value.x,y:p.value.y,width:r.width*f.value,height:r.height*f.value}))),A=i((()=>V(M.value))),B=i((()=>x(e({x:0,y:0},r)))),I=i((()=>{if(""!==k.state.axisGrid&&v.value)return function(t,a,n,r){return e(e({},{strokeWidth:t}),"x"===a?{from:{x:n.x,y:r.y},to:{x:n.x+n.width,y:r.y},stroke:"red"}:{from:{x:r.x,y:n.y},to:{x:r.x,y:n.y+n.height},stroke:"green"})}(f.value,k.state.axisGrid,M.value,b.selectedBornsOrigin.value)})),E=i((()=>{if(m.value&&["scale","rotate"].includes(t.currentCommand))return{origin:b.selectedBornsOrigin.value,current:S(m.value),side:"rotate"===t.currentCommand}}));function C(){if(!c.value)return;const e=c.value.getBoundingClientRect();r.width=e.width,r.height=e.height}s((()=>t.currentCommand),(e=>{k.setAxisGrid(""),""===e&&(v.value=void 0)}));const $=Qe();return y(C),s((()=>$.state.size),C),{scale:f,viewSize:r,svg:u,wrapper:c,viewBox:A,gridLineElm:I,scaleNaviElm:E,canvasMode:i((()=>k.state.canvasMode)),focus(){u.value&&u.value.focus()},wheel(e){const t=m.value?m.value:B.value,a=S(t);f.value=f.value*Math.pow(1.1,e.deltaY>0?1:-1);const r=S(t);p.value=l(p.value,n(a,r))},downMiddle(){m.value&&(w.value={origin:e({},p.value),downAt:e({},m.value)})},upMiddle(){w.value=void 0},leave(){w.value=void 0},mousemove:e=>{if(m.value=g(e),w.value)p.value=l(w.value.origin,o(n(w.value.downAt,m.value),f.value));else{if(!v.value)return;a("mousemove",{current:S(m.value),start:S(v.value)})}},clickAny(e){e.target===u.value?(v.value=void 0,a("click-empty")):a("click-any")},keyDownTab:()=>{a("tab")},keyDownEscape:()=>{a("escape")},editKeyDown(e){m.value&&(!["grab","scale"].includes(t.currentCommand)||"x"!==e&&"y"!==e?(v.value=m.value,a(e)):k.switchAxisGrid(e))}}}});const et=B("data-v-7ff760c8");I("data-v-7ff760c8");const tt={ref:"wrapper",class:"app-canvas-root"},at={class:"help"};E();const nt=et(((e,t,a,n,r,l)=>{const o=w("ScaleMarker");return f(),v("div",tt,[(f(),v("svg",{ref:"svg",tabindex:"-1",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"none","font-family":"sans-serif",viewBox:e.viewBox,width:e.viewSize.width,height:e.viewSize.height,onWheel:t[1]||(t[1]=b(((...t)=>e.wheel&&e.wheel(...t)),["prevent"])),onClick:t[2]||(t[2]=b(((...t)=>e.clickAny&&e.clickAny(...t)),["left"])),onContextmenu:t[3]||(t[3]=b(((...t)=>e.keyDownEscape&&e.keyDownEscape(...t)),["right","prevent"])),onMouseenter:t[4]||(t[4]=(...t)=>e.focus&&e.focus(...t)),onMousemove:t[5]||(t[5]=b(((...t)=>e.mousemove&&e.mousemove(...t)),["prevent"])),onMousedown:t[6]||(t[6]=b(((...t)=>e.downMiddle&&e.downMiddle(...t)),["middle","prevent"])),onMouseup:t[7]||(t[7]=b(((...t)=>e.upMiddle&&e.upMiddle(...t)),["middle","prevent"])),onMouseleave:t[8]||(t[8]=(...t)=>e.leave&&e.leave(...t)),onKeydown:[t[9]||(t[9]=k(b(((...t)=>e.keyDownEscape&&e.keyDownEscape(...t)),["exact","prevent"]),["escape"])),t[10]||(t[10]=k(b(((...t)=>e.keyDownTab&&e.keyDownTab(...t)),["exact","prevent"]),["tab"])),t[11]||(t[11]=k(b((t=>e.editKeyDown("g")),["exact","prevent"]),["g"])),t[12]||(t[12]=k(b((t=>e.editKeyDown("s")),["exact","prevent"]),["s"])),t[13]||(t[13]=k(b((t=>e.editKeyDown("r")),["exact","prevent"]),["r"])),t[14]||(t[14]=k(b((t=>e.editKeyDown("e")),["exact","prevent"]),["e"])),t[15]||(t[15]=k(b((t=>e.editKeyDown("x")),["exact","prevent"]),["x"])),t[16]||(t[16]=k(b((t=>e.editKeyDown("y")),["exact","prevent"]),["y"])),t[17]||(t[17]=k(b((t=>e.editKeyDown("shift-a")),["shift","exact","prevent"]),["a"]))]},[m("rect",{x:e.originalViewBox.x,y:e.originalViewBox.y,width:e.originalViewBox.width,height:e.originalViewBox.height,fill:"none",stroke:"black","stroke-width":"1","stroke-dasharray":"4 4"},null,8,["x","y","width","height"]),e.gridLineElm?(f(),v("line",{key:0,x1:e.gridLineElm.from.x,y1:e.gridLineElm.from.y,x2:e.gridLineElm.to.x,y2:e.gridLineElm.to.y,stroke:e.gridLineElm.stroke,"stroke-width":e.gridLineElm.strokeWidth},null,8,["x1","y1","x2","y2","stroke","stroke-width"])):S("",!0),M(e.$slots,"default"),e.scaleNaviElm?(f(),v(o,{key:1,origin:e.scaleNaviElm.origin,current:e.scaleNaviElm.current,scale:e.scale,side:e.scaleNaviElm.side},null,8,["origin","current","scale","side"])):S("",!0)],40,["viewBox","width","height"])),m("div",at,[m("p",null,"Mode: "+A(e.canvasMode),1)])],512)}));Ze.render=nt,Ze.__scopeId="data-v-7ff760c8";var rt=u({props:{tabs:{type:Array,default:()=>[]}},setup(e){var t,a;const n=h(null!=(a=null==(t=e.tabs[0])?void 0:t.key)?a:"");return{current:n,setTab:e=>n.value=e}}});const lt=B("data-v-16db2673");I("data-v-16db2673");const ot={class:"tab-panel-root"},dt={class:"panels"};E();const it=lt(((e,t,a,n,r,l)=>(f(),v("div",ot,[m("ul",null,[(f(!0),v(C,null,$(e.tabs,(t=>(f(),v("li",{key:t.key,class:{current:t.key===e.current}},[m("a",{href:"#",onClick:b((a=>e.setTab(t.key)),["prevent"])},A(t.label),9,["onClick"])],2)))),128))]),m("div",dt,[(f(!0),v(C,null,$(e.tabs,(t=>F((f(),v("div",{key:t.key},[M(e.$slots,t.key)],512)),[[L,t.key===e.current]]))),128))])]))));rt.render=it,rt.__scopeId="data-v-16db2673";var st=u({setup(){const e=ce();return{allStack:i((()=>e.allStack.value)),currentItemIndex:i((()=>e.currentItemIndex.value))}}});const ut=B("data-v-65f8ee82");I("data-v-65f8ee82");const ct=m("h3",null,"history",-1);E();const vt=ut(((e,t,a,n,r,l)=>(f(),v("div",null,[ct,m("ul",null,[(f(!0),v(C,null,$(e.allStack,((t,a)=>(f(),v("li",{key:a,class:{current:a===e.currentItemIndex}},A(t.name),3)))),128))])]))));st.render=vt,st.__scopeId="data-v-65f8ee82";var mt=u({props:{options:{type:Array,default:()=>[]},modelValue:{type:[Number,String],default:""}},emits:["update:modelValue"],setup:(e,{emit:t})=>({value:i({get:()=>e.modelValue,set(e){t("update:modelValue",e)}})})});const ft=B("data-v-fddf1844");I("data-v-fddf1844");const pt={class:"select-root"},ht=m("option",{value:""},"-- None --",-1);E();const yt=ft(((e,t,a,n,r,l)=>(f(),v("span",pt,[F(m("select",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.value=t)},[ht,(f(!0),v(C,null,$(e.options,(e=>(f(),v("option",{key:e.value,value:e.value},A(e.label),9,["value"])))),128))],512),[[O,e.value]])]))));mt.render=yt,mt.__scopeId="data-v-fddf1844";var gt=u({components:{TabPanel:rt,HistoryStack:st,SelectField:mt},setup(){const e=Le(),t=h(""),a=i((()=>e.lastSelectedArmature.value?e.lastSelectedArmature.value.borns.filter((t=>{var a;return t.id!==(null==(a=e.lastSelectedBorn.value)?void 0:a.id)})).map((e=>({value:e.id,label:e.name}))):[])),n=i((()=>e.lastSelectedBorn.value?"born":e.lastSelectedArmature.value?"armature":""));function r(){e.lastSelectedBorn.value?t.value=e.lastSelectedBorn.value.name:e.lastSelectedArmature.value?t.value=e.lastSelectedArmature.value.name:t.value=""}return s(e.lastSelectedArmature,r),s(e.lastSelectedBorn,r),{draftName:t,lastSelectedArmature:e.lastSelectedArmature,lastSelectedBorn:e.lastSelectedBorn,parentOptions:a,selectedObjectType:n,connected:i({get(){var t,a;return null!=(a=null==(t=e.lastSelectedBorn.value)?void 0:t.connected)&&a},set(t){e.updateBorn({connected:t})}}),parentId:i({get(){var t,a;return null!=(a=null==(t=e.lastSelectedBorn.value)?void 0:t.parentId)?a:""},set(t){e.updateBorn({parentId:t})}}),changeArmatureName(){t.value&&e.updateArmatureName(t.value)},changeBornName(){t.value&&e.updateBorn({name:t.value})}}}});const xt=B("data-v-a1a2983c");I("data-v-a1a2983c");const wt=m("h3",null,"Armature",-1),bt={class:"field inline"},kt=m("label",null,"Name",-1),St=m("h3",null,"Born",-1),Mt={class:"field inline"},At=m("label",null,"Name",-1),Bt={class:"field inline"},It=m("label",null,"Parent",-1),Et={class:"field inline"},Ct=m("label",null,"Connect",-1);E();const $t=xt(((e,t,a,n,r,l)=>{const o=w("SelectField"),d=w("HistoryStack"),i=w("TabPanel");return f(),v("div",null,[m(i,{tabs:[{key:"detail",label:"Detail"},{key:"history",label:"History"}]},{detail:xt((()=>["armature"===e.selectedObjectType?(f(),v("form",{key:0,onSubmit:t[3]||(t[3]=b((()=>{}),["prevent"]))},[wt,m("div",bt,[kt,F(m("input",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.draftName=t),type:"text",onChange:t[2]||(t[2]=(...t)=>e.changeArmatureName&&e.changeArmatureName(...t))},null,544),[[N,e.draftName]])])],32)):S("",!0),"born"===e.selectedObjectType?(f(),v("form",{key:1,onSubmit:t[8]||(t[8]=b((()=>{}),["prevent"]))},[St,m("div",Mt,[At,F(m("input",{"onUpdate:modelValue":t[4]||(t[4]=t=>e.draftName=t),type:"text",onChange:t[5]||(t[5]=(...t)=>e.changeBornName&&e.changeBornName(...t))},null,544),[[N,e.draftName]])]),m("div",Bt,[It,m(o,{modelValue:e.parentId,"onUpdate:modelValue":t[6]||(t[6]=t=>e.parentId=t),options:e.parentOptions},null,8,["modelValue","options"])]),m("div",Et,[Ct,F(m("input",{"onUpdate:modelValue":t[7]||(t[7]=t=>e.connected=t),type:"checkbox",disabled:!e.parentId},null,8,["disabled"]),[[D,e.connected]])])],32)):S("",!0)])),history:xt((()=>[m(d)])),_:1})])}));gt.render=$t,gt.__scopeId="data-v-a1a2983c";const Ft=ce();function Lt(t,a){const n=e({},t.selectedMap),r=t.lastSelectedId;return{name:`Select ${t.label}`,undo:()=>{t.selectedMap=e({},n),t.lastSelectedId=r},redo:()=>{t.selectedMap=a?{[a]:!0}:{},t.lastSelectedId=a}}}const Ot=h(0),Nt=h(60),Dt=function(t){const a=d({label:t,list:[],lastSelectedId:"",selectedMap:{}}),n=i((()=>a.list.findIndex((e=>e.id===a.lastSelectedId&&a.selectedMap[a.lastSelectedId])))),r=i((()=>Y(a.list))),l=i((()=>-1!==n.value?a.list[n.value]:void 0));return s((()=>a.selectedMap),(()=>{a.selectedMap[a.lastSelectedId]||(a.lastSelectedId="")})),s((()=>r.value),(()=>{a.selectedMap=Object.keys(a.selectedMap).reduce(((t,n)=>r.value[n]?e(e({},t),{[n]:a.selectedMap[n]}):t),{})})),{state:a,itemMap:r,lastSelectedItem:l,selectItem:function(e){if(a.lastSelectedId===e)return;const t=Lt(a,e);t.redo(),Ft.push(t)},addItem:function(e){const t=function(e,t){const a=e.list.length,n=Lt(e,t.id),r=()=>{e.list.push(t),n.redo()};return{name:`Add ${e.label}`,undo:()=>{e.list.splice(a,1),n.undo()},redo:r}}(a,e);t.redo(),Ft.push(t)},deleteItem:function(){if(-1===n.value)return;const t=function(t,a){const n=e({},t.list[a]),r=a,l=Lt(t,""),o=()=>{t.list.splice(r,1)};return{name:`Delete ${t.label}`,undo:()=>{t.list.splice(r,0,n),l.undo()},redo:o}}(a,n.value);t.redo(),Ft.push(t)},updateItem:function(t){if(-1===n.value)return;const r=function(t,a,n){const r=Q(t.list[n],a),l=()=>{t.list[n]=e(e({},t.list[n]),a)};return{name:`Update ${t.label}`,undo:()=>{t.list[n]=e(e({},t.list[n]),r)},redo:l}}(a,t,n.value);r.redo(),Ft.push(r)}}}("Action"),jt=ce(),Pt=Le();function zt(){Pt.lastSelectedArmature.value&&Dt.addItem(function(a={},n=!1){return e({id:n?t():"",name:"",totalFrame:60,armatureId:"",keyframes:[]},a)}({name:H("action",Dt.state.list.map((e=>e.name))),armatureId:Pt.lastSelectedArmature.value.id},!0))}function Tt(e){if(Nt.value===e)return;const t=function(e){const t=Nt.value;return{name:"Update End Frame",undo:()=>{Nt.value=t},redo:()=>{Nt.value=e}}}(e);t.redo(),jt.push(t)}var _t=u({emits:["down-left","up-left","mousemove","drag","click-any","click-empty","escape","g","x"],setup(t,{emit:a}){const r=h(),u=h(),c=function(t={}){const a=d({width:600,height:100}),r=h(),s=h(),u=h(1),c=h({x:0,y:0}),v=h(),m=h(),f=i((()=>({x:c.value.x,y:c.value.y,width:a.width*u.value,height:a.height*u.value}))),p=i((()=>x(e({x:0,y:0},a)))),y=i((()=>V(f.value)));function g(e){return l(c.value,o(e,u.value))}return{viewSize:a,editStartPoint:r,mousePoint:s,scale:u,viewOrigin:c,dragInfo:m,viewMovingInfo:v,viewCenter:p,viewBox:y,viewToCanvas:g,wheel(e,a=!1){var r,o;const d=!a&&s.value?s.value:p.value,i=g(d);u.value=Math.min(Math.max(u.value*Math.pow(1.1,e.deltaY>0?1:-1),null!=(r=t.scaleMin)?r:0),null!=(o=t.scaleMax)?o:10);const v=g(d);c.value=l(c.value,n(i,v))},downLeft(){s.value&&(m.value={})},upLeft(){m.value=void 0},downMiddle(){s.value&&(v.value={origin:e({},c.value),downAt:e({},s.value)})},upMiddle(){v.value=void 0},leave(){v.value=void 0},viewMove(){v.value&&s.value&&(c.value=l(v.value.origin,o(n(v.value.downAt,s.value),u.value)))}}}({scaleMin:1});function v(){if(!u.value)return;const e=u.value.getBoundingClientRect();c.viewSize.width=e.width,c.viewSize.height=e.height}const m=Qe();return y(v),s((()=>m.state.size),v),{scale:c.scale,viewOrigin:c.viewOrigin,viewSize:i((()=>c.viewSize)),wrapper:u,svg:r,viewBox:c.viewBox,focus(){r.value&&r.value.focus()},wheel:e=>c.wheel(e,!0),downLeft:()=>{c.mousePoint.value&&(c.downLeft(),a("down-left",c.viewToCanvas(c.mousePoint.value)))},upLeft:()=>{c.upLeft(),a("up-left")},downMiddle:c.downMiddle,upMiddle:c.upMiddle,leave:c.leave,mousemove:e=>{c.mousePoint.value=g(e),c.dragInfo.value?a("drag",c.viewToCanvas(c.mousePoint.value)):c.viewMovingInfo.value?c.viewMove():c.editStartPoint.value&&a("mousemove",{current:c.viewToCanvas(c.mousePoint.value),start:c.viewToCanvas(c.editStartPoint.value)})},clickAny(e){e.target===r.value?(c.editStartPoint.value=void 0,a("click-empty")):a("click-any")},keyDownEscape:()=>{a("escape")},editKeyDown(e){c.mousePoint.value&&(c.editStartPoint.value=c.mousePoint.value,a(e))}}}});const Wt=B("data-v-5868f1c8");I("data-v-5868f1c8");const Ut={ref:"wrapper",class:"timeline-canvas-root"};E();const Vt=Wt(((e,t,a,n,r,l)=>(f(),v("div",Ut,[(f(),v("svg",{ref:"svg",tabindex:"-1",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"none","font-family":"sans-serif",viewBox:e.viewBox,width:e.viewSize.width,height:e.viewSize.height,onWheel:t[1]||(t[1]=b(((...t)=>e.wheel&&e.wheel(...t)),["prevent"])),onClick:t[2]||(t[2]=b(((...t)=>e.clickAny&&e.clickAny(...t)),["left"])),onContextmenu:t[3]||(t[3]=b(((...t)=>e.keyDownEscape&&e.keyDownEscape(...t)),["right","prevent"])),onMouseenter:t[4]||(t[4]=(...t)=>e.focus&&e.focus(...t)),onMousedown:[t[5]||(t[5]=b(((...t)=>e.downLeft&&e.downLeft(...t)),["left","prevent"])),t[8]||(t[8]=b(((...t)=>e.downMiddle&&e.downMiddle(...t)),["middle","prevent"]))],onMouseup:[t[6]||(t[6]=b(((...t)=>e.upLeft&&e.upLeft(...t)),["left","prevent"])),t[9]||(t[9]=b(((...t)=>e.upMiddle&&e.upMiddle(...t)),["middle","prevent"]))],onMousemove:t[7]||(t[7]=b(((...t)=>e.mousemove&&e.mousemove(...t)),["prevent"])),onMouseleave:t[10]||(t[10]=(...t)=>e.leave&&e.leave(...t)),onKeydown:[t[11]||(t[11]=k(b(((...t)=>e.keyDownEscape&&e.keyDownEscape(...t)),["exact","prevent"]),["escape"])),t[12]||(t[12]=k(b((t=>e.editKeyDown("g")),["exact","prevent"]),["g"])),t[13]||(t[13]=k(b((t=>e.editKeyDown("x")),["exact","prevent"]),["x"]))]},[M(e.$slots,"default",{scale:e.scale,viewOrigin:e.viewOrigin,viewSize:e.viewSize})],40,["viewBox","width","height"]))],512))));_t.render=Vt,_t.__scopeId="data-v-5868f1c8";var Gt=u({props:{labelWidth:{type:Number,default:100},index:{type:Number,required:!0},label:{type:String,required:!0}},setup:()=>({height:24})});Gt.render=function(e,t,a,n,r,l){return f(),v("g",{transform:`translate(0, ${e.index*e.height})`},[m("rect",{width:e.labelWidth,height:e.height,fill:"#fff",stroke:"black"},null,8,["width","height"]),m("text",{x:"4",y:e.height/2,"dominant-baseline":"central"},A(e.label),9,["y"])],8,["transform"])};function Kt(e){return Math.round(function(e){return Math.round(Math.log(e)/Math.log(1.1))}(e)/2)+1}var Ht=u({props:{scale:{type:Number,default:1},originX:{type:Number,default:0},viewWidth:{type:Number,default:100},currentFrame:{type:Number,default:0},endFrame:{type:Number,default:60}},emits:["down-current-frame","up-current-frame"],setup(e,{emit:t}){const a=i((()=>Kt(e.scale))),n=i((()=>function(e,t){const a=Math.floor(Math.max(t,0)/20);return a-a%(2*e)}(a.value,e.originX))),r=i((()=>Math.ceil(e.viewWidth*e.scale/20))),l=i((()=>Math.floor(r.value/a.value))),o=i((()=>[...Array(l.value)].map(((e,t)=>{const r=t*a.value+n.value;return{f:r,labelSize:r%10==0?14:r%2==0?11:0,strokeWidth:r%10==0?2:1}})))),d=i((()=>20*e.currentFrame)),s=i((()=>10*Math.max(e.currentFrame.toString().length,2)+2));return{headerHeight:24,frames:o,frameWidth:20,currentFrameX:d,endFrameX:i((()=>20*e.endFrame)),currentFrameLabelWidth:s,downCurrentFrame:()=>t("down-current-frame")}}});const Rt=B("data-v-d1cae906");I("data-v-d1cae906");const qt={class:"view-only"},Xt={fill:"#aaa",stroke:"none","fill-opacity":"0.5"},Yt=m("g",{transform:"scale(-1, 1)"},[m("rect",{width:"200000",height:"200000"})],-1),Jt=m("rect",{width:"200000",height:"200000"},null,-1);E();const Qt=Rt(((e,t,a,n,r,l)=>(f(),v("g",null,[m("g",{transform:`scale(${e.scale})`,onMousedown:t[1]||(t[1]=b(((...t)=>e.downCurrentFrame&&e.downCurrentFrame(...t)),["left"]))},[m("rect",{x:"-100000",width:"200000",height:e.headerHeight,fill:"#fff",stroke:"#000"},null,8,["height"])],40,["transform"]),m("g",qt,[m("g",null,[(f(!0),v(C,null,$(e.frames,(t=>(f(),v("g",{key:t,transform:`translate(${t.f*e.frameWidth}, 0)`},[m("g",{transform:`scale(${e.scale})`},[t.labelSize>0?(f(),v("text",{key:0,y:e.headerHeight-4,"font-size":t.labelSize,"dominant-baseline":"text-after-edge","text-anchor":"middle"},A(t.f),9,["y","font-size"])):S("",!0),t.strokeWidth>0?(f(),v("line",{key:1,x1:"0",y1:e.headerHeight,x2:"0",y2:"20000",stroke:"#aaa","stroke-width":t.strokeWidth},null,8,["y1","stroke-width"])):S("",!0)],8,["transform"])],8,["transform"])))),128))]),m("g",Xt,[Yt,m("g",{transform:`translate(${e.endFrameX}, 0)`},[Jt],8,["transform"])]),m("g",{transform:`translate(${e.currentFrameX}, 0) scale(${e.scale})`},[m("rect",{x:-e.currentFrameLabelWidth/2,y:2,width:e.currentFrameLabelWidth,height:20,rx:"4",ry:"4",fill:"blue",stroke:"none"},null,8,["x","width"]),m("text",{y:e.headerHeight-4,"font-size":"12","dominant-baseline":"text-after-edge","text-anchor":"middle",fill:"#fff"},A(e.currentFrame),9,["y"]),m("line",{x1:"0",y1:e.headerHeight,x2:"0",y2:"20000",stroke:"blue","stroke-width":"2"},null,8,["y1"])],8,["transform"])])]))));Ht.render=Qt,Ht.__scopeId="data-v-d1cae906";var Zt=u({components:{SelectField:mt,TimelineCanvas:_t,TimelineRow:Gt,TimelineAxis:Ht},setup(){const e=Le(),t={currentFrame:Ot,endFrame:Nt,actions:Dt.state.list,setEndFrame:Tt,selectedAction:Dt.lastSelectedItem,selectAction:Dt.selectItem,addAction:zt,deleteAction:Dt.deleteItem,updateAction:e=>Dt.updateItem(e)},a=h(""),n=h(""),r=h(""),l=i((()=>t.selectedAction.value)),o=i((()=>{var t,a;return null!=(a=null==(t=e.lastSelectedArmature.value)?void 0:t.borns)?a:[]})),d=i((()=>t.actions.map((t=>{var a;const n=(null==(a=e.lastSelectedArmature.value)?void 0:a.id)!==t.armatureId;return{value:t.id,label:`${n?"(x)":""} ${t.name}`}}))));function s(e){var n;"move-current-frame"===a.value&&(t.currentFrame.value=(n=e.x-140-20,Math.round(Math.max(n,0)/20)))}return j((()=>{var e,t;n.value=null!=(t=null==(e=l.value)?void 0:e.name)?t:""})),j((()=>{r.value=t.endFrame.value.toString()})),{actions:t.actions,selectedBorns:o,draftName:n,draftEndFrame:r,labelWidth:140,axisPadding:20,currentFrame:t.currentFrame,endFrame:t.endFrame,changeActionName:()=>{n.value&&t.updateAction({name:n.value})},changeEndFrame:()=>{const e=parseInt(r.value,10);!isNaN(e)&&e>=0?t.setEndFrame(e):r.value=t.endFrame.value.toString()},addAction:t.addAction,deleteAction:t.deleteAction,actionOptions:d,selectedActionId:i({get:()=>{var e,t;return null!=(t=null==(e=l.value)?void 0:e.id)?t:""},set:e=>t.selectAction(e)}),downCurrentFrame:function(){a.value="move-current-frame"},downLeft:function(e){s(e)},drag:s,upLeft:function(){a.value=""}}}});const ea=B("data-v-13a1eea6");I("data-v-13a1eea6");const ta={class:"animation-panel-root"},aa={class:"top"},na={class:"select-action"},ra={class:"end-frame-field"},la=P("End: "),oa={class:"middle"};E();const da=ea(((e,t,a,n,r,l)=>{const o=w("SelectField"),d=w("TimelineAxis"),i=w("TimelineRow"),s=w("TimelineCanvas");return f(),v("div",ta,[m("div",aa,[m("div",na,[m(o,{modelValue:e.selectedActionId,"onUpdate:modelValue":t[1]||(t[1]=t=>e.selectedActionId=t),options:e.actionOptions},null,8,["modelValue","options"])]),F(m("input",{"onUpdate:modelValue":t[2]||(t[2]=t=>e.draftName=t),type:"text",onChange:t[3]||(t[3]=(...t)=>e.changeActionName&&e.changeActionName(...t))},null,544),[[N,e.draftName]]),m("button",{class:"add-action",onClick:t[4]||(t[4]=(...t)=>e.addAction&&e.addAction(...t))},"+"),m("button",{class:"delete-action",onClick:t[5]||(t[5]=(...t)=>e.deleteAction&&e.deleteAction(...t))},"x"),m("label",ra,[la,F(m("input",{"onUpdate:modelValue":t[6]||(t[6]=t=>e.draftEndFrame=t),type:"number",onChange:t[7]||(t[7]=(...t)=>e.changeEndFrame&&e.changeEndFrame(...t))},null,544),[[N,e.draftEndFrame]])])]),m("div",oa,[m(s,{onUpLeft:e.upLeft,onDrag:e.drag,onDownLeft:e.downLeft},{default:ea((({scale:t,viewOrigin:a,viewSize:n})=>[m("g",{transform:`translate(${e.labelWidth+e.axisPadding}, ${a.y})`},[m(d,{scale:t,"origin-x":a.x,"view-width":n.width,"current-frame":e.currentFrame,"end-frame":e.endFrame,onDownCurrentFrame:e.downCurrentFrame},null,8,["scale","origin-x","view-width","current-frame","end-frame","onDownCurrentFrame"])],8,["transform"]),m("g",{transform:`translate(${a.x}, ${a.y}) scale(${t})`},[m("g",null,[m("rect",{width:e.labelWidth,height:"10000",stroke:"none",fill:"#fff"},null,8,["width"]),m("line",{x1:e.labelWidth,y1:"0",x2:e.labelWidth,y2:"10000",stroke:"black"},null,8,["x1","x2"]),m(i,{index:1,"label-width":e.labelWidth,label:"Summary"},null,8,["label-width"]),(f(!0),v(C,null,$(e.selectedBorns,((t,a)=>(f(),v(i,{key:t.id,index:a+2,"label-width":e.labelWidth,label:t.name},null,8,["index","label-width","label"])))),128))])],8,["transform"])])),_:1},8,["onUpLeft","onDrag","onDownLeft"])])])}));Zt.render=da,Zt.__scopeId="data-v-13a1eea6";const ia=d({selectedColor:"orange"});function sa(e,t,a=!1){return l(e,r(o(n(t,e),.15),Math.PI/4*(a?-1:1)))}var ua=u({props:{born:{type:Object,required:!0},parent:{type:Object,default:void 0},opacity:{type:Number,default:1},selectedState:{type:Object,default:()=>({head:!1,tail:!1})}},emits:["select","shift-select"],setup(t,{emit:a}){const{settings:n}={settings:ia},r=i((()=>t.born.head)),l=i((()=>t.born.tail)),o=i((()=>sa(r.value,l.value))),d=i((()=>sa(r.value,l.value,!0)));return{transform:i((()=>W(t.born.transform))),head:r,tail:l,headPath:i((()=>U([r.value,o.value,d.value],!0))),tailPath:i((()=>U([l.value,o.value,d.value],!0))),fill:i((()=>t.selectedState.head&&t.selectedState.tail?n.selectedColor:"#ddd")),fillDark:i((()=>t.selectedState.head&&t.selectedState.tail?n.selectedColor:"#bbb")),fillHead:i((()=>t.selectedState.head?n.selectedColor:"")),fillTail:i((()=>t.selectedState.tail?n.selectedColor:"")),click:e=>a("select",e),shiftClick:n=>{n.head&&n.tail?t.selectedState.head&&t.selectedState.tail?a("shift-select",{head:!1,tail:!1}):a("shift-select",{head:!0,tail:!0}):n.head?a("shift-select",e(e({},t.selectedState),{head:!t.selectedState.head})):n.tail&&a("shift-select",e(e({},t.selectedState),{tail:!t.selectedState.tail}))}}}});const ca=B("data-v-6ac86f00")(((e,t,a,n,r,l)=>(f(),v("g",{stroke:"black",fill:e.fill,transform:e.transform,opacity:e.opacity},[m("g",{onClick:[t[1]||(t[1]=b((t=>e.click({head:!0,tail:!0})),["exact"])),t[2]||(t[2]=b((t=>e.shiftClick({head:!0,tail:!0})),["shift","exact"]))]},[m("path",{d:e.headPath,fill:e.fillDark},null,8,["d","fill"]),m("path",{d:e.tailPath},null,8,["d"])]),m("circle",{r:"10",cx:e.head.x,cy:e.head.y,fill:e.fillHead,onClick:[t[3]||(t[3]=b((t=>e.click({head:!0,tail:!1})),["exact"])),t[4]||(t[4]=b((t=>e.shiftClick({head:!0,tail:!1})),["shift","exact"]))]},null,8,["cx","cy","fill"]),m("circle",{r:"10",cx:e.tail.x,cy:e.tail.y,fill:e.fillTail,onClick:[t[5]||(t[5]=b((t=>e.click({head:!1,tail:!0})),["exact"])),t[6]||(t[6]=b((t=>e.shiftClick({head:!1,tail:!0})),["shift","exact"]))]},null,8,["cx","cy","fill"]),e.parent?(f(),v("line",{key:0,x1:e.parent.tail.x,y1:e.parent.tail.y,x2:e.head.x,y2:e.head.y,"stroke-dasharray":"2 2",class:"view-only"},null,8,["x1","y1","x2","y2"])):S("",!0),m("text",{x:(e.head.x+e.tail.x)/2,y:(e.head.y+e.tail.y)/2,"text-anchor":"middle",fill:"black",stroke:"none",class:"view-only"},A(e.born.name),9,["x","y"])],8,["fill","transform","opacity"]))));ua.render=ca,ua.__scopeId="data-v-6ac86f00";var va=u({components:{BornElm:ua},props:{armature:{type:Object,required:!0},opacity:{type:Number,default:.8},selected:{type:Boolean,default:!1}},emits:["select","shift-select"],setup:(e,{emit:t})=>({bornMap:i((()=>Y(e.armature.borns))),transform:i((()=>W(e.armature.transform))),bornSelectedState:i((()=>e.selected?{head:!0,tail:!0}:void 0)),click:()=>t("select",!e.selected),shiftClick:()=>t("shift-select",!e.selected)})});const ma=B("data-v-e1a73d3c")(((e,t,a,n,r,l)=>{const o=w("BornElm");return f(),v("g",{stroke:"black",transform:e.transform,opacity:e.opacity},[(f(!0),v(C,null,$(e.armature.borns,(t=>(f(),v(o,{key:t.name,born:t,"selected-state":e.bornSelectedState,parent:e.bornMap[t.parentId],onSelect:e.click,onShiftSelect:e.shiftClick},null,8,["born","selected-state","parent","onSelect","onShiftSelect"])))),128))],8,["transform","opacity"])}));function fa(){const t=d({editMode:"",editMovement:void 0}),a=Le(),r=Ye(),l=i((()=>a.state.selectedBorns)),s=i((()=>{var e;return null==(e=a.lastSelectedBorn.value)?void 0:e.id})),u=h(),v=i((()=>!!s.value)),m=i((()=>{var e,t;return null!=(t=null==(e=u.value)?void 0:e.borns.map((e=>e.name)))?t:[]}));function f(){t.editMode="",t.editMovement=void 0}function p(t,a=!1){return e({},function(e,t=!1){const a=t?e.head:e.tail;return q({head:a,tail:a,parentId:t?e.parentId:e.id,connected:!t||e.connected},!0)}(t,a))}const y=i((()=>{if(!t.editMovement)return{};if("scale"===t.editMode){const e=a.selectedBornsOrigin.value,n=r.isOppositeSide(e,t.editMovement.start,t.editMovement.current),d=o(o({x:1,y:1},n?-1:1),z(t.editMovement.current,e)/z(t.editMovement.start,e)),i=r.snapScale(d);return Object.keys(l.value).reduce(((t,a)=>(t[a]=[R({origin:e,scale:i})],t)),{})}if("rotate"===t.editMode){const e=a.selectedBornsOrigin.value,n=(c(t.editMovement.current,e)-c(t.editMovement.start,e))/Math.PI*180;return Object.keys(l.value).reduce(((t,a)=>(t[a]=[R({origin:e,rotate:n})],t)),{})}const e=n(t.editMovement.current,t.editMovement.start),d=r.snapTranslate(e);return Object.keys(l.value).reduce(((e,t)=>(e[t]=[R({translate:d})],e)),{})})),g=i((()=>Object.keys(y.value).reduce(((e,t)=>(e[t]=ee(a.bornMap.value[t],y.value[t],l.value[t]),e)),{})));function x(){u.value&&(a.updateBorns(g.value),t.editMovement=void 0,t.editMode="")}return{state:t,getEditTransforms:e=>y.value[e]||[],begin:e=>u.value=e,end(){f(),u.value=void 0},cancel:f,setEditMode:function(e){if(u.value&&(f(),v.value&&(t.editMode=e,"extrude"===e))){const e={},t=m.value.concat(),n=[];Object.keys(l.value).forEach((r=>{const o=l.value[r],d=a.bornMap.value[r],i=[];o.tail&&i.push(p(d)),o.head&&i.push(p(d,!0)),i.forEach((a=>{e[a.parentId]||(a.name=H(d.name,t),n.push(a),t.push(a.name),e[a.parentId]=!0)}))})),a.addBorns(n,{tail:!0})}},select:function(e,n){t.editMode?x():a.selectBorn(e,n)},shiftSelect:function(e,n){t.editMode?x():a.selectBorn(e,n,!0)},mousemove:function(e){t.editMode&&(t.editMovement=e)},clickAny:function(){t.editMode&&x()},clickEmpty:function(){t.editMode?x():a.selectBorn()}}}va.render=ma,va.__scopeId="data-v-e1a73d3c";var pa=u({components:{AppCanvas:Ze,ArmatureElm:va,BornElm:ua,SidePanel:gt,AnimationPanel:Zt},setup(){const e=Le(),t=Ye(),a=fa(),n=ce(),r=i((()=>t.state.canvasMode)),l=i((()=>e.lastSelectedArmature.value)),o=i((()=>e.state.armatures.filter((t=>{var a;return t.id!==(null==(a=e.lastSelectedArmature.value)?void 0:a.id)})))),d=i((()=>l.value?Y(l.value.borns.map((t=>ee(t,a.getEditTransforms(t.id),e.state.selectedBorns[t.id]||[])))):{})),s=i((()=>{return"grab"===(e=a.state.editMode)||"extrude"===e?"grab":"rotate"===e?"rotate":"scale"===e?"scale":"";var e}));function u(e){var t;["input","textarea"].includes(null==(t=e.target)?void 0:t.tagName.toLowerCase())||e.ctrlKey&&"z"===e.key.toLowerCase()&&(e.preventDefault(),e.shiftKey?n.redo():n.undo())}return y((()=>{document.addEventListener("keydown",u)})),T((()=>{document.removeEventListener("keydown",u)})),{armatures:i((()=>e.state.armatures)),otherArmatures:o,lastSelectedArmatureId:i((()=>{var t;return null==(t=e.lastSelectedArmature.value)?void 0:t.id})),editBornMap:d,selectedBorns:i((()=>e.state.selectedBorns)),armatureEditMode:a,canvasMode:r,canvasCommand:s,mousemove(e){"edit"===r.value&&a.mousemove(e)},clickAny(){"edit"===r.value&&a.clickAny()},clickEmpty(){"edit"===r.value?a.clickEmpty():e.selectArmature()},selectBorn(e,t){a.select(e,t)},shiftSelectBorn(e,t){a.shiftSelect(e,t)},selectArmature(t,a){e.selectArmature(a?t:"")},shiftSelectArmature(t,a){e.selectArmature(a?t:"")},escape(){"edit"===r.value&&a.cancel()},toggleCanvasMode(){"object"===r.value&&e.lastSelectedArmature.value?(t.setCanvasMode("edit"),a.begin(e.lastSelectedArmature.value)):(t.setCanvasMode("object"),a.end())},setEditMode(e){"edit"===r.value&&a.setEditMode(e)},execDelete(){"object"===r.value?e.deleteArmature():""===a.state.editMode&&e.deleteBorn()},addItem(){"object"===r.value?e.addArmature():""===a.state.editMode&&e.addBorn()}}}});const ha=B("data-v-330fa354");I("data-v-330fa354");const ya={class:"main"},ga={key:0},xa={key:1},wa={class:"bottom"};E();const ba=ha(((e,t,a,n,r,l)=>{const o=w("ArmatureElm"),d=w("BornElm"),i=w("AppCanvas"),s=w("SidePanel"),u=w("AnimationPanel");return f(),v("div",null,[m("div",ya,[m(i,{class:"canvas","current-command":e.canvasCommand,onMousemove:e.mousemove,onClickAny:e.clickAny,onClickEmpty:e.clickEmpty,onEscape:e.escape,onTab:e.toggleCanvasMode,onG:t[1]||(t[1]=t=>e.setEditMode("grab")),onS:t[2]||(t[2]=t=>e.setEditMode("scale")),onR:t[3]||(t[3]=t=>e.setEditMode("rotate")),onE:t[4]||(t[4]=t=>e.setEditMode("extrude")),onX:e.execDelete,onShiftA:e.addItem},{default:ha((()=>["object"===e.canvasMode?(f(),v("g",ga,[(f(!0),v(C,null,$(e.armatures,(t=>(f(),v(o,{key:t.id,armature:t,selected:e.lastSelectedArmatureId===t.id,onSelect:a=>e.selectArmature(t.id,a),onShiftSelect:a=>e.shiftSelectArmature(t.id,a)},null,8,["armature","selected","onSelect","onShiftSelect"])))),128))])):S("",!0),"edit"===e.canvasMode?(f(),v("g",xa,[(f(!0),v(C,null,$(e.otherArmatures,(e=>(f(),v(o,{key:e.id,armature:e,opacity:.3},null,8,["armature","opacity"])))),128)),(f(!0),v(C,null,$(e.editBornMap,(t=>(f(),v(d,{key:t.id,born:t,parent:e.editBornMap[t.parentId],"selected-state":e.selectedBorns[t.id],onSelect:a=>e.selectBorn(t.id,a),onShiftSelect:a=>e.shiftSelectBorn(t.id,a)},null,8,["born","parent","selected-state","onSelect","onShiftSelect"])))),128))])):S("",!0)])),_:1},8,["current-command","onMousemove","onClickAny","onClickEmpty","onEscape","onTab","onX","onShiftA"]),m(s,{class:"side-panel"})]),m("div",wa,[m(u)])])}));pa.render=ba,pa.__scopeId="data-v-330fa354",_(pa).mount("#app");
