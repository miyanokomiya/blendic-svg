var e=Object.assign;import{v as t,l as a,a as n,d as l,n as r,i as o,r as d,c as i,w as s,b as u,e as c,f as v,g as m,o as p,h as f,j as h,k as y,m as g,p as b,q as x,s as w,t as M,u as k,x as S,y as A,z as B,A as I,B as C,F as E,C as O,D as $,E as F,G as j,H as L,I as D,J as N,K as T,L as P,M as z,N as _}from"./vendor.7342bca8.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(a){const n=new URL(e,location),l=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((a,r)=>{const o=new URL(e,n);if(self[t].moduleMap[o])return a(self[t].moduleMap[o]);const d=new Blob([`import * as m from '${o}';`,`${t}.moduleMap['${o}']=m;`],{type:"text/javascript"}),i=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(d),onerror(){r(new Error(`Failed to import: ${e}`)),l(i)},onload(){a(self[t].moduleMap[o]),l(i)}});document.head.appendChild(i)})),self[t].moduleMap={}}}("/blendic-svg/assets/");function W(e){return[`translate(${e.translate.x},${e.translate.y})`,`rotate(${e.rotate})`,`scale(${e.scale.x},${e.scale.y})`].join(" ")}function U(e,t=!1){if(0===e.length)return"";const[a,...n]=e;return`M${a.x},${a.y}`+n.map((e=>`L${e.x},${e.y}`)).join("")+(t?"z":"")}function V(e){return`${e.x} ${e.y} ${e.width} ${e.height}`}const G=/\.[0-9]{3,}$/;function K(e){return G.test(e)?e.replace(G,(e=>"."+`${parseInt(e.slice(1),10)+1}`.padStart(3,"0"))):`${e}.001`}function H(e,t){const a=new Map(t.map((e=>[e,!0])));let n=K(e);for(;a.has(n);)n=K(n);return n}function R(t={}){return e({translate:{x:0,y:0},origin:{x:0,y:0},rotate:0,scale:{x:1,y:1}},t)}function q(a={},n=!1){return e({id:n?t():"",name:"",transform:R(),parentId:"",connected:!1,head:{x:0,y:0},tail:{x:0,y:0}},a)}function X(a={},n=!1){return e({id:n?t():"",name:"",transform:R(),borns:[]},a)}function Y(e){return"grab"===e||"extrude"===e?"grab":"rotate"===e?"rotate":"scale"===e?"scale":""}function J(t){return t.reduce(((t,a)=>e(e({},t),{[a.id]:a})),{})}function Q(t,a){return Object.keys(e(e({},t),a)).reduce(((n,l)=>{var r,o;return n[l]=e(e({},null!=(r=t[l])?r:{}),null!=(o=a[l])?o:{}),n}),{})}function Z(e,t){return Object.keys(t).reduce(((t,a)=>(t[a]=e[a],t)),{})}function ee(e,t){return r(l(function(e,t,a){return{x:a.x+(e.x-a.x)*t.x,y:a.y+(e.y-a.y)*t.y}}(e,t.scale,t.origin),t.rotate/180*Math.PI),t.translate)}function te(t,a,o){const d=function(t){return t.reduce(((t,a)=>{const o={x:a.origin.x*(1-a.scale.x),y:a.origin.y*(1-a.scale.y)},d=n(a.origin,l(a.origin,a.rotate/180*Math.PI));return e(e({},t),{scale:{x:t.scale.x*a.scale.x,y:t.scale.y*a.scale.y},rotate:t.rotate+a.rotate,translate:r(r(r(t.translate,a.translate),o),d)})}),R())}(a),i=o.head?ee(t.head,d):t.head,s=o.tail?ee(t.tail,d):t.tail;return e(e({},t),{head:i,tail:s})}function ae(e,t=!1){const a=t?e.head:e.tail;return q({head:a,tail:a,parentId:t?e.parentId:e.id,connected:!t||e.connected},!0)}function ne(e,t){return e.find((e=>e.id===t))}function le(t,a,n,l=!1){const r=ne(t.borns,a);if(!r)return{};let o={[a]:n};if(!l){if(n.head&&r.connected){const a=ne(t.borns,r.parentId);a&&(o=e(e({},le(t,a.id,{tail:!0},l)),o))}n.tail&&function(e,t,a=!1){return e.borns.filter((e=>e.parentId===t&&(!a||e.connected)))}(t,r.id,!0).forEach((e=>{o[e.id]={head:!0}}))}return o}function re(e){return e.reduce(((t,n)=>{const l=ne(e,n.parentId);return l?n.connected&&(t[n.id]={connected:a(l.tail,n.head)}):t[n.id]={connected:!1,parentId:""},t}),{})}const oe=d({undoStack:[],redoStack:[]}),de=i((()=>oe.undoStack.concat(oe.redoStack.concat().reverse()))),ie=i((()=>oe.undoStack.length-1));function se(){oe.undoStack=[],oe.redoStack=[]}function ue(e){oe.undoStack.push(e),oe.redoStack=[]}function ce(){const e=oe.undoStack.pop();e&&(e.undo(),oe.redoStack.push(e))}function ve(){const e=oe.redoStack.pop();e&&(e.redo(),oe.undoStack.push(e))}function me(){return{state:oe,allStack:de,currentItemIndex:ie,clearHistory:se,push:ue,undo:ce,redo:ve}}const pe=me(),fe=d(X({name:"armature",borns:[q({name:"born",head:{x:20,y:200},tail:{x:220,y:200}},!0)]},!0)),he=d({armatures:[fe],lastSelectedArmatureId:"",lastSelectedBornId:"",selectedArmatures:{},selectedBorns:{}}),ye=i((()=>he.armatures.findIndex((e=>e.id===he.lastSelectedArmatureId&&he.selectedArmatures[he.lastSelectedArmatureId])))),ge=i((()=>-1!==ye.value?he.armatures[ye.value]:void 0)),be=i((()=>ge.value?ge.value.borns.findIndex((e=>{var t,a;return e.id===he.lastSelectedBornId&&((null==(t=he.selectedBorns[he.lastSelectedBornId])?void 0:t.head)||(null==(a=he.selectedBorns[he.lastSelectedBornId])?void 0:a.tail))})):-1)),xe=i((()=>{if(ge.value)return-1!==be.value?ge.value.borns[be.value]:void 0})),we=i((()=>J(he.armatures))),Me=i((()=>{var e,t;return J(null!=(t=null==(e=ge.value)?void 0:e.borns)?t:[])})),ke=i((()=>function(e,t){const a=Object.keys(t).map((a=>{const n=[];return t[a].head&&n.push(e[a].head),t[a].tail&&n.push(e[a].tail),n})).flat();return 0===a.length?{x:0,y:0}:o(a.reduce(((e,t)=>r(e,t)),{x:0,y:0}),1/a.length)}(Me.value,he.selectedBorns)));function Se(e=""){if(he.lastSelectedArmatureId===e)return;const t=De(e);t.redo(),pe.push(t)}function Ae(t){if(!ge.value)return;const a=function(t){const a=Z(ge.value,t);return{name:"Update Armature",undo:()=>{const t=ye.value;he.armatures[t]=e(e({},he.armatures[t]),a)},redo:()=>{const a=ye.value;he.armatures[a]=e(e({},he.armatures[a]),t)}}}({name:t});a.redo(),pe.push(a)}function Be(){const t=function(){const t=e({},ge.value),a=ye.value,n=De("");return{name:"Delete Armature",undo:()=>{he.armatures.splice(a,0,t),n.undo()},redo:()=>{he.armatures.splice(a,1)}}}();t.redo(),pe.push(t)}function Ie(){const e=function(e){const t=he.armatures.length,a=De(e.id);return{name:"Add Armature",undo:()=>{he.armatures.splice(t,1),a.undo()},redo:()=>{he.armatures.push(e),a.redo()}}}(X({name:H("armature",he.armatures.map((e=>e.name))),borns:[q({name:"born",tail:{x:100,y:0}},!0)]},!0));e.redo(),pe.push(e)}function Ce(e="",t={head:!0,tail:!0},a=!1,n=!1){if(!ge.value)return;if(he.lastSelectedBornId===e&&(l=he.selectedBorns[e],r=t,!!(null==l?void 0:l.head)==!!(null==r?void 0:r.head)&&!!(null==l?void 0:l.tail)==!!(null==r?void 0:r.tail)))return;var l,r;const o=Ne(e,t,a,n);o.redo(),pe.push(o)}function Ee(){if(!ge.value)return;const e=function(){const e=ge.value.borns.concat(),t=ge.value.borns.filter((e=>!he.selectedBorns[e.id])),a=Te(re(t)),n=Ne("");return{name:"Delete Born",undo:()=>{ge.value.borns=e.concat(),n.undo(),a.undo()},redo:()=>{ge.value.borns=t,a.redo()}}}();e.redo(),pe.push(e)}function Oe(){ge.value&&$e([q({name:H("born",ge.value.borns.map((e=>e.name))),tail:{x:100,y:0}},!0)])}function $e(t,a){if(!ge.value)return;const n=function(e,t){const a=e.map(((e,a)=>Ne(e.id,t[e.id],0!==a)));return{name:"Add Born",undo:()=>{ge.value.borns=ge.value.borns.slice(0,ge.value.borns.length-e.length),a.forEach((e=>e.undo()))},redo:()=>{ge.value.borns=ge.value.borns.concat(e),a.forEach((e=>e.redo()))}}}(t,t.reduce(((t,n)=>(a&&(t[n.id]=e({},a)),t)),{}));n.redo(),pe.push(n)}function Fe(e){if(!ge.value)return;const t=Te(e);t.redo(),pe.push(t)}function je(t){if(!ge.value)return;if(!xe.value)return;const a=function(t){const a=Z(xe.value,t);return{name:"Update Born",undo:()=>{const t=be.value;ge.value.borns[t]=e(e({},ge.value.borns[t]),a)},redo:()=>{const a=be.value;ge.value.borns[a]=e(e({},ge.value.borns[a]),t)}}}(function(t,a){if(!a.connected)return a;const n=ne(t,a.parentId);return e(e({},a),n?{head:n.tail}:{connected:!1,parentId:""})}(ge.value.borns,e(e({},xe.value),t)));a.redo(),pe.push(a)}function Le(){return{state:he,lastSelectedArmature:ge,lastSelectedBorn:xe,bornMap:Me,selectedBornsOrigin:ke,selectArmature:Se,updateArmatureName:Ae,deleteArmature:Be,addArmature:Ie,selectBorn:Ce,deleteBorn:Ee,addBorn:Oe,addBorns:$e,updateBorns:Fe,updateBorn:je}}function De(t){const a=e({},he.selectedArmatures),n=he.lastSelectedArmatureId;return{name:"Select Armature",undo:()=>{he.selectedArmatures=e({},a),he.lastSelectedArmatureId=n},redo:()=>{he.selectedArmatures=t?{[t]:!0}:{},he.lastSelectedArmatureId=t}}}function Ne(t,a={head:!0,tail:!0},n=!1,l=!1){const r=e({},he.selectedBorns),o=he.lastSelectedBornId;return{name:"Select Born",undo:()=>{he.selectedBorns=e({},r),he.lastSelectedBornId=o},redo:()=>{he.selectedBorns=t?Q(e(e({},n?he.selectedBorns:{}),{[t]:a}),le(ge.value,t,a,l)):{},he.lastSelectedBornId=t}}}function Te(t){const a=Q(t,re(ge.value.borns.map((a=>e(e({},a),t[a.id]))))),n=Object.keys(a).reduce(((e,t)=>(Me.value[t]&&(e[t]=Z(Me.value[t],a[t])),e)),{});return{name:"Update Born",undo:()=>{ge.value.borns=ge.value.borns.map((t=>e(e({},t),n[t.id])))},redo:()=>{ge.value.borns=ge.value.borns.map((t=>e(e({},t),a[t.id])))}}}s((()=>he.selectedArmatures),(()=>{he.selectedArmatures[he.lastSelectedArmatureId]||(he.lastSelectedArmatureId="")})),s((()=>we.value),(()=>{he.selectedArmatures=Object.keys(he.selectedArmatures).reduce(((t,a)=>we.value[a]?e(e({},t),{[a]:he.selectedArmatures[a]}):t),{})})),s((()=>he.selectedBorns),(()=>{if(!(e=he.selectedBorns[he.lastSelectedBornId])||!e.head&&!e.tail){const e=Object.keys(he.selectedBorns);he.lastSelectedBornId=e.length>0?e[0]:""}var e})),s((()=>Me.value),(()=>{he.selectedBorns=Object.keys(he.selectedBorns).reduce(((t,a)=>Me.value[a]?e(e({},t),{[a]:he.selectedBorns[a]}):t),{})}));var Pe=u({props:{origin:{type:Object,required:!0},current:{type:Object,required:!0},scale:{type:Number,required:!0},side:{type:Boolean,default:!1}},setup:e=>({rotate:i((()=>c(e.current,e.origin)/Math.PI*180))})});const ze={fill:"black",stroke:"black"},_e=m("circle",{r:"2"},null,-1),We=m("circle",{r:"2"},null,-1),Ue=m("path",{d:"M-20,0L-10,-10L-10,10z"},null,-1),Ve=m("path",{d:"M20,0L10,-10L10,10z"},null,-1);Pe.render=function(e,t,a,n,l,r){return p(),v("g",ze,[m("g",{transform:`translate(${e.origin.x}, ${e.origin.y}) rotate(${e.rotate}) scale(${e.scale})`},[_e],8,["transform"]),m("line",{x1:e.origin.x,y1:e.origin.y,x2:e.current.x,y2:e.current.y,"stroke-width":e.scale,"stroke-dasharray":`${2*e.scale} ${2*e.scale}`},null,8,["x1","y1","x2","y2","stroke-width","stroke-dasharray"]),m("g",{transform:`translate(${e.current.x}, ${e.current.y}) rotate(${e.rotate}) scale(${e.scale})`},[We,m("g",{transform:`rotate(${e.side?90:0})`},[Ue,Ve],8,["transform"])],8,["transform"])])};const Ge=me(),Ke=d({canvasMode:"object",pastCanvasMode:"edit",axisGrid:""});function He(){"edit"===Ke.canvasMode?qe(Ke.pastCanvasMode):qe("edit")}function Re(){"edit"===Ke.canvasMode?"object"===Ke.pastCanvasMode?qe("pose"):qe("object"):"object"===Ke.canvasMode?qe("pose"):qe("object")}function qe(e){const t=function(e){const t=Ke.canvasMode,a=Ke.pastCanvasMode;return{name:"Change Mode",undo:()=>{Ke.canvasMode=t,Ke.pastCanvasMode=a},redo:()=>{Ke.pastCanvasMode=Ke.canvasMode,Ke.canvasMode=e}}}(e);Ge.push(t),t.redo()}function Xe(e){Ke.axisGrid=e}function Ye(e){Ke.axisGrid=Ke.axisGrid===e?"":e}function Je(e){return{x:"y"===Ke.axisGrid?1:e.x,y:"x"===Ke.axisGrid?1:e.y}}function Qe(e){return{x:"y"===Ke.axisGrid?0:e.x,y:"x"===Ke.axisGrid?0:e.y}}function Ze(e,t,a){return f(n(t,e),n(a,e))<0}function et(){return{state:Ke,toggleCanvasMode:He,ctrlToggleCanvasMode:Re,setCanvasMode:qe,setAxisGrid:Xe,switchAxisGrid:Ye,snapScale:Je,snapTranslate:Qe,isOppositeSide:Ze}}const tt=d({size:{width:100,height:100}});function at(){return{state:tt}}window.addEventListener("resize",(()=>{tt.size={width:window.innerWidth,height:window.innerHeight}}));var nt=u({components:{ScaleMarker:Pe},props:{originalViewBox:{type:Object,default:()=>({x:0,y:0,width:600,height:400})},currentCommand:{type:String,default:""}},emits:["mousemove","click-any","click-empty","escape","tab","ctrl-tab","g","s","r","e","x","y","shift-a"],setup(t,{emit:a}){const l=d({width:600,height:400}),u=h(),c=h(),v=h(),m=h(),p=h(1),f=h({x:0,y:0}),x=h(),w=Le(),M=et();function k(e){return r(f.value,o(e,p.value))}const S=i((()=>({x:f.value.x,y:f.value.y,width:l.width*p.value,height:l.height*p.value}))),A=i((()=>V(S.value))),B=i((()=>b(e({x:0,y:0},l)))),I=i((()=>{if(""!==M.state.axisGrid&&v.value)return function(t,a,n,l){return e(e({},{strokeWidth:t}),"x"===a?{from:{x:n.x,y:l.y},to:{x:n.x+n.width,y:l.y},stroke:"red"}:{from:{x:l.x,y:n.y},to:{x:l.x,y:n.y+n.height},stroke:"green"})}(p.value,M.state.axisGrid,S.value,w.selectedBornsOrigin.value)})),C=i((()=>{if(m.value&&["scale","rotate"].includes(t.currentCommand))return{origin:w.selectedBornsOrigin.value,current:k(m.value),side:"rotate"===t.currentCommand}}));function E(){if(!c.value)return;const e=c.value.getBoundingClientRect();l.width=e.width,l.height=e.height}s((()=>t.currentCommand),(e=>{M.setAxisGrid(""),""===e&&(v.value=void 0)}));const O=at();return y(E),s((()=>O.state.size),E),{scale:p,viewSize:l,svg:u,wrapper:c,viewBox:A,gridLineElm:I,scaleNaviElm:C,canvasMode:i((()=>M.state.canvasMode)),focus(){u.value&&u.value.focus()},wheel(e){const t=m.value?m.value:B.value,a=k(t);p.value=p.value*Math.pow(1.1,e.deltaY>0?1:-1);const l=k(t);f.value=r(f.value,n(a,l))},downMiddle(){m.value&&(x.value={origin:e({},f.value),downAt:e({},m.value)})},upMiddle(){x.value=void 0},leave(){x.value=void 0},mousemove:e=>{if(m.value=g(e),x.value)f.value=r(x.value.origin,o(n(x.value.downAt,m.value),p.value));else{if(!v.value)return;a("mousemove",{current:k(m.value),start:k(v.value)})}},clickAny(e){e.target===u.value?(v.value=void 0,a("click-empty")):a("click-any")},keyDownTab:()=>{a("tab")},keyDownCtrlTab:()=>a("ctrl-tab"),keyDownEscape:()=>{a("escape")},editKeyDown(e){m.value&&(!["grab","scale"].includes(t.currentCommand)||"x"!==e&&"y"!==e?(v.value=m.value,a(e)):M.switchAxisGrid(e))}}}});const lt=B("data-v-490056d2");I("data-v-490056d2");const rt={ref:"wrapper",class:"app-canvas-root"},ot={class:"help"};C();const dt=lt(((e,t,a,n,l,r)=>{const o=x("ScaleMarker");return p(),v("div",rt,[(p(),v("svg",{ref:"svg",tabindex:"-1",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"none","font-family":"sans-serif",viewBox:e.viewBox,width:e.viewSize.width,height:e.viewSize.height,onWheel:t[1]||(t[1]=w(((...t)=>e.wheel&&e.wheel(...t)),["prevent"])),onClick:t[2]||(t[2]=w(((...t)=>e.clickAny&&e.clickAny(...t)),["left"])),onContextmenu:t[3]||(t[3]=w(((...t)=>e.keyDownEscape&&e.keyDownEscape(...t)),["right","prevent"])),onMouseenter:t[4]||(t[4]=(...t)=>e.focus&&e.focus(...t)),onMousemove:t[5]||(t[5]=w(((...t)=>e.mousemove&&e.mousemove(...t)),["prevent"])),onMousedown:t[6]||(t[6]=w(((...t)=>e.downMiddle&&e.downMiddle(...t)),["middle","prevent"])),onMouseup:t[7]||(t[7]=w(((...t)=>e.upMiddle&&e.upMiddle(...t)),["middle","prevent"])),onMouseleave:t[8]||(t[8]=(...t)=>e.leave&&e.leave(...t)),onKeydown:[t[9]||(t[9]=M(w(((...t)=>e.keyDownEscape&&e.keyDownEscape(...t)),["exact","prevent"]),["escape"])),t[10]||(t[10]=M(w(((...t)=>e.keyDownTab&&e.keyDownTab(...t)),["exact","prevent"]),["tab"])),t[11]||(t[11]=M(w(((...t)=>e.keyDownCtrlTab&&e.keyDownCtrlTab(...t)),["shift","exact","prevent"]),["tab"])),t[12]||(t[12]=M(w((t=>e.editKeyDown("g")),["exact","prevent"]),["g"])),t[13]||(t[13]=M(w((t=>e.editKeyDown("s")),["exact","prevent"]),["s"])),t[14]||(t[14]=M(w((t=>e.editKeyDown("r")),["exact","prevent"]),["r"])),t[15]||(t[15]=M(w((t=>e.editKeyDown("e")),["exact","prevent"]),["e"])),t[16]||(t[16]=M(w((t=>e.editKeyDown("x")),["exact","prevent"]),["x"])),t[17]||(t[17]=M(w((t=>e.editKeyDown("y")),["exact","prevent"]),["y"])),t[18]||(t[18]=M(w((t=>e.editKeyDown("shift-a")),["shift","exact","prevent"]),["a"]))]},[m("rect",{x:e.originalViewBox.x,y:e.originalViewBox.y,width:e.originalViewBox.width,height:e.originalViewBox.height,fill:"none",stroke:"black","stroke-width":"1","stroke-dasharray":"4 4"},null,8,["x","y","width","height"]),e.gridLineElm?(p(),v("line",{key:0,x1:e.gridLineElm.from.x,y1:e.gridLineElm.from.y,x2:e.gridLineElm.to.x,y2:e.gridLineElm.to.y,stroke:e.gridLineElm.stroke,"stroke-width":e.gridLineElm.strokeWidth},null,8,["x1","y1","x2","y2","stroke","stroke-width"])):k("",!0),S(e.$slots,"default"),e.scaleNaviElm?(p(),v(o,{key:1,origin:e.scaleNaviElm.origin,current:e.scaleNaviElm.current,scale:e.scale,side:e.scaleNaviElm.side},null,8,["origin","current","scale","side"])):k("",!0)],40,["viewBox","width","height"])),m("div",ot,[m("p",null,"Mode: "+A(e.canvasMode),1)])],512)}));nt.render=dt,nt.__scopeId="data-v-490056d2";var it=u({props:{tabs:{type:Array,default:()=>[]}},setup(e){var t,a;const n=h(null!=(a=null==(t=e.tabs[0])?void 0:t.key)?a:"");return{current:n,setTab:e=>n.value=e}}});const st=B("data-v-16db2673");I("data-v-16db2673");const ut={class:"tab-panel-root"},ct={class:"panels"};C();const vt=st(((e,t,a,n,l,r)=>(p(),v("div",ut,[m("ul",null,[(p(!0),v(E,null,O(e.tabs,(t=>(p(),v("li",{key:t.key,class:{current:t.key===e.current}},[m("a",{href:"#",onClick:w((a=>e.setTab(t.key)),["prevent"])},A(t.label),9,["onClick"])],2)))),128))]),m("div",ct,[(p(!0),v(E,null,O(e.tabs,(t=>$((p(),v("div",{key:t.key},[S(e.$slots,t.key)],512)),[[F,t.key===e.current]]))),128))])]))));it.render=vt,it.__scopeId="data-v-16db2673";var mt=u({setup(){const e=me();return{allStack:i((()=>e.allStack.value)),currentItemIndex:i((()=>e.currentItemIndex.value))}}});const pt=B("data-v-65f8ee82");I("data-v-65f8ee82");const ft=m("h3",null,"history",-1);C();const ht=pt(((e,t,a,n,l,r)=>(p(),v("div",null,[ft,m("ul",null,[(p(!0),v(E,null,O(e.allStack,((t,a)=>(p(),v("li",{key:a,class:{current:a===e.currentItemIndex}},A(t.name),3)))),128))])]))));mt.render=ht,mt.__scopeId="data-v-65f8ee82";var yt=u({props:{options:{type:Array,default:()=>[]},modelValue:{type:[Number,String],default:""}},emits:["update:modelValue"],setup:(e,{emit:t})=>({value:i({get:()=>e.modelValue,set(e){t("update:modelValue",e)}})})});const gt=B("data-v-fddf1844");I("data-v-fddf1844");const bt={class:"select-root"},xt=m("option",{value:""},"-- None --",-1);C();const wt=gt(((e,t,a,n,l,r)=>(p(),v("span",bt,[$(m("select",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.value=t)},[xt,(p(!0),v(E,null,O(e.options,(e=>(p(),v("option",{key:e.value,value:e.value},A(e.label),9,["value"])))),128))],512),[[j,e.value]])]))));yt.render=wt,yt.__scopeId="data-v-fddf1844";var Mt=u({components:{TabPanel:it,HistoryStack:mt,SelectField:yt},setup(){const e=Le(),t=h(""),a=i((()=>e.lastSelectedArmature.value?e.lastSelectedArmature.value.borns.filter((t=>{var a;return t.id!==(null==(a=e.lastSelectedBorn.value)?void 0:a.id)})).map((e=>({value:e.id,label:e.name}))):[])),n=i((()=>e.lastSelectedBorn.value?"born":e.lastSelectedArmature.value?"armature":""));function l(){e.lastSelectedBorn.value?t.value=e.lastSelectedBorn.value.name:e.lastSelectedArmature.value?t.value=e.lastSelectedArmature.value.name:t.value=""}return s(e.lastSelectedArmature,l),s(e.lastSelectedBorn,l),{draftName:t,lastSelectedArmature:e.lastSelectedArmature,lastSelectedBorn:e.lastSelectedBorn,parentOptions:a,selectedObjectType:n,connected:i({get(){var t,a;return null!=(a=null==(t=e.lastSelectedBorn.value)?void 0:t.connected)&&a},set(t){e.updateBorn({connected:t})}}),parentId:i({get(){var t,a;return null!=(a=null==(t=e.lastSelectedBorn.value)?void 0:t.parentId)?a:""},set(t){e.updateBorn({parentId:t})}}),changeArmatureName(){t.value&&e.updateArmatureName(t.value)},changeBornName(){t.value&&e.updateBorn({name:t.value})}}}});const kt=B("data-v-a1a2983c");I("data-v-a1a2983c");const St=m("h3",null,"Armature",-1),At={class:"field inline"},Bt=m("label",null,"Name",-1),It=m("h3",null,"Born",-1),Ct={class:"field inline"},Et=m("label",null,"Name",-1),Ot={class:"field inline"},$t=m("label",null,"Parent",-1),Ft={class:"field inline"},jt=m("label",null,"Connect",-1);C();const Lt=kt(((e,t,a,n,l,r)=>{const o=x("SelectField"),d=x("HistoryStack"),i=x("TabPanel");return p(),v("div",null,[m(i,{tabs:[{key:"detail",label:"Detail"},{key:"history",label:"History"}]},{detail:kt((()=>["armature"===e.selectedObjectType?(p(),v("form",{key:0,onSubmit:t[3]||(t[3]=w((()=>{}),["prevent"]))},[St,m("div",At,[Bt,$(m("input",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.draftName=t),type:"text",onChange:t[2]||(t[2]=(...t)=>e.changeArmatureName&&e.changeArmatureName(...t))},null,544),[[L,e.draftName]])])],32)):k("",!0),"born"===e.selectedObjectType?(p(),v("form",{key:1,onSubmit:t[8]||(t[8]=w((()=>{}),["prevent"]))},[It,m("div",Ct,[Et,$(m("input",{"onUpdate:modelValue":t[4]||(t[4]=t=>e.draftName=t),type:"text",onChange:t[5]||(t[5]=(...t)=>e.changeBornName&&e.changeBornName(...t))},null,544),[[L,e.draftName]])]),m("div",Ot,[$t,m(o,{modelValue:e.parentId,"onUpdate:modelValue":t[6]||(t[6]=t=>e.parentId=t),options:e.parentOptions},null,8,["modelValue","options"])]),m("div",Ft,[jt,$(m("input",{"onUpdate:modelValue":t[7]||(t[7]=t=>e.connected=t),type:"checkbox",disabled:!e.parentId},null,8,["disabled"]),[[D,e.connected]])])],32)):k("",!0)])),history:kt((()=>[m(d)])),_:1})])}));Mt.render=Lt,Mt.__scopeId="data-v-a1a2983c";const Dt=me();function Nt(t,a){const n=e({},t.selectedMap),l=t.lastSelectedId;return{name:`Select ${t.label}`,undo:()=>{t.selectedMap=e({},n),t.lastSelectedId=l},redo:()=>{t.selectedMap=a?{[a]:!0}:{},t.lastSelectedId=a}}}const Tt=h(0),Pt=h(60),zt=function(t){const a=d({label:t,list:[],lastSelectedId:"",selectedMap:{}}),n=i((()=>a.list.findIndex((e=>e.id===a.lastSelectedId&&a.selectedMap[a.lastSelectedId])))),l=i((()=>J(a.list))),r=i((()=>-1!==n.value?a.list[n.value]:void 0));return s((()=>a.selectedMap),(()=>{a.selectedMap[a.lastSelectedId]||(a.lastSelectedId="")})),s((()=>l.value),(()=>{a.selectedMap=Object.keys(a.selectedMap).reduce(((t,n)=>l.value[n]?e(e({},t),{[n]:a.selectedMap[n]}):t),{})})),{state:a,itemMap:l,lastSelectedItem:r,selectItem:function(e){if(a.lastSelectedId===e)return;const t=Nt(a,e);t.redo(),Dt.push(t)},addItem:function(e){const t=function(e,t){const a=e.list.length,n=Nt(e,t.id),l=()=>{e.list.push(t),n.redo()};return{name:`Add ${e.label}`,undo:()=>{e.list.splice(a,1),n.undo()},redo:l}}(a,e);t.redo(),Dt.push(t)},deleteItem:function(){if(-1===n.value)return;const t=function(t,a){const n=e({},t.list[a]),l=a,r=Nt(t,""),o=()=>{t.list.splice(l,1)};return{name:`Delete ${t.label}`,undo:()=>{t.list.splice(l,0,n),r.undo()},redo:o}}(a,n.value);t.redo(),Dt.push(t)},updateItem:function(t){if(-1===n.value)return;const l=function(t,a,n){const l=Z(t.list[n],a),r=()=>{t.list[n]=e(e({},t.list[n]),a)};return{name:`Update ${t.label}`,undo:()=>{t.list[n]=e(e({},t.list[n]),l)},redo:r}}(a,t,n.value);l.redo(),Dt.push(l)}}}("Action"),_t=me(),Wt=Le();function Ut(){Wt.lastSelectedArmature.value&&zt.addItem(function(a={},n=!1){return e({id:n?t():"",name:"",totalFrame:60,armatureId:"",keyframes:[]},a)}({name:H("action",zt.state.list.map((e=>e.name))),armatureId:Wt.lastSelectedArmature.value.id},!0))}function Vt(e){if(Pt.value===e)return;const t=function(e){const t=Pt.value;return{name:"Update End Frame",undo:()=>{Pt.value=t},redo:()=>{Pt.value=e}}}(e);t.redo(),_t.push(t)}var Gt=u({emits:["down-left","up-left","mousemove","drag","click-any","click-empty","escape","g","x"],setup(t,{emit:a}){const l=h(),u=h(),c=function(t={}){const a=d({width:600,height:100}),l=h(),s=h(),u=h(1),c=h({x:0,y:0}),v=h(),m=h(),p=i((()=>({x:c.value.x,y:c.value.y,width:a.width*u.value,height:a.height*u.value}))),f=i((()=>b(e({x:0,y:0},a)))),y=i((()=>V(p.value)));function g(e){return r(c.value,o(e,u.value))}return{viewSize:a,editStartPoint:l,mousePoint:s,scale:u,viewOrigin:c,dragInfo:m,viewMovingInfo:v,viewCenter:f,viewBox:y,viewToCanvas:g,wheel(e,a=!1){var l,o;const d=!a&&s.value?s.value:f.value,i=g(d);u.value=Math.min(Math.max(u.value*Math.pow(1.1,e.deltaY>0?1:-1),null!=(l=t.scaleMin)?l:0),null!=(o=t.scaleMax)?o:10);const v=g(d);c.value=r(c.value,n(i,v))},downLeft(){s.value&&(m.value={})},upLeft(){m.value=void 0},downMiddle(){s.value&&(v.value={origin:e({},c.value),downAt:e({},s.value)})},upMiddle(){v.value=void 0},leave(){v.value=void 0},viewMove(){v.value&&s.value&&(c.value=r(v.value.origin,o(n(v.value.downAt,s.value),u.value)))}}}({scaleMin:1});function v(){if(!u.value)return;const e=u.value.getBoundingClientRect();c.viewSize.width=e.width,c.viewSize.height=e.height}const m=at();return y(v),s((()=>m.state.size),v),{scale:c.scale,viewOrigin:c.viewOrigin,viewSize:i((()=>c.viewSize)),wrapper:u,svg:l,viewBox:c.viewBox,focus(){l.value&&l.value.focus()},wheel:e=>c.wheel(e,!0),downLeft:()=>{c.mousePoint.value&&(c.downLeft(),a("down-left",c.viewToCanvas(c.mousePoint.value)))},upLeft:()=>{c.upLeft(),a("up-left")},downMiddle:c.downMiddle,upMiddle:c.upMiddle,leave:c.leave,mousemove:e=>{c.mousePoint.value=g(e),c.dragInfo.value?a("drag",c.viewToCanvas(c.mousePoint.value)):c.viewMovingInfo.value?c.viewMove():c.editStartPoint.value&&a("mousemove",{current:c.viewToCanvas(c.mousePoint.value),start:c.viewToCanvas(c.editStartPoint.value)})},clickAny(e){e.target===l.value?(c.editStartPoint.value=void 0,a("click-empty")):a("click-any")},keyDownEscape:()=>{a("escape")},editKeyDown(e){c.mousePoint.value&&(c.editStartPoint.value=c.mousePoint.value,a(e))}}}});const Kt=B("data-v-5868f1c8");I("data-v-5868f1c8");const Ht={ref:"wrapper",class:"timeline-canvas-root"};C();const Rt=Kt(((e,t,a,n,l,r)=>(p(),v("div",Ht,[(p(),v("svg",{ref:"svg",tabindex:"-1",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"none","font-family":"sans-serif",viewBox:e.viewBox,width:e.viewSize.width,height:e.viewSize.height,onWheel:t[1]||(t[1]=w(((...t)=>e.wheel&&e.wheel(...t)),["prevent"])),onClick:t[2]||(t[2]=w(((...t)=>e.clickAny&&e.clickAny(...t)),["left"])),onContextmenu:t[3]||(t[3]=w(((...t)=>e.keyDownEscape&&e.keyDownEscape(...t)),["right","prevent"])),onMouseenter:t[4]||(t[4]=(...t)=>e.focus&&e.focus(...t)),onMousedown:[t[5]||(t[5]=w(((...t)=>e.downLeft&&e.downLeft(...t)),["left","prevent"])),t[8]||(t[8]=w(((...t)=>e.downMiddle&&e.downMiddle(...t)),["middle","prevent"]))],onMouseup:[t[6]||(t[6]=w(((...t)=>e.upLeft&&e.upLeft(...t)),["left","prevent"])),t[9]||(t[9]=w(((...t)=>e.upMiddle&&e.upMiddle(...t)),["middle","prevent"]))],onMousemove:t[7]||(t[7]=w(((...t)=>e.mousemove&&e.mousemove(...t)),["prevent"])),onMouseleave:t[10]||(t[10]=(...t)=>e.leave&&e.leave(...t)),onKeydown:[t[11]||(t[11]=M(w(((...t)=>e.keyDownEscape&&e.keyDownEscape(...t)),["exact","prevent"]),["escape"])),t[12]||(t[12]=M(w((t=>e.editKeyDown("g")),["exact","prevent"]),["g"])),t[13]||(t[13]=M(w((t=>e.editKeyDown("x")),["exact","prevent"]),["x"]))]},[S(e.$slots,"default",{scale:e.scale,viewOrigin:e.viewOrigin,viewSize:e.viewSize})],40,["viewBox","width","height"]))],512))));Gt.render=Rt,Gt.__scopeId="data-v-5868f1c8";var qt=u({props:{labelWidth:{type:Number,default:100},index:{type:Number,required:!0},label:{type:String,required:!0}},setup:()=>({height:24})});qt.render=function(e,t,a,n,l,r){return p(),v("g",{transform:`translate(0, ${e.index*e.height})`},[m("rect",{width:e.labelWidth,height:e.height,fill:"#fff",stroke:"black"},null,8,["width","height"]),m("text",{x:"4",y:e.height/2,"dominant-baseline":"central"},A(e.label),9,["y"])],8,["transform"])};function Xt(e){return Math.round(function(e){return Math.round(Math.log(e)/Math.log(1.1))}(e)/2)+1}var Yt=u({props:{scale:{type:Number,default:1},originX:{type:Number,default:0},viewWidth:{type:Number,default:100},currentFrame:{type:Number,default:0},endFrame:{type:Number,default:60}},emits:["down-current-frame","up-current-frame"],setup(e,{emit:t}){const a=i((()=>Xt(e.scale))),n=i((()=>function(e,t){const a=Math.floor(Math.max(t,0)/20);return a-a%(2*e)}(a.value,e.originX))),l=i((()=>Math.ceil(e.viewWidth*e.scale/20))),r=i((()=>Math.floor(l.value/a.value))),o=i((()=>[...Array(r.value)].map(((e,t)=>{const l=t*a.value+n.value;return{f:l,labelSize:l%10==0?14:l%2==0?11:0,strokeWidth:l%10==0?2:1}})))),d=i((()=>20*e.currentFrame)),s=i((()=>10*Math.max(e.currentFrame.toString().length,2)+2));return{headerHeight:24,frames:o,frameWidth:20,currentFrameX:d,endFrameX:i((()=>20*e.endFrame)),currentFrameLabelWidth:s,downCurrentFrame:()=>t("down-current-frame")}}});const Jt=B("data-v-d1cae906");I("data-v-d1cae906");const Qt={class:"view-only"},Zt={fill:"#aaa",stroke:"none","fill-opacity":"0.5"},ea=m("g",{transform:"scale(-1, 1)"},[m("rect",{width:"200000",height:"200000"})],-1),ta=m("rect",{width:"200000",height:"200000"},null,-1);C();const aa=Jt(((e,t,a,n,l,r)=>(p(),v("g",null,[m("g",{transform:`scale(${e.scale})`,onMousedown:t[1]||(t[1]=w(((...t)=>e.downCurrentFrame&&e.downCurrentFrame(...t)),["left"]))},[m("rect",{x:"-100000",width:"200000",height:e.headerHeight,fill:"#fff",stroke:"#000"},null,8,["height"])],40,["transform"]),m("g",Qt,[m("g",null,[(p(!0),v(E,null,O(e.frames,(t=>(p(),v("g",{key:t,transform:`translate(${t.f*e.frameWidth}, 0)`},[m("g",{transform:`scale(${e.scale})`},[t.labelSize>0?(p(),v("text",{key:0,y:e.headerHeight-4,"font-size":t.labelSize,"dominant-baseline":"text-after-edge","text-anchor":"middle"},A(t.f),9,["y","font-size"])):k("",!0),t.strokeWidth>0?(p(),v("line",{key:1,x1:"0",y1:e.headerHeight,x2:"0",y2:"20000",stroke:"#aaa","stroke-width":t.strokeWidth},null,8,["y1","stroke-width"])):k("",!0)],8,["transform"])],8,["transform"])))),128))]),m("g",Zt,[ea,m("g",{transform:`translate(${e.endFrameX}, 0)`},[ta],8,["transform"])]),m("g",{transform:`translate(${e.currentFrameX}, 0) scale(${e.scale})`},[m("rect",{x:-e.currentFrameLabelWidth/2,y:2,width:e.currentFrameLabelWidth,height:20,rx:"4",ry:"4",fill:"blue",stroke:"none"},null,8,["x","width"]),m("text",{y:e.headerHeight-4,"font-size":"12","dominant-baseline":"text-after-edge","text-anchor":"middle",fill:"#fff"},A(e.currentFrame),9,["y"]),m("line",{x1:"0",y1:e.headerHeight,x2:"0",y2:"20000",stroke:"blue","stroke-width":"2"},null,8,["y1"])],8,["transform"])])]))));Yt.render=aa,Yt.__scopeId="data-v-d1cae906";var na=u({components:{SelectField:yt,TimelineCanvas:Gt,TimelineRow:qt,TimelineAxis:Yt},setup(){const e=Le(),t={currentFrame:Tt,endFrame:Pt,actions:zt.state.list,setEndFrame:Vt,selectedAction:zt.lastSelectedItem,selectAction:zt.selectItem,addAction:Ut,deleteAction:zt.deleteItem,updateAction:e=>zt.updateItem(e)},a=h(""),n=h(""),l=h(""),r=i((()=>t.selectedAction.value)),o=i((()=>{var t,a;return null!=(a=null==(t=e.lastSelectedArmature.value)?void 0:t.borns)?a:[]})),d=i((()=>t.actions.map((t=>{var a;const n=(null==(a=e.lastSelectedArmature.value)?void 0:a.id)!==t.armatureId;return{value:t.id,label:`${n?"(x)":""} ${t.name}`}}))));function s(e){var n;"move-current-frame"===a.value&&(t.currentFrame.value=(n=e.x-140-20,Math.round(Math.max(n,0)/20)))}return N((()=>{var e,t;n.value=null!=(t=null==(e=r.value)?void 0:e.name)?t:""})),N((()=>{l.value=t.endFrame.value.toString()})),{actions:t.actions,selectedBorns:o,draftName:n,draftEndFrame:l,labelWidth:140,axisPadding:20,currentFrame:t.currentFrame,endFrame:t.endFrame,changeActionName:()=>{n.value&&t.updateAction({name:n.value})},changeEndFrame:()=>{const e=parseInt(l.value,10);!isNaN(e)&&e>=0?t.setEndFrame(e):l.value=t.endFrame.value.toString()},addAction:t.addAction,deleteAction:t.deleteAction,actionOptions:d,selectedActionId:i({get:()=>{var e,t;return null!=(t=null==(e=r.value)?void 0:e.id)?t:""},set:e=>t.selectAction(e)}),downCurrentFrame:function(){a.value="move-current-frame"},downLeft:function(e){s(e)},drag:s,upLeft:function(){a.value=""}}}});const la=B("data-v-13a1eea6");I("data-v-13a1eea6");const ra={class:"animation-panel-root"},oa={class:"top"},da={class:"select-action"},ia={class:"end-frame-field"},sa=T("End: "),ua={class:"middle"};C();const ca=la(((e,t,a,n,l,r)=>{const o=x("SelectField"),d=x("TimelineAxis"),i=x("TimelineRow"),s=x("TimelineCanvas");return p(),v("div",ra,[m("div",oa,[m("div",da,[m(o,{modelValue:e.selectedActionId,"onUpdate:modelValue":t[1]||(t[1]=t=>e.selectedActionId=t),options:e.actionOptions},null,8,["modelValue","options"])]),$(m("input",{"onUpdate:modelValue":t[2]||(t[2]=t=>e.draftName=t),type:"text",onChange:t[3]||(t[3]=(...t)=>e.changeActionName&&e.changeActionName(...t))},null,544),[[L,e.draftName]]),m("button",{class:"add-action",onClick:t[4]||(t[4]=(...t)=>e.addAction&&e.addAction(...t))},"+"),m("button",{class:"delete-action",onClick:t[5]||(t[5]=(...t)=>e.deleteAction&&e.deleteAction(...t))},"x"),m("label",ia,[sa,$(m("input",{"onUpdate:modelValue":t[6]||(t[6]=t=>e.draftEndFrame=t),type:"number",onChange:t[7]||(t[7]=(...t)=>e.changeEndFrame&&e.changeEndFrame(...t))},null,544),[[L,e.draftEndFrame]])])]),m("div",ua,[m(s,{onUpLeft:e.upLeft,onDrag:e.drag,onDownLeft:e.downLeft},{default:la((({scale:t,viewOrigin:a,viewSize:n})=>[m("g",{transform:`translate(${e.labelWidth+e.axisPadding}, ${a.y})`},[m(d,{scale:t,"origin-x":a.x,"view-width":n.width,"current-frame":e.currentFrame,"end-frame":e.endFrame,onDownCurrentFrame:e.downCurrentFrame},null,8,["scale","origin-x","view-width","current-frame","end-frame","onDownCurrentFrame"])],8,["transform"]),m("g",{transform:`translate(${a.x}, ${a.y}) scale(${t})`},[m("g",null,[m("rect",{width:e.labelWidth,height:"10000",stroke:"none",fill:"#fff"},null,8,["width"]),m("line",{x1:e.labelWidth,y1:"0",x2:e.labelWidth,y2:"10000",stroke:"black"},null,8,["x1","x2"]),m(i,{index:1,"label-width":e.labelWidth,label:"Summary"},null,8,["label-width"]),(p(!0),v(E,null,O(e.selectedBorns,((t,a)=>(p(),v(i,{key:t.id,index:a+2,"label-width":e.labelWidth,label:t.name},null,8,["index","label-width","label"])))),128))])],8,["transform"])])),_:1},8,["onUpLeft","onDrag","onDownLeft"])])])}));na.render=ca,na.__scopeId="data-v-13a1eea6";const va=d({selectedColor:"orange"});function ma(e,t,a=!1){return r(e,l(o(n(t,e),.15),Math.PI/4*(a?-1:1)))}var pa=u({props:{born:{type:Object,required:!0},parent:{type:Object,default:void 0},opacity:{type:Number,default:1},selectedState:{type:Object,default:()=>({head:!1,tail:!1})},poseMode:{type:Boolean,default:!1}},emits:["select","shift-select"],setup(t,{emit:a}){const{settings:n}={settings:va},l=i((()=>t.born.head)),r=i((()=>t.born.tail)),o=i((()=>ma(l.value,r.value))),d=i((()=>ma(l.value,r.value,!0))),s=i((()=>t.poseMode?t.selectedState.head||t.selectedState.tail:t.selectedState.head&&t.selectedState.tail));return{transform:i((()=>W(t.born.transform))),head:l,tail:r,headPath:i((()=>U([l.value,o.value,d.value],!0))),tailPath:i((()=>U([r.value,o.value,d.value],!0))),fill:i((()=>s.value?n.selectedColor:"#ddd")),fillDark:i((()=>s.value?n.selectedColor:"#bbb")),fillHead:i((()=>t.selectedState.head?n.selectedColor:"")),fillTail:i((()=>t.selectedState.tail?n.selectedColor:"")),click:e=>{t.poseMode?s.value?a("select",{head:!1,tail:!1}):a("select",{head:!0,tail:!0}):a("select",e)},shiftClick:n=>{t.poseMode||n.head&&n.tail?s.value?a("shift-select",{head:!1,tail:!1}):a("shift-select",{head:!0,tail:!0}):n.head?a("shift-select",e(e({},t.selectedState),{head:!t.selectedState.head})):n.tail&&a("shift-select",e(e({},t.selectedState),{tail:!t.selectedState.tail}))}}}});const fa=B("data-v-13fd028e")(((e,t,a,n,l,r)=>(p(),v("g",{stroke:"black",fill:e.fill,transform:e.transform,opacity:e.opacity},[m("g",{onClick:[t[1]||(t[1]=w((t=>e.click({head:!0,tail:!0})),["exact"])),t[2]||(t[2]=w((t=>e.shiftClick({head:!0,tail:!0})),["shift","exact"]))]},[m("path",{d:e.headPath,fill:e.fillDark},null,8,["d","fill"]),m("path",{d:e.tailPath},null,8,["d"])]),m("circle",{r:"10",cx:e.head.x,cy:e.head.y,fill:e.fillHead,onClick:[t[3]||(t[3]=w((t=>e.click({head:!0,tail:!1})),["exact"])),t[4]||(t[4]=w((t=>e.shiftClick({head:!0,tail:!1})),["shift","exact"]))]},null,8,["cx","cy","fill"]),m("circle",{r:"10",cx:e.tail.x,cy:e.tail.y,fill:e.fillTail,onClick:[t[5]||(t[5]=w((t=>e.click({head:!1,tail:!0})),["exact"])),t[6]||(t[6]=w((t=>e.shiftClick({head:!1,tail:!0})),["shift","exact"]))]},null,8,["cx","cy","fill"]),e.parent?(p(),v("line",{key:0,x1:e.parent.tail.x,y1:e.parent.tail.y,x2:e.head.x,y2:e.head.y,"stroke-dasharray":"2 2",class:"view-only"},null,8,["x1","y1","x2","y2"])):k("",!0),m("text",{x:(e.head.x+e.tail.x)/2,y:(e.head.y+e.tail.y)/2,"text-anchor":"middle",fill:"black",stroke:"none",class:"view-only"},A(e.born.name),9,["x","y"])],8,["fill","transform","opacity"]))));pa.render=fa,pa.__scopeId="data-v-13fd028e";var ha=u({components:{BornElm:pa},props:{armature:{type:Object,required:!0},opacity:{type:Number,default:.8},selected:{type:Boolean,default:!1}},emits:["select","shift-select"],setup:(e,{emit:t})=>({bornMap:i((()=>J(e.armature.borns))),transform:i((()=>W(e.armature.transform))),bornSelectedState:i((()=>e.selected?{head:!0,tail:!0}:void 0)),click:()=>t("select",!e.selected),shiftClick:()=>t("shift-select",!e.selected)})});const ya=B("data-v-e1a73d3c")(((e,t,a,n,l,r)=>{const o=x("BornElm");return p(),v("g",{stroke:"black",transform:e.transform,opacity:e.opacity},[(p(!0),v(E,null,O(e.armature.borns,(t=>(p(),v(o,{key:t.name,born:t,"selected-state":e.bornSelectedState,parent:e.bornMap[t.parentId],onSelect:e.click,onShiftSelect:e.shiftClick},null,8,["born","selected-state","parent","onSelect","onShiftSelect"])))),128))],8,["transform","opacity"])}));ha.render=ya,ha.__scopeId="data-v-e1a73d3c";var ga=u({components:{AppCanvas:nt,ArmatureElm:ha,BornElm:pa,SidePanel:Mt,AnimationPanel:na},setup(){const t=Le(),a=et(),l=function(){const t=d({editMode:"",editMovement:void 0}),a=Le(),l=et(),r=i((()=>a.state.selectedBorns)),s=i((()=>{var e;return null==(e=a.lastSelectedBorn.value)?void 0:e.id})),u=h(),v=i((()=>!!s.value)),m=i((()=>{var e,t;return null!=(t=null==(e=u.value)?void 0:e.borns.map((e=>e.name)))?t:[]}));function p(){t.editMode="",t.editMovement=void 0}function f(t,a=!1){return e({},ae(t,a))}const y=i((()=>{if(!t.editMovement)return{};if("scale"===t.editMode){const e=a.selectedBornsOrigin.value,n=l.isOppositeSide(e,t.editMovement.start,t.editMovement.current),d=o(o({x:1,y:1},n?-1:1),P(t.editMovement.current,e)/P(t.editMovement.start,e)),i=l.snapScale(d);return Object.keys(r.value).reduce(((t,a)=>(t[a]=[R({origin:e,scale:i})],t)),{})}if("rotate"===t.editMode){const e=a.selectedBornsOrigin.value,n=(c(t.editMovement.current,e)-c(t.editMovement.start,e))/Math.PI*180;return Object.keys(r.value).reduce(((t,a)=>(t[a]=[R({origin:e,rotate:n})],t)),{})}const e=n(t.editMovement.current,t.editMovement.start),d=l.snapTranslate(e);return Object.keys(r.value).reduce(((e,t)=>(e[t]=[R({translate:d})],e)),{})})),g=i((()=>Object.keys(y.value).reduce(((e,t)=>(e[t]=te(a.bornMap.value[t],y.value[t],r.value[t]),e)),{})));function b(){u.value&&(a.updateBorns(g.value),t.editMovement=void 0,t.editMode="")}return{state:t,getEditTransforms:e=>y.value[e]||[],begin:e=>u.value=e,end(){p(),u.value=void 0},cancel:p,setEditMode:function(e){if(u.value&&(p(),v.value&&(t.editMode=e,"extrude"===e))){const e={},t=m.value.concat(),n=[];Object.keys(r.value).forEach((l=>{const o=r.value[l],d=a.bornMap.value[l],i=[];o.tail&&i.push(f(d)),o.head&&i.push(f(d,!0)),i.forEach((a=>{e[a.parentId]||(a.name=H(d.name,t),n.push(a),t.push(a.name),e[a.parentId]=!0)}))})),a.addBorns(n,{tail:!0})}},select:function(e,n){t.editMode?b():a.selectBorn(e,n)},shiftSelect:function(e,n){t.editMode?b():a.selectBorn(e,n,!0)},mousemove:function(e){t.editMode&&(t.editMovement=e)},clickAny:function(){t.editMode&&b()},clickEmpty:function(){t.editMode?b():a.selectBorn()}}}(),r=function(){const t=d({editMode:"",editMovement:void 0}),a=Le(),l=et(),r=i((()=>a.state.selectedBorns)),s=i((()=>{var e;return null==(e=a.lastSelectedBorn.value)?void 0:e.id})),u=h(),v=i((()=>!!s.value)),m=i((()=>{var e,t;return null!=(t=null==(e=u.value)?void 0:e.borns.map((e=>e.name)))?t:[]}));function p(){t.editMode="",t.editMovement=void 0}function f(t,a=!1){return e({},ae(t,a))}const y=i((()=>{if(!t.editMovement)return{};if("scale"===t.editMode){const e=a.selectedBornsOrigin.value,n=l.isOppositeSide(e,t.editMovement.start,t.editMovement.current),d=o(o({x:1,y:1},n?-1:1),P(t.editMovement.current,e)/P(t.editMovement.start,e)),i=l.snapScale(d);return Object.keys(r.value).reduce(((t,a)=>(t[a]=[R({origin:e,scale:i})],t)),{})}if("rotate"===t.editMode){const e=a.selectedBornsOrigin.value,n=(c(t.editMovement.current,e)-c(t.editMovement.start,e))/Math.PI*180;return Object.keys(r.value).reduce(((t,a)=>(t[a]=[R({origin:e,rotate:n})],t)),{})}const e=n(t.editMovement.current,t.editMovement.start),d=l.snapTranslate(e);return Object.keys(r.value).reduce(((e,t)=>(e[t]=[R({translate:d})],e)),{})})),g=i((()=>Object.keys(y.value).reduce(((e,t)=>(e[t]=te(a.bornMap.value[t],y.value[t],r.value[t]),e)),{})));function b(){u.value&&(a.updateBorns(g.value),t.editMovement=void 0,t.editMode="")}return{state:t,getEditTransforms:e=>y.value[e]||[],begin:e=>u.value=e,end(){p(),u.value=void 0},cancel:p,setEditMode:function(e){if(u.value&&(p(),v.value&&(t.editMode=e,"extrude"===e))){const e={},t=m.value.concat(),n=[];Object.keys(r.value).forEach((l=>{const o=r.value[l],d=a.bornMap.value[l],i=[];o.tail&&i.push(f(d)),o.head&&i.push(f(d,!0)),i.forEach((a=>{e[a.parentId]||(a.name=H(d.name,t),n.push(a),t.push(a.name),e[a.parentId]=!0)}))})),a.addBorns(n,{tail:!0})}},select:function(e,n){t.editMode?b():a.selectBorn(e,n,!1,!0)},shiftSelect:function(e,n){t.editMode?b():a.selectBorn(e,n,!0,!0)},mousemove:function(e){t.editMode&&(t.editMovement=e)},clickAny:function(){t.editMode&&b()},clickEmpty:function(){t.editMode?b():a.selectBorn()}}}(),s=me(),u=i((()=>a.state.canvasMode)),v=i((()=>t.lastSelectedArmature.value)),m=i((()=>t.state.armatures.filter((e=>{var a;return e.id!==(null==(a=t.lastSelectedArmature.value)?void 0:a.id)})))),p=i((()=>v.value?J(v.value.borns.map((e=>te(e,l.getEditTransforms(e.id),t.state.selectedBorns[e.id]||[])))):{})),f=i((()=>"edit"===u.value?Y(l.state.editMode):"pose"===u.value?Y(r.state.editMode):""));function g(e){var t;["input","textarea"].includes(null==(t=e.target)?void 0:t.tagName.toLowerCase())||e.ctrlKey&&"z"===e.key.toLowerCase()&&(e.preventDefault(),e.shiftKey?s.redo():s.undo())}return y((()=>{document.addEventListener("keydown",g)})),z((()=>{document.removeEventListener("keydown",g)})),{armatures:i((()=>t.state.armatures)),otherArmatures:m,lastSelectedArmatureId:i((()=>{var e;return null==(e=t.lastSelectedArmature.value)?void 0:e.id})),editBornMap:p,selectedBorns:i((()=>t.state.selectedBorns)),armatureEditMode:l,canvasMode:u,canvasCommand:f,mousemove(e){"edit"===u.value?l.mousemove(e):"pose"===u.value&&r.mousemove(e)},clickAny(){"edit"===u.value?l.clickAny():"pose"===u.value&&r.clickAny()},clickEmpty(){"object"===u.value?t.selectArmature():"edit"===u.value?l.clickEmpty():"pose"===u.value&&r.clickEmpty()},selectBorn(e,t){"edit"===u.value?l.select(e,t):"pose"===u.value&&r.select(e,t)},shiftSelectBorn(e,t){"edit"===u.value?l.shiftSelect(e,t):"pose"===u.value&&r.shiftSelect(e,t)},selectArmature(e,a){t.selectArmature(a?e:"")},shiftSelectArmature(e,a){t.selectArmature(a?e:"")},escape(){"edit"===u.value?l.cancel():"pose"===u.value&&r.cancel()},toggleCanvasMode(){t.lastSelectedArmature.value&&("edit"!==u.value?(l.end(),r.end(),a.setCanvasMode("edit"),l.begin(t.lastSelectedArmature.value)):(l.end(),a.toggleCanvasMode()))},ctrlToggleCanvasMode(){t.lastSelectedArmature.value&&("object"===u.value?(a.setCanvasMode("pose"),r.begin(t.lastSelectedArmature.value)):(l.end(),r.end(),a.ctrlToggleCanvasMode()))},setEditMode(e){"edit"===u.value?l.setEditMode(e):"pose"===u.value&&r.setEditMode(e)},execDelete(){"object"===u.value?t.deleteArmature():"edit"===u.value&&""===l.state.editMode&&t.deleteBorn()},addItem(){"object"===u.value?t.addArmature():"edit"===u.value&&""===l.state.editMode&&t.addBorn()}}}});const ba=B("data-v-ea9dfa5a");I("data-v-ea9dfa5a");const xa={class:"main"},wa={key:0},Ma={key:1},ka={key:2},Sa={class:"bottom"};C();const Aa=ba(((e,t,a,n,l,r)=>{const o=x("ArmatureElm"),d=x("BornElm"),i=x("AppCanvas"),s=x("SidePanel"),u=x("AnimationPanel");return p(),v("div",null,[m("div",xa,[m(i,{"current-command":e.canvasCommand,class:"canvas",onMousemove:e.mousemove,onClickAny:e.clickAny,onClickEmpty:e.clickEmpty,onEscape:e.escape,onTab:e.toggleCanvasMode,onCtrlTab:e.ctrlToggleCanvasMode,onG:t[1]||(t[1]=t=>e.setEditMode("grab")),onS:t[2]||(t[2]=t=>e.setEditMode("scale")),onR:t[3]||(t[3]=t=>e.setEditMode("rotate")),onE:t[4]||(t[4]=t=>e.setEditMode("extrude")),onX:e.execDelete,onShiftA:e.addItem},{default:ba((()=>["object"===e.canvasMode?(p(),v("g",wa,[(p(!0),v(E,null,O(e.armatures,(t=>(p(),v(o,{key:t.id,armature:t,selected:e.lastSelectedArmatureId===t.id,onSelect:a=>e.selectArmature(t.id,a),onShiftSelect:a=>e.shiftSelectArmature(t.id,a)},null,8,["armature","selected","onSelect","onShiftSelect"])))),128))])):k("",!0),"edit"===e.canvasMode?(p(),v("g",Ma,[(p(!0),v(E,null,O(e.otherArmatures,(e=>(p(),v(o,{key:e.id,armature:e,opacity:.3},null,8,["armature","opacity"])))),128)),(p(!0),v(E,null,O(e.editBornMap,(t=>(p(),v(d,{key:t.id,born:t,parent:e.editBornMap[t.parentId],"selected-state":e.selectedBorns[t.id],onSelect:a=>e.selectBorn(t.id,a),onShiftSelect:a=>e.shiftSelectBorn(t.id,a)},null,8,["born","parent","selected-state","onSelect","onShiftSelect"])))),128))])):k("",!0),"pose"===e.canvasMode?(p(),v("g",ka,[(p(!0),v(E,null,O(e.otherArmatures,(e=>(p(),v(o,{key:e.id,armature:e,opacity:.3},null,8,["armature","opacity"])))),128)),(p(!0),v(E,null,O(e.editBornMap,(t=>(p(),v(d,{key:t.id,born:t,parent:e.editBornMap[t.parentId],"selected-state":e.selectedBorns[t.id],"pose-mode":"",onSelect:a=>e.selectBorn(t.id,a),onShiftSelect:a=>e.shiftSelectBorn(t.id,a)},null,8,["born","parent","selected-state","onSelect","onShiftSelect"])))),128))])):k("",!0)])),_:1},8,["current-command","onMousemove","onClickAny","onClickEmpty","onEscape","onTab","onCtrlTab","onX","onShiftA"]),m(s,{class:"side-panel"})]),m("div",Sa,[m(u)])])}));ga.render=Aa,ga.__scopeId="data-v-ea9dfa5a",_(ga).mount("#app");
