var e=Object.prototype.hasOwnProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.propertyIsEnumerable,n=Object.assign,r=(n,r)=>{var l={};for(var o in n)e.call(n,o)&&r.indexOf(o)<0&&(l[o]=n[o]);if(null!=n&&t)for(var o of t(n))r.indexOf(o)<0&&a.call(n,o)&&(l[o]=n[o]);return l};import{v as l,n as o,l as s,d,i as c,a as i,r as u,c as m,w as v,b as f,e as p,f as h,g as y,o as b,h as g,j as x,k,m as w,p as S,q as M,s as A,t as B,u as I,x as C,y as E,z as O,A as F,B as j,C as $,F as D,D as L,E as T,G as N,H as P,I as _,J as z,K,L as W,M as U,N as V}from"./vendor.6dea0f0f.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(a){const n=new URL(e,location),r=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((a,l)=>{const o=new URL(e,n);if(self[t].moduleMap[o])return a(self[t].moduleMap[o]);const s=new Blob([`import * as m from '${o}';`,`${t}.moduleMap['${o}']=m;`],{type:"text/javascript"}),d=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(s),onerror(){l(new Error(`Failed to import: ${e}`)),r(d)},onload(){a(self[t].moduleMap[o]),r(d)}});document.head.appendChild(d)})),self[t].moduleMap={}}}("/blendic-svg/assets/");function G(e){return[`translate(${e.translate.x},${e.translate.y})`,`rotate(${e.rotate})`,`scale(${e.scale.x},${e.scale.y})`].join(" ")}function H(e,t=!1){if(0===e.length)return"";const[a,...n]=e;return`M${a.x},${a.y}`+n.map((e=>`L${e.x},${e.y}`)).join("")+(t?"z":"")}function R(e){return`${e.x} ${e.y} ${e.width} ${e.height}`}const q=/\.[0-9]{3,}$/;function X(e){return q.test(e)?e.replace(q,(e=>"."+`${parseInt(e.slice(1),10)+1}`.padStart(3,"0"))):`${e}.001`}function Y(e,t){const a=new Map(t.map((e=>[e,!0])));let n=X(e);for(;a.has(n);)n=X(n);return n}function J(e,t){return e.reduce(((e,a)=>(e[a[t]]=a,e)),{})}function Q(e={}){return n({translate:{x:0,y:0},origin:{x:0,y:0},rotate:0,scale:{x:1,y:1}},e)}function Z(e={},t=!1){return n({id:t?l():"",name:"",transform:Q(),parentId:"",connected:!1,head:{x:0,y:0},tail:{x:0,y:0}},e)}function ee(e={},t=!1){return n({id:t?l():"",name:"",transform:Q(),borns:[]},e)}function te(e){return J(e,"id")}function ae(e){return J(e,"bornId")}function ne(e,t){return Object.keys(n(n({},e),t)).reduce(((a,r)=>{var l,o;return a[r]=n(n({},null!=(l=e[r])?l:{}),null!=(o=t[r])?o:{}),a}),{})}function re(e,t){return Object.keys(t).reduce(((t,a)=>(t[a]=e[a],t)),{})}function le(e){return!!e&&(!!e.head||!!e.tail)}function oe(e){return e.reduce(((e,t)=>{return n=t,Q({scale:{x:(a=e).scale.x*n.scale.x,y:a.scale.y*n.scale.y},rotate:a.rotate+n.rotate,translate:o(a.translate,n.translate)});var a,n}),Q())}function se(e,t){return o(d(function(e,t,a={x:0,y:0}){return{x:a.x+(e.x-a.x)*t.x,y:a.y+(e.y-a.y)*t.y}}(e,t.scale,t.origin),t.rotate/180*Math.PI,t.origin),t.translate)}function de(e,t,a){const r=a.head?se(e.head,t):e.head,l=a.tail?se(e.tail,t):e.tail;return n(n({},e),{head:r,tail:l})}function ce(e,t){const a=oe(t),r=se(e.head,Q({translate:a.translate})),l=se(e.tail,Q(n(n({},a),{origin:e.head})));return n(n({},e),{head:r,tail:l,transform:Q()})}function ie(e,t){return e.find((e=>e.id===t))}function ue(e,t,a,r=!1){const l=ie(e.borns,t);if(!l)return{};let o={[t]:a};if(!r){if(a.head&&l.connected){const t=ie(e.borns,l.parentId);t&&(o=n(n({},ue(e,t.id,{tail:!0},r)),o))}a.tail&&function(e,t,a=!1){return e.borns.filter((e=>e.parentId===t&&(!a||e.connected)))}(e,l.id,!0).forEach((e=>{o[e.id]={head:!0}}))}return o}function me(e){return e.reduce(((t,a)=>{const n=ie(e,a.parentId);return n?a.connected&&(t[a.id]={connected:s(n.tail,a.head)}):t[a.id]={connected:!1,parentId:""},t}),{})}function ve(e){const t=[],a=Object.keys(e).reduce(((a,n)=>{const r=e[n];return r.parentId?a[r.parentId]?a[r.parentId].push(r):a[r.parentId]=[r]:t.push(r),a}),{});return t.map((e=>n(n({},e),{children:fe(a,e.id)})))}function fe(e,t){var a,r;return null!=(r=null==(a=e[t])?void 0:a.map((t=>n(n({},t),{children:fe(e,t.id)}))))?r:[]}function pe(e){return te(ye(function(e){return ve(e).map((e=>n(n({},e),{children:he(e)})))}(e)))}function he(e){var t;return null!=(t=e.children.map((t=>{const a=function(e,t){const a=o(t.head,t.transform.translate),r=se(a,n(n({},e.transform),{origin:e.head})),l=i(r,a);return n(n({},t),{transform:{translate:o(t.transform.translate,l),rotate:t.transform.rotate+e.transform.rotate,scale:{x:t.transform.scale.x*e.transform.scale.x,y:t.transform.scale.y*e.transform.scale.y},origin:{x:0,y:0}}})}(e,t);return n(n({},a),{children:he(n(n({},a),{children:t.children}))})})))?t:[]}function ye(e){return e.map((e=>{const{children:t}=e;return r(e,["children"])})).concat(e.flatMap((e=>ye(e.children))))}function be(e,t){return te(ge(ve(e),t))}function ge(e,t){return e.flatMap((e=>{if(le(t[e.id])){const{children:t}=e;return[r(e,["children"])]}return ge(e.children,t)}))}const xe=u({undoStack:[],redoStack:[]}),ke=m((()=>xe.undoStack.concat(xe.redoStack.concat().reverse()))),we=m((()=>xe.undoStack.length-1));function Se(){xe.undoStack=[],xe.redoStack=[]}function Me(e){xe.undoStack.push(e),xe.redoStack=[]}function Ae(){const e=xe.undoStack.pop();e&&(e.undo(),xe.redoStack.push(e))}function Be(){const e=xe.redoStack.pop();e&&(e.redo(),xe.undoStack.push(e))}function Ie(){return{state:xe,allStack:ke,currentItemIndex:we,clearHistory:Se,push:Me,undo:Ae,redo:Be}}const Ce=Ie(),Ee=u(ee({name:"armature",borns:[Z({name:"born",head:{x:20,y:200},tail:{x:220,y:200}},!0)]},!0)),Oe=u({armatures:[Ee],lastSelectedArmatureId:"",lastSelectedBornId:"",selectedArmatures:{},selectedBorns:{}}),Fe=m((()=>Oe.armatures.findIndex((e=>e.id===Oe.lastSelectedArmatureId&&Oe.selectedArmatures[Oe.lastSelectedArmatureId])))),je=m((()=>-1!==Fe.value?Oe.armatures[Fe.value]:void 0)),$e=m((()=>je.value?je.value.borns.findIndex((e=>{var t,a;return e.id===Oe.lastSelectedBornId&&((null==(t=Oe.selectedBorns[Oe.lastSelectedBornId])?void 0:t.head)||(null==(a=Oe.selectedBorns[Oe.lastSelectedBornId])?void 0:a.tail))})):-1)),De=m((()=>{if(je.value)return-1!==$e.value?je.value.borns[$e.value]:void 0})),Le=m((()=>te(Oe.armatures))),Te=m((()=>{var e,t;return te(null!=(t=null==(e=je.value)?void 0:e.borns)?t:[])})),Ne=m((()=>function(e,t){const a=Object.keys(t).map((a=>{const n=[],r=ce(e[a],[e[a].transform]);return t[a].head&&n.push(r.head),t[a].tail&&n.push(r.tail),n})).flat();return 0===a.length?{x:0,y:0}:c(a.reduce(((e,t)=>o(e,t)),{x:0,y:0}),1/a.length)}(Te.value,Oe.selectedBorns)));function Pe(e=""){if(Oe.lastSelectedArmatureId===e)return;const t=Xe(e);t.redo(),Ce.push(t)}function _e(e){if(!je.value)return;const t=function(e){const t=re(je.value,e);return{name:"Update Armature",undo:()=>{const e=Fe.value;Oe.armatures[e]=n(n({},Oe.armatures[e]),t)},redo:()=>{const t=Fe.value;Oe.armatures[t]=n(n({},Oe.armatures[t]),e)}}}({name:e});t.redo(),Ce.push(t)}function ze(){const e=function(){const e=n({},je.value),t=Fe.value,a=Xe("");return{name:"Delete Armature",undo:()=>{Oe.armatures.splice(t,0,e),a.undo()},redo:()=>{Oe.armatures.splice(t,1)}}}();e.redo(),Ce.push(e)}function Ke(){const e=function(e){const t=Oe.armatures.length,a=Xe(e.id);return{name:"Add Armature",undo:()=>{Oe.armatures.splice(t,1),a.undo()},redo:()=>{Oe.armatures.push(e),a.redo()}}}(ee({name:Y("armature",Oe.armatures.map((e=>e.name))),borns:[Z({name:"born",tail:{x:100,y:0}},!0)]},!0));e.redo(),Ce.push(e)}function We(e="",t={head:!0,tail:!0},a=!1,n=!1){if(!je.value)return;if(Oe.lastSelectedBornId===e&&(r=Oe.selectedBorns[e],l=t,!!(null==r?void 0:r.head)==!!(null==l?void 0:l.head)&&!!(null==r?void 0:r.tail)==!!(null==l?void 0:l.tail)))return;var r,l;const o=Ye(e,t,a,n);o.redo(),Ce.push(o)}function Ue(){if(!je.value)return;const e=function(){const e=je.value.borns.concat(),t=je.value.borns.filter((e=>!Oe.selectedBorns[e.id])),a=Je(me(t)),n=Ye("");return{name:"Delete Born",undo:()=>{je.value.borns=e.concat(),n.undo(),a.undo()},redo:()=>{je.value.borns=t,a.redo()}}}();e.redo(),Ce.push(e)}function Ve(){je.value&&Ge([Z({name:Y("born",je.value.borns.map((e=>e.name))),tail:{x:100,y:0}},!0)])}function Ge(e,t){if(!je.value)return;const a=function(e,t){const a=e.map(((e,a)=>Ye(e.id,t[e.id],0!==a)));return{name:"Add Born",undo:()=>{je.value.borns=je.value.borns.slice(0,je.value.borns.length-e.length),a.forEach((e=>e.undo()))},redo:()=>{je.value.borns=je.value.borns.concat(e),a.forEach((e=>e.redo()))}}}(e,e.reduce(((e,a)=>(t&&(e[a.id]=n({},t)),e)),{}));a.redo(),Ce.push(a)}function He(e){if(!je.value)return;const t=Je(e);t.redo(),Ce.push(t)}function Re(e){if(!je.value)return;if(!De.value)return;const t=function(e){const t=re(De.value,e);return{name:"Update Born",undo:()=>{const e=$e.value;je.value.borns[e]=n(n({},je.value.borns[e]),t)},redo:()=>{const t=$e.value;je.value.borns[t]=n(n({},je.value.borns[t]),e)}}}(function(e,t){if(!t.connected)return t;const a=ie(e,t.parentId);return n(n({},t),a?{head:a.tail}:{connected:!1,parentId:""})}(je.value.borns,n(n({},De.value),e)));t.redo(),Ce.push(t)}function qe(){return{state:Oe,lastSelectedArmature:je,lastSelectedBorn:De,bornMap:Te,selectedBornsOrigin:Ne,selectArmature:Pe,updateArmatureName:_e,deleteArmature:ze,addArmature:Ke,selectBorn:We,deleteBorn:Ue,addBorn:Ve,addBorns:Ge,updateBorns:He,updateBorn:Re}}function Xe(e){const t=n({},Oe.selectedArmatures),a=Oe.lastSelectedArmatureId;return{name:"Select Armature",undo:()=>{Oe.selectedArmatures=n({},t),Oe.lastSelectedArmatureId=a},redo:()=>{Oe.selectedArmatures=e?{[e]:!0}:{},Oe.lastSelectedArmatureId=e}}}function Ye(e,t={head:!0,tail:!0},a=!1,r=!1){const l=n({},Oe.selectedBorns),o=Oe.lastSelectedBornId;return{name:"Select Born",undo:()=>{Oe.selectedBorns=n({},l),Oe.lastSelectedBornId=o},redo:()=>{Oe.selectedBorns=e?ne(n(n({},a?Oe.selectedBorns:{}),{[e]:t}),ue(je.value,e,t,r)):{},Oe.lastSelectedBornId=e}}}function Je(e){const t=ne(e,me(je.value.borns.map((t=>n(n({},t),e[t.id]))))),a=Object.keys(t).reduce(((e,a)=>(Te.value[a]&&(e[a]=re(Te.value[a],t[a])),e)),{});return{name:"Update Born",undo:()=>{je.value.borns=je.value.borns.map((e=>n(n({},e),a[e.id])))},redo:()=>{je.value.borns=je.value.borns.map((e=>n(n({},e),t[e.id])))}}}v((()=>Oe.selectedArmatures),(()=>{Oe.selectedArmatures[Oe.lastSelectedArmatureId]||(Oe.lastSelectedArmatureId="")})),v((()=>Le.value),(()=>{Oe.selectedArmatures=Object.keys(Oe.selectedArmatures).reduce(((e,t)=>Le.value[t]?n(n({},e),{[t]:Oe.selectedArmatures[t]}):e),{})})),v((()=>Oe.selectedBorns),(()=>{if(!le(Oe.selectedBorns[Oe.lastSelectedBornId])){const e=Object.keys(Oe.selectedBorns);Oe.lastSelectedBornId=e.length>0?e[0]:""}})),v((()=>Te.value),(()=>{Oe.selectedBorns=Object.keys(Oe.selectedBorns).reduce(((e,t)=>Te.value[t]?n(n({},e),{[t]:Oe.selectedBorns[t]}):e),{})}));var Qe=f({props:{origin:{type:Object,required:!0},current:{type:Object,required:!0},scale:{type:Number,required:!0},side:{type:Boolean,default:!1}},setup:e=>({rotate:m((()=>p(e.current,e.origin)/Math.PI*180))})});const Ze={fill:"black",stroke:"black"},et=y("circle",{r:"2"},null,-1),tt=y("circle",{r:"2"},null,-1),at=y("path",{d:"M-20,0L-10,-10L-10,10z"},null,-1),nt=y("path",{d:"M20,0L10,-10L10,10z"},null,-1);function rt(e){const t=u({command:"",editMovement:void 0}),a=qe(),r=m((()=>a.state.selectedBorns)),l=m((()=>{var e;return null==(e=a.lastSelectedBorn.value)?void 0:e.id})),o=m((()=>a.lastSelectedArmature.value)),s=m((()=>!!l.value)),d=m((()=>{var e,t;return null!=(t=null==(e=o.value)?void 0:e.borns.map((e=>e.name)))?t:[]}));function v(){t.command="",t.editMovement=void 0}function f(e,t=!1){return n({},function(e,t=!1){const a=t?e.head:e.tail;return Z({head:a,tail:a,parentId:t?e.parentId:e.id,connected:!t||e.connected},!0)}(e,t))}const h=m((()=>{if(!t.editMovement)return{};if("scale"===t.command){const n=a.selectedBornsOrigin.value,l=e.isOppositeSide(n,t.editMovement.start,t.editMovement.current),o=c(c({x:1,y:1},l?-1:1),g(t.editMovement.current,n)/g(t.editMovement.start,n)),s=e.snapScale(o);return Object.keys(r.value).reduce(((e,t)=>(e[t]=Q({origin:n,scale:s}),e)),{})}if("rotate"===t.command){const e=a.selectedBornsOrigin.value,n=(p(t.editMovement.current,e)-p(t.editMovement.start,e))/Math.PI*180;return Object.keys(r.value).reduce(((t,a)=>(t[a]=Q({origin:e,rotate:n}),t)),{})}const n=i(t.editMovement.current,t.editMovement.start),l=e.snapTranslate(n);return Object.keys(r.value).reduce(((e,t)=>(e[t]=Q({translate:l}),e)),{})})),y=m((()=>Object.keys(h.value).reduce(((e,t)=>(e[t]=de(a.bornMap.value[t],h.value[t],r.value[t]),e)),{})));function b(){o.value&&(a.updateBorns(y.value),t.editMovement=void 0,t.command="")}return{command:m((()=>t.command)),getEditTransforms:e=>h.value[e]||Q(),end:()=>v(),cancel:v,setEditMode:function(e){if(o.value&&(v(),s.value&&(t.command=e,"extrude"===e))){const e={},t=d.value.concat(),n=[];Object.keys(r.value).forEach((l=>{const o=r.value[l],s=a.bornMap.value[l],d=[];o.tail&&d.push(f(s)),o.head&&d.push(f(s,!0)),d.forEach((a=>{e[a.parentId]||(a.name=Y(s.name,t),n.push(a),t.push(a.name),e[a.parentId]=!0)}))})),a.addBorns(n,{tail:!0})}},select:function(e,n){t.command?b():a.selectBorn(e,n)},shiftSelect:function(e,n){t.command?b():a.selectBorn(e,n,!0)},mousemove:function(e){t.command&&(t.editMovement=e)},clickAny:function(){t.command&&b()},clickEmpty:function(){t.command?b():a.selectBorn()},execDelete:function(){""===t.command&&a.deleteBorn()},execAdd:function(){""===t.command&&a.addBorn()}}}Qe.render=function(e,t,a,n,r,l){return b(),h("g",Ze,[y("g",{transform:`translate(${e.origin.x}, ${e.origin.y}) rotate(${e.rotate}) scale(${e.scale})`},[et],8,["transform"]),y("line",{x1:e.origin.x,y1:e.origin.y,x2:e.current.x,y2:e.current.y,"stroke-width":e.scale,"stroke-dasharray":`${2*e.scale} ${2*e.scale}`},null,8,["x1","y1","x2","y2","stroke-width","stroke-dasharray"]),y("g",{transform:`translate(${e.current.x}, ${e.current.y}) rotate(${e.rotate}) scale(${e.scale})`},[tt,y("g",{transform:`rotate(${e.side?90:0})`},[at,nt],8,["transform"])],8,["transform"])])};const lt=Ie();function ot(e,t){const a=n({},e.selectedMap),r=e.lastSelectedId;return{name:`Select ${e.label}`,undo:()=>{e.selectedMap=n({},a),e.lastSelectedId=r},redo:()=>{e.selectedMap=t?{[t]:!0}:{},e.lastSelectedId=t}}}function st(e){return Math.round(function(e){return Math.round(Math.log(e)/Math.log(1.1))}(e)/2)+1}const dt=x(0),ct=x(60),it=function(e){const t=u({label:e,list:[],lastSelectedId:"",selectedMap:{}}),a=m((()=>t.list.findIndex((e=>e.id===t.lastSelectedId&&t.selectedMap[t.lastSelectedId])))),r=m((()=>te(t.list))),l=m((()=>-1!==a.value?t.list[a.value]:void 0));return v((()=>t.selectedMap),(()=>{t.selectedMap[t.lastSelectedId]||(t.lastSelectedId="")})),v((()=>r.value),(()=>{t.selectedMap=Object.keys(t.selectedMap).reduce(((e,a)=>r.value[a]?n(n({},e),{[a]:t.selectedMap[a]}):e),{})})),{state:t,itemMap:r,lastSelectedItem:l,selectItem:function(e){if(t.lastSelectedId===e)return;const a=ot(t,e);a.redo(),lt.push(a)},addItem:function(e){const a=function(e,t){const a=e.list.length,n=ot(e,t.id),r=()=>{e.list.push(t),n.redo()};return{name:`Add ${e.label}`,undo:()=>{e.list.splice(a,1),n.undo()},redo:r}}(t,e);a.redo(),lt.push(a)},deleteItem:function(){if(-1===a.value)return;const e=function(e,t){const a=n({},e.list[t]),r=t,l=ot(e,""),o=()=>{e.list.splice(r,1)};return{name:`Delete ${e.label}`,undo:()=>{e.list.splice(r,0,a),l.undo()},redo:o}}(t,a.value);e.redo(),lt.push(e)},updateItem:function(e){if(-1===a.value)return;const r=function(e,t,a){const r=re(e.list[a],t),l=()=>{e.list[a]=n(n({},e.list[a]),t)};return{name:`Update ${e.label}`,undo:()=>{e.list[a]=n(n({},e.list[a]),r)},redo:l}}(t,e,a.value);r.redo(),lt.push(r)}}}("Action"),ut=x({}),mt=Ie(),vt=qe(),ft=m((()=>{var e,t;return function(e){const t={};return e.forEach((e=>{t[e.frame]?t[e.frame].push(e):t[e.frame]=[e]})),t}(null!=(t=null==(e=it.lastSelectedItem.value)?void 0:e.keyframes)?t:[])})),pt=m((()=>{var e,t;return function(e){const t={};return e.forEach((e=>{t[e.frame]?t[e.bornId].push(e):t[e.bornId]=[e]})),t}(null!=(t=null==(e=it.lastSelectedItem.value)?void 0:e.keyframes)?t:[])})),ht=m((()=>{var e,t,a,n;return a=null!=(t=null==(e=it.lastSelectedItem.value)?void 0:e.keyframes)?t:[],n=dt.value,a.filter((e=>e.frame===n))})),yt=m((()=>ae(ht.value))),bt=m((()=>Array.from(new Set(Object.keys(ut.value).concat(Object.keys(yt.value)))))),gt=m((()=>bt.value.reduce(((e,t)=>(yt.value[t]?e[t]=oe([yt.value[t].transform,Ct(t)]):e[t]=Ct(t),e)),{}))),xt=m((()=>vt.lastSelectedArmature.value?pe(te(vt.lastSelectedArmature.value.borns.map((e=>n(n({},e),{transform:Et(e.id)}))))):{})),kt=m((()=>{return e=xt.value,t=vt.state.selectedBorns,te(Object.keys(e).filter((e=>le(t[e]))).map((t=>e[t])));var e,t})),wt=m((()=>be(xt.value,vt.state.selectedBorns))),St=m((()=>vt.lastSelectedArmature.value?function(e){const t=Object.keys(e).map((t=>ce(e[t],[e[t].transform]).head));return 0===t.length?{x:0,y:0}:c(t.reduce(((e,t)=>o(e,t)),{x:0,y:0}),1/t.length)}(wt.value):{x:0,y:0}));function Mt(){vt.lastSelectedArmature.value&&it.addItem(function(e={},t=!1){return n({id:t?l():"",name:"",totalFrame:60,armatureId:"",keyframes:[]},e)}({name:Y("action",it.state.list.map((e=>e.name))),armatureId:vt.lastSelectedArmature.value.id},!0))}function At(e){if(ct.value===e)return;const t=function(e){const t=ct.value;return{name:"Update End Frame",undo:()=>{ct.value=t},redo:()=>{ct.value=e}}}(e);t.redo(),mt.push(t)}function Bt(e){const t=function(e){const t=n({},ut.value);return{name:"Update Pose",undo:()=>{ut.value=t},redo:()=>{ut.value=e}}}(e);t.redo(),mt.push(t)}function It(e){Bt(Array.from(new Set(Object.keys(ut.value).concat(Object.keys(e)))).reduce(((t,a)=>{var n;return t[a]=oe([Ct(a),null!=(n=e[a])?n:Q()]),t}),{}))}function Ct(e){var t;return null!=(t=ut.value[e])?t:Q()}function Et(e){var t;return null!=(t=gt.value[e])?t:Q()}function Ot(){if(!it.lastSelectedItem.value)return;const e=function(e){const t=ae(e),a=dt.value,r=n({},ut.value),l=it.lastSelectedItem.value.keyframes.filter((e=>e.frame===a&&t[e.bornId]));return{name:"Insert Keyframe",undo:()=>{const e=it.lastSelectedItem.value.keyframes.filter((e=>!(e.frame===a&&t[e.bornId]))).concat(l);dt.value=a,it.lastSelectedItem.value.keyframes=e,ut.value=r},redo:()=>{const n=it.lastSelectedItem.value.keyframes.filter((e=>!(e.frame===a&&t[e.bornId]))).concat(e);var r,l;dt.value=a,it.lastSelectedItem.value.keyframes=n,ut.value=(r=ut.value,l=t,Object.keys(r).reduce(((e,t)=>(t in l||(e[t]=r[t]),e)),{}))}}}(Object.keys(kt.value).map((e=>function(e={},t=!1){return n({id:t?l():"",frame:0,bornId:"",transform:Q()},e)}({frame:dt.value,bornId:e,transform:Et(e)},!0))));e.redo(),mt.push(e)}function Ft(e){dt.value=e,ut.value={}}function jt(){return{currentFrame:dt,endFrame:ct,actions:it.state.list,keyframeMapByFrame:ft,keyframeMapByBornId:pt,posedBornIds:bt,currentPosedBorns:xt,selectedAllBorns:kt,selectedBorns:wt,selectedPosedBornOrigin:St,getCurrentSelfTransforms:Et,setEndFrame:At,selectedAction:it.lastSelectedItem,selectAction:it.selectItem,addAction:Mt,deleteAction:it.deleteItem,updateAction:e=>it.updateItem(e),applyEditedTransforms:It,execInsertKeyframe:Ot,setCurrentFrame:Ft}}const $t=Ie(),Dt=u({canvasMode:"object",pastCanvasMode:"edit",axisGrid:""}),Lt=m((()=>"edit"===Dt.canvasMode?rt(Ht()):"pose"===Dt.canvasMode?function(e){const t=u({command:"",editMovement:void 0}),a=qe(),n=jt(),r=m((()=>{var e;return null==(e=a.lastSelectedBorn.value)?void 0:e.id})),l=m((()=>a.lastSelectedArmature.value)),o=m((()=>!!r.value));function s(){t.command="",t.editMovement=void 0}function c(e,t){const a=n.currentPosedBorns.value[t],r=n.currentPosedBorns.value[a.parentId];return r?d(e,-r.transform.rotate/180*Math.PI):e}const v=m((()=>{if(!t.editMovement)return{};if("rotate"===t.command){const e=n.selectedPosedBornOrigin.value,a=(p(t.editMovement.current,e)-p(t.editMovement.start,e))/Math.PI*180;return Object.keys(n.selectedBorns.value).reduce(((e,t)=>(e[t]=Q({rotate:a}),e)),{})}const a=i(t.editMovement.current,t.editMovement.start),r=e.snapTranslate(a);return Object.keys(n.selectedBorns.value).reduce(((e,t)=>(n.selectedBorns.value[t].connected||(e[t]=Q({translate:c(r,t)})),e)),{})}));function f(){l.value&&(n.applyEditedTransforms(v.value),t.editMovement=void 0,t.command="")}return{command:m((()=>t.command)),getEditTransforms(e){var t;return null!=(t=v.value[e])?t:Q()},end:()=>s(),cancel:s,setEditMode:function(e){l.value&&(s(),o.value&&(t.command=e))},select:function(e,n){t.command?f():a.selectBorn(e,n,!1,!0)},shiftSelect:function(e,n){t.command?f():a.selectBorn(e,n,!0,!0)},mousemove:function(e){t.command&&(t.editMovement=e)},clickAny:function(){t.command&&f()},clickEmpty:function(){t.command?f():a.selectBorn()},execDelete:()=>{},execAdd:()=>{}}}(Ht()):function(){const e=u({command:"",editMovement:void 0}),t=qe(),a=m((()=>t.lastSelectedArmature.value));function n(){e.command="",e.editMovement=void 0}const r=m((()=>({})));function l(){a.value&&(e.editMovement=void 0,e.command="")}return{command:m((()=>e.command)),getEditTransforms:e=>r.value[e]||Q(),end:()=>n(),cancel:n,setEditMode:function(t){a.value&&(n(),e.command=t)},select:function(a,n){e.command?l():t.selectBorn(a,n)},shiftSelect:function(a,n){e.command?l():t.selectBorn(a,n,!0)},mousemove:function(t){e.command&&(e.editMovement=t)},clickAny:function(){e.command&&l()},clickEmpty:function(){e.command?l():t.selectArmature()},execDelete:function(){""===e.command&&t.deleteArmature()},execAdd:function(){""===e.command&&t.addArmature()}}}()));v(Lt,((e,t)=>{t&&t.end()}));const Tt=m((()=>Lt.value.command.value));function Nt(){"edit"===Dt.canvasMode?_t(Dt.pastCanvasMode):_t("edit")}function Pt(){"edit"===Dt.canvasMode?"object"===Dt.pastCanvasMode?_t("pose"):_t("object"):"object"===Dt.canvasMode?_t("pose"):_t("object")}function _t(e){const t=function(e){const t=Dt.canvasMode,a=Dt.pastCanvasMode;return{name:"Change Mode",undo:()=>{Dt.canvasMode=t,Dt.pastCanvasMode=a},redo:()=>{Dt.pastCanvasMode=Dt.canvasMode,Dt.canvasMode=e}}}(e);$t.push(t),t.redo()}function zt(e){Dt.axisGrid=e}function Kt(e){Dt.axisGrid=Dt.axisGrid===e?"":e}function Wt(e){return{x:"y"===Dt.axisGrid?1:e.x,y:"x"===Dt.axisGrid?1:e.y}}function Ut(e){return{x:"y"===Dt.axisGrid?0:e.x,y:"x"===Dt.axisGrid?0:e.y}}function Vt(e,t,a){return k(i(t,e),i(a,e))<0}function Gt(e){return Lt.value.getEditTransforms(e)}function Ht(){return{state:Dt,command:Tt,toggleCanvasMode:Nt,ctrlToggleCanvasMode:Pt,setCanvasMode:_t,setAxisGrid:zt,switchAxisGrid:Kt,snapScale:Wt,snapTranslate:Ut,isOppositeSide:Vt,getEditTransforms:Gt,mousemove:e=>Lt.value.mousemove(e),clickAny:()=>Lt.value.clickAny(),clickEmpty:()=>Lt.value.clickEmpty(),cancel:()=>Lt.value.cancel(),setEditMode:e=>Lt.value.setEditMode(e),execDelete:()=>Lt.value.execDelete(),execAdd:()=>Lt.value.execAdd(),select:(e,t)=>Lt.value.select(e,t),shiftSelect:(e,t)=>Lt.value.shiftSelect(e,t)}}const Rt=u({size:{width:100,height:100}});function qt(){return{state:Rt}}window.addEventListener("resize",(()=>{Rt.size={width:window.innerWidth,height:window.innerHeight}}));var Xt=f({components:{ScaleMarker:Qe},props:{originalViewBox:{type:Object,default:()=>({x:0,y:0,width:600,height:400})},currentCommand:{type:String,default:""}},emits:["mousemove","click-any","click-empty","escape","tab","ctrl-tab","g","s","r","e","x","y","shift-a","i"],setup(e,{emit:t}){const a=u({width:600,height:400}),r=x(),l=x(),s=x(),d=x(),f=x(1),p=x({x:0,y:0}),h=x(),y=qe(),b=Ht(),g=jt();function k(e){return o(p.value,c(e,f.value))}const A=m((()=>"edit"===b.state.canvasMode?y.selectedBornsOrigin.value:g.selectedPosedBornOrigin.value)),B=m((()=>({x:p.value.x,y:p.value.y,width:a.width*f.value,height:a.height*f.value}))),I=m((()=>R(B.value))),C=m((()=>M(n({x:0,y:0},a)))),E=m((()=>{if(""!==b.state.axisGrid&&s.value)return function(e,t,a,r){return n(n({},{strokeWidth:e}),"x"===t?{from:{x:a.x,y:r.y},to:{x:a.x+a.width,y:r.y},stroke:"red"}:{from:{x:r.x,y:a.y},to:{x:r.x,y:a.y+a.height},stroke:"green"})}(f.value,b.state.axisGrid,B.value,A.value)})),O=m((()=>{if(d.value&&["scale","rotate"].includes(e.currentCommand))return{origin:A.value,current:k(d.value),side:"rotate"===e.currentCommand}}));function F(){if(!l.value)return;const e=l.value.getBoundingClientRect();a.width=e.width,a.height=e.height}v((()=>e.currentCommand),(e=>{b.setAxisGrid(""),""===e&&(s.value=void 0)}));const j=qt();return w(F),v((()=>j.state.size),F),{scale:f,viewSize:a,svg:r,wrapper:l,viewBox:I,gridLineElm:E,scaleNaviElm:O,canvasMode:m((()=>b.state.canvasMode)),focus(){r.value&&r.value.focus()},wheel(e){const t=d.value?d.value:C.value,a=k(t);f.value=f.value*Math.pow(1.1,e.deltaY>0?1:-1);const n=k(t);p.value=o(p.value,i(a,n))},downMiddle(){d.value&&(h.value={origin:n({},p.value),downAt:n({},d.value)})},upMiddle(){h.value=void 0},leave(){h.value=void 0},mousemove:e=>{if(d.value=S(e),h.value)p.value=o(h.value.origin,c(i(h.value.downAt,d.value),f.value));else{if(!s.value)return;t("mousemove",{current:k(d.value),start:k(s.value)})}},clickAny(e){e.target===r.value?(s.value=void 0,t("click-empty")):t("click-any")},keyDownTab:()=>{t("tab")},keyDownCtrlTab:()=>t("ctrl-tab"),keyDownEscape:()=>{t("escape")},editKeyDown(a){d.value&&(!["grab","scale"].includes(e.currentCommand)||"x"!==a&&"y"!==a?(s.value=d.value,t(a)):b.switchAxisGrid(a))}}}});const Yt=F("data-v-38b1c92f");j("data-v-38b1c92f");const Jt={ref:"wrapper",class:"app-canvas-root"},Qt={class:"help"};$();const Zt=Yt(((e,t,a,n,r,l)=>{const o=A("ScaleMarker");return b(),h("div",Jt,[(b(),h("svg",{ref:"svg",tabindex:"-1",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"none","font-family":"sans-serif",viewBox:e.viewBox,width:e.viewSize.width,height:e.viewSize.height,onWheel:t[1]||(t[1]=B(((...t)=>e.wheel&&e.wheel(...t)),["prevent"])),onClick:t[2]||(t[2]=B(((...t)=>e.clickAny&&e.clickAny(...t)),["left"])),onContextmenu:t[3]||(t[3]=B(((...t)=>e.keyDownEscape&&e.keyDownEscape(...t)),["right","prevent"])),onMouseenter:t[4]||(t[4]=(...t)=>e.focus&&e.focus(...t)),onMousemove:t[5]||(t[5]=B(((...t)=>e.mousemove&&e.mousemove(...t)),["prevent"])),onMousedown:t[6]||(t[6]=B(((...t)=>e.downMiddle&&e.downMiddle(...t)),["middle","prevent"])),onMouseup:t[7]||(t[7]=B(((...t)=>e.upMiddle&&e.upMiddle(...t)),["middle","prevent"])),onMouseleave:t[8]||(t[8]=(...t)=>e.leave&&e.leave(...t)),onKeydown:[t[9]||(t[9]=I(B(((...t)=>e.keyDownEscape&&e.keyDownEscape(...t)),["exact","prevent"]),["escape"])),t[10]||(t[10]=I(B(((...t)=>e.keyDownTab&&e.keyDownTab(...t)),["exact","prevent"]),["tab"])),t[11]||(t[11]=I(B(((...t)=>e.keyDownCtrlTab&&e.keyDownCtrlTab(...t)),["shift","exact","prevent"]),["tab"])),t[12]||(t[12]=I(B((t=>e.editKeyDown("g")),["exact","prevent"]),["g"])),t[13]||(t[13]=I(B((t=>e.editKeyDown("s")),["exact","prevent"]),["s"])),t[14]||(t[14]=I(B((t=>e.editKeyDown("r")),["exact","prevent"]),["r"])),t[15]||(t[15]=I(B((t=>e.editKeyDown("e")),["exact","prevent"]),["e"])),t[16]||(t[16]=I(B((t=>e.editKeyDown("x")),["exact","prevent"]),["x"])),t[17]||(t[17]=I(B((t=>e.editKeyDown("y")),["exact","prevent"]),["y"])),t[18]||(t[18]=I(B((t=>e.editKeyDown("shift-a")),["shift","exact","prevent"]),["a"])),t[19]||(t[19]=I(B((t=>e.editKeyDown("i")),["exact","prevent"]),["i"]))]},[y("rect",{x:e.originalViewBox.x,y:e.originalViewBox.y,width:e.originalViewBox.width,height:e.originalViewBox.height,fill:"none",stroke:"black","stroke-width":"1","stroke-dasharray":"4 4"},null,8,["x","y","width","height"]),e.gridLineElm?(b(),h("line",{key:0,x1:e.gridLineElm.from.x,y1:e.gridLineElm.from.y,x2:e.gridLineElm.to.x,y2:e.gridLineElm.to.y,stroke:e.gridLineElm.stroke,"stroke-width":e.gridLineElm.strokeWidth},null,8,["x1","y1","x2","y2","stroke","stroke-width"])):C("",!0),E(e.$slots,"default"),e.scaleNaviElm?(b(),h(o,{key:1,origin:e.scaleNaviElm.origin,current:e.scaleNaviElm.current,scale:e.scale,side:e.scaleNaviElm.side},null,8,["origin","current","scale","side"])):C("",!0)],40,["viewBox","width","height"])),y("div",Qt,[y("p",null,"Mode: "+O(e.canvasMode),1)])],512)}));Xt.render=Zt,Xt.__scopeId="data-v-38b1c92f";var ea=f({props:{tabs:{type:Array,default:()=>[]}},setup(e){var t,a;const n=x(null!=(a=null==(t=e.tabs[0])?void 0:t.key)?a:"");return{current:n,setTab:e=>n.value=e}}});const ta=F("data-v-16db2673");j("data-v-16db2673");const aa={class:"tab-panel-root"},na={class:"panels"};$();const ra=ta(((e,t,a,n,r,l)=>(b(),h("div",aa,[y("ul",null,[(b(!0),h(D,null,L(e.tabs,(t=>(b(),h("li",{key:t.key,class:{current:t.key===e.current}},[y("a",{href:"#",onClick:B((a=>e.setTab(t.key)),["prevent"])},O(t.label),9,["onClick"])],2)))),128))]),y("div",na,[(b(!0),h(D,null,L(e.tabs,(t=>T((b(),h("div",{key:t.key},[E(e.$slots,t.key)],512)),[[N,t.key===e.current]]))),128))])]))));ea.render=ra,ea.__scopeId="data-v-16db2673";var la=f({setup(){const e=Ie();return{allStack:m((()=>e.allStack.value)),currentItemIndex:m((()=>e.currentItemIndex.value))}}});const oa=F("data-v-65f8ee82");j("data-v-65f8ee82");const sa=y("h3",null,"history",-1);$();const da=oa(((e,t,a,n,r,l)=>(b(),h("div",null,[sa,y("ul",null,[(b(!0),h(D,null,L(e.allStack,((t,a)=>(b(),h("li",{key:a,class:{current:a===e.currentItemIndex}},O(t.name),3)))),128))])]))));la.render=da,la.__scopeId="data-v-65f8ee82";var ca=f({props:{options:{type:Array,default:()=>[]},modelValue:{type:[Number,String],default:""}},emits:["update:modelValue"],setup:(e,{emit:t})=>({value:m({get:()=>e.modelValue,set(e){t("update:modelValue",e)}})})});const ia=F("data-v-fddf1844");j("data-v-fddf1844");const ua={class:"select-root"},ma=y("option",{value:""},"-- None --",-1);$();const va=ia(((e,t,a,n,r,l)=>(b(),h("span",ua,[T(y("select",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.value=t)},[ma,(b(!0),h(D,null,L(e.options,(e=>(b(),h("option",{key:e.value,value:e.value},O(e.label),9,["value"])))),128))],512),[[P,e.value]])]))));ca.render=va,ca.__scopeId="data-v-fddf1844";var fa=f({components:{TabPanel:ea,HistoryStack:la,SelectField:ca},setup(){const e=qe(),t=x(""),a=m((()=>e.lastSelectedArmature.value?e.lastSelectedArmature.value.borns.filter((t=>{var a;return t.id!==(null==(a=e.lastSelectedBorn.value)?void 0:a.id)})).map((e=>({value:e.id,label:e.name}))):[])),n=m((()=>e.lastSelectedBorn.value?"born":e.lastSelectedArmature.value?"armature":""));function r(){e.lastSelectedBorn.value?t.value=e.lastSelectedBorn.value.name:e.lastSelectedArmature.value?t.value=e.lastSelectedArmature.value.name:t.value=""}return v(e.lastSelectedArmature,r),v(e.lastSelectedBorn,r),{draftName:t,lastSelectedArmature:e.lastSelectedArmature,lastSelectedBorn:e.lastSelectedBorn,parentOptions:a,selectedObjectType:n,connected:m({get(){var t,a;return null!=(a=null==(t=e.lastSelectedBorn.value)?void 0:t.connected)&&a},set(t){e.updateBorn({connected:t})}}),parentId:m({get(){var t,a;return null!=(a=null==(t=e.lastSelectedBorn.value)?void 0:t.parentId)?a:""},set(t){e.updateBorn({parentId:t})}}),changeArmatureName(){t.value&&e.updateArmatureName(t.value)},changeBornName(){t.value&&e.updateBorn({name:t.value})}}}});const pa=F("data-v-a1a2983c");j("data-v-a1a2983c");const ha=y("h3",null,"Armature",-1),ya={class:"field inline"},ba=y("label",null,"Name",-1),ga=y("h3",null,"Born",-1),xa={class:"field inline"},ka=y("label",null,"Name",-1),wa={class:"field inline"},Sa=y("label",null,"Parent",-1),Ma={class:"field inline"},Aa=y("label",null,"Connect",-1);$();const Ba=pa(((e,t,a,n,r,l)=>{const o=A("SelectField"),s=A("HistoryStack"),d=A("TabPanel");return b(),h("div",null,[y(d,{tabs:[{key:"detail",label:"Detail"},{key:"history",label:"History"}]},{detail:pa((()=>["armature"===e.selectedObjectType?(b(),h("form",{key:0,onSubmit:t[3]||(t[3]=B((()=>{}),["prevent"]))},[ha,y("div",ya,[ba,T(y("input",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.draftName=t),type:"text",onChange:t[2]||(t[2]=(...t)=>e.changeArmatureName&&e.changeArmatureName(...t))},null,544),[[_,e.draftName]])])],32)):C("",!0),"born"===e.selectedObjectType?(b(),h("form",{key:1,onSubmit:t[8]||(t[8]=B((()=>{}),["prevent"]))},[ga,y("div",xa,[ka,T(y("input",{"onUpdate:modelValue":t[4]||(t[4]=t=>e.draftName=t),type:"text",onChange:t[5]||(t[5]=(...t)=>e.changeBornName&&e.changeBornName(...t))},null,544),[[_,e.draftName]])]),y("div",wa,[Sa,y(o,{modelValue:e.parentId,"onUpdate:modelValue":t[6]||(t[6]=t=>e.parentId=t),options:e.parentOptions},null,8,["modelValue","options"])]),y("div",Ma,[Aa,T(y("input",{"onUpdate:modelValue":t[7]||(t[7]=t=>e.connected=t),type:"checkbox",disabled:!e.parentId},null,8,["disabled"]),[[z,e.connected]])])],32)):C("",!0)])),history:pa((()=>[y(s)])),_:1})])}));fa.render=Ba,fa.__scopeId="data-v-a1a2983c";var Ia=f({emits:["down-left","up-left","mousemove","drag","click-any","click-empty","escape","g","x"],setup(e,{emit:t}){const a=x(),r=x(),l=function(e={}){const t=u({width:600,height:100}),a=x(),r=x(),l=x(1),s=x({x:0,y:0}),d=x(),v=x(),f=m((()=>({x:s.value.x,y:s.value.y,width:t.width*l.value,height:t.height*l.value}))),p=m((()=>M(n({x:0,y:0},t)))),h=m((()=>R(f.value)));function y(e){return o(s.value,c(e,l.value))}return{viewSize:t,editStartPoint:a,mousePoint:r,scale:l,viewOrigin:s,dragInfo:v,viewMovingInfo:d,viewCenter:p,viewBox:h,viewToCanvas:y,wheel(t,a=!1){var n,d;const c=!a&&r.value?r.value:p.value,u=y(c);l.value=Math.min(Math.max(l.value*Math.pow(1.1,t.deltaY>0?1:-1),null!=(n=e.scaleMin)?n:0),null!=(d=e.scaleMax)?d:10);const m=y(c);s.value=o(s.value,i(u,m))},downLeft(){r.value&&(v.value={})},upLeft(){v.value=void 0},downMiddle(){r.value&&(d.value={origin:n({},s.value),downAt:n({},r.value)})},upMiddle(){d.value=void 0},leave(){d.value=void 0},viewMove(){d.value&&r.value&&(s.value=o(d.value.origin,c(i(d.value.downAt,r.value),l.value)))}}}({scaleMin:1});function s(){if(!r.value)return;const e=r.value.getBoundingClientRect();l.viewSize.width=e.width,l.viewSize.height=e.height}const d=qt();return w(s),v((()=>d.state.size),s),{scale:l.scale,viewOrigin:l.viewOrigin,viewSize:m((()=>l.viewSize)),wrapper:r,svg:a,viewBox:l.viewBox,focus(){a.value&&a.value.focus()},wheel:e=>l.wheel(e,!0),downLeft:()=>{l.mousePoint.value&&(l.downLeft(),t("down-left",l.viewToCanvas(l.mousePoint.value)))},upLeft:()=>{l.upLeft(),t("up-left")},downMiddle:l.downMiddle,upMiddle:l.upMiddle,leave:l.leave,mousemove:e=>{l.mousePoint.value=S(e),l.dragInfo.value?t("drag",l.viewToCanvas(l.mousePoint.value)):l.viewMovingInfo.value?l.viewMove():l.editStartPoint.value&&t("mousemove",{current:l.viewToCanvas(l.mousePoint.value),start:l.viewToCanvas(l.editStartPoint.value)})},clickAny(e){e.target===a.value?(l.editStartPoint.value=void 0,t("click-empty")):t("click-any")},keyDownEscape:()=>{t("escape")},editKeyDown(e){l.mousePoint.value&&(l.editStartPoint.value=l.mousePoint.value,t(e))}}}});const Ca=F("data-v-5868f1c8");j("data-v-5868f1c8");const Ea={ref:"wrapper",class:"timeline-canvas-root"};$();const Oa=Ca(((e,t,a,n,r,l)=>(b(),h("div",Ea,[(b(),h("svg",{ref:"svg",tabindex:"-1",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"none","font-family":"sans-serif",viewBox:e.viewBox,width:e.viewSize.width,height:e.viewSize.height,onWheel:t[1]||(t[1]=B(((...t)=>e.wheel&&e.wheel(...t)),["prevent"])),onClick:t[2]||(t[2]=B(((...t)=>e.clickAny&&e.clickAny(...t)),["left"])),onContextmenu:t[3]||(t[3]=B(((...t)=>e.keyDownEscape&&e.keyDownEscape(...t)),["right","prevent"])),onMouseenter:t[4]||(t[4]=(...t)=>e.focus&&e.focus(...t)),onMousedown:[t[5]||(t[5]=B(((...t)=>e.downLeft&&e.downLeft(...t)),["left","prevent"])),t[8]||(t[8]=B(((...t)=>e.downMiddle&&e.downMiddle(...t)),["middle","prevent"]))],onMouseup:[t[6]||(t[6]=B(((...t)=>e.upLeft&&e.upLeft(...t)),["left","prevent"])),t[9]||(t[9]=B(((...t)=>e.upMiddle&&e.upMiddle(...t)),["middle","prevent"]))],onMousemove:t[7]||(t[7]=B(((...t)=>e.mousemove&&e.mousemove(...t)),["prevent"])),onMouseleave:t[10]||(t[10]=(...t)=>e.leave&&e.leave(...t)),onKeydown:[t[11]||(t[11]=I(B(((...t)=>e.keyDownEscape&&e.keyDownEscape(...t)),["exact","prevent"]),["escape"])),t[12]||(t[12]=I(B((t=>e.editKeyDown("g")),["exact","prevent"]),["g"])),t[13]||(t[13]=I(B((t=>e.editKeyDown("x")),["exact","prevent"]),["x"]))]},[E(e.$slots,"default",{scale:e.scale,viewOrigin:e.viewOrigin,viewSize:e.viewSize})],40,["viewBox","width","height"]))],512))));Ia.render=Oa,Ia.__scopeId="data-v-5868f1c8";var Fa=f({props:{labelWidth:{type:Number,default:100},index:{type:Number,required:!0},label:{type:String,required:!0}},setup:()=>({height:24})});Fa.render=function(e,t,a,n,r,l){return b(),h("g",{transform:`translate(0, ${e.index*e.height})`},[y("rect",{width:e.labelWidth,height:e.height,fill:"#fff",stroke:"black"},null,8,["width","height"]),y("text",{x:"4",y:e.height/2,"dominant-baseline":"central"},O(e.label),9,["y"])],8,["transform"])};var ja=f({props:{scale:{type:Number,default:1},originX:{type:Number,default:0},viewWidth:{type:Number,default:100},currentFrame:{type:Number,default:0},endFrame:{type:Number,default:60}},emits:["down-current-frame","up-current-frame"],setup(e,{emit:t}){const a=m((()=>st(e.scale))),n=m((()=>function(e,t){const a=Math.floor(Math.max(t,0)/20);return a-a%(2*e)}(a.value,e.originX))),r=m((()=>Math.ceil(e.viewWidth*e.scale/20))),l=m((()=>Math.floor(r.value/a.value))),o=m((()=>[...Array(l.value)].map(((e,t)=>{const r=t*a.value+n.value;return{f:r,labelSize:r%10==0?14:r%2==0?11:0,strokeWidth:r%10==0?2:1}})))),s=m((()=>20*e.currentFrame)),d=m((()=>10*Math.max(e.currentFrame.toString().length,2)+2));return{headerHeight:24,frames:o,frameWidth:20,currentFrameX:s,endFrameX:m((()=>20*e.endFrame)),currentFrameLabelWidth:d,downCurrentFrame:()=>t("down-current-frame")}}});const $a=F("data-v-32f7398e");j("data-v-32f7398e");const Da={class:"view-only"},La={fill:"#aaa",stroke:"none","fill-opacity":"0.5"},Ta=y("g",{transform:"scale(-1, 1)"},[y("rect",{width:"200000",height:"200000"})],-1),Na=y("rect",{width:"200000",height:"200000"},null,-1);$();const Pa=$a(((e,t,a,n,r,l)=>(b(),h("g",null,[y("g",{transform:`scale(${e.scale})`,onMousedown:t[1]||(t[1]=B(((...t)=>e.downCurrentFrame&&e.downCurrentFrame(...t)),["left"]))},[y("rect",{x:"-100000",width:"200000",height:e.headerHeight,fill:"#fff",stroke:"#000"},null,8,["height"])],40,["transform"]),y("g",Da,[y("g",null,[(b(!0),h(D,null,L(e.frames,(t=>(b(),h("g",{key:t,transform:`translate(${t.f*e.frameWidth}, 0)`},[y("g",{transform:`scale(${e.scale})`},[t.labelSize>0?(b(),h("text",{key:0,y:e.headerHeight-4,"font-size":t.labelSize,"dominant-baseline":"text-after-edge","text-anchor":"middle"},O(t.f),9,["y","font-size"])):C("",!0),t.strokeWidth>0?(b(),h("line",{key:1,x1:"0",y1:e.headerHeight,x2:"0",y2:"20000",stroke:"#aaa","stroke-width":t.strokeWidth},null,8,["y1","stroke-width"])):C("",!0)],8,["transform"])],8,["transform"])))),128))]),y("g",La,[Ta,y("g",{transform:`translate(${e.endFrameX}, 0)`},[Na],8,["transform"])]),y("g",{transform:`translate(${e.currentFrameX}, 0) scale(${e.scale})`},[y("rect",{x:-e.currentFrameLabelWidth/2,y:2,width:e.currentFrameLabelWidth,height:20,rx:"4",ry:"4",fill:"blue",stroke:"none"},null,8,["x","width"]),y("text",{y:e.headerHeight-4,"font-size":"12","dominant-baseline":"text-after-edge","text-anchor":"middle",fill:"#fff"},O(e.currentFrame),9,["y"]),y("line",{x1:"0",y1:e.headerHeight,x2:"0",y2:"20000",stroke:"blue","stroke-width":"2"},null,8,["y1"])],8,["transform"])])]))));ja.render=Pa,ja.__scopeId="data-v-32f7398e";var _a=f({props:{scale:{type:Number,default:1},keyframeMapByFrame:{type:Object,default:0},bornIds:{type:Array,default:()=>[]}},emits:[],setup(e){const t=m((()=>e.bornIds.reduce(((e,t,a)=>(e[t]=a,e)),{}))),a=m((()=>Object.keys(e.keyframeMapByFrame).reduce(((a,n)=>(a[n]=e.keyframeMapByFrame[n].filter((e=>t.value[e.bornId]>-1)).sort(((e,a)=>t.value[e.bornId]-t.value[a.bornId])),a)),{})));return{headerHeight:24,frameWidth:20,bornIndexMap:t,sortedKeyframeMapByFrame:a}}});const za=F("data-v-440e9ef0");j("data-v-440e9ef0");const Ka={class:"view-only"},Wa={key:"all",r:"4",stroke:"#000",fill:"#fff"};$();const Ua=za(((e,t,a,n,r,l)=>(b(),h("g",null,[y("g",Ka,[y("g",null,[(b(!0),h(D,null,L(e.sortedKeyframeMapByFrame,((t,a)=>(b(),h("g",{key:a,transform:`translate(${parseInt(a)*e.frameWidth}, 0)`},[y("g",{transform:`scale(${e.scale}) translate(0, 36)`},[t.length>0?(b(),h("circle",Wa)):C("",!0),(b(!0),h(D,null,L(t,((e,t)=>(b(),h("circle",{key:e.bornId,cy:24*(t+1),r:"4",stroke:"#000",fill:"#fff"},null,8,["cy"])))),128))],8,["transform"])],8,["transform"])))),128))])])]))));_a.render=Ua,_a.__scopeId="data-v-440e9ef0";var Va=f({components:{SelectField:ca,TimelineCanvas:Ia,TimelineRow:Fa,TimelineAxis:ja,Keyframes:_a},setup(){const e=qe(),t=jt(),a=x(""),n=x(""),r=x(""),l=m((()=>t.selectedAction.value)),o=m((()=>{return e=t.selectedAllBorns.value,Object.keys(e).map((t=>e[t]));var e})),s=m((()=>o.value.map((e=>e.id)))),d=m((()=>t.keyframeMapByFrame.value)),c=m((()=>t.actions.map((t=>{var a;const n=(null==(a=e.lastSelectedArmature.value)?void 0:a.id)!==t.armatureId;return{value:t.id,label:`${n?"(x)":""} ${t.name}`}}))));function i(e){var n;"move-current-frame"===a.value&&t.setCurrentFrame((n=e.x-140-20,Math.round(Math.max(n,0)/20)))}return K((()=>{var e,t;n.value=null!=(t=null==(e=l.value)?void 0:e.name)?t:""})),K((()=>{r.value=t.endFrame.value.toString()})),{actions:t.actions,selectedAllBornList:o,selectedAllBornIdList:s,keyframeMapByFrame:d,draftName:n,draftEndFrame:r,labelWidth:140,axisPadding:20,currentFrame:t.currentFrame,endFrame:t.endFrame,changeActionName:()=>{n.value&&t.updateAction({name:n.value})},changeEndFrame:()=>{const e=parseInt(r.value,10);!isNaN(e)&&e>=0?t.setEndFrame(e):r.value=t.endFrame.value.toString()},addAction:t.addAction,deleteAction:t.deleteAction,actionOptions:c,selectedActionId:m({get:()=>{var e,t;return null!=(t=null==(e=l.value)?void 0:e.id)?t:""},set:e=>t.selectAction(e)}),downCurrentFrame:function(){a.value="move-current-frame"},downLeft:function(e){i(e)},drag:i,upLeft:function(){a.value=""}}}});const Ga=F("data-v-3b7d27ce");j("data-v-3b7d27ce");const Ha={class:"animation-panel-root"},Ra={class:"top"},qa={class:"select-action"},Xa={class:"end-frame-field"},Ya=W("End: "),Ja={class:"middle"};$();const Qa=Ga(((e,t,a,n,r,l)=>{const o=A("SelectField"),s=A("TimelineAxis"),d=A("Keyframes"),c=A("TimelineRow"),i=A("TimelineCanvas");return b(),h("div",Ha,[y("div",Ra,[y("div",qa,[y(o,{modelValue:e.selectedActionId,"onUpdate:modelValue":t[1]||(t[1]=t=>e.selectedActionId=t),options:e.actionOptions},null,8,["modelValue","options"])]),T(y("input",{"onUpdate:modelValue":t[2]||(t[2]=t=>e.draftName=t),type:"text",onChange:t[3]||(t[3]=(...t)=>e.changeActionName&&e.changeActionName(...t))},null,544),[[_,e.draftName]]),y("button",{class:"add-action",onClick:t[4]||(t[4]=(...t)=>e.addAction&&e.addAction(...t))},"+"),y("button",{class:"delete-action",onClick:t[5]||(t[5]=(...t)=>e.deleteAction&&e.deleteAction(...t))},"x"),y("label",Xa,[Ya,T(y("input",{"onUpdate:modelValue":t[6]||(t[6]=t=>e.draftEndFrame=t),type:"number",onChange:t[7]||(t[7]=(...t)=>e.changeEndFrame&&e.changeEndFrame(...t))},null,544),[[_,e.draftEndFrame]])])]),y("div",Ja,[y(i,{onUpLeft:e.upLeft,onDrag:e.drag,onDownLeft:e.downLeft},{default:Ga((({scale:t,viewOrigin:a,viewSize:n})=>[y("g",{transform:`translate(${e.labelWidth+e.axisPadding}, ${a.y})`},[y(s,{scale:t,"origin-x":a.x,"view-width":n.width,"current-frame":e.currentFrame,"end-frame":e.endFrame,onDownCurrentFrame:e.downCurrentFrame},null,8,["scale","origin-x","view-width","current-frame","end-frame","onDownCurrentFrame"]),y(d,{scale:t,"keyframe-map-by-frame":e.keyframeMapByFrame,"born-ids":e.selectedAllBornIdList},null,8,["scale","keyframe-map-by-frame","born-ids"])],8,["transform"]),y("g",{transform:`translate(${a.x}, ${a.y}) scale(${t})`},[y("g",null,[y("rect",{width:e.labelWidth,height:"10000",stroke:"none",fill:"#fff"},null,8,["width"]),y("line",{x1:e.labelWidth,y1:"0",x2:e.labelWidth,y2:"10000",stroke:"black"},null,8,["x1","x2"]),y(c,{index:1,"label-width":e.labelWidth,label:"Summary"},null,8,["label-width"]),(b(!0),h(D,null,L(e.selectedAllBornList,((t,a)=>(b(),h(c,{key:t.id,index:a+2,"label-width":e.labelWidth,label:t.name},null,8,["index","label-width","label"])))),128))])],8,["transform"])])),_:1},8,["onUpLeft","onDrag","onDownLeft"])])])}));Va.render=Qa,Va.__scopeId="data-v-3b7d27ce";const Za=u({selectedColor:"orange"});function en(e,t,a=!1){return o(e,d(c(i(t,e),.15),Math.PI/4*(a?-1:1)))}var tn=f({props:{born:{type:Object,required:!0},parent:{type:Object,default:void 0},opacity:{type:Number,default:1},selectedState:{type:Object,default:()=>({head:!1,tail:!1})},poseMode:{type:Boolean,default:!1}},emits:["select","shift-select"],setup(e,{emit:t}){const{settings:a}={settings:Za},r=m((()=>e.born.head)),l=m((()=>e.born.tail)),o=m((()=>en(r.value,l.value))),s=m((()=>en(r.value,l.value,!0))),d=m((()=>e.poseMode?e.selectedState.head||e.selectedState.tail:e.selectedState.head&&e.selectedState.tail));return{transform:m((()=>G(e.born.transform))),head:r,tail:l,headPath:m((()=>H([r.value,o.value,s.value],!0))),tailPath:m((()=>H([l.value,o.value,s.value],!0))),fill:m((()=>d.value?a.selectedColor:"#ddd")),fillDark:m((()=>d.value?a.selectedColor:"#bbb")),fillHead:m((()=>e.selectedState.head?a.selectedColor:"")),fillTail:m((()=>e.selectedState.tail?a.selectedColor:"")),click:a=>{e.poseMode?d.value?t("select",{head:!1,tail:!1}):t("select",{head:!0,tail:!0}):t("select",a)},shiftClick:a=>{e.poseMode||a.head&&a.tail?d.value?t("shift-select",{head:!1,tail:!1}):t("shift-select",{head:!0,tail:!0}):a.head?t("shift-select",n(n({},e.selectedState),{head:!e.selectedState.head})):a.tail&&t("shift-select",n(n({},e.selectedState),{tail:!e.selectedState.tail}))}}}});const an=F("data-v-13fd028e")(((e,t,a,n,r,l)=>(b(),h("g",{stroke:"black",fill:e.fill,transform:e.transform,opacity:e.opacity},[y("g",{onClick:[t[1]||(t[1]=B((t=>e.click({head:!0,tail:!0})),["exact"])),t[2]||(t[2]=B((t=>e.shiftClick({head:!0,tail:!0})),["shift","exact"]))]},[y("path",{d:e.headPath,fill:e.fillDark},null,8,["d","fill"]),y("path",{d:e.tailPath},null,8,["d"])]),y("circle",{r:"10",cx:e.head.x,cy:e.head.y,fill:e.fillHead,onClick:[t[3]||(t[3]=B((t=>e.click({head:!0,tail:!1})),["exact"])),t[4]||(t[4]=B((t=>e.shiftClick({head:!0,tail:!1})),["shift","exact"]))]},null,8,["cx","cy","fill"]),y("circle",{r:"10",cx:e.tail.x,cy:e.tail.y,fill:e.fillTail,onClick:[t[5]||(t[5]=B((t=>e.click({head:!1,tail:!0})),["exact"])),t[6]||(t[6]=B((t=>e.shiftClick({head:!1,tail:!0})),["shift","exact"]))]},null,8,["cx","cy","fill"]),e.parent?(b(),h("line",{key:0,x1:e.parent.tail.x,y1:e.parent.tail.y,x2:e.head.x,y2:e.head.y,"stroke-dasharray":"2 2",class:"view-only"},null,8,["x1","y1","x2","y2"])):C("",!0),y("text",{x:(e.head.x+e.tail.x)/2,y:(e.head.y+e.tail.y)/2,"text-anchor":"middle",fill:"black",stroke:"none",class:"view-only"},O(e.born.name),9,["x","y"])],8,["fill","transform","opacity"]))));tn.render=an,tn.__scopeId="data-v-13fd028e";var nn=f({components:{BornElm:tn},props:{armature:{type:Object,required:!0},opacity:{type:Number,default:.8},selected:{type:Boolean,default:!1}},emits:["select","shift-select"],setup:(e,{emit:t})=>({bornMap:m((()=>te(e.armature.borns))),transform:m((()=>G(e.armature.transform))),bornSelectedState:m((()=>e.selected?{head:!0,tail:!0}:void 0)),click:()=>t("select",!e.selected),shiftClick:()=>t("shift-select",!e.selected)})});const rn=F("data-v-e1a73d3c")(((e,t,a,n,r,l)=>{const o=A("BornElm");return b(),h("g",{stroke:"black",transform:e.transform,opacity:e.opacity},[(b(!0),h(D,null,L(e.armature.borns,(t=>(b(),h(o,{key:t.name,born:t,"selected-state":e.bornSelectedState,parent:e.bornMap[t.parentId],onSelect:e.click,onShiftSelect:e.shiftClick},null,8,["born","selected-state","parent","onSelect","onShiftSelect"])))),128))],8,["transform","opacity"])}));nn.render=rn,nn.__scopeId="data-v-e1a73d3c";var ln=f({components:{AppCanvas:Xt,ArmatureElm:nn,BornElm:tn,SidePanel:fa,AnimationPanel:Va},setup(){const e=qe(),t=Ht(),a=jt(),r=Ie(),l=m((()=>t.state.canvasMode)),o=m((()=>e.lastSelectedArmature.value)),s=m((()=>e.state.armatures.filter((t=>{var a;return t.id!==(null==(a=e.lastSelectedArmature.value)?void 0:a.id)})))),d=m((()=>{if(!o.value)return{};if("edit"===l.value)return te(o.value.borns.map((a=>de(a,t.getEditTransforms(a.id),e.state.selectedBorns[a.id]||[]))));{const e=pe(te(o.value.borns.map((e=>n(n({},e),{transform:oe([a.getCurrentSelfTransforms(e.id),t.getEditTransforms(e.id)])})))));return Object.keys(e).reduce(((t,a)=>{const n=e[a];return t[a]=ce(n,[n.transform]),t}),{})}})),c=m((()=>{return"grab"===(e=t.command.value)||"extrude"===e?"grab":"rotate"===e?"rotate":"scale"===e?"scale":"";var e}));function i(e){var t;["input","textarea"].includes(null==(t=e.target)?void 0:t.tagName.toLowerCase())||e.ctrlKey&&"z"===e.key.toLowerCase()&&(e.preventDefault(),e.shiftKey?r.redo():r.undo())}return w((()=>{document.addEventListener("keydown",i)})),U((()=>{document.removeEventListener("keydown",i)})),{armatures:m((()=>e.state.armatures)),otherArmatures:s,lastSelectedArmatureId:m((()=>{var t;return null==(t=e.lastSelectedArmature.value)?void 0:t.id})),editBornMap:d,selectedBorns:m((()=>e.state.selectedBorns)),canvasMode:l,canvasCommand:c,mousemove(e){t.mousemove(e)},clickAny(){t.clickAny()},clickEmpty(){t.clickEmpty()},selectBorn(e,a){t.select(e,a)},shiftSelectBorn(e,a){t.shiftSelect(e,a)},selectArmature(t,a){e.selectArmature(a?t:"")},shiftSelectArmature(t,a){e.selectArmature(a?t:"")},escape(){t.cancel()},toggleCanvasMode(){e.lastSelectedArmature.value&&t.toggleCanvasMode()},ctrlToggleCanvasMode(){e.lastSelectedArmature.value&&t.ctrlToggleCanvasMode()},setEditMode(e){t.setEditMode(e)},execDelete(){t.execDelete()},addItem(){t.execAdd()},saveKeyframe(){a.execInsertKeyframe()}}}});const on=F("data-v-33b4028d");j("data-v-33b4028d");const sn={class:"main"},dn={key:0},cn={key:1},un={key:2},mn={class:"bottom"};$();const vn=on(((e,t,a,n,r,l)=>{const o=A("ArmatureElm"),s=A("BornElm"),d=A("AppCanvas"),c=A("SidePanel"),i=A("AnimationPanel");return b(),h("div",null,[y("div",sn,[y(d,{"current-command":e.canvasCommand,class:"canvas",onMousemove:e.mousemove,onClickAny:e.clickAny,onClickEmpty:e.clickEmpty,onEscape:e.escape,onTab:e.toggleCanvasMode,onCtrlTab:e.ctrlToggleCanvasMode,onG:t[1]||(t[1]=t=>e.setEditMode("grab")),onS:t[2]||(t[2]=t=>e.setEditMode("scale")),onR:t[3]||(t[3]=t=>e.setEditMode("rotate")),onE:t[4]||(t[4]=t=>e.setEditMode("extrude")),onX:e.execDelete,onShiftA:e.addItem,onI:e.saveKeyframe},{default:on((()=>["object"===e.canvasMode?(b(),h("g",dn,[(b(!0),h(D,null,L(e.armatures,(t=>(b(),h(o,{key:t.id,armature:t,selected:e.lastSelectedArmatureId===t.id,onSelect:a=>e.selectArmature(t.id,a),onShiftSelect:a=>e.shiftSelectArmature(t.id,a)},null,8,["armature","selected","onSelect","onShiftSelect"])))),128))])):C("",!0),"edit"===e.canvasMode?(b(),h("g",cn,[(b(!0),h(D,null,L(e.otherArmatures,(e=>(b(),h(o,{key:e.id,armature:e,opacity:.3},null,8,["armature","opacity"])))),128)),(b(!0),h(D,null,L(e.editBornMap,(t=>(b(),h(s,{key:t.id,born:t,parent:e.editBornMap[t.parentId],"selected-state":e.selectedBorns[t.id],onSelect:a=>e.selectBorn(t.id,a),onShiftSelect:a=>e.shiftSelectBorn(t.id,a)},null,8,["born","parent","selected-state","onSelect","onShiftSelect"])))),128))])):C("",!0),"pose"===e.canvasMode?(b(),h("g",un,[(b(!0),h(D,null,L(e.otherArmatures,(e=>(b(),h(o,{key:e.id,armature:e,opacity:.3},null,8,["armature","opacity"])))),128)),(b(!0),h(D,null,L(e.editBornMap,(t=>(b(),h(s,{key:t.id,born:t,parent:e.editBornMap[t.parentId],"selected-state":e.selectedBorns[t.id],"pose-mode":"",onSelect:a=>e.selectBorn(t.id,a),onShiftSelect:a=>e.shiftSelectBorn(t.id,a)},null,8,["born","parent","selected-state","onSelect","onShiftSelect"])))),128))])):C("",!0)])),_:1},8,["current-command","onMousemove","onClickAny","onClickEmpty","onEscape","onTab","onCtrlTab","onX","onShiftA","onI"]),y(c,{class:"side-panel"})]),y("div",mn,[y(i)])])}));ln.render=vn,ln.__scopeId="data-v-33b4028d",V(ln).mount("#app");
