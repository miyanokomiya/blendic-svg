var e=Object.assign;import{v as t,l as a,n,a as r,d as l,i as o,r as d,c as s,w as c,b as i,e as u,f as v,g as m,o as f,h as p,j as h,k as y,m as g,p as x,q as b,s as w,t as k,u as S,x as M,y as A,z as B,A as I,B as C,C as E,F as O,D as $,E as T,G as D,H as F,I as L,J as j,K as N,L as P,M as z,N as _}from"./vendor.6dea0f0f.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(a){const n=new URL(e,location),r=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((a,l)=>{const o=new URL(e,n);if(self[t].moduleMap[o])return a(self[t].moduleMap[o]);const d=new Blob([`import * as m from '${o}';`,`${t}.moduleMap['${o}']=m;`],{type:"text/javascript"}),s=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(d),onerror(){l(new Error(`Failed to import: ${e}`)),r(s)},onload(){a(self[t].moduleMap[o]),r(s)}});document.head.appendChild(s)})),self[t].moduleMap={}}}("/blendic-svg/assets/");function W(e){return[`translate(${e.translate.x},${e.translate.y})`,`rotate(${e.rotate})`,`scale(${e.scale.x},${e.scale.y})`].join(" ")}function U(e,t=!1){if(0===e.length)return"";const[a,...n]=e;return`M${a.x},${a.y}`+n.map((e=>`L${e.x},${e.y}`)).join("")+(t?"z":"")}function V(e){return`${e.x} ${e.y} ${e.width} ${e.height}`}const G=/\.[0-9]{3,}$/;function K(e){return G.test(e)?e.replace(G,(e=>"."+`${parseInt(e.slice(1),10)+1}`.padStart(3,"0"))):`${e}.001`}function H(e,t){const a=new Map(t.map((e=>[e,!0])));let n=K(e);for(;a.has(n);)n=K(n);return n}function R(t={}){return e({translate:{x:0,y:0},origin:{x:0,y:0},rotate:0,scale:{x:1,y:1}},t)}function q(a={},n=!1){return e({id:n?t():"",name:"",transform:R(),parentId:"",connected:!1,head:{x:0,y:0},tail:{x:0,y:0}},a)}function X(a={},n=!1){return e({id:n?t():"",name:"",transform:R(),borns:[]},a)}function Y(t){return t.reduce(((t,a)=>e(e({},t),{[a.id]:a})),{})}function J(t,a){return Object.keys(e(e({},t),a)).reduce(((n,r)=>{var l,o;return n[r]=e(e({},null!=(l=t[r])?l:{}),null!=(o=a[r])?o:{}),n}),{})}function Q(e,t){return Object.keys(t).reduce(((t,a)=>(t[a]=e[a],t)),{})}function Z(e,t){return n(l(function(e,t,a){return{x:a.x+(e.x-a.x)*t.x,y:a.y+(e.y-a.y)*t.y}}(e,t.scale,t.origin),t.rotate/180*Math.PI,t.origin),t.translate)}function ee(t,a,o){const d=function(t){return t.reduce(((t,a)=>{const o={x:a.origin.x*(1-a.scale.x),y:a.origin.y*(1-a.scale.y)},d=a.rotate/180*Math.PI,s=n(l(t.translate,d),r(a.origin,l(a.origin,d)));return e(e({},t),{scale:{x:t.scale.x*a.scale.x,y:t.scale.y*a.scale.y},rotate:t.rotate+a.rotate,translate:n(n(a.translate,o),s)})}),R())}(a),s=o.head?Z(t.head,d):t.head,c=o.tail?Z(t.tail,d):t.tail;return e(e({},t),{head:s,tail:c})}function te(e,t,a,n){return ee(ee(e,t,{head:!0,tail:!0}),a,n)}function ae(e,t){return e.find((e=>e.id===t))}function ne(t,a,n,r=!1){const l=ae(t.borns,a);if(!l)return{};let o={[a]:n};if(!r){if(n.head&&l.connected){const a=ae(t.borns,l.parentId);a&&(o=e(e({},ne(t,a.id,{tail:!0},r)),o))}n.tail&&function(e,t,a=!1){return e.borns.filter((e=>e.parentId===t&&(!a||e.connected)))}(t,l.id,!0).forEach((e=>{o[e.id]={head:!0}}))}return o}function re(e){return e.reduce(((t,n)=>{const r=ae(e,n.parentId);return r?n.connected&&(t[n.id]={connected:a(r.tail,n.head)}):t[n.id]={connected:!1,parentId:""},t}),{})}function le(e,t,a=!1){const r=Object.keys(t).map((n=>{const r=[];return t[n].head&&r.push(e[n].head),!a&&t[n].tail&&r.push(e[n].tail),r})).flat();return 0===r.length?{x:0,y:0}:o(r.reduce(((e,t)=>n(e,t)),{x:0,y:0}),1/r.length)}const oe=d({undoStack:[],redoStack:[]}),de=s((()=>oe.undoStack.concat(oe.redoStack.concat().reverse()))),se=s((()=>oe.undoStack.length-1));function ce(){oe.undoStack=[],oe.redoStack=[]}function ie(e){oe.undoStack.push(e),oe.redoStack=[]}function ue(){const e=oe.undoStack.pop();e&&(e.undo(),oe.redoStack.push(e))}function ve(){const e=oe.redoStack.pop();e&&(e.redo(),oe.undoStack.push(e))}function me(){return{state:oe,allStack:de,currentItemIndex:se,clearHistory:ce,push:ie,undo:ue,redo:ve}}const fe=me(),pe=d(X({name:"armature",borns:[q({name:"born",head:{x:20,y:200},tail:{x:220,y:200}},!0)]},!0)),he=d({armatures:[pe],lastSelectedArmatureId:"",lastSelectedBornId:"",selectedArmatures:{},selectedBorns:{}}),ye=s((()=>he.armatures.findIndex((e=>e.id===he.lastSelectedArmatureId&&he.selectedArmatures[he.lastSelectedArmatureId])))),ge=s((()=>-1!==ye.value?he.armatures[ye.value]:void 0)),xe=s((()=>ge.value?ge.value.borns.findIndex((e=>{var t,a;return e.id===he.lastSelectedBornId&&((null==(t=he.selectedBorns[he.lastSelectedBornId])?void 0:t.head)||(null==(a=he.selectedBorns[he.lastSelectedBornId])?void 0:a.tail))})):-1)),be=s((()=>{if(ge.value)return-1!==xe.value?ge.value.borns[xe.value]:void 0})),we=s((()=>Y(he.armatures))),ke=s((()=>{var e,t;return Y(null!=(t=null==(e=ge.value)?void 0:e.borns)?t:[])})),Se=s((()=>le(ke.value,he.selectedBorns))),Me=s((()=>le(ke.value,he.selectedBorns,!0)));function Ae(e=""){if(he.lastSelectedArmatureId===e)return;const t=je(e);t.redo(),fe.push(t)}function Be(t){if(!ge.value)return;const a=function(t){const a=Q(ge.value,t);return{name:"Update Armature",undo:()=>{const t=ye.value;he.armatures[t]=e(e({},he.armatures[t]),a)},redo:()=>{const a=ye.value;he.armatures[a]=e(e({},he.armatures[a]),t)}}}({name:t});a.redo(),fe.push(a)}function Ie(){const t=function(){const t=e({},ge.value),a=ye.value,n=je("");return{name:"Delete Armature",undo:()=>{he.armatures.splice(a,0,t),n.undo()},redo:()=>{he.armatures.splice(a,1)}}}();t.redo(),fe.push(t)}function Ce(){const e=function(e){const t=he.armatures.length,a=je(e.id);return{name:"Add Armature",undo:()=>{he.armatures.splice(t,1),a.undo()},redo:()=>{he.armatures.push(e),a.redo()}}}(X({name:H("armature",he.armatures.map((e=>e.name))),borns:[q({name:"born",tail:{x:100,y:0}},!0)]},!0));e.redo(),fe.push(e)}function Ee(e="",t={head:!0,tail:!0},a=!1,n=!1){if(!ge.value)return;if(he.lastSelectedBornId===e&&(r=he.selectedBorns[e],l=t,!!(null==r?void 0:r.head)==!!(null==l?void 0:l.head)&&!!(null==r?void 0:r.tail)==!!(null==l?void 0:l.tail)))return;var r,l;const o=Ne(e,t,a,n);o.redo(),fe.push(o)}function Oe(){if(!ge.value)return;const e=function(){const e=ge.value.borns.concat(),t=ge.value.borns.filter((e=>!he.selectedBorns[e.id])),a=Pe(re(t)),n=Ne("");return{name:"Delete Born",undo:()=>{ge.value.borns=e.concat(),n.undo(),a.undo()},redo:()=>{ge.value.borns=t,a.redo()}}}();e.redo(),fe.push(e)}function $e(){ge.value&&Te([q({name:H("born",ge.value.borns.map((e=>e.name))),tail:{x:100,y:0}},!0)])}function Te(t,a){if(!ge.value)return;const n=function(e,t){const a=e.map(((e,a)=>Ne(e.id,t[e.id],0!==a)));return{name:"Add Born",undo:()=>{ge.value.borns=ge.value.borns.slice(0,ge.value.borns.length-e.length),a.forEach((e=>e.undo()))},redo:()=>{ge.value.borns=ge.value.borns.concat(e),a.forEach((e=>e.redo()))}}}(t,t.reduce(((t,n)=>(a&&(t[n.id]=e({},a)),t)),{}));n.redo(),fe.push(n)}function De(e){if(!ge.value)return;const t=Pe(e);t.redo(),fe.push(t)}function Fe(t){if(!ge.value)return;if(!be.value)return;const a=function(t){const a=Q(be.value,t);return{name:"Update Born",undo:()=>{const t=xe.value;ge.value.borns[t]=e(e({},ge.value.borns[t]),a)},redo:()=>{const a=xe.value;ge.value.borns[a]=e(e({},ge.value.borns[a]),t)}}}(function(t,a){if(!a.connected)return a;const n=ae(t,a.parentId);return e(e({},a),n?{head:n.tail}:{connected:!1,parentId:""})}(ge.value.borns,e(e({},be.value),t)));a.redo(),fe.push(a)}function Le(){return{state:he,lastSelectedArmature:ge,lastSelectedBorn:be,bornMap:ke,selectedBornsOrigin:Se,selectedPoseBornsOrigin:Me,selectArmature:Ae,updateArmatureName:Be,deleteArmature:Ie,addArmature:Ce,selectBorn:Ee,deleteBorn:Oe,addBorn:$e,addBorns:Te,updateBorns:De,updateBorn:Fe}}function je(t){const a=e({},he.selectedArmatures),n=he.lastSelectedArmatureId;return{name:"Select Armature",undo:()=>{he.selectedArmatures=e({},a),he.lastSelectedArmatureId=n},redo:()=>{he.selectedArmatures=t?{[t]:!0}:{},he.lastSelectedArmatureId=t}}}function Ne(t,a={head:!0,tail:!0},n=!1,r=!1){const l=e({},he.selectedBorns),o=he.lastSelectedBornId;return{name:"Select Born",undo:()=>{he.selectedBorns=e({},l),he.lastSelectedBornId=o},redo:()=>{he.selectedBorns=t?J(e(e({},n?he.selectedBorns:{}),{[t]:a}),ne(ge.value,t,a,r)):{},he.lastSelectedBornId=t}}}function Pe(t){const a=J(t,re(ge.value.borns.map((a=>e(e({},a),t[a.id]))))),n=Object.keys(a).reduce(((e,t)=>(ke.value[t]&&(e[t]=Q(ke.value[t],a[t])),e)),{});return{name:"Update Born",undo:()=>{ge.value.borns=ge.value.borns.map((t=>e(e({},t),n[t.id])))},redo:()=>{ge.value.borns=ge.value.borns.map((t=>e(e({},t),a[t.id])))}}}c((()=>he.selectedArmatures),(()=>{he.selectedArmatures[he.lastSelectedArmatureId]||(he.lastSelectedArmatureId="")})),c((()=>we.value),(()=>{he.selectedArmatures=Object.keys(he.selectedArmatures).reduce(((t,a)=>we.value[a]?e(e({},t),{[a]:he.selectedArmatures[a]}):t),{})})),c((()=>he.selectedBorns),(()=>{if(!(e=he.selectedBorns[he.lastSelectedBornId])||!e.head&&!e.tail){const e=Object.keys(he.selectedBorns);he.lastSelectedBornId=e.length>0?e[0]:""}var e})),c((()=>ke.value),(()=>{he.selectedBorns=Object.keys(he.selectedBorns).reduce(((t,a)=>ke.value[a]?e(e({},t),{[a]:he.selectedBorns[a]}):t),{})}));var ze=i({props:{origin:{type:Object,required:!0},current:{type:Object,required:!0},scale:{type:Number,required:!0},side:{type:Boolean,default:!1}},setup:e=>({rotate:s((()=>u(e.current,e.origin)/Math.PI*180))})});const _e={fill:"black",stroke:"black"},We=m("circle",{r:"2"},null,-1),Ue=m("circle",{r:"2"},null,-1),Ve=m("path",{d:"M-20,0L-10,-10L-10,10z"},null,-1),Ge=m("path",{d:"M20,0L10,-10L10,10z"},null,-1);function Ke(t){const a=d({command:"",editMovement:void 0}),n=Le(),l=s((()=>n.state.selectedBorns)),c=s((()=>{var e;return null==(e=n.lastSelectedBorn.value)?void 0:e.id})),i=s((()=>n.lastSelectedArmature.value)),v=s((()=>!!c.value)),m=s((()=>{var e,t;return null!=(t=null==(e=i.value)?void 0:e.borns.map((e=>e.name)))?t:[]}));function f(){a.command="",a.editMovement=void 0}function h(t,a=!1){return e({},function(e,t=!1){const a=t?e.head:e.tail;return q({head:a,tail:a,parentId:t?e.parentId:e.id,connected:!t||e.connected},!0)}(t,a))}const y=s((()=>{if(!a.editMovement)return{};if("scale"===a.command){const e=n.selectedBornsOrigin.value,r=t.isOppositeSide(e,a.editMovement.start,a.editMovement.current),d=o(o({x:1,y:1},r?-1:1),p(a.editMovement.current,e)/p(a.editMovement.start,e)),s=t.snapScale(d);return Object.keys(l.value).reduce(((t,a)=>(t[a]=[R({origin:e,scale:s})],t)),{})}if("rotate"===a.command){const e=n.selectedBornsOrigin.value,t=(u(a.editMovement.current,e)-u(a.editMovement.start,e))/Math.PI*180;return Object.keys(l.value).reduce(((a,n)=>(a[n]=[R({origin:e,rotate:t})],a)),{})}const e=r(a.editMovement.current,a.editMovement.start),d=t.snapTranslate(e);return Object.keys(l.value).reduce(((e,t)=>(e[t]=[R({translate:d})],e)),{})})),g=s((()=>Object.keys(y.value).reduce(((e,t)=>(e[t]=ee(n.bornMap.value[t],y.value[t],l.value[t]),e)),{})));function x(){i.value&&(n.updateBorns(g.value),a.editMovement=void 0,a.command="")}return{command:s((()=>a.command)),getEditTransforms:e=>y.value[e]||[],end:()=>f(),cancel:f,setEditMode:function(e){if(i.value&&(f(),v.value&&(a.command=e,"extrude"===e))){const e={},t=m.value.concat(),a=[];Object.keys(l.value).forEach((r=>{const o=l.value[r],d=n.bornMap.value[r],s=[];o.tail&&s.push(h(d)),o.head&&s.push(h(d,!0)),s.forEach((n=>{e[n.parentId]||(n.name=H(d.name,t),a.push(n),t.push(n.name),e[n.parentId]=!0)}))})),n.addBorns(a,{tail:!0})}},select:function(e,t){a.command?x():n.selectBorn(e,t)},shiftSelect:function(e,t){a.command?x():n.selectBorn(e,t,!0)},mousemove:function(e){a.command&&(a.editMovement=e)},clickAny:function(){a.command&&x()},clickEmpty:function(){a.command?x():n.selectBorn()},execDelete:function(){""===a.command&&n.deleteBorn()},execAdd:function(){""===a.command&&n.addBorn()}}}ze.render=function(e,t,a,n,r,l){return f(),v("g",_e,[m("g",{transform:`translate(${e.origin.x}, ${e.origin.y}) rotate(${e.rotate}) scale(${e.scale})`},[We],8,["transform"]),m("line",{x1:e.origin.x,y1:e.origin.y,x2:e.current.x,y2:e.current.y,"stroke-width":e.scale,"stroke-dasharray":`${2*e.scale} ${2*e.scale}`},null,8,["x1","y1","x2","y2","stroke-width","stroke-dasharray"]),m("g",{transform:`translate(${e.current.x}, ${e.current.y}) rotate(${e.rotate}) scale(${e.scale})`},[Ue,m("g",{transform:`rotate(${e.side?90:0})`},[Ve,Ge],8,["transform"])],8,["transform"])])};const He=me();function Re(t,a){const n=e({},t.selectedMap),r=t.lastSelectedId;return{name:`Select ${t.label}`,undo:()=>{t.selectedMap=e({},n),t.lastSelectedId=r},redo:()=>{t.selectedMap=a?{[a]:!0}:{},t.lastSelectedId=a}}}const qe=h(0),Xe=h(60),Ye=function(t){const a=d({label:t,list:[],lastSelectedId:"",selectedMap:{}}),n=s((()=>a.list.findIndex((e=>e.id===a.lastSelectedId&&a.selectedMap[a.lastSelectedId])))),r=s((()=>Y(a.list))),l=s((()=>-1!==n.value?a.list[n.value]:void 0));return c((()=>a.selectedMap),(()=>{a.selectedMap[a.lastSelectedId]||(a.lastSelectedId="")})),c((()=>r.value),(()=>{a.selectedMap=Object.keys(a.selectedMap).reduce(((t,n)=>r.value[n]?e(e({},t),{[n]:a.selectedMap[n]}):t),{})})),{state:a,itemMap:r,lastSelectedItem:l,selectItem:function(e){if(a.lastSelectedId===e)return;const t=Re(a,e);t.redo(),He.push(t)},addItem:function(e){const t=function(e,t){const a=e.list.length,n=Re(e,t.id),r=()=>{e.list.push(t),n.redo()};return{name:`Add ${e.label}`,undo:()=>{e.list.splice(a,1),n.undo()},redo:r}}(a,e);t.redo(),He.push(t)},deleteItem:function(){if(-1===n.value)return;const t=function(t,a){const n=e({},t.list[a]),r=a,l=Re(t,""),o=()=>{t.list.splice(r,1)};return{name:`Delete ${t.label}`,undo:()=>{t.list.splice(r,0,n),l.undo()},redo:o}}(a,n.value);t.redo(),He.push(t)},updateItem:function(t){if(-1===n.value)return;const r=function(t,a,n){const r=Q(t.list[n],a),l=()=>{t.list[n]=e(e({},t.list[n]),a)};return{name:`Update ${t.label}`,undo:()=>{t.list[n]=e(e({},t.list[n]),r)},redo:l}}(a,t,n.value);r.redo(),He.push(r)}}}("Action"),Je=h({}),Qe=me(),Ze=Le(),et=s((()=>{var e,t;return null!=(t=null==(e=Ye.lastSelectedItem.value)?void 0:e.keyframes.filter((e=>e.frame===qe.value)))?t:[]})),tt=s((()=>et.value.reduce(((t,a)=>e(e({},t),{[a.bornId]:a})),{}))),at=s((()=>Array.from(new Set(Object.keys(Je.value).concat(Object.keys(tt.value)))))),nt=s((()=>at.value.reduce(((e,t)=>(tt.value[t]?e[t]=[tt.value[t].transform,...st(t)]:e[t]=st(t),e)),{})));function rt(){Ze.lastSelectedArmature.value&&Ye.addItem(function(a={},n=!1){return e({id:n?t():"",name:"",totalFrame:60,armatureId:"",keyframes:[]},a)}({name:H("action",Ye.state.list.map((e=>e.name))),armatureId:Ze.lastSelectedArmature.value.id},!0))}function lt(e){if(Xe.value===e)return;const t=function(e){const t=Xe.value;return{name:"Update End Frame",undo:()=>{Xe.value=t},redo:()=>{Xe.value=e}}}(e);t.redo(),Qe.push(t)}function ot(t){const a=function(t){const a=e({},Je.value);return{name:"Update Pose",undo:()=>{Je.value=a},redo:()=>{Je.value=t}}}(t);a.redo(),Qe.push(a)}function dt(e){ot(Array.from(new Set(Object.keys(Je.value).concat(Object.keys(e)))).reduce(((t,a)=>{var n;return console.log(st(a)),t[a]=st(a).concat(null!=(n=e[a])?n:[]),t}),{}))}function st(e){var t;return null!=(t=Je.value[e])?t:[]}function ct(e){var t;return null!=(t=nt.value[e])?t:[]}function it(){return{currentFrame:qe,endFrame:Xe,actions:Ye.state.list,posedBornIds:at,currentTransforms:nt,getBornEditedTransforms:st,getBornCurrentTransforms:ct,setEndFrame:lt,selectedAction:Ye.lastSelectedItem,selectAction:Ye.selectItem,addAction:rt,deleteAction:Ye.deleteItem,updateAction:e=>Ye.updateItem(e),applyEditedTransforms:dt}}const ut=me(),vt=d({canvasMode:"object",pastCanvasMode:"edit",axisGrid:""}),mt=s((()=>"edit"===vt.canvasMode?Ke(Mt()):"pose"===vt.canvasMode?function(e){const t=d({command:"",editMovement:void 0}),a=Le(),n=it(),l=s((()=>a.state.selectedBorns)),c=s((()=>{var e;return null==(e=a.lastSelectedBorn.value)?void 0:e.id})),i=s((()=>a.lastSelectedArmature.value)),v=s((()=>!!c.value));function m(){t.command="",t.editMovement=void 0}s((()=>{var e,t;return null!=(t=null==(e=i.value)?void 0:e.borns.map((e=>e.id)))?t:[]}));const f=s((()=>{if(!t.editMovement)return{};if("scale"===t.command){const n=a.selectedBornsOrigin.value,r=e.isOppositeSide(n,t.editMovement.start,t.editMovement.current),d=o(o({x:1,y:1},r?-1:1),p(t.editMovement.current,n)/p(t.editMovement.start,n)),s=e.snapScale(d);return Object.keys(l.value).reduce(((e,t)=>(e[t]=[R({origin:n,scale:s})],e)),{})}if("rotate"===t.command){const e=a.selectedPoseBornsOrigin.value,n=(u(t.editMovement.current,e)-u(t.editMovement.start,e))/Math.PI*180;return Object.keys(l.value).reduce(((t,a)=>(t[a]=[R({origin:e,rotate:n})],t)),{})}const n=r(t.editMovement.current,t.editMovement.start),d=e.snapTranslate(n);return Object.keys(l.value).reduce(((e,t)=>(e[t]=[R({translate:d})],e)),{})}));function h(){i.value&&(n.applyEditedTransforms(f.value),t.editMovement=void 0,t.command="")}return{command:s((()=>t.command)),getEditTransforms(e){var t;return null!=(t=f.value[e])?t:[]},end:()=>m(),cancel:m,setEditMode:function(e){i.value&&(m(),v.value&&(t.command=e))},select:function(e,n){t.command?h():a.selectBorn(e,n,!1,!0)},shiftSelect:function(e,n){t.command?h():a.selectBorn(e,n,!0,!0)},mousemove:function(e){t.command&&(t.editMovement=e)},clickAny:function(){t.command&&h()},clickEmpty:function(){t.command?h():a.selectBorn()},execDelete:()=>{},execAdd:()=>{}}}(Mt()):function(){const e=d({command:"",editMovement:void 0}),t=Le(),a=s((()=>t.lastSelectedArmature.value));function n(){e.command="",e.editMovement=void 0}const r=s((()=>({})));function l(){a.value&&(e.editMovement=void 0,e.command="")}return{command:s((()=>e.command)),getEditTransforms:e=>r.value[e]||[],end:()=>n(),cancel:n,setEditMode:function(t){a.value&&(n(),e.command=t)},select:function(a,n){e.command?l():t.selectBorn(a,n)},shiftSelect:function(a,n){e.command?l():t.selectBorn(a,n,!0)},mousemove:function(t){e.command&&(e.editMovement=t)},clickAny:function(){e.command&&l()},clickEmpty:function(){e.command?l():t.selectArmature()},execDelete:function(){""===e.command&&t.deleteArmature()},execAdd:function(){""===e.command&&t.addArmature()}}}()));c(mt,((e,t)=>{t&&t.end()}));const ft=s((()=>mt.value.command.value));function pt(){"edit"===vt.canvasMode?yt(vt.pastCanvasMode):yt("edit")}function ht(){"edit"===vt.canvasMode?"object"===vt.pastCanvasMode?yt("pose"):yt("object"):"object"===vt.canvasMode?yt("pose"):yt("object")}function yt(e){const t=function(e){const t=vt.canvasMode,a=vt.pastCanvasMode;return{name:"Change Mode",undo:()=>{vt.canvasMode=t,vt.pastCanvasMode=a},redo:()=>{vt.pastCanvasMode=vt.canvasMode,vt.canvasMode=e}}}(e);ut.push(t),t.redo()}function gt(e){vt.axisGrid=e}function xt(e){vt.axisGrid=vt.axisGrid===e?"":e}function bt(e){return{x:"y"===vt.axisGrid?1:e.x,y:"x"===vt.axisGrid?1:e.y}}function wt(e){return{x:"y"===vt.axisGrid?0:e.x,y:"x"===vt.axisGrid?0:e.y}}function kt(e,t,a){return y(r(t,e),r(a,e))<0}function St(e){var t;return null!=(t=mt.value.getEditTransforms(e))?t:[]}function Mt(){return{state:vt,command:ft,toggleCanvasMode:pt,ctrlToggleCanvasMode:ht,setCanvasMode:yt,setAxisGrid:gt,switchAxisGrid:xt,snapScale:bt,snapTranslate:wt,isOppositeSide:kt,getEditTransforms:St,mousemove:e=>mt.value.mousemove(e),clickAny:()=>mt.value.clickAny(),clickEmpty:()=>mt.value.clickEmpty(),cancel:()=>mt.value.cancel(),setEditMode:e=>mt.value.setEditMode(e),execDelete:()=>mt.value.execDelete(),execAdd:()=>mt.value.execAdd(),select:(e,t)=>mt.value.select(e,t),shiftSelect:(e,t)=>mt.value.shiftSelect(e,t)}}const At=d({size:{width:100,height:100}});function Bt(){return{state:At}}window.addEventListener("resize",(()=>{At.size={width:window.innerWidth,height:window.innerHeight}}));var It=i({components:{ScaleMarker:ze},props:{originalViewBox:{type:Object,default:()=>({x:0,y:0,width:600,height:400})},currentCommand:{type:String,default:""}},emits:["mousemove","click-any","click-empty","escape","tab","ctrl-tab","g","s","r","e","x","y","shift-a"],setup(t,{emit:a}){const l=d({width:600,height:400}),i=h(),u=h(),v=h(),m=h(),f=h(1),p=h({x:0,y:0}),y=h(),w=Le(),k=Mt();function S(e){return n(p.value,o(e,f.value))}const M=s((()=>(k.state.canvasMode,w.selectedPoseBornsOrigin.value))),A=s((()=>({x:p.value.x,y:p.value.y,width:l.width*f.value,height:l.height*f.value}))),B=s((()=>V(A.value))),I=s((()=>b(e({x:0,y:0},l)))),C=s((()=>{if(""!==k.state.axisGrid&&v.value)return function(t,a,n,r){return e(e({},{strokeWidth:t}),"x"===a?{from:{x:n.x,y:r.y},to:{x:n.x+n.width,y:r.y},stroke:"red"}:{from:{x:r.x,y:n.y},to:{x:r.x,y:n.y+n.height},stroke:"green"})}(f.value,k.state.axisGrid,A.value,M.value)})),E=s((()=>{if(m.value&&["scale","rotate"].includes(t.currentCommand))return{origin:M.value,current:S(m.value),side:"rotate"===t.currentCommand}}));function O(){if(!u.value)return;const e=u.value.getBoundingClientRect();l.width=e.width,l.height=e.height}c((()=>t.currentCommand),(e=>{k.setAxisGrid(""),""===e&&(v.value=void 0)}));const $=Bt();return g(O),c((()=>$.state.size),O),{scale:f,viewSize:l,svg:i,wrapper:u,viewBox:B,gridLineElm:C,scaleNaviElm:E,canvasMode:s((()=>k.state.canvasMode)),focus(){i.value&&i.value.focus()},wheel(e){const t=m.value?m.value:I.value,a=S(t);f.value=f.value*Math.pow(1.1,e.deltaY>0?1:-1);const l=S(t);p.value=n(p.value,r(a,l))},downMiddle(){m.value&&(y.value={origin:e({},p.value),downAt:e({},m.value)})},upMiddle(){y.value=void 0},leave(){y.value=void 0},mousemove:e=>{if(m.value=x(e),y.value)p.value=n(y.value.origin,o(r(y.value.downAt,m.value),f.value));else{if(!v.value)return;a("mousemove",{current:S(m.value),start:S(v.value)})}},clickAny(e){e.target===i.value?(v.value=void 0,a("click-empty")):a("click-any")},keyDownTab:()=>{a("tab")},keyDownCtrlTab:()=>a("ctrl-tab"),keyDownEscape:()=>{a("escape")},editKeyDown(e){m.value&&(!["grab","scale"].includes(t.currentCommand)||"x"!==e&&"y"!==e?(v.value=m.value,a(e)):k.switchAxisGrid(e))}}}});const Ct=I("data-v-323b2088");C("data-v-323b2088");const Et={ref:"wrapper",class:"app-canvas-root"},Ot={class:"help"};E();const $t=Ct(((e,t,a,n,r,l)=>{const o=w("ScaleMarker");return f(),v("div",Et,[(f(),v("svg",{ref:"svg",tabindex:"-1",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"none","font-family":"sans-serif",viewBox:e.viewBox,width:e.viewSize.width,height:e.viewSize.height,onWheel:t[1]||(t[1]=k(((...t)=>e.wheel&&e.wheel(...t)),["prevent"])),onClick:t[2]||(t[2]=k(((...t)=>e.clickAny&&e.clickAny(...t)),["left"])),onContextmenu:t[3]||(t[3]=k(((...t)=>e.keyDownEscape&&e.keyDownEscape(...t)),["right","prevent"])),onMouseenter:t[4]||(t[4]=(...t)=>e.focus&&e.focus(...t)),onMousemove:t[5]||(t[5]=k(((...t)=>e.mousemove&&e.mousemove(...t)),["prevent"])),onMousedown:t[6]||(t[6]=k(((...t)=>e.downMiddle&&e.downMiddle(...t)),["middle","prevent"])),onMouseup:t[7]||(t[7]=k(((...t)=>e.upMiddle&&e.upMiddle(...t)),["middle","prevent"])),onMouseleave:t[8]||(t[8]=(...t)=>e.leave&&e.leave(...t)),onKeydown:[t[9]||(t[9]=S(k(((...t)=>e.keyDownEscape&&e.keyDownEscape(...t)),["exact","prevent"]),["escape"])),t[10]||(t[10]=S(k(((...t)=>e.keyDownTab&&e.keyDownTab(...t)),["exact","prevent"]),["tab"])),t[11]||(t[11]=S(k(((...t)=>e.keyDownCtrlTab&&e.keyDownCtrlTab(...t)),["shift","exact","prevent"]),["tab"])),t[12]||(t[12]=S(k((t=>e.editKeyDown("g")),["exact","prevent"]),["g"])),t[13]||(t[13]=S(k((t=>e.editKeyDown("s")),["exact","prevent"]),["s"])),t[14]||(t[14]=S(k((t=>e.editKeyDown("r")),["exact","prevent"]),["r"])),t[15]||(t[15]=S(k((t=>e.editKeyDown("e")),["exact","prevent"]),["e"])),t[16]||(t[16]=S(k((t=>e.editKeyDown("x")),["exact","prevent"]),["x"])),t[17]||(t[17]=S(k((t=>e.editKeyDown("y")),["exact","prevent"]),["y"])),t[18]||(t[18]=S(k((t=>e.editKeyDown("shift-a")),["shift","exact","prevent"]),["a"]))]},[m("rect",{x:e.originalViewBox.x,y:e.originalViewBox.y,width:e.originalViewBox.width,height:e.originalViewBox.height,fill:"none",stroke:"black","stroke-width":"1","stroke-dasharray":"4 4"},null,8,["x","y","width","height"]),e.gridLineElm?(f(),v("line",{key:0,x1:e.gridLineElm.from.x,y1:e.gridLineElm.from.y,x2:e.gridLineElm.to.x,y2:e.gridLineElm.to.y,stroke:e.gridLineElm.stroke,"stroke-width":e.gridLineElm.strokeWidth},null,8,["x1","y1","x2","y2","stroke","stroke-width"])):M("",!0),A(e.$slots,"default"),e.scaleNaviElm?(f(),v(o,{key:1,origin:e.scaleNaviElm.origin,current:e.scaleNaviElm.current,scale:e.scale,side:e.scaleNaviElm.side},null,8,["origin","current","scale","side"])):M("",!0)],40,["viewBox","width","height"])),m("div",Ot,[m("p",null,"Mode: "+B(e.canvasMode),1)])],512)}));It.render=$t,It.__scopeId="data-v-323b2088";var Tt=i({props:{tabs:{type:Array,default:()=>[]}},setup(e){var t,a;const n=h(null!=(a=null==(t=e.tabs[0])?void 0:t.key)?a:"");return{current:n,setTab:e=>n.value=e}}});const Dt=I("data-v-16db2673");C("data-v-16db2673");const Ft={class:"tab-panel-root"},Lt={class:"panels"};E();const jt=Dt(((e,t,a,n,r,l)=>(f(),v("div",Ft,[m("ul",null,[(f(!0),v(O,null,$(e.tabs,(t=>(f(),v("li",{key:t.key,class:{current:t.key===e.current}},[m("a",{href:"#",onClick:k((a=>e.setTab(t.key)),["prevent"])},B(t.label),9,["onClick"])],2)))),128))]),m("div",Lt,[(f(!0),v(O,null,$(e.tabs,(t=>T((f(),v("div",{key:t.key},[A(e.$slots,t.key)],512)),[[D,t.key===e.current]]))),128))])]))));Tt.render=jt,Tt.__scopeId="data-v-16db2673";var Nt=i({setup(){const e=me();return{allStack:s((()=>e.allStack.value)),currentItemIndex:s((()=>e.currentItemIndex.value))}}});const Pt=I("data-v-65f8ee82");C("data-v-65f8ee82");const zt=m("h3",null,"history",-1);E();const _t=Pt(((e,t,a,n,r,l)=>(f(),v("div",null,[zt,m("ul",null,[(f(!0),v(O,null,$(e.allStack,((t,a)=>(f(),v("li",{key:a,class:{current:a===e.currentItemIndex}},B(t.name),3)))),128))])]))));Nt.render=_t,Nt.__scopeId="data-v-65f8ee82";var Wt=i({props:{options:{type:Array,default:()=>[]},modelValue:{type:[Number,String],default:""}},emits:["update:modelValue"],setup:(e,{emit:t})=>({value:s({get:()=>e.modelValue,set(e){t("update:modelValue",e)}})})});const Ut=I("data-v-fddf1844");C("data-v-fddf1844");const Vt={class:"select-root"},Gt=m("option",{value:""},"-- None --",-1);E();const Kt=Ut(((e,t,a,n,r,l)=>(f(),v("span",Vt,[T(m("select",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.value=t)},[Gt,(f(!0),v(O,null,$(e.options,(e=>(f(),v("option",{key:e.value,value:e.value},B(e.label),9,["value"])))),128))],512),[[F,e.value]])]))));Wt.render=Kt,Wt.__scopeId="data-v-fddf1844";var Ht=i({components:{TabPanel:Tt,HistoryStack:Nt,SelectField:Wt},setup(){const e=Le(),t=h(""),a=s((()=>e.lastSelectedArmature.value?e.lastSelectedArmature.value.borns.filter((t=>{var a;return t.id!==(null==(a=e.lastSelectedBorn.value)?void 0:a.id)})).map((e=>({value:e.id,label:e.name}))):[])),n=s((()=>e.lastSelectedBorn.value?"born":e.lastSelectedArmature.value?"armature":""));function r(){e.lastSelectedBorn.value?t.value=e.lastSelectedBorn.value.name:e.lastSelectedArmature.value?t.value=e.lastSelectedArmature.value.name:t.value=""}return c(e.lastSelectedArmature,r),c(e.lastSelectedBorn,r),{draftName:t,lastSelectedArmature:e.lastSelectedArmature,lastSelectedBorn:e.lastSelectedBorn,parentOptions:a,selectedObjectType:n,connected:s({get(){var t,a;return null!=(a=null==(t=e.lastSelectedBorn.value)?void 0:t.connected)&&a},set(t){e.updateBorn({connected:t})}}),parentId:s({get(){var t,a;return null!=(a=null==(t=e.lastSelectedBorn.value)?void 0:t.parentId)?a:""},set(t){e.updateBorn({parentId:t})}}),changeArmatureName(){t.value&&e.updateArmatureName(t.value)},changeBornName(){t.value&&e.updateBorn({name:t.value})}}}});const Rt=I("data-v-a1a2983c");C("data-v-a1a2983c");const qt=m("h3",null,"Armature",-1),Xt={class:"field inline"},Yt=m("label",null,"Name",-1),Jt=m("h3",null,"Born",-1),Qt={class:"field inline"},Zt=m("label",null,"Name",-1),ea={class:"field inline"},ta=m("label",null,"Parent",-1),aa={class:"field inline"},na=m("label",null,"Connect",-1);E();const ra=Rt(((e,t,a,n,r,l)=>{const o=w("SelectField"),d=w("HistoryStack"),s=w("TabPanel");return f(),v("div",null,[m(s,{tabs:[{key:"detail",label:"Detail"},{key:"history",label:"History"}]},{detail:Rt((()=>["armature"===e.selectedObjectType?(f(),v("form",{key:0,onSubmit:t[3]||(t[3]=k((()=>{}),["prevent"]))},[qt,m("div",Xt,[Yt,T(m("input",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.draftName=t),type:"text",onChange:t[2]||(t[2]=(...t)=>e.changeArmatureName&&e.changeArmatureName(...t))},null,544),[[L,e.draftName]])])],32)):M("",!0),"born"===e.selectedObjectType?(f(),v("form",{key:1,onSubmit:t[8]||(t[8]=k((()=>{}),["prevent"]))},[Jt,m("div",Qt,[Zt,T(m("input",{"onUpdate:modelValue":t[4]||(t[4]=t=>e.draftName=t),type:"text",onChange:t[5]||(t[5]=(...t)=>e.changeBornName&&e.changeBornName(...t))},null,544),[[L,e.draftName]])]),m("div",ea,[ta,m(o,{modelValue:e.parentId,"onUpdate:modelValue":t[6]||(t[6]=t=>e.parentId=t),options:e.parentOptions},null,8,["modelValue","options"])]),m("div",aa,[na,T(m("input",{"onUpdate:modelValue":t[7]||(t[7]=t=>e.connected=t),type:"checkbox",disabled:!e.parentId},null,8,["disabled"]),[[j,e.connected]])])],32)):M("",!0)])),history:Rt((()=>[m(d)])),_:1})])}));Ht.render=ra,Ht.__scopeId="data-v-a1a2983c";var la=i({emits:["down-left","up-left","mousemove","drag","click-any","click-empty","escape","g","x"],setup(t,{emit:a}){const l=h(),i=h(),u=function(t={}){const a=d({width:600,height:100}),l=h(),c=h(),i=h(1),u=h({x:0,y:0}),v=h(),m=h(),f=s((()=>({x:u.value.x,y:u.value.y,width:a.width*i.value,height:a.height*i.value}))),p=s((()=>b(e({x:0,y:0},a)))),y=s((()=>V(f.value)));function g(e){return n(u.value,o(e,i.value))}return{viewSize:a,editStartPoint:l,mousePoint:c,scale:i,viewOrigin:u,dragInfo:m,viewMovingInfo:v,viewCenter:p,viewBox:y,viewToCanvas:g,wheel(e,a=!1){var l,o;const d=!a&&c.value?c.value:p.value,s=g(d);i.value=Math.min(Math.max(i.value*Math.pow(1.1,e.deltaY>0?1:-1),null!=(l=t.scaleMin)?l:0),null!=(o=t.scaleMax)?o:10);const v=g(d);u.value=n(u.value,r(s,v))},downLeft(){c.value&&(m.value={})},upLeft(){m.value=void 0},downMiddle(){c.value&&(v.value={origin:e({},u.value),downAt:e({},c.value)})},upMiddle(){v.value=void 0},leave(){v.value=void 0},viewMove(){v.value&&c.value&&(u.value=n(v.value.origin,o(r(v.value.downAt,c.value),i.value)))}}}({scaleMin:1});function v(){if(!i.value)return;const e=i.value.getBoundingClientRect();u.viewSize.width=e.width,u.viewSize.height=e.height}const m=Bt();return g(v),c((()=>m.state.size),v),{scale:u.scale,viewOrigin:u.viewOrigin,viewSize:s((()=>u.viewSize)),wrapper:i,svg:l,viewBox:u.viewBox,focus(){l.value&&l.value.focus()},wheel:e=>u.wheel(e,!0),downLeft:()=>{u.mousePoint.value&&(u.downLeft(),a("down-left",u.viewToCanvas(u.mousePoint.value)))},upLeft:()=>{u.upLeft(),a("up-left")},downMiddle:u.downMiddle,upMiddle:u.upMiddle,leave:u.leave,mousemove:e=>{u.mousePoint.value=x(e),u.dragInfo.value?a("drag",u.viewToCanvas(u.mousePoint.value)):u.viewMovingInfo.value?u.viewMove():u.editStartPoint.value&&a("mousemove",{current:u.viewToCanvas(u.mousePoint.value),start:u.viewToCanvas(u.editStartPoint.value)})},clickAny(e){e.target===l.value?(u.editStartPoint.value=void 0,a("click-empty")):a("click-any")},keyDownEscape:()=>{a("escape")},editKeyDown(e){u.mousePoint.value&&(u.editStartPoint.value=u.mousePoint.value,a(e))}}}});const oa=I("data-v-5868f1c8");C("data-v-5868f1c8");const da={ref:"wrapper",class:"timeline-canvas-root"};E();const sa=oa(((e,t,a,n,r,l)=>(f(),v("div",da,[(f(),v("svg",{ref:"svg",tabindex:"-1",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"none","font-family":"sans-serif",viewBox:e.viewBox,width:e.viewSize.width,height:e.viewSize.height,onWheel:t[1]||(t[1]=k(((...t)=>e.wheel&&e.wheel(...t)),["prevent"])),onClick:t[2]||(t[2]=k(((...t)=>e.clickAny&&e.clickAny(...t)),["left"])),onContextmenu:t[3]||(t[3]=k(((...t)=>e.keyDownEscape&&e.keyDownEscape(...t)),["right","prevent"])),onMouseenter:t[4]||(t[4]=(...t)=>e.focus&&e.focus(...t)),onMousedown:[t[5]||(t[5]=k(((...t)=>e.downLeft&&e.downLeft(...t)),["left","prevent"])),t[8]||(t[8]=k(((...t)=>e.downMiddle&&e.downMiddle(...t)),["middle","prevent"]))],onMouseup:[t[6]||(t[6]=k(((...t)=>e.upLeft&&e.upLeft(...t)),["left","prevent"])),t[9]||(t[9]=k(((...t)=>e.upMiddle&&e.upMiddle(...t)),["middle","prevent"]))],onMousemove:t[7]||(t[7]=k(((...t)=>e.mousemove&&e.mousemove(...t)),["prevent"])),onMouseleave:t[10]||(t[10]=(...t)=>e.leave&&e.leave(...t)),onKeydown:[t[11]||(t[11]=S(k(((...t)=>e.keyDownEscape&&e.keyDownEscape(...t)),["exact","prevent"]),["escape"])),t[12]||(t[12]=S(k((t=>e.editKeyDown("g")),["exact","prevent"]),["g"])),t[13]||(t[13]=S(k((t=>e.editKeyDown("x")),["exact","prevent"]),["x"]))]},[A(e.$slots,"default",{scale:e.scale,viewOrigin:e.viewOrigin,viewSize:e.viewSize})],40,["viewBox","width","height"]))],512))));la.render=sa,la.__scopeId="data-v-5868f1c8";var ca=i({props:{labelWidth:{type:Number,default:100},index:{type:Number,required:!0},label:{type:String,required:!0}},setup:()=>({height:24})});ca.render=function(e,t,a,n,r,l){return f(),v("g",{transform:`translate(0, ${e.index*e.height})`},[m("rect",{width:e.labelWidth,height:e.height,fill:"#fff",stroke:"black"},null,8,["width","height"]),m("text",{x:"4",y:e.height/2,"dominant-baseline":"central"},B(e.label),9,["y"])],8,["transform"])};function ia(e){return Math.round(function(e){return Math.round(Math.log(e)/Math.log(1.1))}(e)/2)+1}var ua=i({props:{scale:{type:Number,default:1},originX:{type:Number,default:0},viewWidth:{type:Number,default:100},currentFrame:{type:Number,default:0},endFrame:{type:Number,default:60}},emits:["down-current-frame","up-current-frame"],setup(e,{emit:t}){const a=s((()=>ia(e.scale))),n=s((()=>function(e,t){const a=Math.floor(Math.max(t,0)/20);return a-a%(2*e)}(a.value,e.originX))),r=s((()=>Math.ceil(e.viewWidth*e.scale/20))),l=s((()=>Math.floor(r.value/a.value))),o=s((()=>[...Array(l.value)].map(((e,t)=>{const r=t*a.value+n.value;return{f:r,labelSize:r%10==0?14:r%2==0?11:0,strokeWidth:r%10==0?2:1}})))),d=s((()=>20*e.currentFrame)),c=s((()=>10*Math.max(e.currentFrame.toString().length,2)+2));return{headerHeight:24,frames:o,frameWidth:20,currentFrameX:d,endFrameX:s((()=>20*e.endFrame)),currentFrameLabelWidth:c,downCurrentFrame:()=>t("down-current-frame")}}});const va=I("data-v-d1cae906");C("data-v-d1cae906");const ma={class:"view-only"},fa={fill:"#aaa",stroke:"none","fill-opacity":"0.5"},pa=m("g",{transform:"scale(-1, 1)"},[m("rect",{width:"200000",height:"200000"})],-1),ha=m("rect",{width:"200000",height:"200000"},null,-1);E();const ya=va(((e,t,a,n,r,l)=>(f(),v("g",null,[m("g",{transform:`scale(${e.scale})`,onMousedown:t[1]||(t[1]=k(((...t)=>e.downCurrentFrame&&e.downCurrentFrame(...t)),["left"]))},[m("rect",{x:"-100000",width:"200000",height:e.headerHeight,fill:"#fff",stroke:"#000"},null,8,["height"])],40,["transform"]),m("g",ma,[m("g",null,[(f(!0),v(O,null,$(e.frames,(t=>(f(),v("g",{key:t,transform:`translate(${t.f*e.frameWidth}, 0)`},[m("g",{transform:`scale(${e.scale})`},[t.labelSize>0?(f(),v("text",{key:0,y:e.headerHeight-4,"font-size":t.labelSize,"dominant-baseline":"text-after-edge","text-anchor":"middle"},B(t.f),9,["y","font-size"])):M("",!0),t.strokeWidth>0?(f(),v("line",{key:1,x1:"0",y1:e.headerHeight,x2:"0",y2:"20000",stroke:"#aaa","stroke-width":t.strokeWidth},null,8,["y1","stroke-width"])):M("",!0)],8,["transform"])],8,["transform"])))),128))]),m("g",fa,[pa,m("g",{transform:`translate(${e.endFrameX}, 0)`},[ha],8,["transform"])]),m("g",{transform:`translate(${e.currentFrameX}, 0) scale(${e.scale})`},[m("rect",{x:-e.currentFrameLabelWidth/2,y:2,width:e.currentFrameLabelWidth,height:20,rx:"4",ry:"4",fill:"blue",stroke:"none"},null,8,["x","width"]),m("text",{y:e.headerHeight-4,"font-size":"12","dominant-baseline":"text-after-edge","text-anchor":"middle",fill:"#fff"},B(e.currentFrame),9,["y"]),m("line",{x1:"0",y1:e.headerHeight,x2:"0",y2:"20000",stroke:"blue","stroke-width":"2"},null,8,["y1"])],8,["transform"])])]))));ua.render=ya,ua.__scopeId="data-v-d1cae906";var ga=i({components:{SelectField:Wt,TimelineCanvas:la,TimelineRow:ca,TimelineAxis:ua},setup(){const e=Le(),t=it(),a=h(""),n=h(""),r=h(""),l=s((()=>t.selectedAction.value)),o=s((()=>{var t,a;return null!=(a=null==(t=e.lastSelectedArmature.value)?void 0:t.borns)?a:[]})),d=s((()=>t.actions.map((t=>{var a;const n=(null==(a=e.lastSelectedArmature.value)?void 0:a.id)!==t.armatureId;return{value:t.id,label:`${n?"(x)":""} ${t.name}`}}))));function c(e){var n;"move-current-frame"===a.value&&(t.currentFrame.value=(n=e.x-140-20,Math.round(Math.max(n,0)/20)))}return N((()=>{var e,t;n.value=null!=(t=null==(e=l.value)?void 0:e.name)?t:""})),N((()=>{r.value=t.endFrame.value.toString()})),{actions:t.actions,selectedBorns:o,draftName:n,draftEndFrame:r,labelWidth:140,axisPadding:20,currentFrame:t.currentFrame,endFrame:t.endFrame,changeActionName:()=>{n.value&&t.updateAction({name:n.value})},changeEndFrame:()=>{const e=parseInt(r.value,10);!isNaN(e)&&e>=0?t.setEndFrame(e):r.value=t.endFrame.value.toString()},addAction:t.addAction,deleteAction:t.deleteAction,actionOptions:d,selectedActionId:s({get:()=>{var e,t;return null!=(t=null==(e=l.value)?void 0:e.id)?t:""},set:e=>t.selectAction(e)}),downCurrentFrame:function(){a.value="move-current-frame"},downLeft:function(e){c(e)},drag:c,upLeft:function(){a.value=""}}}});const xa=I("data-v-13a1eea6");C("data-v-13a1eea6");const ba={class:"animation-panel-root"},wa={class:"top"},ka={class:"select-action"},Sa={class:"end-frame-field"},Ma=P("End: "),Aa={class:"middle"};E();const Ba=xa(((e,t,a,n,r,l)=>{const o=w("SelectField"),d=w("TimelineAxis"),s=w("TimelineRow"),c=w("TimelineCanvas");return f(),v("div",ba,[m("div",wa,[m("div",ka,[m(o,{modelValue:e.selectedActionId,"onUpdate:modelValue":t[1]||(t[1]=t=>e.selectedActionId=t),options:e.actionOptions},null,8,["modelValue","options"])]),T(m("input",{"onUpdate:modelValue":t[2]||(t[2]=t=>e.draftName=t),type:"text",onChange:t[3]||(t[3]=(...t)=>e.changeActionName&&e.changeActionName(...t))},null,544),[[L,e.draftName]]),m("button",{class:"add-action",onClick:t[4]||(t[4]=(...t)=>e.addAction&&e.addAction(...t))},"+"),m("button",{class:"delete-action",onClick:t[5]||(t[5]=(...t)=>e.deleteAction&&e.deleteAction(...t))},"x"),m("label",Sa,[Ma,T(m("input",{"onUpdate:modelValue":t[6]||(t[6]=t=>e.draftEndFrame=t),type:"number",onChange:t[7]||(t[7]=(...t)=>e.changeEndFrame&&e.changeEndFrame(...t))},null,544),[[L,e.draftEndFrame]])])]),m("div",Aa,[m(c,{onUpLeft:e.upLeft,onDrag:e.drag,onDownLeft:e.downLeft},{default:xa((({scale:t,viewOrigin:a,viewSize:n})=>[m("g",{transform:`translate(${e.labelWidth+e.axisPadding}, ${a.y})`},[m(d,{scale:t,"origin-x":a.x,"view-width":n.width,"current-frame":e.currentFrame,"end-frame":e.endFrame,onDownCurrentFrame:e.downCurrentFrame},null,8,["scale","origin-x","view-width","current-frame","end-frame","onDownCurrentFrame"])],8,["transform"]),m("g",{transform:`translate(${a.x}, ${a.y}) scale(${t})`},[m("g",null,[m("rect",{width:e.labelWidth,height:"10000",stroke:"none",fill:"#fff"},null,8,["width"]),m("line",{x1:e.labelWidth,y1:"0",x2:e.labelWidth,y2:"10000",stroke:"black"},null,8,["x1","x2"]),m(s,{index:1,"label-width":e.labelWidth,label:"Summary"},null,8,["label-width"]),(f(!0),v(O,null,$(e.selectedBorns,((t,a)=>(f(),v(s,{key:t.id,index:a+2,"label-width":e.labelWidth,label:t.name},null,8,["index","label-width","label"])))),128))])],8,["transform"])])),_:1},8,["onUpLeft","onDrag","onDownLeft"])])])}));ga.render=Ba,ga.__scopeId="data-v-13a1eea6";const Ia=d({selectedColor:"orange"});function Ca(e,t,a=!1){return n(e,l(o(r(t,e),.15),Math.PI/4*(a?-1:1)))}var Ea=i({props:{born:{type:Object,required:!0},parent:{type:Object,default:void 0},opacity:{type:Number,default:1},selectedState:{type:Object,default:()=>({head:!1,tail:!1})},poseMode:{type:Boolean,default:!1}},emits:["select","shift-select"],setup(t,{emit:a}){const{settings:n}={settings:Ia},r=s((()=>t.born.head)),l=s((()=>t.born.tail)),o=s((()=>Ca(r.value,l.value))),d=s((()=>Ca(r.value,l.value,!0))),c=s((()=>t.poseMode?t.selectedState.head||t.selectedState.tail:t.selectedState.head&&t.selectedState.tail));return{transform:s((()=>W(t.born.transform))),head:r,tail:l,headPath:s((()=>U([r.value,o.value,d.value],!0))),tailPath:s((()=>U([l.value,o.value,d.value],!0))),fill:s((()=>c.value?n.selectedColor:"#ddd")),fillDark:s((()=>c.value?n.selectedColor:"#bbb")),fillHead:s((()=>t.selectedState.head?n.selectedColor:"")),fillTail:s((()=>t.selectedState.tail?n.selectedColor:"")),click:e=>{t.poseMode?c.value?a("select",{head:!1,tail:!1}):a("select",{head:!0,tail:!0}):a("select",e)},shiftClick:n=>{t.poseMode||n.head&&n.tail?c.value?a("shift-select",{head:!1,tail:!1}):a("shift-select",{head:!0,tail:!0}):n.head?a("shift-select",e(e({},t.selectedState),{head:!t.selectedState.head})):n.tail&&a("shift-select",e(e({},t.selectedState),{tail:!t.selectedState.tail}))}}}});const Oa=I("data-v-13fd028e")(((e,t,a,n,r,l)=>(f(),v("g",{stroke:"black",fill:e.fill,transform:e.transform,opacity:e.opacity},[m("g",{onClick:[t[1]||(t[1]=k((t=>e.click({head:!0,tail:!0})),["exact"])),t[2]||(t[2]=k((t=>e.shiftClick({head:!0,tail:!0})),["shift","exact"]))]},[m("path",{d:e.headPath,fill:e.fillDark},null,8,["d","fill"]),m("path",{d:e.tailPath},null,8,["d"])]),m("circle",{r:"10",cx:e.head.x,cy:e.head.y,fill:e.fillHead,onClick:[t[3]||(t[3]=k((t=>e.click({head:!0,tail:!1})),["exact"])),t[4]||(t[4]=k((t=>e.shiftClick({head:!0,tail:!1})),["shift","exact"]))]},null,8,["cx","cy","fill"]),m("circle",{r:"10",cx:e.tail.x,cy:e.tail.y,fill:e.fillTail,onClick:[t[5]||(t[5]=k((t=>e.click({head:!1,tail:!0})),["exact"])),t[6]||(t[6]=k((t=>e.shiftClick({head:!1,tail:!0})),["shift","exact"]))]},null,8,["cx","cy","fill"]),e.parent?(f(),v("line",{key:0,x1:e.parent.tail.x,y1:e.parent.tail.y,x2:e.head.x,y2:e.head.y,"stroke-dasharray":"2 2",class:"view-only"},null,8,["x1","y1","x2","y2"])):M("",!0),m("text",{x:(e.head.x+e.tail.x)/2,y:(e.head.y+e.tail.y)/2,"text-anchor":"middle",fill:"black",stroke:"none",class:"view-only"},B(e.born.name),9,["x","y"])],8,["fill","transform","opacity"]))));Ea.render=Oa,Ea.__scopeId="data-v-13fd028e";var $a=i({components:{BornElm:Ea},props:{armature:{type:Object,required:!0},opacity:{type:Number,default:.8},selected:{type:Boolean,default:!1}},emits:["select","shift-select"],setup:(e,{emit:t})=>({bornMap:s((()=>Y(e.armature.borns))),transform:s((()=>W(e.armature.transform))),bornSelectedState:s((()=>e.selected?{head:!0,tail:!0}:void 0)),click:()=>t("select",!e.selected),shiftClick:()=>t("shift-select",!e.selected)})});const Ta=I("data-v-e1a73d3c")(((e,t,a,n,r,l)=>{const o=w("BornElm");return f(),v("g",{stroke:"black",transform:e.transform,opacity:e.opacity},[(f(!0),v(O,null,$(e.armature.borns,(t=>(f(),v(o,{key:t.name,born:t,"selected-state":e.bornSelectedState,parent:e.bornMap[t.parentId],onSelect:e.click,onShiftSelect:e.shiftClick},null,8,["born","selected-state","parent","onSelect","onShiftSelect"])))),128))],8,["transform","opacity"])}));$a.render=Ta,$a.__scopeId="data-v-e1a73d3c";var Da=i({components:{AppCanvas:It,ArmatureElm:$a,BornElm:Ea,SidePanel:Ht,AnimationPanel:ga},setup(){const e=Le(),t=Mt(),a=it(),n=me(),r=s((()=>t.state.canvasMode)),l=s((()=>e.lastSelectedArmature.value)),o=s((()=>e.state.armatures.filter((t=>{var a;return t.id!==(null==(a=e.lastSelectedArmature.value)?void 0:a.id)})))),d=s((()=>l.value?Y(l.value.borns.map((n=>(console.log(te(n,a.getBornCurrentTransforms(n.id),t.getEditTransforms(n.id),e.state.selectedBorns[n.id]||[]).transform),te(n,a.getBornCurrentTransforms(n.id),t.getEditTransforms(n.id),e.state.selectedBorns[n.id]||[]))))):{})),c=s((()=>{return"grab"===(e=t.command.value)||"extrude"===e?"grab":"rotate"===e?"rotate":"scale"===e?"scale":"";var e}));function i(e){var t;["input","textarea"].includes(null==(t=e.target)?void 0:t.tagName.toLowerCase())||e.ctrlKey&&"z"===e.key.toLowerCase()&&(e.preventDefault(),e.shiftKey?n.redo():n.undo())}return g((()=>{document.addEventListener("keydown",i)})),z((()=>{document.removeEventListener("keydown",i)})),{armatures:s((()=>e.state.armatures)),otherArmatures:o,lastSelectedArmatureId:s((()=>{var t;return null==(t=e.lastSelectedArmature.value)?void 0:t.id})),editBornMap:d,selectedBorns:s((()=>e.state.selectedBorns)),canvasMode:r,canvasCommand:c,mousemove(e){t.mousemove(e)},clickAny(){t.clickAny()},clickEmpty(){t.clickEmpty()},selectBorn(e,a){t.select(e,a)},shiftSelectBorn(e,a){t.shiftSelect(e,a)},selectArmature(t,a){e.selectArmature(a?t:"")},shiftSelectArmature(t,a){e.selectArmature(a?t:"")},escape(){t.cancel()},toggleCanvasMode(){e.lastSelectedArmature.value&&t.toggleCanvasMode()},ctrlToggleCanvasMode(){e.lastSelectedArmature.value&&t.ctrlToggleCanvasMode()},setEditMode(e){t.setEditMode(e)},execDelete(){t.execDelete()},addItem(){t.execAdd()}}}});const Fa=I("data-v-703f895c");C("data-v-703f895c");const La={class:"main"},ja={key:0},Na={key:1},Pa={key:2},za={class:"bottom"};E();const _a=Fa(((e,t,a,n,r,l)=>{const o=w("ArmatureElm"),d=w("BornElm"),s=w("AppCanvas"),c=w("SidePanel"),i=w("AnimationPanel");return f(),v("div",null,[m("div",La,[m(s,{"current-command":e.canvasCommand,class:"canvas",onMousemove:e.mousemove,onClickAny:e.clickAny,onClickEmpty:e.clickEmpty,onEscape:e.escape,onTab:e.toggleCanvasMode,onCtrlTab:e.ctrlToggleCanvasMode,onG:t[1]||(t[1]=t=>e.setEditMode("grab")),onS:t[2]||(t[2]=t=>e.setEditMode("scale")),onR:t[3]||(t[3]=t=>e.setEditMode("rotate")),onE:t[4]||(t[4]=t=>e.setEditMode("extrude")),onX:e.execDelete,onShiftA:e.addItem},{default:Fa((()=>["object"===e.canvasMode?(f(),v("g",ja,[(f(!0),v(O,null,$(e.armatures,(t=>(f(),v(o,{key:t.id,armature:t,selected:e.lastSelectedArmatureId===t.id,onSelect:a=>e.selectArmature(t.id,a),onShiftSelect:a=>e.shiftSelectArmature(t.id,a)},null,8,["armature","selected","onSelect","onShiftSelect"])))),128))])):M("",!0),"edit"===e.canvasMode?(f(),v("g",Na,[(f(!0),v(O,null,$(e.otherArmatures,(e=>(f(),v(o,{key:e.id,armature:e,opacity:.3},null,8,["armature","opacity"])))),128)),(f(!0),v(O,null,$(e.editBornMap,(t=>(f(),v(d,{key:t.id,born:t,parent:e.editBornMap[t.parentId],"selected-state":e.selectedBorns[t.id],onSelect:a=>e.selectBorn(t.id,a),onShiftSelect:a=>e.shiftSelectBorn(t.id,a)},null,8,["born","parent","selected-state","onSelect","onShiftSelect"])))),128))])):M("",!0),"pose"===e.canvasMode?(f(),v("g",Pa,[(f(!0),v(O,null,$(e.otherArmatures,(e=>(f(),v(o,{key:e.id,armature:e,opacity:.3},null,8,["armature","opacity"])))),128)),(f(!0),v(O,null,$(e.editBornMap,(t=>(f(),v(d,{key:t.id,born:t,parent:e.editBornMap[t.parentId],"selected-state":e.selectedBorns[t.id],"pose-mode":"",onSelect:a=>e.selectBorn(t.id,a),onShiftSelect:a=>e.shiftSelectBorn(t.id,a)},null,8,["born","parent","selected-state","onSelect","onShiftSelect"])))),128))])):M("",!0)])),_:1},8,["current-command","onMousemove","onClickAny","onClickEmpty","onEscape","onTab","onCtrlTab","onX","onShiftA"]),m(c,{class:"side-panel"})]),m("div",za,[m(i)])])}));Da.render=_a,Da.__scopeId="data-v-703f895c",_(Da).mount("#app");
