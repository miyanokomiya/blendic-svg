var e=Object.prototype.hasOwnProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.propertyIsEnumerable,n=Object.assign,r=(n,r)=>{var l={};for(var o in n)e.call(n,o)&&r.indexOf(o)<0&&(l[o]=n[o]);if(null!=n&&t)for(var o of t(n))r.indexOf(o)<0&&a.call(n,o)&&(l[o]=n[o]);return l};import{v as l,n as o,l as s,d as c,i as d,a as u,r as i,c as m,w as v,b as f,e as p,f as h,g as y,o as b,h as g,j as x,k,m as w,p as S,q as M,s as A,t as B,u as I,x as C,y as E,z as O,A as F,B as j,C as $,F as D,D as L,E as T,G as N,H as P,I as _,J as z,K,L as W,M as U,N as V}from"./vendor.6dea0f0f.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(a){const n=new URL(e,location),r=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((a,l)=>{const o=new URL(e,n);if(self[t].moduleMap[o])return a(self[t].moduleMap[o]);const s=new Blob([`import * as m from '${o}';`,`${t}.moduleMap['${o}']=m;`],{type:"text/javascript"}),c=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(s),onerror(){l(new Error(`Failed to import: ${e}`)),r(c)},onload(){a(self[t].moduleMap[o]),r(c)}});document.head.appendChild(c)})),self[t].moduleMap={}}}("/blendic-svg/assets/");function G(e,t){return e.reduce(((e,a)=>(e[a[t]]=a,e)),{})}function H(e,t){const a={};return e.forEach((e=>{a[e[t]]?a[e[t]].push(e):a[e[t]]=[e]})),a}function R(e,t){return Object.keys(e).reduce(((a,n)=>(a[n]=t(e[n]),a)),{})}function q(e={}){return n({translate:{x:0,y:0},origin:{x:0,y:0},rotate:0,scale:{x:1,y:1}},e)}function X(e={},t=!1){return n({id:t?l():"",name:"",transform:q(),parentId:"",connected:!1,head:{x:0,y:0},tail:{x:0,y:0}},e)}function Y(e={},t=!1){return n({id:t?l():"",name:"",transform:q(),borns:[]},e)}function J(e){return G(e,"id")}function Q(e){return G(e,"bornId")}function Z(e,t){return Object.keys(n(n({},e),t)).reduce(((a,r)=>{var l,o;return a[r]=n(n({},null!=(l=e[r])?l:{}),null!=(o=t[r])?o:{}),a}),{})}function ee(e,t){return Object.keys(t).reduce(((t,a)=>(t[a]=e[a],t)),{})}function te(e){return!!e&&(!!e.head||!!e.tail)}function ae(e){return[`translate(${e.translate.x},${e.translate.y})`,`rotate(${e.rotate})`,`scale(${e.scale.x},${e.scale.y})`].join(" ")}function ne(e,t=!1){if(0===e.length)return"";const[a,...n]=e;return`M${a.x},${a.y}`+n.map((e=>`L${e.x},${e.y}`)).join("")+(t?"z":"")}function re(e){return`${e.x} ${e.y} ${e.width} ${e.height}`}const le=/\.[0-9]{3,}$/;function oe(e){return le.test(e)?e.replace(le,(e=>"."+`${parseInt(e.slice(1),10)+1}`.padStart(3,"0"))):`${e}.001`}function se(e,t){const a=new Map(t.map((e=>[e,!0])));let n=oe(e);for(;a.has(n);)n=oe(n);return n}function ce(e){return e.reduce(((e,t)=>{return n=t,q({scale:{x:(a=e).scale.x*n.scale.x,y:a.scale.y*n.scale.y},rotate:a.rotate+n.rotate,translate:o(a.translate,n.translate)});var a,n}),q())}function de(e,t){return o(c(function(e,t,a={x:0,y:0}){return{x:a.x+(e.x-a.x)*t.x,y:a.y+(e.y-a.y)*t.y}}(e,t.scale,t.origin),t.rotate/180*Math.PI,t.origin),t.translate)}function ue(e,t,a){const r=a.head?de(e.head,t):e.head,l=a.tail?de(e.tail,t):e.tail;return n(n({},e),{head:r,tail:l})}function ie(e,t){const a=ce(t),r=de(e.head,q({translate:a.translate})),l=de(e.tail,q(n(n({},a),{origin:e.head})));return n(n({},e),{head:r,tail:l,transform:q()})}function me(e,t){return e.find((e=>e.id===t))}function ve(e,t,a,r=!1){const l=me(e.borns,t);if(!l)return{};let o={[t]:a};if(!r){if(a.head&&l.connected){const t=me(e.borns,l.parentId);t&&(o=n(n({},ve(e,t.id,{tail:!0},r)),o))}a.tail&&function(e,t,a=!1){return e.borns.filter((e=>e.parentId===t&&(!a||e.connected)))}(e,l.id,!0).forEach((e=>{o[e.id]={head:!0}}))}return o}function fe(e){return e.reduce(((t,a)=>{const n=me(e,a.parentId);return n?a.connected&&(t[a.id]={connected:s(n.tail,a.head)}):t[a.id]={connected:!1,parentId:""},t}),{})}function pe(e){const t=[],a=Object.keys(e).reduce(((a,n)=>{const r=e[n];return r.parentId?a[r.parentId]?a[r.parentId].push(r):a[r.parentId]=[r]:t.push(r),a}),{});return t.map((e=>n(n({},e),{children:he(a,e.id)})))}function he(e,t){var a,r;return null!=(r=null==(a=e[t])?void 0:a.map((t=>n(n({},t),{children:he(e,t.id)}))))?r:[]}function ye(e){return J(ge(function(e){return pe(e).map((e=>n(n({},e),{children:be(e)})))}(e)))}function be(e){var t;return null!=(t=e.children.map((t=>{const a=function(e,t){const a=o(t.head,t.transform.translate),r=de(a,n(n({},e.transform),{origin:e.head})),l=u(r,a);return n(n({},t),{transform:{translate:o(t.transform.translate,l),rotate:t.transform.rotate+e.transform.rotate,scale:{x:t.transform.scale.x*e.transform.scale.x,y:t.transform.scale.y*e.transform.scale.y},origin:{x:0,y:0}}})}(e,t);return n(n({},a),{children:be(n(n({},a),{children:t.children}))})})))?t:[]}function ge(e){return e.map((e=>{const{children:t}=e;return r(e,["children"])})).concat(e.flatMap((e=>ge(e.children))))}function xe(e,t){return J(ke(pe(e),t))}function ke(e,t){return e.flatMap((e=>{if(te(t[e.id])){const{children:t}=e;return[r(e,["children"])]}return ke(e.children,t)}))}function we(e,t,a){return e*(1-a)+t*a}function Se(e,t,a){return{x:we(e.x,t.x,a),y:we(e.y,t.y,a)}}const Me=i({undoStack:[],redoStack:[]}),Ae=m((()=>Me.undoStack.concat(Me.redoStack.concat().reverse()))),Be=m((()=>Me.undoStack.length-1));function Ie(){Me.undoStack=[],Me.redoStack=[]}function Ce(e){Me.undoStack.push(e),Me.redoStack=[]}function Ee(){const e=Me.undoStack.pop();e&&(e.undo(),Me.redoStack.push(e))}function Oe(){const e=Me.redoStack.pop();e&&(e.redo(),Me.undoStack.push(e))}function Fe(){return{state:Me,allStack:Ae,currentItemIndex:Be,clearHistory:Ie,push:Ce,undo:Ee,redo:Oe}}const je=Fe(),$e=i(Y({name:"armature",borns:[X({name:"born",head:{x:20,y:200},tail:{x:220,y:200}},!0)]},!0)),De=i({armatures:[$e],lastSelectedArmatureId:"",lastSelectedBornId:"",selectedArmatures:{},selectedBorns:{}}),Le=m((()=>De.armatures.findIndex((e=>e.id===De.lastSelectedArmatureId&&De.selectedArmatures[De.lastSelectedArmatureId])))),Te=m((()=>-1!==Le.value?De.armatures[Le.value]:void 0)),Ne=m((()=>Te.value?Te.value.borns.findIndex((e=>{var t,a;return e.id===De.lastSelectedBornId&&((null==(t=De.selectedBorns[De.lastSelectedBornId])?void 0:t.head)||(null==(a=De.selectedBorns[De.lastSelectedBornId])?void 0:a.tail))})):-1)),Pe=m((()=>{if(Te.value)return-1!==Ne.value?Te.value.borns[Ne.value]:void 0})),_e=m((()=>J(De.armatures))),ze=m((()=>{var e,t;return J(null!=(t=null==(e=Te.value)?void 0:e.borns)?t:[])})),Ke=m((()=>function(e,t){const a=Object.keys(t).map((a=>{const n=[],r=ie(e[a],[e[a].transform]);return t[a].head&&n.push(r.head),t[a].tail&&n.push(r.tail),n})).flat();return 0===a.length?{x:0,y:0}:d(a.reduce(((e,t)=>o(e,t)),{x:0,y:0}),1/a.length)}(ze.value,De.selectedBorns)));function We(){if(De.lastSelectedArmatureId)return;const e=De.armatures[0];e&&Ue(e.id)}function Ue(e=""){if(De.lastSelectedArmatureId===e)return;const t=tt(e);t.redo(),je.push(t)}function Ve(e){if(!Te.value)return;const t=function(e){const t=ee(Te.value,e);return{name:"Update Armature",undo:()=>{const e=Le.value;De.armatures[e]=n(n({},De.armatures[e]),t)},redo:()=>{const t=Le.value;De.armatures[t]=n(n({},De.armatures[t]),e)}}}({name:e});t.redo(),je.push(t)}function Ge(){const e=function(){const e=n({},Te.value),t=Le.value,a=tt("");return{name:"Delete Armature",undo:()=>{De.armatures.splice(t,0,e),a.undo()},redo:()=>{De.armatures.splice(t,1)}}}();e.redo(),je.push(e)}function He(){const e=function(e){const t=De.armatures.length,a=tt(e.id);return{name:"Add Armature",undo:()=>{De.armatures.splice(t,1),a.undo()},redo:()=>{De.armatures.push(e),a.redo()}}}(Y({name:se("armature",De.armatures.map((e=>e.name))),borns:[X({name:"born",tail:{x:100,y:0}},!0)]},!0));e.redo(),je.push(e)}function Re(){if(!Te.value)return;const e=function(){const e=n({},De.selectedBorns),t=De.lastSelectedBornId;return{name:"Select All Born",undo:()=>{De.selectedBorns=n({},e),De.lastSelectedBornId=t},redo:()=>{De.selectedBorns=Te.value?Te.value.borns.reduce(((e,t)=>(e[t.id]={head:!0,tail:!0},e)),{}):{}}}}();e.redo(),je.push(e)}function qe(e="",t={head:!0,tail:!0},a=!1,n=!1){if(!Te.value)return;if(De.lastSelectedBornId===e&&(r=De.selectedBorns[e],l=t,!!(null==r?void 0:r.head)==!!(null==l?void 0:l.head)&&!!(null==r?void 0:r.tail)==!!(null==l?void 0:l.tail)))return;var r,l;const o=at(e,t,a,n);o.redo(),je.push(o)}function Xe(){if(!Te.value)return;const e=function(){const e=Te.value.borns.concat(),t=Te.value.borns.filter((e=>!De.selectedBorns[e.id])),a=nt(fe(t)),n=at("");return{name:"Delete Born",undo:()=>{Te.value.borns=e.concat(),n.undo(),a.undo()},redo:()=>{Te.value.borns=t,a.redo()}}}();e.redo(),je.push(e)}function Ye(){Te.value&&Je([X({name:se("born",Te.value.borns.map((e=>e.name))),tail:{x:100,y:0}},!0)])}function Je(e,t){if(!Te.value)return;const a=function(e,t){const a=e.map(((e,a)=>at(e.id,t[e.id],0!==a)));return{name:"Add Born",undo:()=>{Te.value.borns=Te.value.borns.slice(0,Te.value.borns.length-e.length),a.forEach((e=>e.undo()))},redo:()=>{Te.value.borns=Te.value.borns.concat(e),a.forEach((e=>e.redo()))}}}(e,e.reduce(((e,a)=>(t&&(e[a.id]=n({},t)),e)),{}));a.redo(),je.push(a)}function Qe(e){if(!Te.value)return;const t=nt(e);t.redo(),je.push(t)}function Ze(e){if(!Te.value)return;if(!Pe.value)return;const t=function(e){const t=ee(Pe.value,e);return{name:"Update Born",undo:()=>{const e=Ne.value;Te.value.borns[e]=n(n({},Te.value.borns[e]),t)},redo:()=>{const t=Ne.value;Te.value.borns[t]=n(n({},Te.value.borns[t]),e)}}}(function(e,t){if(!t.connected)return t;const a=me(e,t.parentId);return n(n({},t),a?{head:a.tail}:{connected:!1,parentId:""})}(Te.value.borns,n(n({},Pe.value),e)));t.redo(),je.push(t)}function et(){return{state:De,lastSelectedArmature:Te,lastSelectedBorn:Pe,bornMap:ze,selectedBornsOrigin:Ke,selectAllArmature:We,selectArmature:Ue,updateArmatureName:Ve,deleteArmature:Ge,addArmature:He,selectAllBorn:Re,selectBorn:qe,deleteBorn:Xe,addBorn:Ye,addBorns:Je,updateBorns:Qe,updateBorn:Ze}}function tt(e){const t=n({},De.selectedArmatures),a=De.lastSelectedArmatureId;return{name:"Select Armature",undo:()=>{De.selectedArmatures=n({},t),De.lastSelectedArmatureId=a},redo:()=>{De.selectedArmatures=e?{[e]:!0}:{},De.lastSelectedArmatureId=e}}}function at(e,t={head:!0,tail:!0},a=!1,r=!1){const l=n({},De.selectedBorns),o=De.lastSelectedBornId;return{name:"Select Born",undo:()=>{De.selectedBorns=n({},l),De.lastSelectedBornId=o},redo:()=>{De.selectedBorns=e?Z(n(n({},a?De.selectedBorns:{}),{[e]:t}),ve(Te.value,e,t,r)):{},De.lastSelectedBornId=e}}}function nt(e){const t=Z(e,fe(Te.value.borns.map((t=>n(n({},t),e[t.id]))))),a=Object.keys(t).reduce(((e,a)=>(ze.value[a]&&(e[a]=ee(ze.value[a],t[a])),e)),{});return{name:"Update Born",undo:()=>{Te.value.borns=Te.value.borns.map((e=>n(n({},e),a[e.id])))},redo:()=>{Te.value.borns=Te.value.borns.map((e=>n(n({},e),t[e.id])))}}}v((()=>De.selectedArmatures),(()=>{De.selectedArmatures[De.lastSelectedArmatureId]||(De.lastSelectedArmatureId="")})),v((()=>_e.value),(()=>{De.selectedArmatures=Object.keys(De.selectedArmatures).reduce(((e,t)=>_e.value[t]?n(n({},e),{[t]:De.selectedArmatures[t]}):e),{})})),v((()=>De.selectedBorns),(()=>{if(!te(De.selectedBorns[De.lastSelectedBornId])){const e=Object.keys(De.selectedBorns);De.lastSelectedBornId=e.length>0?e[0]:""}})),v((()=>ze.value),(()=>{De.selectedBorns=Object.keys(De.selectedBorns).reduce(((e,t)=>ze.value[t]?n(n({},e),{[t]:De.selectedBorns[t]}):e),{})}));var rt=f({props:{origin:{type:Object,required:!0},current:{type:Object,required:!0},scale:{type:Number,required:!0},side:{type:Boolean,default:!1}},setup:e=>({rotate:m((()=>p(e.current,e.origin)/Math.PI*180))})});const lt={fill:"black",stroke:"black"},ot=y("circle",{r:"2"},null,-1),st=y("circle",{r:"2"},null,-1),ct=y("path",{d:"M-20,0L-10,-10L-10,10z"},null,-1),dt=y("path",{d:"M20,0L10,-10L10,10z"},null,-1);function ut(e){const t=i({command:"",editMovement:void 0}),a=et(),r=m((()=>a.state.selectedBorns)),l=m((()=>{var e;return null==(e=a.lastSelectedBorn.value)?void 0:e.id})),o=m((()=>a.lastSelectedArmature.value)),s=m((()=>!!l.value)),c=m((()=>{var e,t;return null!=(t=null==(e=o.value)?void 0:e.borns.map((e=>e.name)))?t:[]}));function v(){t.command="",t.editMovement=void 0}function f(e,t=!1){return n({},function(e,t=!1){const a=t?e.head:e.tail;return X({head:a,tail:a,parentId:t?e.parentId:e.id,connected:!t||e.connected},!0)}(e,t))}const h=m((()=>{if(!t.editMovement)return{};if("scale"===t.command){const n=a.selectedBornsOrigin.value,l=e.isOppositeSide(n,t.editMovement.start,t.editMovement.current),o=d(d({x:1,y:1},l?-1:1),g(t.editMovement.current,n)/g(t.editMovement.start,n)),s=e.snapScale(o);return Object.keys(r.value).reduce(((e,t)=>(e[t]=q({origin:n,scale:s}),e)),{})}if("rotate"===t.command){const e=a.selectedBornsOrigin.value,n=(p(t.editMovement.current,e)-p(t.editMovement.start,e))/Math.PI*180;return Object.keys(r.value).reduce(((t,a)=>(t[a]=q({origin:e,rotate:n}),t)),{})}const n=u(t.editMovement.current,t.editMovement.start),l=e.snapTranslate(n);return Object.keys(r.value).reduce(((e,t)=>(e[t]=q({translate:l}),e)),{})})),y=m((()=>Object.keys(h.value).reduce(((e,t)=>(e[t]=ue(a.bornMap.value[t],h.value[t],r.value[t]),e)),{})));function b(){o.value&&(a.updateBorns(y.value),t.editMovement=void 0,t.command="")}return{command:m((()=>t.command)),getEditTransforms:e=>h.value[e]||q(),end:()=>v(),cancel:v,setEditMode:function(e){if(o.value&&(v(),s.value&&(t.command=e,"extrude"===e))){const e={},t=c.value.concat(),n=[];Object.keys(r.value).forEach((l=>{const o=r.value[l],s=a.bornMap.value[l],c=[];o.tail&&c.push(f(s)),o.head&&c.push(f(s,!0)),c.forEach((a=>{e[a.parentId]||(a.name=se(s.name,t),n.push(a),t.push(a.name),e[a.parentId]=!0)}))})),a.addBorns(n,{tail:!0})}},select:function(e,n){t.command?b():a.selectBorn(e,n)},shiftSelect:function(e,n){t.command?b():a.selectBorn(e,n,!0)},selectAll:function(){t.command?b():a.selectAllBorn()},mousemove:function(e){t.command&&(t.editMovement=e)},clickAny:function(){t.command&&b()},clickEmpty:function(){t.command?b():a.selectBorn()},execDelete:function(){""===t.command&&a.deleteBorn()},execAdd:function(){""===t.command&&a.addBorn()}}}rt.render=function(e,t,a,n,r,l){return b(),h("g",lt,[y("g",{transform:`translate(${e.origin.x}, ${e.origin.y}) rotate(${e.rotate}) scale(${e.scale})`},[ot],8,["transform"]),y("line",{x1:e.origin.x,y1:e.origin.y,x2:e.current.x,y2:e.current.y,"stroke-width":e.scale,"stroke-dasharray":`${2*e.scale} ${2*e.scale}`},null,8,["x1","y1","x2","y2","stroke-width","stroke-dasharray"]),y("g",{transform:`translate(${e.current.x}, ${e.current.y}) rotate(${e.rotate}) scale(${e.scale})`},[st,y("g",{transform:`rotate(${e.side?90:0})`},[ct,dt],8,["transform"])],8,["transform"])])};const it=Fe();function mt(e,t){const a=n({},e.selectedMap),r=e.lastSelectedId;return{name:`Select ${e.label}`,undo:()=>{e.selectedMap=n({},a),e.lastSelectedId=r},redo:()=>{e.selectedMap=t?{[t]:!0}:{},e.lastSelectedId=t}}}function vt(e){return Math.round(function(e){return Math.round(Math.log(e)/Math.log(1.1))}(e)/2)+1}function ft(e,t,a){return R(function(e,t){return R(e,(e=>function(e,t){if(0===e.length)return[];const a=e.findIndex((e=>t<=e.frame));if(-1===a)return[e[e.length-1]];const n=e[a];if(n.frame===t||0===a)return[n];const r=e[a-1];return r.frame===t?[r]:[r,n]}(e,t)))}(e,t),(e=>function(e,t,a=(e=>e)){if(0===e.length)return q();if(1===e.length)return e[0].transform;const n=e[0],r=e[1],l=a((t-n.frame)/(r.frame-n.frame));return function(e,t,a){return q({scale:Se(e.scale,t.scale,a),rotate:we(e.rotate,t.rotate,a),translate:Se(e.translate,t.translate,a)})}(n.transform,r.transform,l)}(e,t,a)))}const pt=x(0),ht=x(60),yt=function(e){const t=i({label:e,list:[],lastSelectedId:"",selectedMap:{}}),a=m((()=>t.list.findIndex((e=>e.id===t.lastSelectedId&&t.selectedMap[t.lastSelectedId])))),r=m((()=>J(t.list))),l=m((()=>-1!==a.value?t.list[a.value]:void 0));return v((()=>t.selectedMap),(()=>{t.selectedMap[t.lastSelectedId]||(t.lastSelectedId="")})),v((()=>r.value),(()=>{t.selectedMap=Object.keys(t.selectedMap).reduce(((e,a)=>r.value[a]?n(n({},e),{[a]:t.selectedMap[a]}):e),{})})),{state:t,itemMap:r,lastSelectedItem:l,selectItem:function(e){if(t.lastSelectedId===e)return;const a=mt(t,e);a.redo(),it.push(a)},addItem:function(e){const a=function(e,t){const a=e.list.length,n=mt(e,t.id),r=()=>{e.list.push(t),n.redo()};return{name:`Add ${e.label}`,undo:()=>{e.list.splice(a,1),n.undo()},redo:r}}(t,e);a.redo(),it.push(a)},deleteItem:function(){if(-1===a.value)return;const e=function(e,t){const a=n({},e.list[t]),r=t,l=mt(e,""),o=()=>{e.list.splice(r,1)};return{name:`Delete ${e.label}`,undo:()=>{e.list.splice(r,0,a),l.undo()},redo:o}}(t,a.value);e.redo(),it.push(e)},updateItem:function(e){if(-1===a.value)return;const r=function(e,t,a){const r=ee(e.list[a],t),l=()=>{e.list[a]=n(n({},e.list[a]),t)};return{name:`Update ${e.label}`,undo:()=>{e.list[a]=n(n({},e.list[a]),r)},redo:l}}(t,e,a.value);r.redo(),it.push(r)}}}("Action"),bt=x({}),gt=Fe(),xt=et(),kt=m((()=>{var e,t;return H(null!=(t=null==(e=yt.lastSelectedItem.value)?void 0:e.keyframes)?t:[],"frame")})),wt=m((()=>{var e,t;return H(null!=(t=null==(e=yt.lastSelectedItem.value)?void 0:e.keyframes)?t:[],"bornId")})),St=m((()=>{var e,t,a,n;return a=null!=(t=null==(e=yt.lastSelectedItem.value)?void 0:e.keyframes)?t:[],n=pt.value,a.filter((e=>e.frame===n))})),Mt=m((()=>ft(wt.value,pt.value)));m((()=>Q(St.value)));const At=m((()=>Array.from(new Set(Object.keys(bt.value).concat(Object.keys(wt.value)))))),Bt=m((()=>At.value.reduce(((e,t)=>{var a,n;return e[t]=ce([(a=t,null!=(n=Mt.value[a])?n:q()),Lt(t)]),e}),{}))),It=m((()=>xt.lastSelectedArmature.value?ye(J(xt.lastSelectedArmature.value.borns.map((e=>n(n({},e),{transform:Tt(e.id)}))))):{})),Ct=m((()=>{return e=It.value,t=xt.state.selectedBorns,J(Object.keys(e).filter((e=>te(t[e]))).map((t=>e[t])));var e,t})),Et=m((()=>xe(It.value,xt.state.selectedBorns))),Ot=m((()=>xt.lastSelectedArmature.value?function(e){const t=Object.keys(e).map((t=>ie(e[t],[e[t].transform]).head));return 0===t.length?{x:0,y:0}:d(t.reduce(((e,t)=>o(e,t)),{x:0,y:0}),1/t.length)}(Et.value):{x:0,y:0}));function Ft(){xt.lastSelectedArmature.value&&yt.addItem(function(e={},t=!1){return n({id:t?l():"",name:"",totalFrame:60,armatureId:"",keyframes:[]},e)}({name:se("action",yt.state.list.map((e=>e.name))),armatureId:xt.lastSelectedArmature.value.id},!0))}function jt(e){if(ht.value===e)return;const t=function(e){const t=ht.value;return{name:"Update End Frame",undo:()=>{ht.value=t},redo:()=>{ht.value=e}}}(e);t.redo(),gt.push(t)}function $t(e){const t=function(e){const t=n({},bt.value);return{name:"Update Pose",undo:()=>{bt.value=t},redo:()=>{bt.value=e}}}(e);t.redo(),gt.push(t)}function Dt(e){$t(Array.from(new Set(Object.keys(bt.value).concat(Object.keys(e)))).reduce(((t,a)=>{var n;return t[a]=ce([Lt(a),null!=(n=e[a])?n:q()]),t}),{}))}function Lt(e){var t;return null!=(t=bt.value[e])?t:q()}function Tt(e){var t;return null!=(t=Bt.value[e])?t:q()}function Nt(){if(!yt.lastSelectedItem.value)return;const e=function(e){const t=Q(e),a=pt.value,r=n({},bt.value),l=yt.lastSelectedItem.value.keyframes.filter((e=>e.frame===a&&t[e.bornId]));return{name:"Insert Keyframe",undo:()=>{const e=yt.lastSelectedItem.value.keyframes.filter((e=>!(e.frame===a&&t[e.bornId]))).concat(l);pt.value=a,yt.lastSelectedItem.value.keyframes=e,bt.value=r},redo:()=>{const n=yt.lastSelectedItem.value.keyframes.filter((e=>!(e.frame===a&&t[e.bornId]))).concat(e);var r,l;pt.value=a,yt.lastSelectedItem.value.keyframes=n,bt.value=(r=bt.value,l=t,Object.keys(r).reduce(((e,t)=>(t in l||(e[t]=r[t]),e)),{}))}}}(Object.keys(Ct.value).map((e=>function(e={},t=!1){return n({id:t?l():"",frame:0,bornId:"",transform:q()},e)}({frame:pt.value,bornId:e,transform:Tt(e)},!0))));e.redo(),gt.push(e)}function Pt(e){pt.value=e,bt.value={}}function _t(){return{currentFrame:pt,endFrame:ht,actions:yt.state.list,keyframeMapByFrame:kt,keyframeMapByBornId:wt,posedBornIds:At,currentPosedBorns:It,selectedAllBorns:Ct,selectedBorns:Et,selectedPosedBornOrigin:Ot,getCurrentSelfTransforms:Tt,setEndFrame:jt,selectedAction:yt.lastSelectedItem,selectAction:yt.selectItem,addAction:Ft,deleteAction:yt.deleteItem,updateAction:e=>yt.updateItem(e),applyEditedTransforms:Dt,execInsertKeyframe:Nt,setCurrentFrame:Pt}}const zt=Fe(),Kt=i({canvasMode:"object",pastCanvasMode:"edit",axisGrid:""}),Wt=m((()=>"edit"===Kt.canvasMode?ut(Zt()):"pose"===Kt.canvasMode?function(e){const t=i({command:"",editMovement:void 0}),a=et(),n=_t(),r=m((()=>{var e;return null==(e=a.lastSelectedBorn.value)?void 0:e.id})),l=m((()=>a.lastSelectedArmature.value)),o=m((()=>!!r.value));function s(){t.command="",t.editMovement=void 0}function d(e,t){const a=n.currentPosedBorns.value[t],r=n.currentPosedBorns.value[a.parentId];return r?c(e,-r.transform.rotate/180*Math.PI):e}const v=m((()=>{if(!t.editMovement)return{};if("rotate"===t.command){const e=n.selectedPosedBornOrigin.value,a=(p(t.editMovement.current,e)-p(t.editMovement.start,e))/Math.PI*180;return Object.keys(n.selectedBorns.value).reduce(((e,t)=>(e[t]=q({rotate:a}),e)),{})}const a=u(t.editMovement.current,t.editMovement.start),r=e.snapTranslate(a);return Object.keys(n.selectedBorns.value).reduce(((e,t)=>(n.selectedBorns.value[t].connected||(e[t]=q({translate:d(r,t)})),e)),{})}));function f(){l.value&&(n.applyEditedTransforms(v.value),t.editMovement=void 0,t.command="")}return{command:m((()=>t.command)),getEditTransforms(e){var t;return null!=(t=v.value[e])?t:q()},end:()=>s(),cancel:s,setEditMode:function(e){l.value&&(s(),o.value&&(t.command=e))},select:function(e,n){t.command?f():a.selectBorn(e,n,!1,!0)},shiftSelect:function(e,n){t.command?f():a.selectBorn(e,n,!0,!0)},selectAll:function(){t.command?f():a.selectAllBorn()},mousemove:function(e){t.command&&(t.editMovement=e)},clickAny:function(){t.command&&f()},clickEmpty:function(){t.command?f():a.selectBorn()},execDelete:()=>{},execAdd:()=>{}}}(Zt()):function(){const e=i({command:"",editMovement:void 0}),t=et(),a=m((()=>t.lastSelectedArmature.value));function n(){e.command="",e.editMovement=void 0}const r=m((()=>({})));function l(){a.value&&(e.editMovement=void 0,e.command="")}return{command:m((()=>e.command)),getEditTransforms:e=>r.value[e]||q(),end:()=>n(),cancel:n,setEditMode:function(t){a.value&&(n(),e.command=t)},select:function(a,n){e.command?l():t.selectBorn(a,n)},shiftSelect:function(a,n){e.command?l():t.selectBorn(a,n,!0)},selectAll:function(){e.command?l():t.selectAllArmature()},mousemove:function(t){e.command&&(e.editMovement=t)},clickAny:function(){e.command&&l()},clickEmpty:function(){e.command?l():t.selectArmature()},execDelete:function(){""===e.command&&t.deleteArmature()},execAdd:function(){""===e.command&&t.addArmature()}}}()));v(Wt,((e,t)=>{t&&t.end()}));const Ut=m((()=>Wt.value.command.value));function Vt(){"edit"===Kt.canvasMode?Ht(Kt.pastCanvasMode):Ht("edit")}function Gt(){"edit"===Kt.canvasMode?"object"===Kt.pastCanvasMode?Ht("pose"):Ht("object"):"object"===Kt.canvasMode?Ht("pose"):Ht("object")}function Ht(e){const t=function(e){const t=Kt.canvasMode,a=Kt.pastCanvasMode;return{name:"Change Mode",undo:()=>{Kt.canvasMode=t,Kt.pastCanvasMode=a},redo:()=>{Kt.pastCanvasMode=Kt.canvasMode,Kt.canvasMode=e}}}(e);zt.push(t),t.redo()}function Rt(e){Kt.axisGrid=e}function qt(e){Kt.axisGrid=Kt.axisGrid===e?"":e}function Xt(e){return{x:"y"===Kt.axisGrid?1:e.x,y:"x"===Kt.axisGrid?1:e.y}}function Yt(e){return{x:"y"===Kt.axisGrid?0:e.x,y:"x"===Kt.axisGrid?0:e.y}}function Jt(e,t,a){return k(u(t,e),u(a,e))<0}function Qt(e){return Wt.value.getEditTransforms(e)}function Zt(){return{state:Kt,command:Ut,toggleCanvasMode:Vt,ctrlToggleCanvasMode:Gt,setCanvasMode:Ht,setAxisGrid:Rt,switchAxisGrid:qt,snapScale:Xt,snapTranslate:Yt,isOppositeSide:Jt,getEditTransforms:Qt,mousemove:e=>Wt.value.mousemove(e),clickAny:()=>Wt.value.clickAny(),clickEmpty:()=>Wt.value.clickEmpty(),cancel:()=>Wt.value.cancel(),setEditMode:e=>Wt.value.setEditMode(e),execDelete:()=>Wt.value.execDelete(),execAdd:()=>Wt.value.execAdd(),select:(e,t)=>Wt.value.select(e,t),shiftSelect:(e,t)=>Wt.value.shiftSelect(e,t),selectAll:()=>Wt.value.selectAll()}}const ea=i({size:{width:100,height:100}});function ta(){return{state:ea}}window.addEventListener("resize",(()=>{ea.size={width:window.innerWidth,height:window.innerHeight}}));var aa=f({components:{ScaleMarker:rt},props:{originalViewBox:{type:Object,default:()=>({x:0,y:0,width:600,height:400})},currentCommand:{type:String,default:""}},emits:["mousemove","click-any","click-empty","escape","tab","ctrl-tab","g","s","r","e","x","y","a","shift-a","i"],setup(e,{emit:t}){const a=i({width:600,height:400}),r=x(),l=x(),s=x(),c=x(),f=x(1),p=x({x:0,y:0}),h=x(),y=et(),b=Zt(),g=_t();function k(e){return o(p.value,d(e,f.value))}const A=m((()=>"edit"===b.state.canvasMode?y.selectedBornsOrigin.value:g.selectedPosedBornOrigin.value)),B=m((()=>({x:p.value.x,y:p.value.y,width:a.width*f.value,height:a.height*f.value}))),I=m((()=>re(B.value))),C=m((()=>M(n({x:0,y:0},a)))),E=m((()=>{if(""!==b.state.axisGrid&&s.value)return function(e,t,a,r){return n(n({},{strokeWidth:e}),"x"===t?{from:{x:a.x,y:r.y},to:{x:a.x+a.width,y:r.y},stroke:"red"}:{from:{x:r.x,y:a.y},to:{x:r.x,y:a.y+a.height},stroke:"green"})}(f.value,b.state.axisGrid,B.value,A.value)})),O=m((()=>{if(c.value&&["scale","rotate"].includes(e.currentCommand))return{origin:A.value,current:k(c.value),side:"rotate"===e.currentCommand}}));function F(){if(!l.value)return;const e=l.value.getBoundingClientRect();a.width=e.width,a.height=e.height}v((()=>e.currentCommand),(e=>{b.setAxisGrid(""),""===e&&(s.value=void 0)}));const j=ta();return w(F),v((()=>j.state.size),F),{scale:f,viewSize:a,svg:r,wrapper:l,viewBox:I,gridLineElm:E,scaleNaviElm:O,canvasMode:m((()=>b.state.canvasMode)),focus(){r.value&&r.value.focus()},wheel(e){const t=c.value?c.value:C.value,a=k(t);f.value=f.value*Math.pow(1.1,e.deltaY>0?1:-1);const n=k(t);p.value=o(p.value,u(a,n))},downMiddle(){c.value&&(h.value={origin:n({},p.value),downAt:n({},c.value)})},upMiddle(){h.value=void 0},leave(){h.value=void 0},mousemove:e=>{if(c.value=S(e),h.value)p.value=o(h.value.origin,d(u(h.value.downAt,c.value),f.value));else{if(!s.value)return;t("mousemove",{current:k(c.value),start:k(s.value)})}},clickAny(e){e.target===r.value?(s.value=void 0,t("click-empty")):t("click-any")},keyDownTab:()=>{t("tab")},keyDownCtrlTab:()=>t("ctrl-tab"),keyDownEscape:()=>{t("escape")},editKeyDown(a){c.value&&(!["grab","scale"].includes(e.currentCommand)||"x"!==a&&"y"!==a?(s.value=c.value,t(a)):b.switchAxisGrid(a))}}}});const na=F("data-v-7afb009e");j("data-v-7afb009e");const ra={ref:"wrapper",class:"app-canvas-root"},la={class:"help"};$();const oa=na(((e,t,a,n,r,l)=>{const o=A("ScaleMarker");return b(),h("div",ra,[(b(),h("svg",{ref:"svg",tabindex:"-1",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"none","font-family":"sans-serif",viewBox:e.viewBox,width:e.viewSize.width,height:e.viewSize.height,onWheel:t[1]||(t[1]=B(((...t)=>e.wheel&&e.wheel(...t)),["prevent"])),onClick:t[2]||(t[2]=B(((...t)=>e.clickAny&&e.clickAny(...t)),["left"])),onContextmenu:t[3]||(t[3]=B(((...t)=>e.keyDownEscape&&e.keyDownEscape(...t)),["right","prevent"])),onMouseenter:t[4]||(t[4]=(...t)=>e.focus&&e.focus(...t)),onMousemove:t[5]||(t[5]=B(((...t)=>e.mousemove&&e.mousemove(...t)),["prevent"])),onMousedown:t[6]||(t[6]=B(((...t)=>e.downMiddle&&e.downMiddle(...t)),["middle","prevent"])),onMouseup:t[7]||(t[7]=B(((...t)=>e.upMiddle&&e.upMiddle(...t)),["middle","prevent"])),onMouseleave:t[8]||(t[8]=(...t)=>e.leave&&e.leave(...t)),onKeydown:[t[9]||(t[9]=I(B(((...t)=>e.keyDownEscape&&e.keyDownEscape(...t)),["exact","prevent"]),["escape"])),t[10]||(t[10]=I(B(((...t)=>e.keyDownTab&&e.keyDownTab(...t)),["exact","prevent"]),["tab"])),t[11]||(t[11]=I(B(((...t)=>e.keyDownCtrlTab&&e.keyDownCtrlTab(...t)),["shift","exact","prevent"]),["tab"])),t[12]||(t[12]=I(B((t=>e.editKeyDown("g")),["exact","prevent"]),["g"])),t[13]||(t[13]=I(B((t=>e.editKeyDown("s")),["exact","prevent"]),["s"])),t[14]||(t[14]=I(B((t=>e.editKeyDown("r")),["exact","prevent"]),["r"])),t[15]||(t[15]=I(B((t=>e.editKeyDown("e")),["exact","prevent"]),["e"])),t[16]||(t[16]=I(B((t=>e.editKeyDown("x")),["exact","prevent"]),["x"])),t[17]||(t[17]=I(B((t=>e.editKeyDown("y")),["exact","prevent"]),["y"])),t[18]||(t[18]=I(B((t=>e.editKeyDown("a")),["exact","prevent"]),["a"])),t[19]||(t[19]=I(B((t=>e.editKeyDown("shift-a")),["shift","exact","prevent"]),["a"])),t[20]||(t[20]=I(B((t=>e.editKeyDown("i")),["exact","prevent"]),["i"]))]},[y("rect",{x:e.originalViewBox.x,y:e.originalViewBox.y,width:e.originalViewBox.width,height:e.originalViewBox.height,fill:"none",stroke:"black","stroke-width":"1","stroke-dasharray":"4 4"},null,8,["x","y","width","height"]),e.gridLineElm?(b(),h("line",{key:0,x1:e.gridLineElm.from.x,y1:e.gridLineElm.from.y,x2:e.gridLineElm.to.x,y2:e.gridLineElm.to.y,stroke:e.gridLineElm.stroke,"stroke-width":e.gridLineElm.strokeWidth},null,8,["x1","y1","x2","y2","stroke","stroke-width"])):C("",!0),E(e.$slots,"default"),e.scaleNaviElm?(b(),h(o,{key:1,origin:e.scaleNaviElm.origin,current:e.scaleNaviElm.current,scale:e.scale,side:e.scaleNaviElm.side},null,8,["origin","current","scale","side"])):C("",!0)],40,["viewBox","width","height"])),y("div",la,[y("p",null,"Mode: "+O(e.canvasMode),1)])],512)}));aa.render=oa,aa.__scopeId="data-v-7afb009e";var sa=f({props:{tabs:{type:Array,default:()=>[]}},setup(e){var t,a;const n=x(null!=(a=null==(t=e.tabs[0])?void 0:t.key)?a:"");return{current:n,setTab:e=>n.value=e}}});const ca=F("data-v-16db2673");j("data-v-16db2673");const da={class:"tab-panel-root"},ua={class:"panels"};$();const ia=ca(((e,t,a,n,r,l)=>(b(),h("div",da,[y("ul",null,[(b(!0),h(D,null,L(e.tabs,(t=>(b(),h("li",{key:t.key,class:{current:t.key===e.current}},[y("a",{href:"#",onClick:B((a=>e.setTab(t.key)),["prevent"])},O(t.label),9,["onClick"])],2)))),128))]),y("div",ua,[(b(!0),h(D,null,L(e.tabs,(t=>T((b(),h("div",{key:t.key},[E(e.$slots,t.key)],512)),[[N,t.key===e.current]]))),128))])]))));sa.render=ia,sa.__scopeId="data-v-16db2673";var ma=f({setup(){const e=Fe();return{allStack:m((()=>e.allStack.value)),currentItemIndex:m((()=>e.currentItemIndex.value))}}});const va=F("data-v-65f8ee82");j("data-v-65f8ee82");const fa=y("h3",null,"history",-1);$();const pa=va(((e,t,a,n,r,l)=>(b(),h("div",null,[fa,y("ul",null,[(b(!0),h(D,null,L(e.allStack,((t,a)=>(b(),h("li",{key:a,class:{current:a===e.currentItemIndex}},O(t.name),3)))),128))])]))));ma.render=pa,ma.__scopeId="data-v-65f8ee82";var ha=f({props:{options:{type:Array,default:()=>[]},modelValue:{type:[Number,String],default:""}},emits:["update:modelValue"],setup:(e,{emit:t})=>({value:m({get:()=>e.modelValue,set(e){t("update:modelValue",e)}})})});const ya=F("data-v-fddf1844");j("data-v-fddf1844");const ba={class:"select-root"},ga=y("option",{value:""},"-- None --",-1);$();const xa=ya(((e,t,a,n,r,l)=>(b(),h("span",ba,[T(y("select",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.value=t)},[ga,(b(!0),h(D,null,L(e.options,(e=>(b(),h("option",{key:e.value,value:e.value},O(e.label),9,["value"])))),128))],512),[[P,e.value]])]))));ha.render=xa,ha.__scopeId="data-v-fddf1844";var ka=f({components:{TabPanel:sa,HistoryStack:ma,SelectField:ha},setup(){const e=et(),t=x(""),a=m((()=>e.lastSelectedArmature.value?e.lastSelectedArmature.value.borns.filter((t=>{var a;return t.id!==(null==(a=e.lastSelectedBorn.value)?void 0:a.id)})).map((e=>({value:e.id,label:e.name}))):[])),n=m((()=>e.lastSelectedBorn.value?"born":e.lastSelectedArmature.value?"armature":""));function r(){e.lastSelectedBorn.value?t.value=e.lastSelectedBorn.value.name:e.lastSelectedArmature.value?t.value=e.lastSelectedArmature.value.name:t.value=""}return v(e.lastSelectedArmature,r),v(e.lastSelectedBorn,r),{draftName:t,lastSelectedArmature:e.lastSelectedArmature,lastSelectedBorn:e.lastSelectedBorn,parentOptions:a,selectedObjectType:n,connected:m({get(){var t,a;return null!=(a=null==(t=e.lastSelectedBorn.value)?void 0:t.connected)&&a},set(t){e.updateBorn({connected:t})}}),parentId:m({get(){var t,a;return null!=(a=null==(t=e.lastSelectedBorn.value)?void 0:t.parentId)?a:""},set(t){e.updateBorn({parentId:t})}}),changeArmatureName(){t.value&&e.updateArmatureName(t.value)},changeBornName(){t.value&&e.updateBorn({name:t.value})}}}});const wa=F("data-v-a1a2983c");j("data-v-a1a2983c");const Sa=y("h3",null,"Armature",-1),Ma={class:"field inline"},Aa=y("label",null,"Name",-1),Ba=y("h3",null,"Born",-1),Ia={class:"field inline"},Ca=y("label",null,"Name",-1),Ea={class:"field inline"},Oa=y("label",null,"Parent",-1),Fa={class:"field inline"},ja=y("label",null,"Connect",-1);$();const $a=wa(((e,t,a,n,r,l)=>{const o=A("SelectField"),s=A("HistoryStack"),c=A("TabPanel");return b(),h("div",null,[y(c,{tabs:[{key:"detail",label:"Detail"},{key:"history",label:"History"}]},{detail:wa((()=>["armature"===e.selectedObjectType?(b(),h("form",{key:0,onSubmit:t[3]||(t[3]=B((()=>{}),["prevent"]))},[Sa,y("div",Ma,[Aa,T(y("input",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.draftName=t),type:"text",onChange:t[2]||(t[2]=(...t)=>e.changeArmatureName&&e.changeArmatureName(...t))},null,544),[[_,e.draftName]])])],32)):C("",!0),"born"===e.selectedObjectType?(b(),h("form",{key:1,onSubmit:t[8]||(t[8]=B((()=>{}),["prevent"]))},[Ba,y("div",Ia,[Ca,T(y("input",{"onUpdate:modelValue":t[4]||(t[4]=t=>e.draftName=t),type:"text",onChange:t[5]||(t[5]=(...t)=>e.changeBornName&&e.changeBornName(...t))},null,544),[[_,e.draftName]])]),y("div",Ea,[Oa,y(o,{modelValue:e.parentId,"onUpdate:modelValue":t[6]||(t[6]=t=>e.parentId=t),options:e.parentOptions},null,8,["modelValue","options"])]),y("div",Fa,[ja,T(y("input",{"onUpdate:modelValue":t[7]||(t[7]=t=>e.connected=t),type:"checkbox",disabled:!e.parentId},null,8,["disabled"]),[[z,e.connected]])])],32)):C("",!0)])),history:wa((()=>[y(s)])),_:1})])}));ka.render=$a,ka.__scopeId="data-v-a1a2983c";var Da=f({emits:["down-left","up-left","mousemove","drag","click-any","click-empty","escape","g","x"],setup(e,{emit:t}){const a=x(),r=x(),l=function(e={}){const t=i({width:600,height:100}),a=x(),r=x(),l=x(1),s=x({x:0,y:0}),c=x(),v=x(),f=m((()=>({x:s.value.x,y:s.value.y,width:t.width*l.value,height:t.height*l.value}))),p=m((()=>M(n({x:0,y:0},t)))),h=m((()=>re(f.value)));function y(e){return o(s.value,d(e,l.value))}return{viewSize:t,editStartPoint:a,mousePoint:r,scale:l,viewOrigin:s,dragInfo:v,viewMovingInfo:c,viewCenter:p,viewBox:h,viewToCanvas:y,wheel(t,a=!1){var n,c;const d=!a&&r.value?r.value:p.value,i=y(d);l.value=Math.min(Math.max(l.value*Math.pow(1.1,t.deltaY>0?1:-1),null!=(n=e.scaleMin)?n:0),null!=(c=e.scaleMax)?c:10);const m=y(d);s.value=o(s.value,u(i,m))},downLeft(){r.value&&(v.value={})},upLeft(){v.value=void 0},downMiddle(){r.value&&(c.value={origin:n({},s.value),downAt:n({},r.value)})},upMiddle(){c.value=void 0},leave(){c.value=void 0},viewMove(){c.value&&r.value&&(s.value=o(c.value.origin,d(u(c.value.downAt,r.value),l.value)))}}}({scaleMin:1});function s(){if(!r.value)return;const e=r.value.getBoundingClientRect();l.viewSize.width=e.width,l.viewSize.height=e.height}const c=ta();return w(s),v((()=>c.state.size),s),{scale:l.scale,viewOrigin:l.viewOrigin,viewSize:m((()=>l.viewSize)),wrapper:r,svg:a,viewBox:l.viewBox,focus(){a.value&&a.value.focus()},wheel:e=>l.wheel(e,!0),downLeft:()=>{l.mousePoint.value&&(l.downLeft(),t("down-left",l.viewToCanvas(l.mousePoint.value)))},upLeft:()=>{l.upLeft(),t("up-left")},downMiddle:l.downMiddle,upMiddle:l.upMiddle,leave:l.leave,mousemove:e=>{l.mousePoint.value=S(e),l.dragInfo.value?t("drag",l.viewToCanvas(l.mousePoint.value)):l.viewMovingInfo.value?l.viewMove():l.editStartPoint.value&&t("mousemove",{current:l.viewToCanvas(l.mousePoint.value),start:l.viewToCanvas(l.editStartPoint.value)})},clickAny(e){e.target===a.value?(l.editStartPoint.value=void 0,t("click-empty")):t("click-any")},keyDownEscape:()=>{t("escape")},editKeyDown(e){l.mousePoint.value&&(l.editStartPoint.value=l.mousePoint.value,t(e))}}}});const La=F("data-v-5868f1c8");j("data-v-5868f1c8");const Ta={ref:"wrapper",class:"timeline-canvas-root"};$();const Na=La(((e,t,a,n,r,l)=>(b(),h("div",Ta,[(b(),h("svg",{ref:"svg",tabindex:"-1",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"none","font-family":"sans-serif",viewBox:e.viewBox,width:e.viewSize.width,height:e.viewSize.height,onWheel:t[1]||(t[1]=B(((...t)=>e.wheel&&e.wheel(...t)),["prevent"])),onClick:t[2]||(t[2]=B(((...t)=>e.clickAny&&e.clickAny(...t)),["left"])),onContextmenu:t[3]||(t[3]=B(((...t)=>e.keyDownEscape&&e.keyDownEscape(...t)),["right","prevent"])),onMouseenter:t[4]||(t[4]=(...t)=>e.focus&&e.focus(...t)),onMousedown:[t[5]||(t[5]=B(((...t)=>e.downLeft&&e.downLeft(...t)),["left","prevent"])),t[8]||(t[8]=B(((...t)=>e.downMiddle&&e.downMiddle(...t)),["middle","prevent"]))],onMouseup:[t[6]||(t[6]=B(((...t)=>e.upLeft&&e.upLeft(...t)),["left","prevent"])),t[9]||(t[9]=B(((...t)=>e.upMiddle&&e.upMiddle(...t)),["middle","prevent"]))],onMousemove:t[7]||(t[7]=B(((...t)=>e.mousemove&&e.mousemove(...t)),["prevent"])),onMouseleave:t[10]||(t[10]=(...t)=>e.leave&&e.leave(...t)),onKeydown:[t[11]||(t[11]=I(B(((...t)=>e.keyDownEscape&&e.keyDownEscape(...t)),["exact","prevent"]),["escape"])),t[12]||(t[12]=I(B((t=>e.editKeyDown("g")),["exact","prevent"]),["g"])),t[13]||(t[13]=I(B((t=>e.editKeyDown("x")),["exact","prevent"]),["x"]))]},[E(e.$slots,"default",{scale:e.scale,viewOrigin:e.viewOrigin,viewSize:e.viewSize})],40,["viewBox","width","height"]))],512))));Da.render=Na,Da.__scopeId="data-v-5868f1c8";var Pa=f({props:{labelWidth:{type:Number,default:100},index:{type:Number,required:!0},label:{type:String,required:!0}},setup:()=>({height:24})});Pa.render=function(e,t,a,n,r,l){return b(),h("g",{transform:`translate(0, ${e.index*e.height})`},[y("rect",{width:e.labelWidth,height:e.height,fill:"#fff",stroke:"black"},null,8,["width","height"]),y("text",{x:"4",y:e.height/2,"dominant-baseline":"central"},O(e.label),9,["y"])],8,["transform"])};var _a=f({props:{scale:{type:Number,default:1},originX:{type:Number,default:0},viewWidth:{type:Number,default:100},currentFrame:{type:Number,default:0},endFrame:{type:Number,default:60}},emits:["down-current-frame","up-current-frame"],setup(e,{emit:t}){const a=m((()=>vt(e.scale))),n=m((()=>function(e,t){const a=Math.floor(Math.max(t,0)/20);return a-a%(2*e)}(a.value,e.originX))),r=m((()=>Math.ceil(e.viewWidth*e.scale/20))),l=m((()=>Math.floor(r.value/a.value))),o=m((()=>[...Array(l.value)].map(((e,t)=>{const r=t*a.value+n.value;return{f:r,labelSize:r%10==0?14:r%2==0?11:0,strokeWidth:r%10==0?2:1}})))),s=m((()=>20*e.currentFrame)),c=m((()=>10*Math.max(e.currentFrame.toString().length,2)+2));return{headerHeight:24,frames:o,frameWidth:20,currentFrameX:s,endFrameX:m((()=>20*e.endFrame)),currentFrameLabelWidth:c,downCurrentFrame:()=>t("down-current-frame")}}});const za=F("data-v-87cba9d8");j("data-v-87cba9d8");const Ka={class:"view-only"},Wa={fill:"#aaa",stroke:"none","fill-opacity":"0.5"},Ua=y("g",{transform:"scale(-1, 1)"},[y("rect",{width:"200000",height:"200000"})],-1),Va=y("rect",{width:"200000",height:"200000"},null,-1);$();const Ga=za(((e,t,a,n,r,l)=>(b(),h("g",null,[y("g",{transform:`scale(${e.scale})`,onMousedown:t[1]||(t[1]=B(((...t)=>e.downCurrentFrame&&e.downCurrentFrame(...t)),["left"]))},[y("rect",{x:"-100000",width:"200000",height:e.headerHeight,fill:"#fff",stroke:"#000"},null,8,["height"])],40,["transform"]),y("g",Ka,[y("g",null,[(b(!0),h(D,null,L(e.frames,(t=>(b(),h("g",{key:t,transform:`translate(${t.f*e.frameWidth}, 0)`},[y("g",{transform:`scale(${e.scale})`},[t.labelSize>0?(b(),h("text",{key:0,y:e.headerHeight-4,"font-size":t.labelSize,"dominant-baseline":"text-after-edge","text-anchor":"middle"},O(t.f),9,["y","font-size"])):C("",!0),t.strokeWidth>0?(b(),h("line",{key:1,x1:"0",y1:e.headerHeight,x2:"0",y2:"20000",stroke:"#aaa","stroke-width":t.strokeWidth},null,8,["y1","stroke-width"])):C("",!0)],8,["transform"])],8,["transform"])))),128))]),y("g",Wa,[Ua,y("g",{transform:`translate(${e.endFrameX}, 0)`},[Va],8,["transform"])]),y("g",{transform:`translate(${e.currentFrameX}, 0) scale(${e.scale})`},[y("rect",{x:-e.currentFrameLabelWidth/2,y:2,width:e.currentFrameLabelWidth,height:20,rx:"4",ry:"4",fill:"blue",stroke:"none"},null,8,["x","width"]),y("text",{y:e.headerHeight-4,"font-size":"12","dominant-baseline":"text-after-edge","text-anchor":"middle",fill:"#fff"},O(e.currentFrame),9,["y"]),y("line",{x1:"0",y1:e.headerHeight,x2:"0",y2:"20000",stroke:"blue","stroke-width":"2"},null,8,["y1"])],8,["transform"])])]))));_a.render=Ga,_a.__scopeId="data-v-87cba9d8";var Ha=f({props:{scale:{type:Number,default:1},keyframeMapByFrame:{type:Object,default:0},bornIds:{type:Array,default:()=>[]}},emits:[],setup(e){const t=m((()=>e.bornIds.reduce(((e,t,a)=>(e[t]=a,e)),{}))),a=m((()=>Object.keys(e.keyframeMapByFrame).reduce(((a,n)=>(a[n]=e.keyframeMapByFrame[n].filter((e=>t.value[e.bornId]>-1)).sort(((e,a)=>t.value[e.bornId]-t.value[a.bornId])),a)),{})));return{headerHeight:24,frameWidth:20,bornIndexMap:t,sortedKeyframeMapByFrame:a}}});const Ra=F("data-v-e402282e");j("data-v-e402282e");const qa={class:"view-only"},Xa={key:"all",r:"4",stroke:"#000",fill:"#fff"};$();const Ya=Ra(((e,t,a,n,r,l)=>(b(),h("g",null,[y("g",qa,[y("g",null,[(b(!0),h(D,null,L(e.sortedKeyframeMapByFrame,((t,a)=>(b(),h("g",{key:a,transform:`translate(${parseInt(a)*e.frameWidth}, 0)`},[y("g",{transform:`scale(${e.scale}) translate(0, 36)`},[t.length>0?(b(),h("circle",Xa)):C("",!0),(b(!0),h(D,null,L(t,((e,t)=>(b(),h("circle",{key:e.bornId,cy:24*(t+1),r:"4",stroke:"#000",fill:"#fff"},null,8,["cy"])))),128))],8,["transform"])],8,["transform"])))),128))])])]))));Ha.render=Ya,Ha.__scopeId="data-v-e402282e";var Ja=f({components:{SelectField:ha,TimelineCanvas:Da,TimelineRow:Pa,TimelineAxis:_a,Keyframes:Ha},setup(){const e=et(),t=_t(),a=x(""),n=x(""),r=x(""),l=m((()=>t.selectedAction.value)),o=m((()=>{return e=t.selectedAllBorns.value,Object.keys(e).map((t=>e[t]));var e})),s=m((()=>o.value.map((e=>e.id)))),c=m((()=>t.keyframeMapByFrame.value)),d=m((()=>t.actions.map((t=>{var a;const n=(null==(a=e.lastSelectedArmature.value)?void 0:a.id)!==t.armatureId;return{value:t.id,label:`${n?"(x)":""} ${t.name}`}}))));function u(e){var n;"move-current-frame"===a.value&&t.setCurrentFrame((n=e.x-140-20,Math.round(Math.max(n,0)/20)))}return K((()=>{var e,t;n.value=null!=(t=null==(e=l.value)?void 0:e.name)?t:""})),K((()=>{r.value=t.endFrame.value.toString()})),{actions:t.actions,selectedAllBornList:o,selectedAllBornIdList:s,keyframeMapByFrame:c,draftName:n,draftEndFrame:r,labelWidth:140,axisPadding:20,currentFrame:t.currentFrame,endFrame:t.endFrame,changeActionName:()=>{n.value&&t.updateAction({name:n.value})},changeEndFrame:()=>{const e=parseInt(r.value,10);!isNaN(e)&&e>=0?t.setEndFrame(e):r.value=t.endFrame.value.toString()},addAction:t.addAction,deleteAction:t.deleteAction,actionOptions:d,selectedActionId:m({get:()=>{var e,t;return null!=(t=null==(e=l.value)?void 0:e.id)?t:""},set:e=>t.selectAction(e)}),downCurrentFrame:function(){a.value="move-current-frame"},downLeft:function(e){u(e)},drag:u,upLeft:function(){a.value=""}}}});const Qa=F("data-v-3b7d27ce");j("data-v-3b7d27ce");const Za={class:"animation-panel-root"},en={class:"top"},tn={class:"select-action"},an={class:"end-frame-field"},nn=W("End: "),rn={class:"middle"};$();const ln=Qa(((e,t,a,n,r,l)=>{const o=A("SelectField"),s=A("TimelineAxis"),c=A("Keyframes"),d=A("TimelineRow"),u=A("TimelineCanvas");return b(),h("div",Za,[y("div",en,[y("div",tn,[y(o,{modelValue:e.selectedActionId,"onUpdate:modelValue":t[1]||(t[1]=t=>e.selectedActionId=t),options:e.actionOptions},null,8,["modelValue","options"])]),T(y("input",{"onUpdate:modelValue":t[2]||(t[2]=t=>e.draftName=t),type:"text",onChange:t[3]||(t[3]=(...t)=>e.changeActionName&&e.changeActionName(...t))},null,544),[[_,e.draftName]]),y("button",{class:"add-action",onClick:t[4]||(t[4]=(...t)=>e.addAction&&e.addAction(...t))},"+"),y("button",{class:"delete-action",onClick:t[5]||(t[5]=(...t)=>e.deleteAction&&e.deleteAction(...t))},"x"),y("label",an,[nn,T(y("input",{"onUpdate:modelValue":t[6]||(t[6]=t=>e.draftEndFrame=t),type:"number",onChange:t[7]||(t[7]=(...t)=>e.changeEndFrame&&e.changeEndFrame(...t))},null,544),[[_,e.draftEndFrame]])])]),y("div",rn,[y(u,{onUpLeft:e.upLeft,onDrag:e.drag,onDownLeft:e.downLeft},{default:Qa((({scale:t,viewOrigin:a,viewSize:n})=>[y("g",{transform:`translate(${e.labelWidth+e.axisPadding}, ${a.y})`},[y(s,{scale:t,"origin-x":a.x,"view-width":n.width,"current-frame":e.currentFrame,"end-frame":e.endFrame,onDownCurrentFrame:e.downCurrentFrame},null,8,["scale","origin-x","view-width","current-frame","end-frame","onDownCurrentFrame"]),y(c,{scale:t,"keyframe-map-by-frame":e.keyframeMapByFrame,"born-ids":e.selectedAllBornIdList},null,8,["scale","keyframe-map-by-frame","born-ids"])],8,["transform"]),y("g",{transform:`translate(${a.x}, ${a.y}) scale(${t})`},[y("g",null,[y("rect",{width:e.labelWidth,height:"10000",stroke:"none",fill:"#fff"},null,8,["width"]),y("line",{x1:e.labelWidth,y1:"0",x2:e.labelWidth,y2:"10000",stroke:"black"},null,8,["x1","x2"]),y(d,{index:1,"label-width":e.labelWidth,label:"Summary"},null,8,["label-width"]),(b(!0),h(D,null,L(e.selectedAllBornList,((t,a)=>(b(),h(d,{key:t.id,index:a+2,"label-width":e.labelWidth,label:t.name},null,8,["index","label-width","label"])))),128))])],8,["transform"])])),_:1},8,["onUpLeft","onDrag","onDownLeft"])])])}));Ja.render=ln,Ja.__scopeId="data-v-3b7d27ce";const on=i({selectedColor:"orange"});function sn(e,t,a=!1){return o(e,c(d(u(t,e),.15),Math.PI/4*(a?-1:1)))}var cn=f({props:{born:{type:Object,required:!0},parent:{type:Object,default:void 0},opacity:{type:Number,default:1},selectedState:{type:Object,default:()=>({head:!1,tail:!1})},poseMode:{type:Boolean,default:!1}},emits:["select","shift-select"],setup(e,{emit:t}){const{settings:a}={settings:on},r=m((()=>e.born.head)),l=m((()=>e.born.tail)),o=m((()=>sn(r.value,l.value))),s=m((()=>sn(r.value,l.value,!0))),c=m((()=>e.poseMode?e.selectedState.head||e.selectedState.tail:e.selectedState.head&&e.selectedState.tail));return{transform:m((()=>ae(e.born.transform))),head:r,tail:l,headPath:m((()=>ne([r.value,o.value,s.value],!0))),tailPath:m((()=>ne([l.value,o.value,s.value],!0))),fill:m((()=>c.value?a.selectedColor:"#ddd")),fillDark:m((()=>c.value?a.selectedColor:"#bbb")),fillHead:m((()=>e.selectedState.head?a.selectedColor:"")),fillTail:m((()=>e.selectedState.tail?a.selectedColor:"")),click:a=>{e.poseMode?c.value?t("select",{head:!1,tail:!1}):t("select",{head:!0,tail:!0}):t("select",a)},shiftClick:a=>{e.poseMode||a.head&&a.tail?c.value?t("shift-select",{head:!1,tail:!1}):t("shift-select",{head:!0,tail:!0}):a.head?t("shift-select",n(n({},e.selectedState),{head:!e.selectedState.head})):a.tail&&t("shift-select",n(n({},e.selectedState),{tail:!e.selectedState.tail}))}}}});const dn=F("data-v-13fd028e")(((e,t,a,n,r,l)=>(b(),h("g",{stroke:"black",fill:e.fill,transform:e.transform,opacity:e.opacity},[y("g",{onClick:[t[1]||(t[1]=B((t=>e.click({head:!0,tail:!0})),["exact"])),t[2]||(t[2]=B((t=>e.shiftClick({head:!0,tail:!0})),["shift","exact"]))]},[y("path",{d:e.headPath,fill:e.fillDark},null,8,["d","fill"]),y("path",{d:e.tailPath},null,8,["d"])]),y("circle",{r:"10",cx:e.head.x,cy:e.head.y,fill:e.fillHead,onClick:[t[3]||(t[3]=B((t=>e.click({head:!0,tail:!1})),["exact"])),t[4]||(t[4]=B((t=>e.shiftClick({head:!0,tail:!1})),["shift","exact"]))]},null,8,["cx","cy","fill"]),y("circle",{r:"10",cx:e.tail.x,cy:e.tail.y,fill:e.fillTail,onClick:[t[5]||(t[5]=B((t=>e.click({head:!1,tail:!0})),["exact"])),t[6]||(t[6]=B((t=>e.shiftClick({head:!1,tail:!0})),["shift","exact"]))]},null,8,["cx","cy","fill"]),e.parent?(b(),h("line",{key:0,x1:e.parent.tail.x,y1:e.parent.tail.y,x2:e.head.x,y2:e.head.y,"stroke-dasharray":"2 2",class:"view-only"},null,8,["x1","y1","x2","y2"])):C("",!0),y("text",{x:(e.head.x+e.tail.x)/2,y:(e.head.y+e.tail.y)/2,"text-anchor":"middle",fill:"black",stroke:"none",class:"view-only"},O(e.born.name),9,["x","y"])],8,["fill","transform","opacity"]))));cn.render=dn,cn.__scopeId="data-v-13fd028e";var un=f({components:{BornElm:cn},props:{armature:{type:Object,required:!0},opacity:{type:Number,default:.8},selected:{type:Boolean,default:!1}},emits:["select","shift-select"],setup:(e,{emit:t})=>({bornMap:m((()=>J(e.armature.borns))),transform:m((()=>ae(e.armature.transform))),bornSelectedState:m((()=>e.selected?{head:!0,tail:!0}:void 0)),click:()=>t("select",!e.selected),shiftClick:()=>t("shift-select",!e.selected)})});const mn=F("data-v-e1a73d3c")(((e,t,a,n,r,l)=>{const o=A("BornElm");return b(),h("g",{stroke:"black",transform:e.transform,opacity:e.opacity},[(b(!0),h(D,null,L(e.armature.borns,(t=>(b(),h(o,{key:t.name,born:t,"selected-state":e.bornSelectedState,parent:e.bornMap[t.parentId],onSelect:e.click,onShiftSelect:e.shiftClick},null,8,["born","selected-state","parent","onSelect","onShiftSelect"])))),128))],8,["transform","opacity"])}));un.render=mn,un.__scopeId="data-v-e1a73d3c";var vn=f({components:{AppCanvas:aa,ArmatureElm:un,BornElm:cn,SidePanel:ka,AnimationPanel:Ja},setup(){const e=et(),t=Zt(),a=_t(),r=Fe(),l=m((()=>t.state.canvasMode)),o=m((()=>e.lastSelectedArmature.value)),s=m((()=>e.state.armatures.filter((t=>{var a;return t.id!==(null==(a=e.lastSelectedArmature.value)?void 0:a.id)})))),c=m((()=>{if(!o.value)return{};if("edit"===l.value)return J(o.value.borns.map((a=>ue(a,t.getEditTransforms(a.id),e.state.selectedBorns[a.id]||[]))));{const e=ye(J(o.value.borns.map((e=>n(n({},e),{transform:ce([a.getCurrentSelfTransforms(e.id),t.getEditTransforms(e.id)])})))));return Object.keys(e).reduce(((t,a)=>{const n=e[a];return t[a]=ie(n,[n.transform]),t}),{})}})),d=m((()=>{return"grab"===(e=t.command.value)||"extrude"===e?"grab":"rotate"===e?"rotate":"scale"===e?"scale":"";var e}));function u(e){var t;["input","textarea"].includes(null==(t=e.target)?void 0:t.tagName.toLowerCase())||e.ctrlKey&&"z"===e.key.toLowerCase()&&(e.preventDefault(),e.shiftKey?r.redo():r.undo())}return w((()=>{document.addEventListener("keydown",u)})),U((()=>{document.removeEventListener("keydown",u)})),{armatures:m((()=>e.state.armatures)),otherArmatures:s,lastSelectedArmatureId:m((()=>{var t;return null==(t=e.lastSelectedArmature.value)?void 0:t.id})),visibledBornMap:c,selectedBorns:m((()=>e.state.selectedBorns)),canvasMode:l,canvasCommand:d,mousemove(e){t.mousemove(e)},clickAny(){t.clickAny()},clickEmpty(){t.clickEmpty()},selectBorn(e,a){t.select(e,a)},shiftSelectBorn(e,a){t.shiftSelect(e,a)},selectArmature(t,a){e.selectArmature(a?t:"")},shiftSelectArmature(t,a){e.selectArmature(a?t:"")},escape(){t.cancel()},toggleCanvasMode(){e.lastSelectedArmature.value&&t.toggleCanvasMode()},ctrlToggleCanvasMode(){e.lastSelectedArmature.value&&t.ctrlToggleCanvasMode()},setEditMode(e){t.setEditMode(e)},execDelete(){t.execDelete()},selectAll(){t.selectAll()},addItem(){t.execAdd()},saveKeyframe(){a.execInsertKeyframe()}}}});const fn=F("data-v-aaea8cfe");j("data-v-aaea8cfe");const pn={class:"main"},hn={key:0},yn={key:1},bn={key:2},gn={class:"bottom"};$();const xn=fn(((e,t,a,n,r,l)=>{const o=A("ArmatureElm"),s=A("BornElm"),c=A("AppCanvas"),d=A("SidePanel"),u=A("AnimationPanel");return b(),h("div",null,[y("div",pn,[y(c,{"current-command":e.canvasCommand,class:"canvas",onMousemove:e.mousemove,onClickAny:e.clickAny,onClickEmpty:e.clickEmpty,onEscape:e.escape,onTab:e.toggleCanvasMode,onCtrlTab:e.ctrlToggleCanvasMode,onG:t[1]||(t[1]=t=>e.setEditMode("grab")),onS:t[2]||(t[2]=t=>e.setEditMode("scale")),onR:t[3]||(t[3]=t=>e.setEditMode("rotate")),onE:t[4]||(t[4]=t=>e.setEditMode("extrude")),onX:e.execDelete,onA:e.selectAll,onShiftA:e.addItem,onI:e.saveKeyframe},{default:fn((()=>["object"===e.canvasMode?(b(),h("g",hn,[(b(!0),h(D,null,L(e.armatures,(t=>(b(),h(o,{key:t.id,armature:t,selected:e.lastSelectedArmatureId===t.id,onSelect:a=>e.selectArmature(t.id,a),onShiftSelect:a=>e.shiftSelectArmature(t.id,a)},null,8,["armature","selected","onSelect","onShiftSelect"])))),128))])):C("",!0),"edit"===e.canvasMode?(b(),h("g",yn,[(b(!0),h(D,null,L(e.otherArmatures,(e=>(b(),h(o,{key:e.id,armature:e,opacity:.3},null,8,["armature","opacity"])))),128)),(b(!0),h(D,null,L(e.visibledBornMap,(t=>(b(),h(s,{key:t.id,born:t,parent:e.visibledBornMap[t.parentId],"selected-state":e.selectedBorns[t.id],onSelect:a=>e.selectBorn(t.id,a),onShiftSelect:a=>e.shiftSelectBorn(t.id,a)},null,8,["born","parent","selected-state","onSelect","onShiftSelect"])))),128))])):C("",!0),"pose"===e.canvasMode?(b(),h("g",bn,[(b(!0),h(D,null,L(e.otherArmatures,(e=>(b(),h(o,{key:e.id,armature:e,opacity:.3},null,8,["armature","opacity"])))),128)),(b(!0),h(D,null,L(e.visibledBornMap,(t=>(b(),h(s,{key:t.id,born:t,parent:e.visibledBornMap[t.parentId],"selected-state":e.selectedBorns[t.id],"pose-mode":"",onSelect:a=>e.selectBorn(t.id,a),onShiftSelect:a=>e.shiftSelectBorn(t.id,a)},null,8,["born","parent","selected-state","onSelect","onShiftSelect"])))),128))])):C("",!0)])),_:1},8,["current-command","onMousemove","onClickAny","onClickEmpty","onEscape","onTab","onCtrlTab","onX","onA","onShiftA","onI"]),y(d,{class:"side-panel"})]),y("div",gn,[y(u)])])}));vn.render=xn,vn.__scopeId="data-v-aaea8cfe",V(vn).mount("#app");
