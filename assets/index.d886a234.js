var e=Object.assign;import{v as t,n as a,l as n,d as r,i as l,r as o,c as d,w as s,a as c,b as i,e as u,f as v,o as m,g as f,h as p,j as h,k as y,m as g,p as b,q as x,s as w,t as k,u as S,x as M,y as A,z as B,A as I,B as C,C as E,F as O,D as $,E as D,G as T,H as F,I as L,J as j,K as N,L as P,M as z,N as _}from"./vendor.cdf2ab5c.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(a){const n=new URL(e,location),r=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((a,l)=>{const o=new URL(e,n);if(self[t].moduleMap[o])return a(self[t].moduleMap[o]);const d=new Blob([`import * as m from '${o}';`,`${t}.moduleMap['${o}']=m;`],{type:"text/javascript"}),s=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(d),onerror(){l(new Error(`Failed to import: ${e}`)),r(s)},onload(){a(self[t].moduleMap[o]),r(s)}});document.head.appendChild(s)})),self[t].moduleMap={}}}("/blendic-svg/assets/");function W(e){return[`translate(${e.translate.x},${e.translate.y})`,`rotate(${e.rotate})`,`scale(${e.scale.x},${e.scale.y})`].join(" ")}function U(e,t=!1){if(0===e.length)return"";const[a,...n]=e;return`M${a.x},${a.y}`+n.map((e=>`L${e.x},${e.y}`)).join("")+(t?"z":"")}function V(e){return`${e.x} ${e.y} ${e.width} ${e.height}`}const G=/\.[0-9]{3,}$/;function K(e){return G.test(e)?e.replace(G,(e=>"."+`${parseInt(e.slice(1),10)+1}`.padStart(3,"0"))):`${e}.001`}function H(e,t){const a=new Map(t.map((e=>[e,!0])));let n=K(e);for(;a.has(n);)n=K(n);return n}function R(t={}){return e({translate:{x:0,y:0},origin:{x:0,y:0},rotate:0,scale:{x:1,y:1}},t)}function q(a={},n=!1){return e({id:n?t():"",name:"",transform:R(),parentId:"",connected:!1,head:{x:0,y:0},tail:{x:0,y:0}},a)}function X(a={},n=!1){return e({id:n?t():"",name:"",transform:R(),borns:[]},a)}function Y(t){return t.reduce(((t,a)=>e(e({},t),{[a.id]:a})),{})}function J(t,a){return Object.keys(e(e({},t),a)).reduce(((n,r)=>{var l,o;return n[r]=e(e({},null!=(l=t[r])?l:{}),null!=(o=a[r])?o:{}),n}),{})}function Q(e,t){return Object.keys(t).reduce(((t,a)=>(t[a]=e[a],t)),{})}function Z(e){return!!e&&(!!e.head||!!e.tail)}function ee(e){return e.reduce(((e,t)=>{return r=t,R({scale:{x:(n=e).scale.x*r.scale.x,y:n.scale.y*r.scale.y},rotate:n.rotate+r.rotate,translate:a(n.translate,r.translate)});var n,r}),R())}function te(e,t){return a(r(function(e,t,a={x:0,y:0}){return{x:a.x+(e.x-a.x)*t.x,y:a.y+(e.y-a.y)*t.y}}(e,t.scale,t.origin),t.rotate/180*Math.PI,t.origin),t.translate)}function ae(t,a,n){const r=n.head?te(t.head,a):t.head,l=n.tail?te(t.tail,a):t.tail;return e(e({},t),{head:r,tail:l})}function ne(t,a){const n=ee(a),r=te(t.head,R({translate:n.translate})),l=te(t.tail,R(e(e({},n),{origin:t.head})));return e(e({},t),{head:r,tail:l})}function re(e,t){return e.find((e=>e.id===t))}function le(t,a,n,r=!1){const l=re(t.borns,a);if(!l)return{};let o={[a]:n};if(!r){if(n.head&&l.connected){const a=re(t.borns,l.parentId);a&&(o=e(e({},le(t,a.id,{tail:!0},r)),o))}n.tail&&function(e,t,a=!1){return e.borns.filter((e=>e.parentId===t&&(!a||e.connected)))}(t,l.id,!0).forEach((e=>{o[e.id]={head:!0}}))}return o}function oe(e){return e.reduce(((t,a)=>{const r=re(e,a.parentId);return r?a.connected&&(t[a.id]={connected:n(r.tail,a.head)}):t[a.id]={connected:!1,parentId:""},t}),{})}function de(e,t,n=!1){const r=Object.keys(t).map((a=>{const r=[],l=ne(e[a],[e[a].transform]);return t[a].head&&r.push(l.head),!n&&t[a].tail&&r.push(l.tail),r})).flat();return 0===r.length?{x:0,y:0}:l(r.reduce(((e,t)=>a(e,t)),{x:0,y:0}),1/r.length)}const se=o({undoStack:[],redoStack:[]}),ce=d((()=>se.undoStack.concat(se.redoStack.concat().reverse()))),ie=d((()=>se.undoStack.length-1));function ue(){se.undoStack=[],se.redoStack=[]}function ve(e){se.undoStack.push(e),se.redoStack=[]}function me(){const e=se.undoStack.pop();e&&(e.undo(),se.redoStack.push(e))}function fe(){const e=se.redoStack.pop();e&&(e.redo(),se.undoStack.push(e))}function pe(){return{state:se,allStack:ce,currentItemIndex:ie,clearHistory:ue,push:ve,undo:me,redo:fe}}const he=pe(),ye=o(X({name:"armature",borns:[q({name:"born",head:{x:20,y:200},tail:{x:220,y:200}},!0)]},!0)),ge=o({armatures:[ye],lastSelectedArmatureId:"",lastSelectedBornId:"",selectedArmatures:{},selectedBorns:{}}),be=d((()=>ge.armatures.findIndex((e=>e.id===ge.lastSelectedArmatureId&&ge.selectedArmatures[ge.lastSelectedArmatureId])))),xe=d((()=>-1!==be.value?ge.armatures[be.value]:void 0)),we=d((()=>xe.value?xe.value.borns.findIndex((e=>{var t,a;return e.id===ge.lastSelectedBornId&&((null==(t=ge.selectedBorns[ge.lastSelectedBornId])?void 0:t.head)||(null==(a=ge.selectedBorns[ge.lastSelectedBornId])?void 0:a.tail))})):-1)),ke=d((()=>{if(xe.value)return-1!==we.value?xe.value.borns[we.value]:void 0})),Se=d((()=>Y(ge.armatures))),Me=d((()=>{var e,t;return Y(null!=(t=null==(e=xe.value)?void 0:e.borns)?t:[])})),Ae=d((()=>de(Me.value,ge.selectedBorns))),Be=d((()=>de(Me.value,ge.selectedBorns,!0)));function Ie(e=""){if(ge.lastSelectedArmatureId===e)return;const t=Pe(e);t.redo(),he.push(t)}function Ce(t){if(!xe.value)return;const a=function(t){const a=Q(xe.value,t);return{name:"Update Armature",undo:()=>{const t=be.value;ge.armatures[t]=e(e({},ge.armatures[t]),a)},redo:()=>{const a=be.value;ge.armatures[a]=e(e({},ge.armatures[a]),t)}}}({name:t});a.redo(),he.push(a)}function Ee(){const t=function(){const t=e({},xe.value),a=be.value,n=Pe("");return{name:"Delete Armature",undo:()=>{ge.armatures.splice(a,0,t),n.undo()},redo:()=>{ge.armatures.splice(a,1)}}}();t.redo(),he.push(t)}function Oe(){const e=function(e){const t=ge.armatures.length,a=Pe(e.id);return{name:"Add Armature",undo:()=>{ge.armatures.splice(t,1),a.undo()},redo:()=>{ge.armatures.push(e),a.redo()}}}(X({name:H("armature",ge.armatures.map((e=>e.name))),borns:[q({name:"born",tail:{x:100,y:0}},!0)]},!0));e.redo(),he.push(e)}function $e(e="",t={head:!0,tail:!0},a=!1,n=!1){if(!xe.value)return;if(ge.lastSelectedBornId===e&&(r=ge.selectedBorns[e],l=t,!!(null==r?void 0:r.head)==!!(null==l?void 0:l.head)&&!!(null==r?void 0:r.tail)==!!(null==l?void 0:l.tail)))return;var r,l;const o=ze(e,t,a,n);o.redo(),he.push(o)}function De(){if(!xe.value)return;const e=function(){const e=xe.value.borns.concat(),t=xe.value.borns.filter((e=>!ge.selectedBorns[e.id])),a=_e(oe(t)),n=ze("");return{name:"Delete Born",undo:()=>{xe.value.borns=e.concat(),n.undo(),a.undo()},redo:()=>{xe.value.borns=t,a.redo()}}}();e.redo(),he.push(e)}function Te(){xe.value&&Fe([q({name:H("born",xe.value.borns.map((e=>e.name))),tail:{x:100,y:0}},!0)])}function Fe(t,a){if(!xe.value)return;const n=function(e,t){const a=e.map(((e,a)=>ze(e.id,t[e.id],0!==a)));return{name:"Add Born",undo:()=>{xe.value.borns=xe.value.borns.slice(0,xe.value.borns.length-e.length),a.forEach((e=>e.undo()))},redo:()=>{xe.value.borns=xe.value.borns.concat(e),a.forEach((e=>e.redo()))}}}(t,t.reduce(((t,n)=>(a&&(t[n.id]=e({},a)),t)),{}));n.redo(),he.push(n)}function Le(e){if(!xe.value)return;const t=_e(e);t.redo(),he.push(t)}function je(t){if(!xe.value)return;if(!ke.value)return;const a=function(t){const a=Q(ke.value,t);return{name:"Update Born",undo:()=>{const t=we.value;xe.value.borns[t]=e(e({},xe.value.borns[t]),a)},redo:()=>{const a=we.value;xe.value.borns[a]=e(e({},xe.value.borns[a]),t)}}}(function(t,a){if(!a.connected)return a;const n=re(t,a.parentId);return e(e({},a),n?{head:n.tail}:{connected:!1,parentId:""})}(xe.value.borns,e(e({},ke.value),t)));a.redo(),he.push(a)}function Ne(){return{state:ge,lastSelectedArmature:xe,lastSelectedBorn:ke,bornMap:Me,selectedBornsOrigin:Ae,selectedPoseBornsOrigin:Be,selectArmature:Ie,updateArmatureName:Ce,deleteArmature:Ee,addArmature:Oe,selectBorn:$e,deleteBorn:De,addBorn:Te,addBorns:Fe,updateBorns:Le,updateBorn:je}}function Pe(t){const a=e({},ge.selectedArmatures),n=ge.lastSelectedArmatureId;return{name:"Select Armature",undo:()=>{ge.selectedArmatures=e({},a),ge.lastSelectedArmatureId=n},redo:()=>{ge.selectedArmatures=t?{[t]:!0}:{},ge.lastSelectedArmatureId=t}}}function ze(t,a={head:!0,tail:!0},n=!1,r=!1){const l=e({},ge.selectedBorns),o=ge.lastSelectedBornId;return{name:"Select Born",undo:()=>{ge.selectedBorns=e({},l),ge.lastSelectedBornId=o},redo:()=>{ge.selectedBorns=t?J(e(e({},n?ge.selectedBorns:{}),{[t]:a}),le(xe.value,t,a,r)):{},ge.lastSelectedBornId=t}}}function _e(t){const a=J(t,oe(xe.value.borns.map((a=>e(e({},a),t[a.id]))))),n=Object.keys(a).reduce(((e,t)=>(Me.value[t]&&(e[t]=Q(Me.value[t],a[t])),e)),{});return{name:"Update Born",undo:()=>{xe.value.borns=xe.value.borns.map((t=>e(e({},t),n[t.id])))},redo:()=>{xe.value.borns=xe.value.borns.map((t=>e(e({},t),a[t.id])))}}}s((()=>ge.selectedArmatures),(()=>{ge.selectedArmatures[ge.lastSelectedArmatureId]||(ge.lastSelectedArmatureId="")})),s((()=>Se.value),(()=>{ge.selectedArmatures=Object.keys(ge.selectedArmatures).reduce(((t,a)=>Se.value[a]?e(e({},t),{[a]:ge.selectedArmatures[a]}):t),{})})),s((()=>ge.selectedBorns),(()=>{if(!Z(ge.selectedBorns[ge.lastSelectedBornId])){const e=Object.keys(ge.selectedBorns);ge.lastSelectedBornId=e.length>0?e[0]:""}})),s((()=>Me.value),(()=>{ge.selectedBorns=Object.keys(ge.selectedBorns).reduce(((t,a)=>Me.value[a]?e(e({},t),{[a]:ge.selectedBorns[a]}):t),{})}));var We=c({props:{origin:{type:Object,required:!0},current:{type:Object,required:!0},scale:{type:Number,required:!0},side:{type:Boolean,default:!1}},setup:e=>({rotate:d((()=>i(e.current,e.origin)/Math.PI*180))})});const Ue={fill:"black",stroke:"black"},Ve=v("circle",{r:"2"},null,-1),Ge=v("circle",{r:"2"},null,-1),Ke=v("path",{d:"M-20,0L-10,-10L-10,10z"},null,-1),He=v("path",{d:"M20,0L10,-10L10,10z"},null,-1);function Re(t){const a=o({command:"",editMovement:void 0}),n=Ne(),r=d((()=>n.state.selectedBorns)),s=d((()=>{var e;return null==(e=n.lastSelectedBorn.value)?void 0:e.id})),c=d((()=>n.lastSelectedArmature.value)),u=d((()=>!!s.value)),v=d((()=>{var e,t;return null!=(t=null==(e=c.value)?void 0:e.borns.map((e=>e.name)))?t:[]}));function m(){a.command="",a.editMovement=void 0}function h(t,a=!1){return e({},function(e,t=!1){const a=t?e.head:e.tail;return q({head:a,tail:a,parentId:t?e.parentId:e.id,connected:!t||e.connected},!0)}(t,a))}const y=d((()=>{if(!a.editMovement)return{};if("scale"===a.command){const e=n.selectedBornsOrigin.value,o=t.isOppositeSide(e,a.editMovement.start,a.editMovement.current),d=l(l({x:1,y:1},o?-1:1),f(a.editMovement.current,e)/f(a.editMovement.start,e)),s=t.snapScale(d);return Object.keys(r.value).reduce(((t,a)=>(t[a]=R({origin:e,scale:s}),t)),{})}if("rotate"===a.command){const e=n.selectedBornsOrigin.value,t=(i(a.editMovement.current,e)-i(a.editMovement.start,e))/Math.PI*180;return Object.keys(r.value).reduce(((a,n)=>(a[n]=R({origin:e,rotate:t}),a)),{})}const e=p(a.editMovement.current,a.editMovement.start),o=t.snapTranslate(e);return Object.keys(r.value).reduce(((e,t)=>(e[t]=R({translate:o}),e)),{})})),g=d((()=>Object.keys(y.value).reduce(((e,t)=>(e[t]=ae(n.bornMap.value[t],y.value[t],r.value[t]),e)),{})));function b(){c.value&&(n.updateBorns(g.value),a.editMovement=void 0,a.command="")}return{command:d((()=>a.command)),getEditTransforms:e=>y.value[e]||R(),end:()=>m(),cancel:m,setEditMode:function(e){if(c.value&&(m(),u.value&&(a.command=e,"extrude"===e))){const e={},t=v.value.concat(),a=[];Object.keys(r.value).forEach((l=>{const o=r.value[l],d=n.bornMap.value[l],s=[];o.tail&&s.push(h(d)),o.head&&s.push(h(d,!0)),s.forEach((n=>{e[n.parentId]||(n.name=H(d.name,t),a.push(n),t.push(n.name),e[n.parentId]=!0)}))})),n.addBorns(a,{tail:!0})}},select:function(e,t){a.command?b():n.selectBorn(e,t)},shiftSelect:function(e,t){a.command?b():n.selectBorn(e,t,!0)},mousemove:function(e){a.command&&(a.editMovement=e)},clickAny:function(){a.command&&b()},clickEmpty:function(){a.command?b():n.selectBorn()},execDelete:function(){""===a.command&&n.deleteBorn()},execAdd:function(){""===a.command&&n.addBorn()}}}We.render=function(e,t,a,n,r,l){return m(),u("g",Ue,[v("g",{transform:`translate(${e.origin.x}, ${e.origin.y}) rotate(${e.rotate}) scale(${e.scale})`},[Ve],8,["transform"]),v("line",{x1:e.origin.x,y1:e.origin.y,x2:e.current.x,y2:e.current.y,"stroke-width":e.scale,"stroke-dasharray":`${2*e.scale} ${2*e.scale}`},null,8,["x1","y1","x2","y2","stroke-width","stroke-dasharray"]),v("g",{transform:`translate(${e.current.x}, ${e.current.y}) rotate(${e.rotate}) scale(${e.scale})`},[Ge,v("g",{transform:`rotate(${e.side?90:0})`},[Ke,He],8,["transform"])],8,["transform"])])};const qe=pe();function Xe(t,a){const n=e({},t.selectedMap),r=t.lastSelectedId;return{name:`Select ${t.label}`,undo:()=>{t.selectedMap=e({},n),t.lastSelectedId=r},redo:()=>{t.selectedMap=a?{[a]:!0}:{},t.lastSelectedId=a}}}const Ye=h(0),Je=h(60),Qe=function(t){const a=o({label:t,list:[],lastSelectedId:"",selectedMap:{}}),n=d((()=>a.list.findIndex((e=>e.id===a.lastSelectedId&&a.selectedMap[a.lastSelectedId])))),r=d((()=>Y(a.list))),l=d((()=>-1!==n.value?a.list[n.value]:void 0));return s((()=>a.selectedMap),(()=>{a.selectedMap[a.lastSelectedId]||(a.lastSelectedId="")})),s((()=>r.value),(()=>{a.selectedMap=Object.keys(a.selectedMap).reduce(((t,n)=>r.value[n]?e(e({},t),{[n]:a.selectedMap[n]}):t),{})})),{state:a,itemMap:r,lastSelectedItem:l,selectItem:function(e){if(a.lastSelectedId===e)return;const t=Xe(a,e);t.redo(),qe.push(t)},addItem:function(e){const t=function(e,t){const a=e.list.length,n=Xe(e,t.id),r=()=>{e.list.push(t),n.redo()};return{name:`Add ${e.label}`,undo:()=>{e.list.splice(a,1),n.undo()},redo:r}}(a,e);t.redo(),qe.push(t)},deleteItem:function(){if(-1===n.value)return;const t=function(t,a){const n=e({},t.list[a]),r=a,l=Xe(t,""),o=()=>{t.list.splice(r,1)};return{name:`Delete ${t.label}`,undo:()=>{t.list.splice(r,0,n),l.undo()},redo:o}}(a,n.value);t.redo(),qe.push(t)},updateItem:function(t){if(-1===n.value)return;const r=function(t,a,n){const r=Q(t.list[n],a),l=()=>{t.list[n]=e(e({},t.list[n]),a)};return{name:`Update ${t.label}`,undo:()=>{t.list[n]=e(e({},t.list[n]),r)},redo:l}}(a,t,n.value);r.redo(),qe.push(r)}}}("Action"),Ze=h({}),et=pe(),tt=Ne(),at=d((()=>{var e,t;return null!=(t=null==(e=Qe.lastSelectedItem.value)?void 0:e.keyframes.filter((e=>e.frame===Ye.value)))?t:[]})),nt=d((()=>at.value.reduce(((t,a)=>e(e({},t),{[a.bornId]:a})),{}))),rt=d((()=>Array.from(new Set(Object.keys(Ze.value).concat(Object.keys(nt.value)))))),lt=d((()=>rt.value.reduce(((e,t)=>(nt.value[t]?e[t]=ee([nt.value[t].transform,vt(t)]):e[t]=vt(t),e)),{}))),ot=d((()=>tt.lastSelectedArmature.value?Y(tt.lastSelectedArmature.value.borns.map((t=>e(e({},t),{transform:mt(t.id)})))):{}));d((()=>Y(Object.keys(ot.value).filter((e=>Z(tt.state.selectedBorns[e]))).map((e=>ot.value[e])))));const dt=d((()=>tt.lastSelectedArmature.value?de(ot.value,tt.state.selectedBorns,!0):{x:0,y:0}));function st(){tt.lastSelectedArmature.value&&Qe.addItem(function(a={},n=!1){return e({id:n?t():"",name:"",totalFrame:60,armatureId:"",keyframes:[]},a)}({name:H("action",Qe.state.list.map((e=>e.name))),armatureId:tt.lastSelectedArmature.value.id},!0))}function ct(e){if(Je.value===e)return;const t=function(e){const t=Je.value;return{name:"Update End Frame",undo:()=>{Je.value=t},redo:()=>{Je.value=e}}}(e);t.redo(),et.push(t)}function it(t){const a=function(t){const a=e({},Ze.value);return{name:"Update Pose",undo:()=>{Ze.value=a},redo:()=>{Ze.value=t}}}(t);a.redo(),et.push(a)}function ut(e){it(Array.from(new Set(Object.keys(Ze.value).concat(Object.keys(e)))).reduce(((t,a)=>{var n;return t[a]=ee([vt(a),null!=(n=e[a])?n:R()]),t}),{}))}function vt(e){var t;return null!=(t=Ze.value[e])?t:R()}function mt(e){var t;return null!=(t=lt.value[e])?t:R()}function ft(){return{currentFrame:Ye,endFrame:Je,actions:Qe.state.list,posedBornIds:rt,currentPosedBorns:ot,currentTransforms:lt,selectedPosedBornOrigin:dt,getBornCurrentTransforms:mt,setEndFrame:ct,selectedAction:Qe.lastSelectedItem,selectAction:Qe.selectItem,addAction:st,deleteAction:Qe.deleteItem,updateAction:e=>Qe.updateItem(e),applyEditedTransforms:ut}}const pt=pe(),ht=o({canvasMode:"object",pastCanvasMode:"edit",axisGrid:""}),yt=d((()=>"edit"===ht.canvasMode?Re(Ct()):"pose"===ht.canvasMode?function(e){const t=o({command:"",editMovement:void 0}),a=Ne(),n=ft(),r=d((()=>a.state.selectedBorns)),l=d((()=>{var e;return null==(e=a.lastSelectedBorn.value)?void 0:e.id})),s=d((()=>a.lastSelectedArmature.value)),c=d((()=>!!l.value));function u(){t.command="",t.editMovement=void 0}const v=d((()=>{if(!t.editMovement)return{};if("rotate"===t.command){const e=n.selectedPosedBornOrigin.value,a=(i(t.editMovement.current,e)-i(t.editMovement.start,e))/Math.PI*180;return Object.keys(r.value).reduce(((e,t)=>(e[t]=R({rotate:a}),e)),{})}const a=p(t.editMovement.current,t.editMovement.start),l=e.snapTranslate(a);return Object.keys(r.value).reduce(((e,t)=>(e[t]=R({translate:l}),e)),{})}));function m(){s.value&&(n.applyEditedTransforms(v.value),t.editMovement=void 0,t.command="")}return{command:d((()=>t.command)),getEditTransforms(e){var t;return null!=(t=v.value[e])?t:R()},end:()=>u(),cancel:u,setEditMode:function(e){s.value&&(u(),c.value&&(t.command=e))},select:function(e,n){t.command?m():a.selectBorn(e,n,!1,!0)},shiftSelect:function(e,n){t.command?m():a.selectBorn(e,n,!0,!0)},mousemove:function(e){t.command&&(t.editMovement=e)},clickAny:function(){t.command&&m()},clickEmpty:function(){t.command?m():a.selectBorn()},execDelete:()=>{},execAdd:()=>{}}}(Ct()):function(){const e=o({command:"",editMovement:void 0}),t=Ne(),a=d((()=>t.lastSelectedArmature.value));function n(){e.command="",e.editMovement=void 0}const r=d((()=>({})));function l(){a.value&&(e.editMovement=void 0,e.command="")}return{command:d((()=>e.command)),getEditTransforms:e=>r.value[e]||R(),end:()=>n(),cancel:n,setEditMode:function(t){a.value&&(n(),e.command=t)},select:function(a,n){e.command?l():t.selectBorn(a,n)},shiftSelect:function(a,n){e.command?l():t.selectBorn(a,n,!0)},mousemove:function(t){e.command&&(e.editMovement=t)},clickAny:function(){e.command&&l()},clickEmpty:function(){e.command?l():t.selectArmature()},execDelete:function(){""===e.command&&t.deleteArmature()},execAdd:function(){""===e.command&&t.addArmature()}}}()));s(yt,((e,t)=>{t&&t.end()}));const gt=d((()=>yt.value.command.value));function bt(){"edit"===ht.canvasMode?wt(ht.pastCanvasMode):wt("edit")}function xt(){"edit"===ht.canvasMode?"object"===ht.pastCanvasMode?wt("pose"):wt("object"):"object"===ht.canvasMode?wt("pose"):wt("object")}function wt(e){const t=function(e){const t=ht.canvasMode,a=ht.pastCanvasMode;return{name:"Change Mode",undo:()=>{ht.canvasMode=t,ht.pastCanvasMode=a},redo:()=>{ht.pastCanvasMode=ht.canvasMode,ht.canvasMode=e}}}(e);pt.push(t),t.redo()}function kt(e){ht.axisGrid=e}function St(e){ht.axisGrid=ht.axisGrid===e?"":e}function Mt(e){return{x:"y"===ht.axisGrid?1:e.x,y:"x"===ht.axisGrid?1:e.y}}function At(e){return{x:"y"===ht.axisGrid?0:e.x,y:"x"===ht.axisGrid?0:e.y}}function Bt(e,t,a){return y(p(t,e),p(a,e))<0}function It(e){return yt.value.getEditTransforms(e)}function Ct(){return{state:ht,command:gt,toggleCanvasMode:bt,ctrlToggleCanvasMode:xt,setCanvasMode:wt,setAxisGrid:kt,switchAxisGrid:St,snapScale:Mt,snapTranslate:At,isOppositeSide:Bt,getEditTransforms:It,mousemove:e=>yt.value.mousemove(e),clickAny:()=>yt.value.clickAny(),clickEmpty:()=>yt.value.clickEmpty(),cancel:()=>yt.value.cancel(),setEditMode:e=>yt.value.setEditMode(e),execDelete:()=>yt.value.execDelete(),execAdd:()=>yt.value.execAdd(),select:(e,t)=>yt.value.select(e,t),shiftSelect:(e,t)=>yt.value.shiftSelect(e,t)}}const Et=o({size:{width:100,height:100}});function Ot(){return{state:Et}}window.addEventListener("resize",(()=>{Et.size={width:window.innerWidth,height:window.innerHeight}}));var $t=c({components:{ScaleMarker:We},props:{originalViewBox:{type:Object,default:()=>({x:0,y:0,width:600,height:400})},currentCommand:{type:String,default:""}},emits:["mousemove","click-any","click-empty","escape","tab","ctrl-tab","g","s","r","e","x","y","shift-a"],setup(t,{emit:n}){const r=o({width:600,height:400}),c=h(),i=h(),u=h(),v=h(),m=h(1),f=h({x:0,y:0}),y=h(),w=Ne(),k=Ct(),S=ft();function M(e){return a(f.value,l(e,m.value))}const A=d((()=>"edit"===k.state.canvasMode?w.selectedBornsOrigin.value:S.selectedPosedBornOrigin.value)),B=d((()=>({x:f.value.x,y:f.value.y,width:r.width*m.value,height:r.height*m.value}))),I=d((()=>V(B.value))),C=d((()=>x(e({x:0,y:0},r)))),E=d((()=>{if(""!==k.state.axisGrid&&u.value)return function(t,a,n,r){return e(e({},{strokeWidth:t}),"x"===a?{from:{x:n.x,y:r.y},to:{x:n.x+n.width,y:r.y},stroke:"red"}:{from:{x:r.x,y:n.y},to:{x:r.x,y:n.y+n.height},stroke:"green"})}(m.value,k.state.axisGrid,B.value,A.value)})),O=d((()=>{if(v.value&&["scale","rotate"].includes(t.currentCommand))return{origin:A.value,current:M(v.value),side:"rotate"===t.currentCommand}}));function $(){if(!i.value)return;const e=i.value.getBoundingClientRect();r.width=e.width,r.height=e.height}s((()=>t.currentCommand),(e=>{k.setAxisGrid(""),""===e&&(u.value=void 0)}));const D=Ot();return g($),s((()=>D.state.size),$),{scale:m,viewSize:r,svg:c,wrapper:i,viewBox:I,gridLineElm:E,scaleNaviElm:O,canvasMode:d((()=>k.state.canvasMode)),focus(){c.value&&c.value.focus()},wheel(e){const t=v.value?v.value:C.value,n=M(t);m.value=m.value*Math.pow(1.1,e.deltaY>0?1:-1);const r=M(t);f.value=a(f.value,p(n,r))},downMiddle(){v.value&&(y.value={origin:e({},f.value),downAt:e({},v.value)})},upMiddle(){y.value=void 0},leave(){y.value=void 0},mousemove:e=>{if(v.value=b(e),y.value)f.value=a(y.value.origin,l(p(y.value.downAt,v.value),m.value));else{if(!u.value)return;n("mousemove",{current:M(v.value),start:M(u.value)})}},clickAny(e){e.target===c.value?(u.value=void 0,n("click-empty")):n("click-any")},keyDownTab:()=>{n("tab")},keyDownCtrlTab:()=>n("ctrl-tab"),keyDownEscape:()=>{n("escape")},editKeyDown(e){v.value&&(!["grab","scale"].includes(t.currentCommand)||"x"!==e&&"y"!==e?(u.value=v.value,n(e)):k.switchAxisGrid(e))}}}});const Dt=I("data-v-62eb3068");C("data-v-62eb3068");const Tt={ref:"wrapper",class:"app-canvas-root"},Ft={class:"help"};E();const Lt=Dt(((e,t,a,n,r,l)=>{const o=w("ScaleMarker");return m(),u("div",Tt,[(m(),u("svg",{ref:"svg",tabindex:"-1",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"none","font-family":"sans-serif",viewBox:e.viewBox,width:e.viewSize.width,height:e.viewSize.height,onWheel:t[1]||(t[1]=k(((...t)=>e.wheel&&e.wheel(...t)),["prevent"])),onClick:t[2]||(t[2]=k(((...t)=>e.clickAny&&e.clickAny(...t)),["left"])),onContextmenu:t[3]||(t[3]=k(((...t)=>e.keyDownEscape&&e.keyDownEscape(...t)),["right","prevent"])),onMouseenter:t[4]||(t[4]=(...t)=>e.focus&&e.focus(...t)),onMousemove:t[5]||(t[5]=k(((...t)=>e.mousemove&&e.mousemove(...t)),["prevent"])),onMousedown:t[6]||(t[6]=k(((...t)=>e.downMiddle&&e.downMiddle(...t)),["middle","prevent"])),onMouseup:t[7]||(t[7]=k(((...t)=>e.upMiddle&&e.upMiddle(...t)),["middle","prevent"])),onMouseleave:t[8]||(t[8]=(...t)=>e.leave&&e.leave(...t)),onKeydown:[t[9]||(t[9]=S(k(((...t)=>e.keyDownEscape&&e.keyDownEscape(...t)),["exact","prevent"]),["escape"])),t[10]||(t[10]=S(k(((...t)=>e.keyDownTab&&e.keyDownTab(...t)),["exact","prevent"]),["tab"])),t[11]||(t[11]=S(k(((...t)=>e.keyDownCtrlTab&&e.keyDownCtrlTab(...t)),["shift","exact","prevent"]),["tab"])),t[12]||(t[12]=S(k((t=>e.editKeyDown("g")),["exact","prevent"]),["g"])),t[13]||(t[13]=S(k((t=>e.editKeyDown("s")),["exact","prevent"]),["s"])),t[14]||(t[14]=S(k((t=>e.editKeyDown("r")),["exact","prevent"]),["r"])),t[15]||(t[15]=S(k((t=>e.editKeyDown("e")),["exact","prevent"]),["e"])),t[16]||(t[16]=S(k((t=>e.editKeyDown("x")),["exact","prevent"]),["x"])),t[17]||(t[17]=S(k((t=>e.editKeyDown("y")),["exact","prevent"]),["y"])),t[18]||(t[18]=S(k((t=>e.editKeyDown("shift-a")),["shift","exact","prevent"]),["a"]))]},[v("rect",{x:e.originalViewBox.x,y:e.originalViewBox.y,width:e.originalViewBox.width,height:e.originalViewBox.height,fill:"none",stroke:"black","stroke-width":"1","stroke-dasharray":"4 4"},null,8,["x","y","width","height"]),e.gridLineElm?(m(),u("line",{key:0,x1:e.gridLineElm.from.x,y1:e.gridLineElm.from.y,x2:e.gridLineElm.to.x,y2:e.gridLineElm.to.y,stroke:e.gridLineElm.stroke,"stroke-width":e.gridLineElm.strokeWidth},null,8,["x1","y1","x2","y2","stroke","stroke-width"])):M("",!0),A(e.$slots,"default"),e.scaleNaviElm?(m(),u(o,{key:1,origin:e.scaleNaviElm.origin,current:e.scaleNaviElm.current,scale:e.scale,side:e.scaleNaviElm.side},null,8,["origin","current","scale","side"])):M("",!0)],40,["viewBox","width","height"])),v("div",Ft,[v("p",null,"Mode: "+B(e.canvasMode),1)])],512)}));$t.render=Lt,$t.__scopeId="data-v-62eb3068";var jt=c({props:{tabs:{type:Array,default:()=>[]}},setup(e){var t,a;const n=h(null!=(a=null==(t=e.tabs[0])?void 0:t.key)?a:"");return{current:n,setTab:e=>n.value=e}}});const Nt=I("data-v-16db2673");C("data-v-16db2673");const Pt={class:"tab-panel-root"},zt={class:"panels"};E();const _t=Nt(((e,t,a,n,r,l)=>(m(),u("div",Pt,[v("ul",null,[(m(!0),u(O,null,$(e.tabs,(t=>(m(),u("li",{key:t.key,class:{current:t.key===e.current}},[v("a",{href:"#",onClick:k((a=>e.setTab(t.key)),["prevent"])},B(t.label),9,["onClick"])],2)))),128))]),v("div",zt,[(m(!0),u(O,null,$(e.tabs,(t=>D((m(),u("div",{key:t.key},[A(e.$slots,t.key)],512)),[[T,t.key===e.current]]))),128))])]))));jt.render=_t,jt.__scopeId="data-v-16db2673";var Wt=c({setup(){const e=pe();return{allStack:d((()=>e.allStack.value)),currentItemIndex:d((()=>e.currentItemIndex.value))}}});const Ut=I("data-v-65f8ee82");C("data-v-65f8ee82");const Vt=v("h3",null,"history",-1);E();const Gt=Ut(((e,t,a,n,r,l)=>(m(),u("div",null,[Vt,v("ul",null,[(m(!0),u(O,null,$(e.allStack,((t,a)=>(m(),u("li",{key:a,class:{current:a===e.currentItemIndex}},B(t.name),3)))),128))])]))));Wt.render=Gt,Wt.__scopeId="data-v-65f8ee82";var Kt=c({props:{options:{type:Array,default:()=>[]},modelValue:{type:[Number,String],default:""}},emits:["update:modelValue"],setup:(e,{emit:t})=>({value:d({get:()=>e.modelValue,set(e){t("update:modelValue",e)}})})});const Ht=I("data-v-fddf1844");C("data-v-fddf1844");const Rt={class:"select-root"},qt=v("option",{value:""},"-- None --",-1);E();const Xt=Ht(((e,t,a,n,r,l)=>(m(),u("span",Rt,[D(v("select",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.value=t)},[qt,(m(!0),u(O,null,$(e.options,(e=>(m(),u("option",{key:e.value,value:e.value},B(e.label),9,["value"])))),128))],512),[[F,e.value]])]))));Kt.render=Xt,Kt.__scopeId="data-v-fddf1844";var Yt=c({components:{TabPanel:jt,HistoryStack:Wt,SelectField:Kt},setup(){const e=Ne(),t=h(""),a=d((()=>e.lastSelectedArmature.value?e.lastSelectedArmature.value.borns.filter((t=>{var a;return t.id!==(null==(a=e.lastSelectedBorn.value)?void 0:a.id)})).map((e=>({value:e.id,label:e.name}))):[])),n=d((()=>e.lastSelectedBorn.value?"born":e.lastSelectedArmature.value?"armature":""));function r(){e.lastSelectedBorn.value?t.value=e.lastSelectedBorn.value.name:e.lastSelectedArmature.value?t.value=e.lastSelectedArmature.value.name:t.value=""}return s(e.lastSelectedArmature,r),s(e.lastSelectedBorn,r),{draftName:t,lastSelectedArmature:e.lastSelectedArmature,lastSelectedBorn:e.lastSelectedBorn,parentOptions:a,selectedObjectType:n,connected:d({get(){var t,a;return null!=(a=null==(t=e.lastSelectedBorn.value)?void 0:t.connected)&&a},set(t){e.updateBorn({connected:t})}}),parentId:d({get(){var t,a;return null!=(a=null==(t=e.lastSelectedBorn.value)?void 0:t.parentId)?a:""},set(t){e.updateBorn({parentId:t})}}),changeArmatureName(){t.value&&e.updateArmatureName(t.value)},changeBornName(){t.value&&e.updateBorn({name:t.value})}}}});const Jt=I("data-v-a1a2983c");C("data-v-a1a2983c");const Qt=v("h3",null,"Armature",-1),Zt={class:"field inline"},ea=v("label",null,"Name",-1),ta=v("h3",null,"Born",-1),aa={class:"field inline"},na=v("label",null,"Name",-1),ra={class:"field inline"},la=v("label",null,"Parent",-1),oa={class:"field inline"},da=v("label",null,"Connect",-1);E();const sa=Jt(((e,t,a,n,r,l)=>{const o=w("SelectField"),d=w("HistoryStack"),s=w("TabPanel");return m(),u("div",null,[v(s,{tabs:[{key:"detail",label:"Detail"},{key:"history",label:"History"}]},{detail:Jt((()=>["armature"===e.selectedObjectType?(m(),u("form",{key:0,onSubmit:t[3]||(t[3]=k((()=>{}),["prevent"]))},[Qt,v("div",Zt,[ea,D(v("input",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.draftName=t),type:"text",onChange:t[2]||(t[2]=(...t)=>e.changeArmatureName&&e.changeArmatureName(...t))},null,544),[[L,e.draftName]])])],32)):M("",!0),"born"===e.selectedObjectType?(m(),u("form",{key:1,onSubmit:t[8]||(t[8]=k((()=>{}),["prevent"]))},[ta,v("div",aa,[na,D(v("input",{"onUpdate:modelValue":t[4]||(t[4]=t=>e.draftName=t),type:"text",onChange:t[5]||(t[5]=(...t)=>e.changeBornName&&e.changeBornName(...t))},null,544),[[L,e.draftName]])]),v("div",ra,[la,v(o,{modelValue:e.parentId,"onUpdate:modelValue":t[6]||(t[6]=t=>e.parentId=t),options:e.parentOptions},null,8,["modelValue","options"])]),v("div",oa,[da,D(v("input",{"onUpdate:modelValue":t[7]||(t[7]=t=>e.connected=t),type:"checkbox",disabled:!e.parentId},null,8,["disabled"]),[[j,e.connected]])])],32)):M("",!0)])),history:Jt((()=>[v(d)])),_:1})])}));Yt.render=sa,Yt.__scopeId="data-v-a1a2983c";var ca=c({emits:["down-left","up-left","mousemove","drag","click-any","click-empty","escape","g","x"],setup(t,{emit:n}){const r=h(),c=h(),i=function(t={}){const n=o({width:600,height:100}),r=h(),s=h(),c=h(1),i=h({x:0,y:0}),u=h(),v=h(),m=d((()=>({x:i.value.x,y:i.value.y,width:n.width*c.value,height:n.height*c.value}))),f=d((()=>x(e({x:0,y:0},n)))),y=d((()=>V(m.value)));function g(e){return a(i.value,l(e,c.value))}return{viewSize:n,editStartPoint:r,mousePoint:s,scale:c,viewOrigin:i,dragInfo:v,viewMovingInfo:u,viewCenter:f,viewBox:y,viewToCanvas:g,wheel(e,n=!1){var r,l;const o=!n&&s.value?s.value:f.value,d=g(o);c.value=Math.min(Math.max(c.value*Math.pow(1.1,e.deltaY>0?1:-1),null!=(r=t.scaleMin)?r:0),null!=(l=t.scaleMax)?l:10);const u=g(o);i.value=a(i.value,p(d,u))},downLeft(){s.value&&(v.value={})},upLeft(){v.value=void 0},downMiddle(){s.value&&(u.value={origin:e({},i.value),downAt:e({},s.value)})},upMiddle(){u.value=void 0},leave(){u.value=void 0},viewMove(){u.value&&s.value&&(i.value=a(u.value.origin,l(p(u.value.downAt,s.value),c.value)))}}}({scaleMin:1});function u(){if(!c.value)return;const e=c.value.getBoundingClientRect();i.viewSize.width=e.width,i.viewSize.height=e.height}const v=Ot();return g(u),s((()=>v.state.size),u),{scale:i.scale,viewOrigin:i.viewOrigin,viewSize:d((()=>i.viewSize)),wrapper:c,svg:r,viewBox:i.viewBox,focus(){r.value&&r.value.focus()},wheel:e=>i.wheel(e,!0),downLeft:()=>{i.mousePoint.value&&(i.downLeft(),n("down-left",i.viewToCanvas(i.mousePoint.value)))},upLeft:()=>{i.upLeft(),n("up-left")},downMiddle:i.downMiddle,upMiddle:i.upMiddle,leave:i.leave,mousemove:e=>{i.mousePoint.value=b(e),i.dragInfo.value?n("drag",i.viewToCanvas(i.mousePoint.value)):i.viewMovingInfo.value?i.viewMove():i.editStartPoint.value&&n("mousemove",{current:i.viewToCanvas(i.mousePoint.value),start:i.viewToCanvas(i.editStartPoint.value)})},clickAny(e){e.target===r.value?(i.editStartPoint.value=void 0,n("click-empty")):n("click-any")},keyDownEscape:()=>{n("escape")},editKeyDown(e){i.mousePoint.value&&(i.editStartPoint.value=i.mousePoint.value,n(e))}}}});const ia=I("data-v-5868f1c8");C("data-v-5868f1c8");const ua={ref:"wrapper",class:"timeline-canvas-root"};E();const va=ia(((e,t,a,n,r,l)=>(m(),u("div",ua,[(m(),u("svg",{ref:"svg",tabindex:"-1",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"none","font-family":"sans-serif",viewBox:e.viewBox,width:e.viewSize.width,height:e.viewSize.height,onWheel:t[1]||(t[1]=k(((...t)=>e.wheel&&e.wheel(...t)),["prevent"])),onClick:t[2]||(t[2]=k(((...t)=>e.clickAny&&e.clickAny(...t)),["left"])),onContextmenu:t[3]||(t[3]=k(((...t)=>e.keyDownEscape&&e.keyDownEscape(...t)),["right","prevent"])),onMouseenter:t[4]||(t[4]=(...t)=>e.focus&&e.focus(...t)),onMousedown:[t[5]||(t[5]=k(((...t)=>e.downLeft&&e.downLeft(...t)),["left","prevent"])),t[8]||(t[8]=k(((...t)=>e.downMiddle&&e.downMiddle(...t)),["middle","prevent"]))],onMouseup:[t[6]||(t[6]=k(((...t)=>e.upLeft&&e.upLeft(...t)),["left","prevent"])),t[9]||(t[9]=k(((...t)=>e.upMiddle&&e.upMiddle(...t)),["middle","prevent"]))],onMousemove:t[7]||(t[7]=k(((...t)=>e.mousemove&&e.mousemove(...t)),["prevent"])),onMouseleave:t[10]||(t[10]=(...t)=>e.leave&&e.leave(...t)),onKeydown:[t[11]||(t[11]=S(k(((...t)=>e.keyDownEscape&&e.keyDownEscape(...t)),["exact","prevent"]),["escape"])),t[12]||(t[12]=S(k((t=>e.editKeyDown("g")),["exact","prevent"]),["g"])),t[13]||(t[13]=S(k((t=>e.editKeyDown("x")),["exact","prevent"]),["x"]))]},[A(e.$slots,"default",{scale:e.scale,viewOrigin:e.viewOrigin,viewSize:e.viewSize})],40,["viewBox","width","height"]))],512))));ca.render=va,ca.__scopeId="data-v-5868f1c8";var ma=c({props:{labelWidth:{type:Number,default:100},index:{type:Number,required:!0},label:{type:String,required:!0}},setup:()=>({height:24})});ma.render=function(e,t,a,n,r,l){return m(),u("g",{transform:`translate(0, ${e.index*e.height})`},[v("rect",{width:e.labelWidth,height:e.height,fill:"#fff",stroke:"black"},null,8,["width","height"]),v("text",{x:"4",y:e.height/2,"dominant-baseline":"central"},B(e.label),9,["y"])],8,["transform"])};function fa(e){return Math.round(function(e){return Math.round(Math.log(e)/Math.log(1.1))}(e)/2)+1}var pa=c({props:{scale:{type:Number,default:1},originX:{type:Number,default:0},viewWidth:{type:Number,default:100},currentFrame:{type:Number,default:0},endFrame:{type:Number,default:60}},emits:["down-current-frame","up-current-frame"],setup(e,{emit:t}){const a=d((()=>fa(e.scale))),n=d((()=>function(e,t){const a=Math.floor(Math.max(t,0)/20);return a-a%(2*e)}(a.value,e.originX))),r=d((()=>Math.ceil(e.viewWidth*e.scale/20))),l=d((()=>Math.floor(r.value/a.value))),o=d((()=>[...Array(l.value)].map(((e,t)=>{const r=t*a.value+n.value;return{f:r,labelSize:r%10==0?14:r%2==0?11:0,strokeWidth:r%10==0?2:1}})))),s=d((()=>20*e.currentFrame)),c=d((()=>10*Math.max(e.currentFrame.toString().length,2)+2));return{headerHeight:24,frames:o,frameWidth:20,currentFrameX:s,endFrameX:d((()=>20*e.endFrame)),currentFrameLabelWidth:c,downCurrentFrame:()=>t("down-current-frame")}}});const ha=I("data-v-d1cae906");C("data-v-d1cae906");const ya={class:"view-only"},ga={fill:"#aaa",stroke:"none","fill-opacity":"0.5"},ba=v("g",{transform:"scale(-1, 1)"},[v("rect",{width:"200000",height:"200000"})],-1),xa=v("rect",{width:"200000",height:"200000"},null,-1);E();const wa=ha(((e,t,a,n,r,l)=>(m(),u("g",null,[v("g",{transform:`scale(${e.scale})`,onMousedown:t[1]||(t[1]=k(((...t)=>e.downCurrentFrame&&e.downCurrentFrame(...t)),["left"]))},[v("rect",{x:"-100000",width:"200000",height:e.headerHeight,fill:"#fff",stroke:"#000"},null,8,["height"])],40,["transform"]),v("g",ya,[v("g",null,[(m(!0),u(O,null,$(e.frames,(t=>(m(),u("g",{key:t,transform:`translate(${t.f*e.frameWidth}, 0)`},[v("g",{transform:`scale(${e.scale})`},[t.labelSize>0?(m(),u("text",{key:0,y:e.headerHeight-4,"font-size":t.labelSize,"dominant-baseline":"text-after-edge","text-anchor":"middle"},B(t.f),9,["y","font-size"])):M("",!0),t.strokeWidth>0?(m(),u("line",{key:1,x1:"0",y1:e.headerHeight,x2:"0",y2:"20000",stroke:"#aaa","stroke-width":t.strokeWidth},null,8,["y1","stroke-width"])):M("",!0)],8,["transform"])],8,["transform"])))),128))]),v("g",ga,[ba,v("g",{transform:`translate(${e.endFrameX}, 0)`},[xa],8,["transform"])]),v("g",{transform:`translate(${e.currentFrameX}, 0) scale(${e.scale})`},[v("rect",{x:-e.currentFrameLabelWidth/2,y:2,width:e.currentFrameLabelWidth,height:20,rx:"4",ry:"4",fill:"blue",stroke:"none"},null,8,["x","width"]),v("text",{y:e.headerHeight-4,"font-size":"12","dominant-baseline":"text-after-edge","text-anchor":"middle",fill:"#fff"},B(e.currentFrame),9,["y"]),v("line",{x1:"0",y1:e.headerHeight,x2:"0",y2:"20000",stroke:"blue","stroke-width":"2"},null,8,["y1"])],8,["transform"])])]))));pa.render=wa,pa.__scopeId="data-v-d1cae906";var ka=c({components:{SelectField:Kt,TimelineCanvas:ca,TimelineRow:ma,TimelineAxis:pa},setup(){const e=Ne(),t=ft(),a=h(""),n=h(""),r=h(""),l=d((()=>t.selectedAction.value)),o=d((()=>{var t,a;return null!=(a=null==(t=e.lastSelectedArmature.value)?void 0:t.borns)?a:[]})),s=d((()=>t.actions.map((t=>{var a;const n=(null==(a=e.lastSelectedArmature.value)?void 0:a.id)!==t.armatureId;return{value:t.id,label:`${n?"(x)":""} ${t.name}`}}))));function c(e){var n;"move-current-frame"===a.value&&(t.currentFrame.value=(n=e.x-140-20,Math.round(Math.max(n,0)/20)))}return N((()=>{var e,t;n.value=null!=(t=null==(e=l.value)?void 0:e.name)?t:""})),N((()=>{r.value=t.endFrame.value.toString()})),{actions:t.actions,selectedBorns:o,draftName:n,draftEndFrame:r,labelWidth:140,axisPadding:20,currentFrame:t.currentFrame,endFrame:t.endFrame,changeActionName:()=>{n.value&&t.updateAction({name:n.value})},changeEndFrame:()=>{const e=parseInt(r.value,10);!isNaN(e)&&e>=0?t.setEndFrame(e):r.value=t.endFrame.value.toString()},addAction:t.addAction,deleteAction:t.deleteAction,actionOptions:s,selectedActionId:d({get:()=>{var e,t;return null!=(t=null==(e=l.value)?void 0:e.id)?t:""},set:e=>t.selectAction(e)}),downCurrentFrame:function(){a.value="move-current-frame"},downLeft:function(e){c(e)},drag:c,upLeft:function(){a.value=""}}}});const Sa=I("data-v-13a1eea6");C("data-v-13a1eea6");const Ma={class:"animation-panel-root"},Aa={class:"top"},Ba={class:"select-action"},Ia={class:"end-frame-field"},Ca=P("End: "),Ea={class:"middle"};E();const Oa=Sa(((e,t,a,n,r,l)=>{const o=w("SelectField"),d=w("TimelineAxis"),s=w("TimelineRow"),c=w("TimelineCanvas");return m(),u("div",Ma,[v("div",Aa,[v("div",Ba,[v(o,{modelValue:e.selectedActionId,"onUpdate:modelValue":t[1]||(t[1]=t=>e.selectedActionId=t),options:e.actionOptions},null,8,["modelValue","options"])]),D(v("input",{"onUpdate:modelValue":t[2]||(t[2]=t=>e.draftName=t),type:"text",onChange:t[3]||(t[3]=(...t)=>e.changeActionName&&e.changeActionName(...t))},null,544),[[L,e.draftName]]),v("button",{class:"add-action",onClick:t[4]||(t[4]=(...t)=>e.addAction&&e.addAction(...t))},"+"),v("button",{class:"delete-action",onClick:t[5]||(t[5]=(...t)=>e.deleteAction&&e.deleteAction(...t))},"x"),v("label",Ia,[Ca,D(v("input",{"onUpdate:modelValue":t[6]||(t[6]=t=>e.draftEndFrame=t),type:"number",onChange:t[7]||(t[7]=(...t)=>e.changeEndFrame&&e.changeEndFrame(...t))},null,544),[[L,e.draftEndFrame]])])]),v("div",Ea,[v(c,{onUpLeft:e.upLeft,onDrag:e.drag,onDownLeft:e.downLeft},{default:Sa((({scale:t,viewOrigin:a,viewSize:n})=>[v("g",{transform:`translate(${e.labelWidth+e.axisPadding}, ${a.y})`},[v(d,{scale:t,"origin-x":a.x,"view-width":n.width,"current-frame":e.currentFrame,"end-frame":e.endFrame,onDownCurrentFrame:e.downCurrentFrame},null,8,["scale","origin-x","view-width","current-frame","end-frame","onDownCurrentFrame"])],8,["transform"]),v("g",{transform:`translate(${a.x}, ${a.y}) scale(${t})`},[v("g",null,[v("rect",{width:e.labelWidth,height:"10000",stroke:"none",fill:"#fff"},null,8,["width"]),v("line",{x1:e.labelWidth,y1:"0",x2:e.labelWidth,y2:"10000",stroke:"black"},null,8,["x1","x2"]),v(s,{index:1,"label-width":e.labelWidth,label:"Summary"},null,8,["label-width"]),(m(!0),u(O,null,$(e.selectedBorns,((t,a)=>(m(),u(s,{key:t.id,index:a+2,"label-width":e.labelWidth,label:t.name},null,8,["index","label-width","label"])))),128))])],8,["transform"])])),_:1},8,["onUpLeft","onDrag","onDownLeft"])])])}));ka.render=Oa,ka.__scopeId="data-v-13a1eea6";const $a=o({selectedColor:"orange"});function Da(e,t,n=!1){return a(e,r(l(p(t,e),.15),Math.PI/4*(n?-1:1)))}var Ta=c({props:{born:{type:Object,required:!0},parent:{type:Object,default:void 0},opacity:{type:Number,default:1},selectedState:{type:Object,default:()=>({head:!1,tail:!1})},poseMode:{type:Boolean,default:!1}},emits:["select","shift-select"],setup(t,{emit:a}){const{settings:n}={settings:$a},r=d((()=>t.born.head)),l=d((()=>t.born.tail)),o=d((()=>Da(r.value,l.value))),s=d((()=>Da(r.value,l.value,!0))),c=d((()=>t.poseMode?t.selectedState.head||t.selectedState.tail:t.selectedState.head&&t.selectedState.tail));return{transform:d((()=>W(t.born.transform))),head:r,tail:l,headPath:d((()=>U([r.value,o.value,s.value],!0))),tailPath:d((()=>U([l.value,o.value,s.value],!0))),fill:d((()=>c.value?n.selectedColor:"#ddd")),fillDark:d((()=>c.value?n.selectedColor:"#bbb")),fillHead:d((()=>t.selectedState.head?n.selectedColor:"")),fillTail:d((()=>t.selectedState.tail?n.selectedColor:"")),click:e=>{t.poseMode?c.value?a("select",{head:!1,tail:!1}):a("select",{head:!0,tail:!0}):a("select",e)},shiftClick:n=>{t.poseMode||n.head&&n.tail?c.value?a("shift-select",{head:!1,tail:!1}):a("shift-select",{head:!0,tail:!0}):n.head?a("shift-select",e(e({},t.selectedState),{head:!t.selectedState.head})):n.tail&&a("shift-select",e(e({},t.selectedState),{tail:!t.selectedState.tail}))}}}});const Fa=I("data-v-13fd028e")(((e,t,a,n,r,l)=>(m(),u("g",{stroke:"black",fill:e.fill,transform:e.transform,opacity:e.opacity},[v("g",{onClick:[t[1]||(t[1]=k((t=>e.click({head:!0,tail:!0})),["exact"])),t[2]||(t[2]=k((t=>e.shiftClick({head:!0,tail:!0})),["shift","exact"]))]},[v("path",{d:e.headPath,fill:e.fillDark},null,8,["d","fill"]),v("path",{d:e.tailPath},null,8,["d"])]),v("circle",{r:"10",cx:e.head.x,cy:e.head.y,fill:e.fillHead,onClick:[t[3]||(t[3]=k((t=>e.click({head:!0,tail:!1})),["exact"])),t[4]||(t[4]=k((t=>e.shiftClick({head:!0,tail:!1})),["shift","exact"]))]},null,8,["cx","cy","fill"]),v("circle",{r:"10",cx:e.tail.x,cy:e.tail.y,fill:e.fillTail,onClick:[t[5]||(t[5]=k((t=>e.click({head:!1,tail:!0})),["exact"])),t[6]||(t[6]=k((t=>e.shiftClick({head:!1,tail:!0})),["shift","exact"]))]},null,8,["cx","cy","fill"]),e.parent?(m(),u("line",{key:0,x1:e.parent.tail.x,y1:e.parent.tail.y,x2:e.head.x,y2:e.head.y,"stroke-dasharray":"2 2",class:"view-only"},null,8,["x1","y1","x2","y2"])):M("",!0),v("text",{x:(e.head.x+e.tail.x)/2,y:(e.head.y+e.tail.y)/2,"text-anchor":"middle",fill:"black",stroke:"none",class:"view-only"},B(e.born.name),9,["x","y"])],8,["fill","transform","opacity"]))));Ta.render=Fa,Ta.__scopeId="data-v-13fd028e";var La=c({components:{BornElm:Ta},props:{armature:{type:Object,required:!0},opacity:{type:Number,default:.8},selected:{type:Boolean,default:!1}},emits:["select","shift-select"],setup:(e,{emit:t})=>({bornMap:d((()=>Y(e.armature.borns))),transform:d((()=>W(e.armature.transform))),bornSelectedState:d((()=>e.selected?{head:!0,tail:!0}:void 0)),click:()=>t("select",!e.selected),shiftClick:()=>t("shift-select",!e.selected)})});const ja=I("data-v-e1a73d3c")(((e,t,a,n,r,l)=>{const o=w("BornElm");return m(),u("g",{stroke:"black",transform:e.transform,opacity:e.opacity},[(m(!0),u(O,null,$(e.armature.borns,(t=>(m(),u(o,{key:t.name,born:t,"selected-state":e.bornSelectedState,parent:e.bornMap[t.parentId],onSelect:e.click,onShiftSelect:e.shiftClick},null,8,["born","selected-state","parent","onSelect","onShiftSelect"])))),128))],8,["transform","opacity"])}));La.render=ja,La.__scopeId="data-v-e1a73d3c";var Na=c({components:{AppCanvas:$t,ArmatureElm:La,BornElm:Ta,SidePanel:Yt,AnimationPanel:ka},setup(){const e=Ne(),t=Ct(),a=ft(),n=pe(),r=d((()=>t.state.canvasMode)),l=d((()=>e.lastSelectedArmature.value)),o=d((()=>e.state.armatures.filter((t=>{var a;return t.id!==(null==(a=e.lastSelectedArmature.value)?void 0:a.id)})))),s=d((()=>l.value?"edit"===r.value?Y(l.value.borns.map((a=>ae(a,t.getEditTransforms(a.id),e.state.selectedBorns[a.id]||[])))):Y(l.value.borns.map((e=>ne(e,[a.getBornCurrentTransforms(e.id),t.getEditTransforms(e.id)])))):{})),c=d((()=>{return"grab"===(e=t.command.value)||"extrude"===e?"grab":"rotate"===e?"rotate":"scale"===e?"scale":"";var e}));function i(e){var t;["input","textarea"].includes(null==(t=e.target)?void 0:t.tagName.toLowerCase())||e.ctrlKey&&"z"===e.key.toLowerCase()&&(e.preventDefault(),e.shiftKey?n.redo():n.undo())}return g((()=>{document.addEventListener("keydown",i)})),z((()=>{document.removeEventListener("keydown",i)})),{armatures:d((()=>e.state.armatures)),otherArmatures:o,lastSelectedArmatureId:d((()=>{var t;return null==(t=e.lastSelectedArmature.value)?void 0:t.id})),editBornMap:s,selectedBorns:d((()=>e.state.selectedBorns)),canvasMode:r,canvasCommand:c,mousemove(e){t.mousemove(e)},clickAny(){t.clickAny()},clickEmpty(){t.clickEmpty()},selectBorn(e,a){t.select(e,a)},shiftSelectBorn(e,a){t.shiftSelect(e,a)},selectArmature(t,a){e.selectArmature(a?t:"")},shiftSelectArmature(t,a){e.selectArmature(a?t:"")},escape(){t.cancel()},toggleCanvasMode(){e.lastSelectedArmature.value&&t.toggleCanvasMode()},ctrlToggleCanvasMode(){e.lastSelectedArmature.value&&t.ctrlToggleCanvasMode()},setEditMode(e){t.setEditMode(e)},execDelete(){t.execDelete()},addItem(){t.execAdd()}}}});const Pa=I("data-v-54b15e3f");C("data-v-54b15e3f");const za={class:"main"},_a={key:0},Wa={key:1},Ua={key:2},Va={class:"bottom"};E();const Ga=Pa(((e,t,a,n,r,l)=>{const o=w("ArmatureElm"),d=w("BornElm"),s=w("AppCanvas"),c=w("SidePanel"),i=w("AnimationPanel");return m(),u("div",null,[v("div",za,[v(s,{"current-command":e.canvasCommand,class:"canvas",onMousemove:e.mousemove,onClickAny:e.clickAny,onClickEmpty:e.clickEmpty,onEscape:e.escape,onTab:e.toggleCanvasMode,onCtrlTab:e.ctrlToggleCanvasMode,onG:t[1]||(t[1]=t=>e.setEditMode("grab")),onS:t[2]||(t[2]=t=>e.setEditMode("scale")),onR:t[3]||(t[3]=t=>e.setEditMode("rotate")),onE:t[4]||(t[4]=t=>e.setEditMode("extrude")),onX:e.execDelete,onShiftA:e.addItem},{default:Pa((()=>["object"===e.canvasMode?(m(),u("g",_a,[(m(!0),u(O,null,$(e.armatures,(t=>(m(),u(o,{key:t.id,armature:t,selected:e.lastSelectedArmatureId===t.id,onSelect:a=>e.selectArmature(t.id,a),onShiftSelect:a=>e.shiftSelectArmature(t.id,a)},null,8,["armature","selected","onSelect","onShiftSelect"])))),128))])):M("",!0),"edit"===e.canvasMode?(m(),u("g",Wa,[(m(!0),u(O,null,$(e.otherArmatures,(e=>(m(),u(o,{key:e.id,armature:e,opacity:.3},null,8,["armature","opacity"])))),128)),(m(!0),u(O,null,$(e.editBornMap,(t=>(m(),u(d,{key:t.id,born:t,parent:e.editBornMap[t.parentId],"selected-state":e.selectedBorns[t.id],onSelect:a=>e.selectBorn(t.id,a),onShiftSelect:a=>e.shiftSelectBorn(t.id,a)},null,8,["born","parent","selected-state","onSelect","onShiftSelect"])))),128))])):M("",!0),"pose"===e.canvasMode?(m(),u("g",Ua,[(m(!0),u(O,null,$(e.otherArmatures,(e=>(m(),u(o,{key:e.id,armature:e,opacity:.3},null,8,["armature","opacity"])))),128)),(m(!0),u(O,null,$(e.editBornMap,(t=>(m(),u(d,{key:t.id,born:t,parent:e.editBornMap[t.parentId],"selected-state":e.selectedBorns[t.id],"pose-mode":"",onSelect:a=>e.selectBorn(t.id,a),onShiftSelect:a=>e.shiftSelectBorn(t.id,a)},null,8,["born","parent","selected-state","onSelect","onShiftSelect"])))),128))])):M("",!0)])),_:1},8,["current-command","onMousemove","onClickAny","onClickEmpty","onEscape","onTab","onCtrlTab","onX","onShiftA"]),v(c,{class:"side-panel"})]),v("div",Va,[v(i)])])}));Na.render=Ga,Na.__scopeId="data-v-54b15e3f",_(Na).mount("#app");
