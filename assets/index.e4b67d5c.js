var e=Object.prototype.hasOwnProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.propertyIsEnumerable,n=Object.assign,r=(n,r)=>{var l={};for(var o in n)e.call(n,o)&&r.indexOf(o)<0&&(l[o]=n[o]);if(null!=n&&t)for(var o of t(n))r.indexOf(o)<0&&a.call(n,o)&&(l[o]=n[o]);return l};import{v as l,n as o,a as s,l as c,b as d,c as i,r as u,e as m,d as v,f,w as p,g as h,h as y,i as b,j as g,o as x,k,m as w,p as S,q as M,s as A,t as B,u as I,x as C,y as E,z as O,A as F,B as j,C as $,D,E as L,F as T,G as N,H as P,I as _,J as z,K,L as W,M as U,N as V,O as G,P as H,Q as R}from"./vendor.63484718.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(a){const n=new URL(e,location),r=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((a,l)=>{const o=new URL(e,n);if(self[t].moduleMap[o])return a(self[t].moduleMap[o]);const s=new Blob([`import * as m from '${o}';`,`${t}.moduleMap['${o}']=m;`],{type:"text/javascript"}),c=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(s),onerror(){l(new Error(`Failed to import: ${e}`)),r(c)},onload(){a(self[t].moduleMap[o]),r(c)}});document.head.appendChild(c)})),self[t].moduleMap={}}}("/blendic-svg/assets/");function q(e,t){return e.reduce(((e,a)=>(e[a[t]]=a,e)),{})}function X(e,t){const a={};return e.forEach((e=>{a[e[t]]?a[e[t]].push(e):a[e[t]]=[e]})),a}function Y(e,t){return Object.keys(e).reduce(((a,n)=>(a[n]=t(e[n]),a)),{})}function J(e={}){return n({translate:{x:0,y:0},origin:{x:0,y:0},rotate:0,scale:{x:1,y:1}},e)}function Q(e={},t=!1){return n({id:t?l():"",name:"",transform:J(),parentId:"",connected:!1,head:{x:0,y:0},tail:{x:0,y:0}},e)}function Z(e={},t=!1){return n({id:t?l():"",name:"",transform:J(),borns:[]},e)}function ee(e){return q(e,"id")}function te(e){return q(e,"bornId")}function ae(e,t){return Object.keys(n(n({},e),t)).reduce(((a,r)=>{var l,o;return a[r]=n(n({},null!=(l=e[r])?l:{}),null!=(o=t[r])?o:{}),a}),{})}function ne(e,t){return Object.keys(t).reduce(((t,a)=>(t[a]=e[a],t)),{})}function re(e){return!!e&&(!!e.head||!!e.tail)}function le(e){return[`translate(${e.translate.x},${e.translate.y})`,`rotate(${e.rotate})`,`scale(${e.scale.x},${e.scale.y})`].join(" ")}function oe(e,t=!1){if(0===e.length)return"";const[a,...n]=e;return`M${a.x},${a.y}`+n.map((e=>`L${e.x},${e.y}`)).join("")+(t?"z":"")}function se(e){return`${e.x} ${e.y} ${e.width} ${e.height}`}const ce=/\.[0-9]{3,}$/;function de(e){return ce.test(e)?e.replace(ce,(e=>"."+`${parseInt(e.slice(1),10)+1}`.padStart(3,"0"))):`${e}.001`}function ie(e,t){const a=new Map(t.map((e=>[e,!0])));let n=de(e);for(;a.has(n);)n=de(n);return n}function ue(e){return e.reduce(((e,t)=>{return n=t,J({scale:{x:(a=e).scale.x*n.scale.x,y:a.scale.y*n.scale.y},rotate:a.rotate+n.rotate,translate:o(a.translate,n.translate)});var a,n}),J())}function me(e,t){return o(d(function(e,t,a={x:0,y:0}){return{x:a.x+(e.x-a.x)*t.x,y:a.y+(e.y-a.y)*t.y}}(e,t.scale,t.origin),t.rotate/180*Math.PI,t.origin),t.translate)}function ve(e,t,a){const r=a.head?me(e.head,t):e.head,l=a.tail?me(e.tail,t):e.tail;return n(n({},e),{head:r,tail:l})}function fe(e,t){const a=ue(t),r=me(e.head,J({translate:a.translate})),l=me(e.tail,J(n(n({},a),{origin:e.head})));return n(n({},e),{head:r,tail:l,transform:J()})}function pe(e,t){return e.find((e=>e.id===t))}function he(e,t,a,r=!1){const l=pe(e.borns,t);if(!l)return{};let o={[t]:a};if(!r){if(a.head&&l.connected){const t=pe(e.borns,l.parentId);t&&(o=n(n({},he(e,t.id,{tail:!0},r)),o))}a.tail&&function(e,t,a=!1){return e.borns.filter((e=>e.parentId===t&&(!a||e.connected)))}(e,l.id,!0).forEach((e=>{o[e.id]={head:!0}}))}return o}function ye(e){return e.reduce(((t,a)=>{const n=pe(e,a.parentId);return n?a.connected&&(t[a.id]={connected:c(n.tail,a.head)}):a.connected&&(t[a.id]={connected:!1,parentId:""}),t}),{})}function be(e){const t=[],a=Object.keys(e).reduce(((a,n)=>{const r=e[n];return r.parentId?a[r.parentId]?a[r.parentId].push(r):a[r.parentId]=[r]:t.push(r),a}),{});return t.map((e=>n(n({},e),{children:ge(a,e.id)})))}function ge(e,t){var a,r;return null!=(r=null==(a=e[t])?void 0:a.map((t=>n(n({},t),{children:ge(e,t.id)}))))?r:[]}function xe(e){return ee(we(function(e){return be(e).map((e=>n(n({},e),{children:ke(e)})))}(e)))}function ke(e){var t;return null!=(t=e.children.map((t=>{const a=function(e,t){const a=o(t.head,t.transform.translate),r=me(a,n(n({},e.transform),{origin:e.head})),l=i(r,a);return n(n({},t),{transform:{translate:o(t.transform.translate,l),rotate:t.transform.rotate+e.transform.rotate,scale:{x:t.transform.scale.x*e.transform.scale.x,y:t.transform.scale.y*e.transform.scale.y},origin:{x:0,y:0}}})}(e,t);return n(n({},a),{children:ke(n(n({},a),{children:t.children}))})})))?t:[]}function we(e){return e.map((e=>{const{children:t}=e;return r(e,["children"])})).concat(e.flatMap((e=>we(e.children))))}function Se(e,t){return ee(Me(be(e),t))}function Me(e,t){return e.flatMap((e=>{if(re(t[e.id])){const{children:t}=e;return[r(e,["children"])]}return Me(e.children,t)}))}const Ae=v({undoStack:[],redoStack:[]}),Be=f((()=>Ae.undoStack.concat(Ae.redoStack.concat().reverse()))),Ie=f((()=>Ae.undoStack.length-1));function Ce(){Ae.undoStack=[],Ae.redoStack=[]}function Ee(e){Ae.undoStack.push(e),Ae.redoStack=[]}function Oe(){const e=Ae.undoStack.pop();e&&(e.undo(),Ae.redoStack.push(e))}function Fe(){const e=Ae.redoStack.pop();e&&(e.redo(),Ae.undoStack.push(e))}function je(){return{state:Ae,allStack:Be,currentItemIndex:Ie,clearHistory:Ce,push:Ee,undo:Oe,redo:Fe}}const $e=je(),De=v(Z({name:"armature",borns:[Q({name:"born",head:{x:20,y:200},tail:{x:220,y:200}},!0)]},!0)),Le=v({armatures:[De],lastSelectedArmatureId:"",lastSelectedBornId:"",selectedArmatures:{},selectedBorns:{}}),Te=f((()=>Le.armatures.findIndex((e=>e.id===Le.lastSelectedArmatureId&&Le.selectedArmatures[Le.lastSelectedArmatureId])))),Ne=f((()=>-1!==Te.value?Le.armatures[Te.value]:void 0)),Pe=f((()=>Ne.value?Ne.value.borns.findIndex((e=>{var t,a;return e.id===Le.lastSelectedBornId&&((null==(t=Le.selectedBorns[Le.lastSelectedBornId])?void 0:t.head)||(null==(a=Le.selectedBorns[Le.lastSelectedBornId])?void 0:a.tail))})):-1)),_e=f((()=>{if(Ne.value)return-1!==Pe.value?Ne.value.borns[Pe.value]:void 0})),ze=f((()=>ee(Le.armatures))),Ke=f((()=>{var e,t;return ee(null!=(t=null==(e=Ne.value)?void 0:e.borns)?t:[])})),We=f((()=>function(e,t){const a=Object.keys(t).map((a=>{const n=[],r=fe(e[a],[e[a].transform]);return t[a].head&&n.push(r.head),t[a].tail&&n.push(r.tail),n})).flat();return s(a)}(Ke.value,Le.selectedBorns)));function Ue(){if(Le.lastSelectedArmatureId)return;const e=Le.armatures[0];e&&Ve(e.id)}function Ve(e=""){if(Le.lastSelectedArmatureId===e)return;const t=at(e);t.redo(),$e.push(t)}function Ge(e){if(!Ne.value)return;const t=function(e){const t=ne(Ne.value,e);return{name:"Update Armature",undo:()=>{const e=Te.value;Le.armatures[e]=n(n({},Le.armatures[e]),t)},redo:()=>{const t=Te.value;Le.armatures[t]=n(n({},Le.armatures[t]),e)}}}({name:e});t.redo(),$e.push(t)}function He(){const e=function(){const e=n({},Ne.value),t=Te.value,a=at("");return{name:"Delete Armature",undo:()=>{Le.armatures.splice(t,0,e),a.undo()},redo:()=>{Le.armatures.splice(t,1)}}}();e.redo(),$e.push(e)}function Re(){const e=function(e){const t=Le.armatures.length,a=at(e.id);return{name:"Add Armature",undo:()=>{Le.armatures.splice(t,1),a.undo()},redo:()=>{Le.armatures.push(e),a.redo()}}}(Z({name:ie("armature",Le.armatures.map((e=>e.name))),borns:[Q({name:"born",tail:{x:100,y:0}},!0)]},!0));e.redo(),$e.push(e)}function qe(){if(!Ne.value)return;const e=function(){const e=n({},Le.selectedBorns),t=Le.lastSelectedBornId;return{name:"Select All Born",undo:()=>{Le.selectedBorns=n({},e),Le.lastSelectedBornId=t},redo:()=>{Le.selectedBorns=Ne.value?Ne.value.borns.reduce(((e,t)=>(e[t.id]={head:!0,tail:!0},e)),{}):{}}}}();e.redo(),$e.push(e)}function Xe(e="",t={head:!0,tail:!0},a=!1,n=!1){if(!Ne.value)return;if(Le.lastSelectedBornId===e&&(r=Le.selectedBorns[e],l=t,!!(null==r?void 0:r.head)==!!(null==l?void 0:l.head)&&!!(null==r?void 0:r.tail)==!!(null==l?void 0:l.tail)))return;var r,l;const o=nt(e,t,a,n);o.redo(),$e.push(o)}function Ye(){if(!Ne.value)return;const e=function(){const e=Ne.value.borns.concat(),t=Ne.value.borns.filter((e=>!Le.selectedBorns[e.id])),a=rt(ye(t)),n=nt("");return{name:"Delete Born",undo:()=>{Ne.value.borns=e.concat(),n.undo(),a.undo()},redo:()=>{Ne.value.borns=t,a.redo()}}}();e.redo(),$e.push(e)}function Je(){Ne.value&&Qe([Q({name:ie("born",Ne.value.borns.map((e=>e.name))),tail:{x:100,y:0}},!0)])}function Qe(e,t){if(!Ne.value)return;const a=function(e,t){const a=e.map(((e,a)=>nt(e.id,t[e.id],0!==a)));return{name:"Add Born",undo:()=>{Ne.value.borns=Ne.value.borns.slice(0,Ne.value.borns.length-e.length),a.forEach((e=>e.undo()))},redo:()=>{Ne.value.borns=Ne.value.borns.concat(e),a.forEach((e=>e.redo()))}}}(e,e.reduce(((e,a)=>(t&&(e[a.id]=n({},t)),e)),{}));a.redo(),$e.push(a)}function Ze(e){if(!Ne.value)return;const t=rt(e);t.redo(),$e.push(t)}function et(e){if(!Ne.value)return;if(!_e.value)return;const t=function(e){const t=ne(_e.value,e);return{name:"Update Born",undo:()=>{const e=Pe.value;Ne.value.borns[e]=n(n({},Ne.value.borns[e]),t)},redo:()=>{const t=Pe.value;Ne.value.borns[t]=n(n({},Ne.value.borns[t]),e)}}}(function(e,t){if(!t.connected)return t;const a=pe(e,t.parentId);return n(n({},t),a?{head:a.tail}:{connected:!1,parentId:""})}(Ne.value.borns,n(n({},_e.value),e)));t.redo(),$e.push(t)}function tt(){return{state:Le,lastSelectedArmature:Ne,lastSelectedBorn:_e,bornMap:Ke,selectedBornsOrigin:We,selectAllArmature:Ue,selectArmature:Ve,updateArmatureName:Ge,deleteArmature:He,addArmature:Re,selectAllBorn:qe,selectBorn:Xe,deleteBorn:Ye,addBorn:Je,addBorns:Qe,updateBorns:Ze,updateBorn:et}}function at(e){const t=n({},Le.selectedArmatures),a=Le.lastSelectedArmatureId;return{name:"Select Armature",undo:()=>{Le.selectedArmatures=n({},t),Le.lastSelectedArmatureId=a},redo:()=>{Le.selectedArmatures=e?{[e]:!0}:{},Le.lastSelectedArmatureId=e}}}function nt(e,t={head:!0,tail:!0},a=!1,r=!1){const l=n({},Le.selectedBorns),o=Le.lastSelectedBornId;return{name:"Select Born",undo:()=>{Le.selectedBorns=n({},l),Le.lastSelectedBornId=o},redo:()=>{Le.selectedBorns=e?ae(n(n({},a?Le.selectedBorns:{}),{[e]:t}),he(Ne.value,e,t,r)):{},Le.lastSelectedBornId=e}}}function rt(e){const t=ae(e,ye(Ne.value.borns.map((t=>n(n({},t),e[t.id]))))),a=Object.keys(t).reduce(((e,a)=>(Ke.value[a]&&(e[a]=ne(Ke.value[a],t[a])),e)),{});return{name:"Update Born",undo:()=>{Ne.value.borns=Ne.value.borns.map((e=>n(n({},e),a[e.id])))},redo:()=>{Ne.value.borns=Ne.value.borns.map((e=>n(n({},e),t[e.id])))}}}p((()=>Le.selectedArmatures),(()=>{Le.selectedArmatures[Le.lastSelectedArmatureId]||(Le.lastSelectedArmatureId="")})),p((()=>ze.value),(()=>{Le.selectedArmatures=Object.keys(Le.selectedArmatures).reduce(((e,t)=>ze.value[t]?n(n({},e),{[t]:Le.selectedArmatures[t]}):e),{})})),p((()=>Le.selectedBorns),(()=>{if(!re(Le.selectedBorns[Le.lastSelectedBornId])){const e=Object.keys(Le.selectedBorns);Le.lastSelectedBornId=e.length>0?e[0]:""}})),p((()=>Ke.value),(()=>{Le.selectedBorns=Object.keys(Le.selectedBorns).reduce(((e,t)=>Ke.value[t]?n(n({},e),{[t]:Le.selectedBorns[t]}):e),{})}));var lt=h({props:{origin:{type:Object,required:!0},current:{type:Object,required:!0},scale:{type:Number,required:!0},side:{type:Boolean,default:!1}},setup:e=>({rotate:f((()=>y(e.current,e.origin)/Math.PI*180))})});const ot={fill:"black",stroke:"black"},st=g("circle",{r:"2"},null,-1),ct=g("circle",{r:"2"},null,-1),dt=g("path",{d:"M-20,0L-10,-10L-10,10z"},null,-1),it=g("path",{d:"M20,0L10,-10L10,10z"},null,-1);function ut(e){const t=v({command:"",editMovement:void 0}),a=tt(),r=f((()=>a.state.selectedBorns)),l=f((()=>{var e;return null==(e=a.lastSelectedBorn.value)?void 0:e.id})),o=f((()=>a.lastSelectedArmature.value)),s=f((()=>!!l.value)),c=f((()=>{var e,t;return null!=(t=null==(e=o.value)?void 0:e.borns.map((e=>e.name)))?t:[]}));function d(){t.command="",t.editMovement=void 0}function u(e,t=!1){return n({},function(e,t=!1){const a=t?e.head:e.tail;return Q({head:a,tail:a,parentId:t?e.parentId:e.id,connected:!t||e.connected},!0)}(e,t))}const m=f((()=>{if(!t.editMovement)return{};if("scale"===t.command){const n=a.selectedBornsOrigin.value,l=e.isOppositeSide(n,t.editMovement.start,t.editMovement.current),o=k(k({x:1,y:1},l?-1:1),w(t.editMovement.current,n)/w(t.editMovement.start,n)),s=e.snapScale(o);return Object.keys(r.value).reduce(((e,t)=>(e[t]=J({origin:n,scale:s}),e)),{})}if("rotate"===t.command){const e=a.selectedBornsOrigin.value,n=(y(t.editMovement.current,e)-y(t.editMovement.start,e))/Math.PI*180;return Object.keys(r.value).reduce(((t,a)=>(t[a]=J({origin:e,rotate:n}),t)),{})}const n=i(t.editMovement.current,t.editMovement.start),l=e.snapTranslate(n);return Object.keys(r.value).reduce(((e,t)=>(e[t]=J({translate:l}),e)),{})})),p=f((()=>Object.keys(m.value).reduce(((e,t)=>(e[t]=ve(a.bornMap.value[t],m.value[t],r.value[t]),e)),{})));function h(){o.value&&(a.updateBorns(p.value),t.editMovement=void 0,t.command="")}return{command:f((()=>t.command)),getEditTransforms:e=>m.value[e]||J(),end:()=>d(),cancel:d,setEditMode:function(e){if(o.value&&(d(),s.value&&(t.command=e,"extrude"===e))){const e={},t=c.value.concat(),n=[];Object.keys(r.value).forEach((l=>{const o=r.value[l],s=a.bornMap.value[l],c=[];o.tail&&c.push(u(s)),o.head&&c.push(u(s,!0)),c.forEach((a=>{e[a.parentId]||(a.name=ie(s.name,t),n.push(a),t.push(a.name),e[a.parentId]=!0)}))})),a.addBorns(n,{tail:!0})}},select:function(e,n){t.command?h():a.selectBorn(e,n)},shiftSelect:function(e,n){t.command?h():a.selectBorn(e,n,!0)},selectAll:function(){t.command?h():a.selectAllBorn()},mousemove:function(e){t.command&&(t.editMovement=e)},clickAny:function(){t.command&&h()},clickEmpty:function(){t.command?h():a.selectBorn()},execDelete:function(){""===t.command&&a.deleteBorn()},execAdd:function(){""===t.command&&a.addBorn()}}}lt.render=function(e,t,a,n,r,l){return x(),b("g",ot,[g("g",{transform:`translate(${e.origin.x}, ${e.origin.y}) rotate(${e.rotate}) scale(${e.scale})`},[st],8,["transform"]),g("line",{x1:e.origin.x,y1:e.origin.y,x2:e.current.x,y2:e.current.y,"stroke-width":e.scale,"stroke-dasharray":`${2*e.scale} ${2*e.scale}`},null,8,["x1","y1","x2","y2","stroke-width","stroke-dasharray"]),g("g",{transform:`translate(${e.current.x}, ${e.current.y}) rotate(${e.rotate}) scale(${e.scale})`},[ct,g("g",{transform:`rotate(${e.side?90:0})`},[dt,it],8,["transform"])],8,["transform"])])};const mt=je();function vt(e,t){const a=n({},e.selectedMap),r=e.lastSelectedId;return{name:`Select ${e.label}`,undo:()=>{e.selectedMap=n({},a),e.lastSelectedId=r},redo:()=>{e.selectedMap=t?{[t]:!0}:{},e.lastSelectedId=t}}}function ft(e){return Math.round(function(e){return Math.round(Math.log(e)/Math.log(1.1))}(e)/2)+1}function pt(e,t,a){return Y(function(e,t){return Y(e,(e=>function(e,t){if(0===e.length)return[];const a=e.findIndex((e=>t<=e.frame));if(-1===a)return[e[e.length-1]];const n=e[a];if(n.frame===t||0===a)return[n];const r=e[a-1];return r.frame===t?[r]:[r,n]}(e,t)))}(e,t),(e=>function(e,t,a=(e=>e)){if(0===e.length)return J();if(1===e.length)return e[0].transform;const n=e[0],r=e[1],l=a((t-n.frame)/(r.frame-n.frame));return function(e,t,a){return J({scale:u(e.scale,t.scale,a),rotate:m(e.rotate,t.rotate,a),translate:u(e.translate,t.translate,a)})}(n.transform,r.transform,l)}(e,t,a)))}const ht=S(0),yt=S(60),bt=function(e){const t=v({label:e,list:[],lastSelectedId:"",selectedMap:{}}),a=f((()=>t.list.findIndex((e=>e.id===t.lastSelectedId&&t.selectedMap[t.lastSelectedId])))),r=f((()=>ee(t.list))),l=f((()=>-1!==a.value?t.list[a.value]:void 0));return p((()=>t.selectedMap),(()=>{t.selectedMap[t.lastSelectedId]||(t.lastSelectedId="")})),p((()=>r.value),(()=>{t.selectedMap=Object.keys(t.selectedMap).reduce(((e,a)=>r.value[a]?n(n({},e),{[a]:t.selectedMap[a]}):e),{})})),{state:t,itemMap:r,lastSelectedItem:l,selectItem:function(e){if(t.lastSelectedId===e)return;const a=vt(t,e);a.redo(),mt.push(a)},addItem:function(e){const a=function(e,t){const a=e.list.length,n=vt(e,t.id),r=()=>{e.list.push(t),n.redo()};return{name:`Add ${e.label}`,undo:()=>{e.list.splice(a,1),n.undo()},redo:r}}(t,e);a.redo(),mt.push(a)},deleteItem:function(){if(-1===a.value)return;const e=function(e,t){const a=n({},e.list[t]),r=t,l=vt(e,""),o=()=>{e.list.splice(r,1)};return{name:`Delete ${e.label}`,undo:()=>{e.list.splice(r,0,a),l.undo()},redo:o}}(t,a.value);e.redo(),mt.push(e)},updateItem:function(e){if(-1===a.value)return;const r=function(e,t,a){const r=ne(e.list[a],t),l=()=>{e.list[a]=n(n({},e.list[a]),t)};return{name:`Update ${e.label}`,undo:()=>{e.list[a]=n(n({},e.list[a]),r)},redo:l}}(t,e,a.value);r.redo(),mt.push(r)}}}("Action"),gt=S({}),xt=je(),kt=tt(),wt=f((()=>{var e,t;return X(null!=(t=null==(e=bt.lastSelectedItem.value)?void 0:e.keyframes)?t:[],"frame")})),St=f((()=>{var e,t;return X(null!=(t=null==(e=bt.lastSelectedItem.value)?void 0:e.keyframes)?t:[],"bornId")})),Mt=f((()=>{var e,t,a,n;return a=null!=(t=null==(e=bt.lastSelectedItem.value)?void 0:e.keyframes)?t:[],n=ht.value,a.filter((e=>e.frame===n))})),At=f((()=>pt(St.value,ht.value)));f((()=>te(Mt.value)));const Bt=f((()=>Array.from(new Set(Object.keys(gt.value).concat(Object.keys(St.value)))))),It=f((()=>Bt.value.reduce(((e,t)=>{var a,n;return e[t]=ue([(a=t,null!=(n=At.value[a])?n:J()),Tt(t)]),e}),{}))),Ct=f((()=>kt.lastSelectedArmature.value?xe(ee(kt.lastSelectedArmature.value.borns.map((e=>n(n({},e),{transform:Nt(e.id)}))))):{})),Et=f((()=>{return e=Ct.value,t=kt.state.selectedBorns,ee(Object.keys(e).filter((e=>re(t[e]))).map((t=>e[t])));var e,t})),Ot=f((()=>Se(Ct.value,kt.state.selectedBorns))),Ft=f((()=>kt.lastSelectedArmature.value?function(e){const t=Object.keys(e).map((t=>fe(e[t],[e[t].transform]).head));return s(t)}(Ot.value):{x:0,y:0}));function jt(){kt.lastSelectedArmature.value&&bt.addItem(function(e={},t=!1){return n({id:t?l():"",name:"",totalFrame:60,armatureId:"",keyframes:[]},e)}({name:ie("action",bt.state.list.map((e=>e.name))),armatureId:kt.lastSelectedArmature.value.id},!0))}function $t(e){if(yt.value===e)return;const t=function(e){const t=yt.value;return{name:"Update End Frame",undo:()=>{yt.value=t},redo:()=>{yt.value=e}}}(e);t.redo(),xt.push(t)}function Dt(e){const t=function(e){const t=n({},gt.value);return{name:"Update Pose",undo:()=>{gt.value=t},redo:()=>{gt.value=e}}}(e);t.redo(),xt.push(t)}function Lt(e){Dt(Array.from(new Set(Object.keys(gt.value).concat(Object.keys(e)))).reduce(((t,a)=>{var n;return t[a]=ue([Tt(a),null!=(n=e[a])?n:J()]),t}),{}))}function Tt(e){var t;return null!=(t=gt.value[e])?t:J()}function Nt(e){var t;return null!=(t=It.value[e])?t:J()}function Pt(){if(!bt.lastSelectedItem.value)return;const e=function(e){const t=te(e),a=ht.value,r=n({},gt.value),l=bt.lastSelectedItem.value.keyframes.filter((e=>e.frame===a&&t[e.bornId]));return{name:"Insert Keyframe",undo:()=>{const e=bt.lastSelectedItem.value.keyframes.filter((e=>!(e.frame===a&&t[e.bornId]))).concat(l);ht.value=a,bt.lastSelectedItem.value.keyframes=e,gt.value=r},redo:()=>{const n=bt.lastSelectedItem.value.keyframes.filter((e=>!(e.frame===a&&t[e.bornId]))).concat(e);var r,l;ht.value=a,bt.lastSelectedItem.value.keyframes=n,gt.value=(r=gt.value,l=t,Object.keys(r).reduce(((e,t)=>(t in l||(e[t]=r[t]),e)),{}))}}}(Object.keys(Et.value).map((e=>function(e={},t=!1){return n({id:t?l():"",frame:0,bornId:"",transform:J()},e)}({frame:ht.value,bornId:e,transform:Nt(e)},!0))));e.redo(),xt.push(e)}function _t(e){ht.value=e,gt.value={}}function zt(){return{currentFrame:ht,endFrame:yt,actions:bt.state.list,keyframeMapByFrame:wt,keyframeMapByBornId:St,posedBornIds:Bt,currentPosedBorns:Ct,selectedAllBorns:Et,selectedBorns:Ot,selectedPosedBornOrigin:Ft,getCurrentSelfTransforms:Nt,setEndFrame:$t,selectedAction:bt.lastSelectedItem,selectAction:bt.selectItem,addAction:jt,deleteAction:bt.deleteItem,updateAction:e=>bt.updateItem(e),applyEditedTransforms:Lt,execInsertKeyframe:Pt,setCurrentFrame:_t}}const Kt=je(),Wt=v({canvasMode:"object",pastCanvasMode:"edit",axisGrid:""}),Ut=f((()=>"edit"===Wt.canvasMode?ut(ea()):"pose"===Wt.canvasMode?function(e){const t=v({command:"",editMovement:void 0}),a=tt(),n=zt(),r=f((()=>{var e;return null==(e=a.lastSelectedBorn.value)?void 0:e.id})),l=f((()=>a.lastSelectedArmature.value)),o=f((()=>!!r.value));function s(){t.command="",t.editMovement=void 0}function c(e,t){const a=n.currentPosedBorns.value[t],r=n.currentPosedBorns.value[a.parentId];return r?d(e,-r.transform.rotate/180*Math.PI):e}const u=f((()=>{if(!t.editMovement)return{};if("rotate"===t.command){const e=n.selectedPosedBornOrigin.value,a=(y(t.editMovement.current,e)-y(t.editMovement.start,e))/Math.PI*180;return Object.keys(n.selectedBorns.value).reduce(((e,t)=>(e[t]=J({rotate:a}),e)),{})}const a=i(t.editMovement.current,t.editMovement.start),r=e.snapTranslate(a);return Object.keys(n.selectedBorns.value).reduce(((e,t)=>(n.selectedBorns.value[t].connected||(e[t]=J({translate:c(r,t)})),e)),{})}));function m(){l.value&&(n.applyEditedTransforms(u.value),t.editMovement=void 0,t.command="")}return{command:f((()=>t.command)),getEditTransforms(e){var t;return null!=(t=u.value[e])?t:J()},end:()=>s(),cancel:s,setEditMode:function(e){l.value&&(s(),o.value&&(t.command=e))},select:function(e,n){t.command?m():a.selectBorn(e,n,!1,!0)},shiftSelect:function(e,n){t.command?m():a.selectBorn(e,n,!0,!0)},selectAll:function(){t.command?m():a.selectAllBorn()},mousemove:function(e){t.command&&(t.editMovement=e)},clickAny:function(){t.command&&m()},clickEmpty:function(){t.command?m():a.selectBorn()},execDelete:()=>{},execAdd:()=>{}}}(ea()):function(){const e=v({command:"",editMovement:void 0}),t=tt(),a=f((()=>t.lastSelectedArmature.value));function n(){e.command="",e.editMovement=void 0}const r=f((()=>({})));function l(){a.value&&(e.editMovement=void 0,e.command="")}return{command:f((()=>e.command)),getEditTransforms:e=>r.value[e]||J(),end:()=>n(),cancel:n,setEditMode:function(t){a.value&&(n(),e.command=t)},select:function(a,n){e.command?l():t.selectBorn(a,n)},shiftSelect:function(a,n){e.command?l():t.selectBorn(a,n,!0)},selectAll:function(){e.command?l():t.selectAllArmature()},mousemove:function(t){e.command&&(e.editMovement=t)},clickAny:function(){e.command&&l()},clickEmpty:function(){e.command?l():t.selectArmature()},execDelete:function(){""===e.command&&t.deleteArmature()},execAdd:function(){""===e.command&&t.addArmature()}}}()));p(Ut,((e,t)=>{t&&t.end()}));const Vt=f((()=>Ut.value.command.value));function Gt(){"edit"===Wt.canvasMode?Rt(Wt.pastCanvasMode):Rt("edit")}function Ht(){"edit"===Wt.canvasMode?"object"===Wt.pastCanvasMode?Rt("pose"):Rt("object"):"object"===Wt.canvasMode?Rt("pose"):Rt("object")}function Rt(e){const t=function(e){const t=Wt.canvasMode,a=Wt.pastCanvasMode;return{name:"Change Mode",undo:()=>{Wt.canvasMode=t,Wt.pastCanvasMode=a},redo:()=>{Wt.pastCanvasMode=Wt.canvasMode,Wt.canvasMode=e}}}(e);Kt.push(t),t.redo()}function qt(e){Wt.axisGrid=e}function Xt(e){Wt.axisGrid=Wt.axisGrid===e?"":e}function Yt(e){return{x:"y"===Wt.axisGrid?1:e.x,y:"x"===Wt.axisGrid?1:e.y}}function Jt(e){return{x:"y"===Wt.axisGrid?0:e.x,y:"x"===Wt.axisGrid?0:e.y}}function Qt(e,t,a){return M(i(t,e),i(a,e))<0}function Zt(e){return Ut.value.getEditTransforms(e)}function ea(){return{state:Wt,command:Vt,toggleCanvasMode:Gt,ctrlToggleCanvasMode:Ht,setCanvasMode:Rt,setAxisGrid:qt,switchAxisGrid:Xt,snapScale:Yt,snapTranslate:Jt,isOppositeSide:Qt,getEditTransforms:Zt,mousemove:e=>Ut.value.mousemove(e),clickAny:()=>Ut.value.clickAny(),clickEmpty:()=>Ut.value.clickEmpty(),cancel:()=>Ut.value.cancel(),setEditMode:e=>Ut.value.setEditMode(e),execDelete:()=>Ut.value.execDelete(),execAdd:()=>Ut.value.execAdd(),select:(e,t)=>Ut.value.select(e,t),shiftSelect:(e,t)=>Ut.value.shiftSelect(e,t),selectAll:()=>Ut.value.selectAll()}}const ta=v({size:{width:100,height:100}});function aa(){return{state:ta}}window.addEventListener("resize",(()=>{ta.size={width:window.innerWidth,height:window.innerHeight}}));var na=h({components:{ScaleMarker:lt},props:{originalViewBox:{type:Object,default:()=>({x:0,y:0,width:600,height:400})},currentCommand:{type:String,default:""}},emits:["mousemove","click-any","click-empty","escape","tab","ctrl-tab","g","s","r","e","x","y","a","shift-a","i"],setup(e,{emit:t}){const a=v({width:600,height:400}),r=S(),l=S(),s=S(),c=S(),d=S(1),u=S({x:0,y:0}),m=S(),h=tt(),y=ea(),b=zt();function g(e){return o(u.value,k(e,d.value))}const x=f((()=>"edit"===y.state.canvasMode?h.selectedBornsOrigin.value:b.selectedPosedBornOrigin.value)),w=f((()=>({x:u.value.x,y:u.value.y,width:a.width*d.value,height:a.height*d.value}))),M=f((()=>se(w.value))),C=f((()=>I(n({x:0,y:0},a)))),E=f((()=>{if(""!==y.state.axisGrid&&s.value)return function(e,t,a,r){return n(n({},{strokeWidth:e}),"x"===t?{from:{x:a.x,y:r.y},to:{x:a.x+a.width,y:r.y},stroke:"red"}:{from:{x:r.x,y:a.y},to:{x:r.x,y:a.y+a.height},stroke:"green"})}(d.value,y.state.axisGrid,w.value,x.value)})),O=f((()=>{if(c.value&&["scale","rotate"].includes(e.currentCommand))return{origin:x.value,current:g(c.value),side:"rotate"===e.currentCommand}}));function F(){if(!l.value)return;const e=l.value.getBoundingClientRect();a.width=e.width,a.height=e.height}p((()=>e.currentCommand),(e=>{y.setAxisGrid(""),""===e&&(s.value=void 0)}));const j=aa();return A(F),p((()=>j.state.size),F),{scale:d,viewSize:a,svg:r,wrapper:l,viewBox:M,gridLineElm:E,scaleNaviElm:O,canvasMode:f((()=>y.state.canvasMode)),focus(){r.value&&r.value.focus()},wheel(e){const t=c.value?c.value:C.value,a=g(t);d.value=d.value*Math.pow(1.1,e.deltaY>0?1:-1);const n=g(t);u.value=o(u.value,i(a,n))},downMiddle(){c.value&&(m.value={origin:n({},u.value),downAt:n({},c.value)})},upMiddle(){m.value=void 0},leave(){m.value=void 0},mousemove:e=>{if(c.value=B(e),m.value)u.value=o(m.value.origin,k(i(m.value.downAt,c.value),d.value));else{if(!s.value)return;t("mousemove",{current:g(c.value),start:g(s.value)})}},clickAny(e){e.target===r.value?(s.value=void 0,t("click-empty")):t("click-any")},keyDownTab:()=>{t("tab")},keyDownCtrlTab:()=>t("ctrl-tab"),keyDownEscape:()=>{t("escape")},editKeyDown(a){c.value&&(!["grab","scale"].includes(e.currentCommand)||"x"!==a&&"y"!==a?(s.value=c.value,t(a)):y.switchAxisGrid(a))}}}});const ra=D("data-v-7afb009e");L("data-v-7afb009e");const la={ref:"wrapper",class:"app-canvas-root"},oa={class:"help"};T();const sa=ra(((e,t,a,n,r,l)=>{const o=C("ScaleMarker");return x(),b("div",la,[(x(),b("svg",{ref:"svg",tabindex:"-1",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"none","font-family":"sans-serif",viewBox:e.viewBox,width:e.viewSize.width,height:e.viewSize.height,onWheel:t[1]||(t[1]=E(((...t)=>e.wheel&&e.wheel(...t)),["prevent"])),onClick:t[2]||(t[2]=E(((...t)=>e.clickAny&&e.clickAny(...t)),["left"])),onContextmenu:t[3]||(t[3]=E(((...t)=>e.keyDownEscape&&e.keyDownEscape(...t)),["right","prevent"])),onMouseenter:t[4]||(t[4]=(...t)=>e.focus&&e.focus(...t)),onMousemove:t[5]||(t[5]=E(((...t)=>e.mousemove&&e.mousemove(...t)),["prevent"])),onMousedown:t[6]||(t[6]=E(((...t)=>e.downMiddle&&e.downMiddle(...t)),["middle","prevent"])),onMouseup:t[7]||(t[7]=E(((...t)=>e.upMiddle&&e.upMiddle(...t)),["middle","prevent"])),onMouseleave:t[8]||(t[8]=(...t)=>e.leave&&e.leave(...t)),onKeydown:[t[9]||(t[9]=O(E(((...t)=>e.keyDownEscape&&e.keyDownEscape(...t)),["exact","prevent"]),["escape"])),t[10]||(t[10]=O(E(((...t)=>e.keyDownTab&&e.keyDownTab(...t)),["exact","prevent"]),["tab"])),t[11]||(t[11]=O(E(((...t)=>e.keyDownCtrlTab&&e.keyDownCtrlTab(...t)),["shift","exact","prevent"]),["tab"])),t[12]||(t[12]=O(E((t=>e.editKeyDown("g")),["exact","prevent"]),["g"])),t[13]||(t[13]=O(E((t=>e.editKeyDown("s")),["exact","prevent"]),["s"])),t[14]||(t[14]=O(E((t=>e.editKeyDown("r")),["exact","prevent"]),["r"])),t[15]||(t[15]=O(E((t=>e.editKeyDown("e")),["exact","prevent"]),["e"])),t[16]||(t[16]=O(E((t=>e.editKeyDown("x")),["exact","prevent"]),["x"])),t[17]||(t[17]=O(E((t=>e.editKeyDown("y")),["exact","prevent"]),["y"])),t[18]||(t[18]=O(E((t=>e.editKeyDown("a")),["exact","prevent"]),["a"])),t[19]||(t[19]=O(E((t=>e.editKeyDown("shift-a")),["shift","exact","prevent"]),["a"])),t[20]||(t[20]=O(E((t=>e.editKeyDown("i")),["exact","prevent"]),["i"]))]},[g("rect",{x:e.originalViewBox.x,y:e.originalViewBox.y,width:e.originalViewBox.width,height:e.originalViewBox.height,fill:"none",stroke:"black","stroke-width":"1","stroke-dasharray":"4 4"},null,8,["x","y","width","height"]),e.gridLineElm?(x(),b("line",{key:0,x1:e.gridLineElm.from.x,y1:e.gridLineElm.from.y,x2:e.gridLineElm.to.x,y2:e.gridLineElm.to.y,stroke:e.gridLineElm.stroke,"stroke-width":e.gridLineElm.strokeWidth},null,8,["x1","y1","x2","y2","stroke","stroke-width"])):F("",!0),j(e.$slots,"default"),e.scaleNaviElm?(x(),b(o,{key:1,origin:e.scaleNaviElm.origin,current:e.scaleNaviElm.current,scale:e.scale,side:e.scaleNaviElm.side},null,8,["origin","current","scale","side"])):F("",!0)],40,["viewBox","width","height"])),g("div",oa,[g("p",null,"Mode: "+$(e.canvasMode),1)])],512)}));na.render=sa,na.__scopeId="data-v-7afb009e";var ca=h({props:{tabs:{type:Array,default:()=>[]}},setup(e){var t,a;const n=S(null!=(a=null==(t=e.tabs[0])?void 0:t.key)?a:"");return{current:n,setTab:e=>n.value=e}}});const da=D("data-v-16db2673");L("data-v-16db2673");const ia={class:"tab-panel-root"},ua={class:"panels"};T();const ma=da(((e,t,a,n,r,l)=>(x(),b("div",ia,[g("ul",null,[(x(!0),b(N,null,P(e.tabs,(t=>(x(),b("li",{key:t.key,class:{current:t.key===e.current}},[g("a",{href:"#",onClick:E((a=>e.setTab(t.key)),["prevent"])},$(t.label),9,["onClick"])],2)))),128))]),g("div",ua,[(x(!0),b(N,null,P(e.tabs,(t=>_((x(),b("div",{key:t.key},[j(e.$slots,t.key)],512)),[[z,t.key===e.current]]))),128))])]))));ca.render=ma,ca.__scopeId="data-v-16db2673";var va=h({setup(){const e=je();return{allStack:f((()=>e.allStack.value)),currentItemIndex:f((()=>e.currentItemIndex.value))}}});const fa=D("data-v-65f8ee82");L("data-v-65f8ee82");const pa=g("h3",null,"history",-1);T();const ha=fa(((e,t,a,n,r,l)=>(x(),b("div",null,[pa,g("ul",null,[(x(!0),b(N,null,P(e.allStack,((t,a)=>(x(),b("li",{key:a,class:{current:a===e.currentItemIndex}},$(t.name),3)))),128))])]))));va.render=ha,va.__scopeId="data-v-65f8ee82";var ya=h({props:{options:{type:Array,default:()=>[]},modelValue:{type:[Number,String],default:""}},emits:["update:modelValue"],setup:(e,{emit:t})=>({value:f({get:()=>e.modelValue,set(e){t("update:modelValue",e)}})})});const ba=D("data-v-fddf1844");L("data-v-fddf1844");const ga={class:"select-root"},xa=g("option",{value:""},"-- None --",-1);T();const ka=ba(((e,t,a,n,r,l)=>(x(),b("span",ga,[_(g("select",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.value=t)},[xa,(x(!0),b(N,null,P(e.options,(e=>(x(),b("option",{key:e.value,value:e.value},$(e.label),9,["value"])))),128))],512),[[K,e.value]])]))));ya.render=ka,ya.__scopeId="data-v-fddf1844";var wa=h({components:{TabPanel:ca,HistoryStack:va,SelectField:ya},setup(){const e=tt(),t=S(""),a=f((()=>e.lastSelectedArmature.value?e.lastSelectedArmature.value.borns.filter((t=>{var a;return t.id!==(null==(a=e.lastSelectedBorn.value)?void 0:a.id)})).map((e=>({value:e.id,label:e.name}))):[])),n=f((()=>e.lastSelectedBorn.value?"born":e.lastSelectedArmature.value?"armature":""));function r(){e.lastSelectedBorn.value?t.value=e.lastSelectedBorn.value.name:e.lastSelectedArmature.value?t.value=e.lastSelectedArmature.value.name:t.value=""}return p(e.lastSelectedArmature,r),p(e.lastSelectedBorn,r),{draftName:t,lastSelectedArmature:e.lastSelectedArmature,lastSelectedBorn:e.lastSelectedBorn,parentOptions:a,selectedObjectType:n,connected:f({get(){var t,a;return null!=(a=null==(t=e.lastSelectedBorn.value)?void 0:t.connected)&&a},set(t){e.updateBorn({connected:t})}}),parentId:f({get(){var t,a;return null!=(a=null==(t=e.lastSelectedBorn.value)?void 0:t.parentId)?a:""},set(t){e.updateBorn({parentId:t})}}),changeArmatureName(){t.value&&e.updateArmatureName(t.value)},changeBornName(){t.value&&e.updateBorn({name:t.value})}}}});const Sa=D("data-v-a1a2983c");L("data-v-a1a2983c");const Ma=g("h3",null,"Armature",-1),Aa={class:"field inline"},Ba=g("label",null,"Name",-1),Ia=g("h3",null,"Born",-1),Ca={class:"field inline"},Ea=g("label",null,"Name",-1),Oa={class:"field inline"},Fa=g("label",null,"Parent",-1),ja={class:"field inline"},$a=g("label",null,"Connect",-1);T();const Da=Sa(((e,t,a,n,r,l)=>{const o=C("SelectField"),s=C("HistoryStack"),c=C("TabPanel");return x(),b("div",null,[g(c,{tabs:[{key:"detail",label:"Detail"},{key:"history",label:"History"}]},{detail:Sa((()=>["armature"===e.selectedObjectType?(x(),b("form",{key:0,onSubmit:t[3]||(t[3]=E((()=>{}),["prevent"]))},[Ma,g("div",Aa,[Ba,_(g("input",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.draftName=t),type:"text",onChange:t[2]||(t[2]=(...t)=>e.changeArmatureName&&e.changeArmatureName(...t))},null,544),[[W,e.draftName]])])],32)):F("",!0),"born"===e.selectedObjectType?(x(),b("form",{key:1,onSubmit:t[8]||(t[8]=E((()=>{}),["prevent"]))},[Ia,g("div",Ca,[Ea,_(g("input",{"onUpdate:modelValue":t[4]||(t[4]=t=>e.draftName=t),type:"text",onChange:t[5]||(t[5]=(...t)=>e.changeBornName&&e.changeBornName(...t))},null,544),[[W,e.draftName]])]),g("div",Oa,[Fa,g(o,{modelValue:e.parentId,"onUpdate:modelValue":t[6]||(t[6]=t=>e.parentId=t),options:e.parentOptions},null,8,["modelValue","options"])]),g("div",ja,[$a,_(g("input",{"onUpdate:modelValue":t[7]||(t[7]=t=>e.connected=t),type:"checkbox",disabled:!e.parentId},null,8,["disabled"]),[[U,e.connected]])])],32)):F("",!0)])),history:Sa((()=>[g(s)])),_:1})])}));wa.render=Da,wa.__scopeId="data-v-a1a2983c";var La=h({emits:["down-left","up-left","mousemove","drag","click-any","click-empty","escape","g","x"],setup(e,{emit:t}){const a=S(),r=S(),l=function(e={}){const t=v({width:600,height:100}),a=S(),r=S(),l=S(1),s=S({x:0,y:0}),c=S(),d=S(),u=f((()=>({x:s.value.x,y:s.value.y,width:t.width*l.value,height:t.height*l.value}))),m=f((()=>I(n({x:0,y:0},t)))),p=f((()=>se(u.value)));function h(e){return o(s.value,k(e,l.value))}return{viewSize:t,editStartPoint:a,mousePoint:r,scale:l,viewOrigin:s,dragInfo:d,viewMovingInfo:c,viewCenter:m,viewBox:p,viewToCanvas:h,wheel(t,a=!1){var n,c;const d=!a&&r.value?r.value:m.value,u=h(d);l.value=Math.min(Math.max(l.value*Math.pow(1.1,t.deltaY>0?1:-1),null!=(n=e.scaleMin)?n:0),null!=(c=e.scaleMax)?c:10);const v=h(d);s.value=o(s.value,i(u,v))},downLeft(){r.value&&(d.value={})},upLeft(){d.value=void 0},downMiddle(){r.value&&(c.value={origin:n({},s.value),downAt:n({},r.value)})},upMiddle(){c.value=void 0},leave(){c.value=void 0},viewMove(){c.value&&r.value&&(s.value=o(c.value.origin,k(i(c.value.downAt,r.value),l.value)))}}}({scaleMin:1});function s(){if(!r.value)return;const e=r.value.getBoundingClientRect();l.viewSize.width=e.width,l.viewSize.height=e.height}const c=aa();return A(s),p((()=>c.state.size),s),{scale:l.scale,viewOrigin:l.viewOrigin,viewSize:f((()=>l.viewSize)),wrapper:r,svg:a,viewBox:l.viewBox,focus(){a.value&&a.value.focus()},wheel:e=>l.wheel(e,!0),downLeft:()=>{l.mousePoint.value&&(l.downLeft(),t("down-left",l.viewToCanvas(l.mousePoint.value)))},upLeft:()=>{l.upLeft(),t("up-left")},downMiddle:l.downMiddle,upMiddle:l.upMiddle,leave:l.leave,mousemove:e=>{l.mousePoint.value=B(e),l.dragInfo.value?t("drag",l.viewToCanvas(l.mousePoint.value)):l.viewMovingInfo.value?l.viewMove():l.editStartPoint.value&&t("mousemove",{current:l.viewToCanvas(l.mousePoint.value),start:l.viewToCanvas(l.editStartPoint.value)})},clickAny(e){e.target===a.value?(l.editStartPoint.value=void 0,t("click-empty")):t("click-any")},keyDownEscape:()=>{t("escape")},editKeyDown(e){l.mousePoint.value&&(l.editStartPoint.value=l.mousePoint.value,t(e))}}}});const Ta=D("data-v-5868f1c8");L("data-v-5868f1c8");const Na={ref:"wrapper",class:"timeline-canvas-root"};T();const Pa=Ta(((e,t,a,n,r,l)=>(x(),b("div",Na,[(x(),b("svg",{ref:"svg",tabindex:"-1",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"none","font-family":"sans-serif",viewBox:e.viewBox,width:e.viewSize.width,height:e.viewSize.height,onWheel:t[1]||(t[1]=E(((...t)=>e.wheel&&e.wheel(...t)),["prevent"])),onClick:t[2]||(t[2]=E(((...t)=>e.clickAny&&e.clickAny(...t)),["left"])),onContextmenu:t[3]||(t[3]=E(((...t)=>e.keyDownEscape&&e.keyDownEscape(...t)),["right","prevent"])),onMouseenter:t[4]||(t[4]=(...t)=>e.focus&&e.focus(...t)),onMousedown:[t[5]||(t[5]=E(((...t)=>e.downLeft&&e.downLeft(...t)),["left","prevent"])),t[8]||(t[8]=E(((...t)=>e.downMiddle&&e.downMiddle(...t)),["middle","prevent"]))],onMouseup:[t[6]||(t[6]=E(((...t)=>e.upLeft&&e.upLeft(...t)),["left","prevent"])),t[9]||(t[9]=E(((...t)=>e.upMiddle&&e.upMiddle(...t)),["middle","prevent"]))],onMousemove:t[7]||(t[7]=E(((...t)=>e.mousemove&&e.mousemove(...t)),["prevent"])),onMouseleave:t[10]||(t[10]=(...t)=>e.leave&&e.leave(...t)),onKeydown:[t[11]||(t[11]=O(E(((...t)=>e.keyDownEscape&&e.keyDownEscape(...t)),["exact","prevent"]),["escape"])),t[12]||(t[12]=O(E((t=>e.editKeyDown("g")),["exact","prevent"]),["g"])),t[13]||(t[13]=O(E((t=>e.editKeyDown("x")),["exact","prevent"]),["x"]))]},[j(e.$slots,"default",{scale:e.scale,viewOrigin:e.viewOrigin,viewSize:e.viewSize})],40,["viewBox","width","height"]))],512))));La.render=Pa,La.__scopeId="data-v-5868f1c8";var _a=h({props:{labelWidth:{type:Number,default:100},index:{type:Number,required:!0},label:{type:String,required:!0}},setup:()=>({height:24})});_a.render=function(e,t,a,n,r,l){return x(),b("g",{transform:`translate(0, ${e.index*e.height})`},[g("rect",{width:e.labelWidth,height:e.height,fill:"#fff",stroke:"black"},null,8,["width","height"]),g("text",{x:"4",y:e.height/2,"dominant-baseline":"central"},$(e.label),9,["y"])],8,["transform"])};var za=h({props:{scale:{type:Number,default:1},originX:{type:Number,default:0},viewWidth:{type:Number,default:100},currentFrame:{type:Number,default:0},endFrame:{type:Number,default:60}},emits:["down-current-frame","up-current-frame"],setup(e,{emit:t}){const a=f((()=>ft(e.scale))),n=f((()=>function(e,t){const a=Math.floor(Math.max(t,0)/20);return a-a%(2*e)}(a.value,e.originX))),r=f((()=>Math.ceil(e.viewWidth*e.scale/20))),l=f((()=>Math.floor(r.value/a.value))),o=f((()=>[...Array(l.value)].map(((e,t)=>{const r=t*a.value+n.value;return{f:r,labelSize:r%10==0?14:r%2==0?11:0,strokeWidth:r%10==0?2:1}})))),s=f((()=>20*e.currentFrame)),c=f((()=>10*Math.max(e.currentFrame.toString().length,2)+2));return{headerHeight:24,frames:o,frameWidth:20,currentFrameX:s,endFrameX:f((()=>20*e.endFrame)),currentFrameLabelWidth:c,downCurrentFrame:()=>t("down-current-frame")}}});const Ka=D("data-v-87cba9d8");L("data-v-87cba9d8");const Wa={class:"view-only"},Ua={fill:"#aaa",stroke:"none","fill-opacity":"0.5"},Va=g("g",{transform:"scale(-1, 1)"},[g("rect",{width:"200000",height:"200000"})],-1),Ga=g("rect",{width:"200000",height:"200000"},null,-1);T();const Ha=Ka(((e,t,a,n,r,l)=>(x(),b("g",null,[g("g",{transform:`scale(${e.scale})`,onMousedown:t[1]||(t[1]=E(((...t)=>e.downCurrentFrame&&e.downCurrentFrame(...t)),["left"]))},[g("rect",{x:"-100000",width:"200000",height:e.headerHeight,fill:"#fff",stroke:"#000"},null,8,["height"])],40,["transform"]),g("g",Wa,[g("g",null,[(x(!0),b(N,null,P(e.frames,(t=>(x(),b("g",{key:t,transform:`translate(${t.f*e.frameWidth}, 0)`},[g("g",{transform:`scale(${e.scale})`},[t.labelSize>0?(x(),b("text",{key:0,y:e.headerHeight-4,"font-size":t.labelSize,"dominant-baseline":"text-after-edge","text-anchor":"middle"},$(t.f),9,["y","font-size"])):F("",!0),t.strokeWidth>0?(x(),b("line",{key:1,x1:"0",y1:e.headerHeight,x2:"0",y2:"20000",stroke:"#aaa","stroke-width":t.strokeWidth},null,8,["y1","stroke-width"])):F("",!0)],8,["transform"])],8,["transform"])))),128))]),g("g",Ua,[Va,g("g",{transform:`translate(${e.endFrameX}, 0)`},[Ga],8,["transform"])]),g("g",{transform:`translate(${e.currentFrameX}, 0) scale(${e.scale})`},[g("rect",{x:-e.currentFrameLabelWidth/2,y:2,width:e.currentFrameLabelWidth,height:20,rx:"4",ry:"4",fill:"blue",stroke:"none"},null,8,["x","width"]),g("text",{y:e.headerHeight-4,"font-size":"12","dominant-baseline":"text-after-edge","text-anchor":"middle",fill:"#fff"},$(e.currentFrame),9,["y"]),g("line",{x1:"0",y1:e.headerHeight,x2:"0",y2:"20000",stroke:"blue","stroke-width":"2"},null,8,["y1"])],8,["transform"])])]))));za.render=Ha,za.__scopeId="data-v-87cba9d8";var Ra=h({props:{scale:{type:Number,default:1},keyframeMapByFrame:{type:Object,default:0},bornIds:{type:Array,default:()=>[]}},emits:[],setup(e){const t=f((()=>e.bornIds.reduce(((e,t,a)=>(e[t]=a,e)),{}))),a=f((()=>Object.keys(e.keyframeMapByFrame).reduce(((a,n)=>(a[n]=e.keyframeMapByFrame[n].filter((e=>t.value[e.bornId]>-1)).sort(((e,a)=>t.value[e.bornId]-t.value[a.bornId])),a)),{})));return{headerHeight:24,frameWidth:20,bornIndexMap:t,sortedKeyframeMapByFrame:a}}});const qa=D("data-v-e402282e");L("data-v-e402282e");const Xa={class:"view-only"},Ya={key:"all",r:"4",stroke:"#000",fill:"#fff"};T();const Ja=qa(((e,t,a,n,r,l)=>(x(),b("g",null,[g("g",Xa,[g("g",null,[(x(!0),b(N,null,P(e.sortedKeyframeMapByFrame,((t,a)=>(x(),b("g",{key:a,transform:`translate(${parseInt(a)*e.frameWidth}, 0)`},[g("g",{transform:`scale(${e.scale}) translate(0, 36)`},[t.length>0?(x(),b("circle",Ya)):F("",!0),(x(!0),b(N,null,P(t,((e,t)=>(x(),b("circle",{key:e.bornId,cy:24*(t+1),r:"4",stroke:"#000",fill:"#fff"},null,8,["cy"])))),128))],8,["transform"])],8,["transform"])))),128))])])]))));Ra.render=Ja,Ra.__scopeId="data-v-e402282e";var Qa=h({components:{SelectField:ya,TimelineCanvas:La,TimelineRow:_a,TimelineAxis:za,Keyframes:Ra},setup(){const e=tt(),t=zt(),a=S(""),n=S(""),r=S(""),l=f((()=>t.selectedAction.value)),o=f((()=>{return e=t.selectedAllBorns.value,Object.keys(e).map((t=>e[t]));var e})),s=f((()=>o.value.map((e=>e.id)))),c=f((()=>t.keyframeMapByFrame.value)),d=f((()=>t.actions.map((t=>{var a;const n=(null==(a=e.lastSelectedArmature.value)?void 0:a.id)!==t.armatureId;return{value:t.id,label:`${n?"(x)":""} ${t.name}`}}))));function i(e){var n;"move-current-frame"===a.value&&t.setCurrentFrame((n=e.x-140-20,Math.round(Math.max(n,0)/20)))}return V((()=>{var e,t;n.value=null!=(t=null==(e=l.value)?void 0:e.name)?t:""})),V((()=>{r.value=t.endFrame.value.toString()})),{actions:t.actions,selectedAllBornList:o,selectedAllBornIdList:s,keyframeMapByFrame:c,draftName:n,draftEndFrame:r,labelWidth:140,axisPadding:20,currentFrame:t.currentFrame,endFrame:t.endFrame,changeActionName:()=>{n.value&&t.updateAction({name:n.value})},changeEndFrame:()=>{const e=parseInt(r.value,10);!isNaN(e)&&e>=0?t.setEndFrame(e):r.value=t.endFrame.value.toString()},addAction:t.addAction,deleteAction:t.deleteAction,actionOptions:d,selectedActionId:f({get:()=>{var e,t;return null!=(t=null==(e=l.value)?void 0:e.id)?t:""},set:e=>t.selectAction(e)}),downCurrentFrame:function(){a.value="move-current-frame"},downLeft:function(e){i(e)},drag:i,upLeft:function(){a.value=""}}}});const Za=D("data-v-3b7d27ce");L("data-v-3b7d27ce");const en={class:"animation-panel-root"},tn={class:"top"},an={class:"select-action"},nn={class:"end-frame-field"},rn=G("End: "),ln={class:"middle"};T();const on=Za(((e,t,a,n,r,l)=>{const o=C("SelectField"),s=C("TimelineAxis"),c=C("Keyframes"),d=C("TimelineRow"),i=C("TimelineCanvas");return x(),b("div",en,[g("div",tn,[g("div",an,[g(o,{modelValue:e.selectedActionId,"onUpdate:modelValue":t[1]||(t[1]=t=>e.selectedActionId=t),options:e.actionOptions},null,8,["modelValue","options"])]),_(g("input",{"onUpdate:modelValue":t[2]||(t[2]=t=>e.draftName=t),type:"text",onChange:t[3]||(t[3]=(...t)=>e.changeActionName&&e.changeActionName(...t))},null,544),[[W,e.draftName]]),g("button",{class:"add-action",onClick:t[4]||(t[4]=(...t)=>e.addAction&&e.addAction(...t))},"+"),g("button",{class:"delete-action",onClick:t[5]||(t[5]=(...t)=>e.deleteAction&&e.deleteAction(...t))},"x"),g("label",nn,[rn,_(g("input",{"onUpdate:modelValue":t[6]||(t[6]=t=>e.draftEndFrame=t),type:"number",onChange:t[7]||(t[7]=(...t)=>e.changeEndFrame&&e.changeEndFrame(...t))},null,544),[[W,e.draftEndFrame]])])]),g("div",ln,[g(i,{onUpLeft:e.upLeft,onDrag:e.drag,onDownLeft:e.downLeft},{default:Za((({scale:t,viewOrigin:a,viewSize:n})=>[g("g",{transform:`translate(${e.labelWidth+e.axisPadding}, ${a.y})`},[g(s,{scale:t,"origin-x":a.x,"view-width":n.width,"current-frame":e.currentFrame,"end-frame":e.endFrame,onDownCurrentFrame:e.downCurrentFrame},null,8,["scale","origin-x","view-width","current-frame","end-frame","onDownCurrentFrame"]),g(c,{scale:t,"keyframe-map-by-frame":e.keyframeMapByFrame,"born-ids":e.selectedAllBornIdList},null,8,["scale","keyframe-map-by-frame","born-ids"])],8,["transform"]),g("g",{transform:`translate(${a.x}, ${a.y}) scale(${t})`},[g("g",null,[g("rect",{width:e.labelWidth,height:"10000",stroke:"none",fill:"#fff"},null,8,["width"]),g("line",{x1:e.labelWidth,y1:"0",x2:e.labelWidth,y2:"10000",stroke:"black"},null,8,["x1","x2"]),g(d,{index:1,"label-width":e.labelWidth,label:"Summary"},null,8,["label-width"]),(x(!0),b(N,null,P(e.selectedAllBornList,((t,a)=>(x(),b(d,{key:t.id,index:a+2,"label-width":e.labelWidth,label:t.name},null,8,["index","label-width","label"])))),128))])],8,["transform"])])),_:1},8,["onUpLeft","onDrag","onDownLeft"])])])}));Qa.render=on,Qa.__scopeId="data-v-3b7d27ce";const sn=v({selectedColor:"orange"});function cn(e,t,a=!1){return o(e,d(k(i(t,e),.15),Math.PI/4*(a?-1:1)))}var dn=h({props:{born:{type:Object,required:!0},parent:{type:Object,default:void 0},opacity:{type:Number,default:1},selectedState:{type:Object,default:()=>({head:!1,tail:!1})},poseMode:{type:Boolean,default:!1}},emits:["select","shift-select"],setup(e,{emit:t}){const{settings:a}={settings:sn},r=f((()=>e.born.head)),l=f((()=>e.born.tail)),o=f((()=>cn(r.value,l.value))),s=f((()=>cn(r.value,l.value,!0))),c=f((()=>e.poseMode?e.selectedState.head||e.selectedState.tail:e.selectedState.head&&e.selectedState.tail));return{transform:f((()=>le(e.born.transform))),head:r,tail:l,headPath:f((()=>oe([r.value,o.value,s.value],!0))),tailPath:f((()=>oe([l.value,o.value,s.value],!0))),fill:f((()=>c.value?a.selectedColor:"#ddd")),fillDark:f((()=>c.value?a.selectedColor:"#bbb")),fillHead:f((()=>e.selectedState.head?a.selectedColor:"")),fillTail:f((()=>e.selectedState.tail?a.selectedColor:"")),click:a=>{e.poseMode?c.value?t("select",{head:!1,tail:!1}):t("select",{head:!0,tail:!0}):t("select",a)},shiftClick:a=>{e.poseMode||a.head&&a.tail?c.value?t("shift-select",{head:!1,tail:!1}):t("shift-select",{head:!0,tail:!0}):a.head?t("shift-select",n(n({},e.selectedState),{head:!e.selectedState.head})):a.tail&&t("shift-select",n(n({},e.selectedState),{tail:!e.selectedState.tail}))}}}});const un=D("data-v-13fd028e")(((e,t,a,n,r,l)=>(x(),b("g",{stroke:"black",fill:e.fill,transform:e.transform,opacity:e.opacity},[g("g",{onClick:[t[1]||(t[1]=E((t=>e.click({head:!0,tail:!0})),["exact"])),t[2]||(t[2]=E((t=>e.shiftClick({head:!0,tail:!0})),["shift","exact"]))]},[g("path",{d:e.headPath,fill:e.fillDark},null,8,["d","fill"]),g("path",{d:e.tailPath},null,8,["d"])]),g("circle",{r:"10",cx:e.head.x,cy:e.head.y,fill:e.fillHead,onClick:[t[3]||(t[3]=E((t=>e.click({head:!0,tail:!1})),["exact"])),t[4]||(t[4]=E((t=>e.shiftClick({head:!0,tail:!1})),["shift","exact"]))]},null,8,["cx","cy","fill"]),g("circle",{r:"10",cx:e.tail.x,cy:e.tail.y,fill:e.fillTail,onClick:[t[5]||(t[5]=E((t=>e.click({head:!1,tail:!0})),["exact"])),t[6]||(t[6]=E((t=>e.shiftClick({head:!1,tail:!0})),["shift","exact"]))]},null,8,["cx","cy","fill"]),e.parent?(x(),b("line",{key:0,x1:e.parent.tail.x,y1:e.parent.tail.y,x2:e.head.x,y2:e.head.y,"stroke-dasharray":"2 2",class:"view-only"},null,8,["x1","y1","x2","y2"])):F("",!0),g("text",{x:(e.head.x+e.tail.x)/2,y:(e.head.y+e.tail.y)/2,"text-anchor":"middle",fill:"black",stroke:"none",class:"view-only"},$(e.born.name),9,["x","y"])],8,["fill","transform","opacity"]))));dn.render=un,dn.__scopeId="data-v-13fd028e";var mn=h({components:{BornElm:dn},props:{armature:{type:Object,required:!0},opacity:{type:Number,default:.8},selected:{type:Boolean,default:!1}},emits:["select","shift-select"],setup:(e,{emit:t})=>({bornMap:f((()=>ee(e.armature.borns))),transform:f((()=>le(e.armature.transform))),bornSelectedState:f((()=>e.selected?{head:!0,tail:!0}:void 0)),click:()=>t("select",!e.selected),shiftClick:()=>t("shift-select",!e.selected)})});const vn=D("data-v-e1a73d3c")(((e,t,a,n,r,l)=>{const o=C("BornElm");return x(),b("g",{stroke:"black",transform:e.transform,opacity:e.opacity},[(x(!0),b(N,null,P(e.armature.borns,(t=>(x(),b(o,{key:t.name,born:t,"selected-state":e.bornSelectedState,parent:e.bornMap[t.parentId],onSelect:e.click,onShiftSelect:e.shiftClick},null,8,["born","selected-state","parent","onSelect","onShiftSelect"])))),128))],8,["transform","opacity"])}));mn.render=vn,mn.__scopeId="data-v-e1a73d3c";var fn=h({components:{AppCanvas:na,ArmatureElm:mn,BornElm:dn,SidePanel:wa,AnimationPanel:Qa},setup(){const e=tt(),t=ea(),a=zt(),r=je(),l=f((()=>t.state.canvasMode)),o=f((()=>e.lastSelectedArmature.value)),s=f((()=>e.state.armatures.filter((t=>{var a;return t.id!==(null==(a=e.lastSelectedArmature.value)?void 0:a.id)})))),c=f((()=>{if(!o.value)return{};if("edit"===l.value)return ee(o.value.borns.map((a=>ve(a,t.getEditTransforms(a.id),e.state.selectedBorns[a.id]||[]))));{const e=xe(ee(o.value.borns.map((e=>n(n({},e),{transform:ue([a.getCurrentSelfTransforms(e.id),t.getEditTransforms(e.id)])})))));return Object.keys(e).reduce(((t,a)=>{const n=e[a];return t[a]=fe(n,[n.transform]),t}),{})}})),d=f((()=>{return"grab"===(e=t.command.value)||"extrude"===e?"grab":"rotate"===e?"rotate":"scale"===e?"scale":"";var e}));function i(e){var t;["input","textarea"].includes(null==(t=e.target)?void 0:t.tagName.toLowerCase())||e.ctrlKey&&"z"===e.key.toLowerCase()&&(e.preventDefault(),e.shiftKey?r.redo():r.undo())}return A((()=>{document.addEventListener("keydown",i)})),H((()=>{document.removeEventListener("keydown",i)})),{armatures:f((()=>e.state.armatures)),otherArmatures:s,lastSelectedArmatureId:f((()=>{var t;return null==(t=e.lastSelectedArmature.value)?void 0:t.id})),visibledBornMap:c,selectedBorns:f((()=>e.state.selectedBorns)),canvasMode:l,canvasCommand:d,mousemove(e){t.mousemove(e)},clickAny(){t.clickAny()},clickEmpty(){t.clickEmpty()},selectBorn(e,a){t.select(e,a)},shiftSelectBorn(e,a){t.shiftSelect(e,a)},selectArmature(t,a){e.selectArmature(a?t:"")},shiftSelectArmature(t,a){e.selectArmature(a?t:"")},escape(){t.cancel()},toggleCanvasMode(){e.lastSelectedArmature.value&&t.toggleCanvasMode()},ctrlToggleCanvasMode(){e.lastSelectedArmature.value&&t.ctrlToggleCanvasMode()},setEditMode(e){t.setEditMode(e)},execDelete(){t.execDelete()},selectAll(){t.selectAll()},addItem(){t.execAdd()},saveKeyframe(){a.execInsertKeyframe()}}}});const pn=D("data-v-aaea8cfe");L("data-v-aaea8cfe");const hn={class:"main"},yn={key:0},bn={key:1},gn={key:2},xn={class:"bottom"};T();const kn=pn(((e,t,a,n,r,l)=>{const o=C("ArmatureElm"),s=C("BornElm"),c=C("AppCanvas"),d=C("SidePanel"),i=C("AnimationPanel");return x(),b("div",null,[g("div",hn,[g(c,{"current-command":e.canvasCommand,class:"canvas",onMousemove:e.mousemove,onClickAny:e.clickAny,onClickEmpty:e.clickEmpty,onEscape:e.escape,onTab:e.toggleCanvasMode,onCtrlTab:e.ctrlToggleCanvasMode,onG:t[1]||(t[1]=t=>e.setEditMode("grab")),onS:t[2]||(t[2]=t=>e.setEditMode("scale")),onR:t[3]||(t[3]=t=>e.setEditMode("rotate")),onE:t[4]||(t[4]=t=>e.setEditMode("extrude")),onX:e.execDelete,onA:e.selectAll,onShiftA:e.addItem,onI:e.saveKeyframe},{default:pn((()=>["object"===e.canvasMode?(x(),b("g",yn,[(x(!0),b(N,null,P(e.armatures,(t=>(x(),b(o,{key:t.id,armature:t,selected:e.lastSelectedArmatureId===t.id,onSelect:a=>e.selectArmature(t.id,a),onShiftSelect:a=>e.shiftSelectArmature(t.id,a)},null,8,["armature","selected","onSelect","onShiftSelect"])))),128))])):F("",!0),"edit"===e.canvasMode?(x(),b("g",bn,[(x(!0),b(N,null,P(e.otherArmatures,(e=>(x(),b(o,{key:e.id,armature:e,opacity:.3},null,8,["armature","opacity"])))),128)),(x(!0),b(N,null,P(e.visibledBornMap,(t=>(x(),b(s,{key:t.id,born:t,parent:e.visibledBornMap[t.parentId],"selected-state":e.selectedBorns[t.id],onSelect:a=>e.selectBorn(t.id,a),onShiftSelect:a=>e.shiftSelectBorn(t.id,a)},null,8,["born","parent","selected-state","onSelect","onShiftSelect"])))),128))])):F("",!0),"pose"===e.canvasMode?(x(),b("g",gn,[(x(!0),b(N,null,P(e.otherArmatures,(e=>(x(),b(o,{key:e.id,armature:e,opacity:.3},null,8,["armature","opacity"])))),128)),(x(!0),b(N,null,P(e.visibledBornMap,(t=>(x(),b(s,{key:t.id,born:t,parent:e.visibledBornMap[t.parentId],"selected-state":e.selectedBorns[t.id],"pose-mode":"",onSelect:a=>e.selectBorn(t.id,a),onShiftSelect:a=>e.shiftSelectBorn(t.id,a)},null,8,["born","parent","selected-state","onSelect","onShiftSelect"])))),128))])):F("",!0)])),_:1},8,["current-command","onMousemove","onClickAny","onClickEmpty","onEscape","onTab","onCtrlTab","onX","onA","onShiftA","onI"]),g(d,{class:"side-panel"})]),g("div",xn,[g(i)])])}));fn.render=kn,fn.__scopeId="data-v-aaea8cfe",R(fn).mount("#app");
